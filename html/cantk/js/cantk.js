function browser(){}browser.init=function(){var t=navigator.userAgent,e=navigator.appVersion;browser={};browser.ie9=t.indexOf("MSIE 9.0")>=0;browser.ie10=t.indexOf("MSIE 10.0")>=0;browser.ie=t.indexOf("MSIE")>=0||t.indexOf("Trident")>=0;browser.oldIE=t.indexOf("MSIE 8.0")>=0||t.indexOf("MSIE 7.0")>=0||t.indexOf("MSIE 6.0")>=0;browser.android=t.indexOf("Android")>=0&&t.indexOf("Linux")>=0;browser.iPhone=t.indexOf("iPhone")>=0;browser.iPad=t.indexOf("iPad")>=0;browser.blackberry=t.indexOf("BlackBerry")>=0;browser.firefoxMobile=t.indexOf("Mobile")>=0&&t.indexOf("Firefox")>=0;browser.firefoxOS=t.indexOf("Mobile")>=0&&t.indexOf("Firefox")>=0&&t.indexOf("Android")<0;browser.windowPhone=t.indexOf("Windows Phone")>=0;browser.webkit=t.indexOf("WebKit")>=0;browser.weixin=t.indexOf("MicroMessenger")>=0;browser.weibo=t.indexOf("weibo")>=0;browser.qq=t.indexOf("QQ")>=0;if(browser.iPhone){var i=t.match(/iPhone; CPU iPhone OS \d+/g);if(i&&i.length){browser.iOSVersion=parseInt(i[0].match(/\d+/g)[0])}}function n(){var t=navigator.userAgent;var e=["AppleWebKit/","AppleWebKit ","AppleWebKit","MSIE ","Firefox/","Safari/","Opera ","Opera/"];for(var i=0;i<e.length;i++){var n=e[i];var r=t.indexOf(n);if(r>=0){var o=t.substr(r+n.length);var a=parseFloat(o);return a}}return 1}browser.number=n();browser.isAudioSupportLoop=true;if(browser.isIPhone&&browser.iOSVersion<6){browser.isAudioSupportLoop=false}if(browser.oldIE||browser.ie9){window.console={};window.console.log=function(t){}}browser.isMobile=browser.android||browser.iPhone||browser.blackberry||browser.windowPhone||browser.firefoxMobile;if(browser.isMobile){window.console.logStr="";window.console.logR=window.console.log;window.console.getLog=function(){return window.console.logStr};window.console.log=function(t){window.console.logStr+=t+"\n";window.console.logR(t);return}}console.log(navigator.userAgent);window.isSpecialBrowser=browser.qq||browser.weibo||browser.weixin;return};function isQQ(){return browser.qq}function isWeiBo(){return browser.weibo}function isWeiXin(){return browser.weixin}function isWebkit(){return browser.webkit}function isOldIE(){return browser.oldIE}function isIE(){return browser.ie}if(browser.oldIE){console.log("oldIE "+browser.oldIE)}function isMobile(){return browser.isMobile}function isAndroid(){return browser.android}function isIPhone(){return browser.iPhone}function isIPad(){return browser.ipad}function isWinPhone(){return browser.windowPhone}function isBlackBerry(){return browser.blackberry}function isFirefoxMobile(){return browser.firefoxMobile}function isFirefoxOS(){return browser.firefoxOS}function isPhoneGap(){return(window.cordova||window.Cordova||window.PhoneGap||window.phonegap)&&/^file:\/{3}[^\/]/i.test(window.location.href)&&/ios|iphone|ipod|ipad|android/i.test(navigator.userAgent)}function isTizen(){return window.tizen}function browserVersion(){return browser.number}browser.init();function CantkRT(){}CantkRT.init=function(t){window.onload=t};CantkRT.isNative=function(){return CantkRT.isCantkRTV8()||CantkRT.isCantkRTCordova()};CantkRT.isCantkRTV8=function(){return!!window.cantkRTV8};CantkRT.isCantkRTCordova=function(){return!!window.cantkRTCordova};CantkRT.getViewPort=function(){var t;var e;if(window.displayInfo){t=window.displayInfo.width;e=window.displayInfo.height}else if(typeof window.innerWidth!="undefined"){t=window.innerWidth;e=window.innerHeight}else if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0){t=document.documentElement.clientWidth;e=document.documentElement.clientHeight}else{t=document.getElementsByTagName("body")[0].clientWidth;e=document.getElementsByTagName("body")[0].clientHeight}return{width:t,height:e}};CantkRT.getMainCanvas=function(){var t=null;if(CantkRT.canvas){return CantkRT.canvas}t=document.getElementById("main_canvas");if(!t){t=document.createElement("canvas");t.id="main_canvas";t.style.zIndex=0;document.body.appendChild(t)}if(t.setAsMainCanvas){t.setAsMainCanvas()}if(!t.flush){t.flush=function(){}}CantkRT.canvas=t;return t};CantkRT.isResSupportCrossOrgin=function(t){return!!t};CantkRT.noneCrossOriginReg=/api\.map\.baidu\.com/;CantkRT.createImage=function(t,e,i){var n=null;n=new Image;n.onload=function(){if(e){e(n)}};n.onerror=function(t){if(t){console.log(this.src+" load error: "+t.message)}else{console.log(this.src+" load error")}if(n.crossOrigin){var e=n.src;n.crossOrigin=null;n.src=null;n.src=e;console.log("try without image.crossOrigin:"+e);return}if(i){i(n)}};if(!CantkRT.noneCrossOriginReg.test(t)&&CantkRT.isResSupportCrossOrgin(t)){n.crossOrigin="Anonymous"}n.src=t;return n};CantkRT.createImageFromCanvas=function(t,e,i){if(!t){if(i){i()}return null}if(e){e(t)}return t};window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;CantkRT.requestAnimFrame=function(t){return window.requestAnimationFrame(t)};CantkRT.createSound=function(t,e,i,n){var r=new Audio;r.setAsSoundEffect(e);r.onload=function(){if(i){i(r)}};r.onerror=function(t){if(n){n(t)}};r.src=t;return r};CantkRT.createSoundEffect=function(t,e,i){return CantkRT.createSound(t,true,e,i)};CantkRT.createSoundMusic=function(t,e,i){return CantkRT.createSound(t,false,e,i)};Object.defineProperty(Array.prototype,"remove",{enumerable:false,value:function(t,e){for(var i=0;i<this.length;++i){if(this[i]===t){this.splice(i,1);if(!e)break}}return this}});Object.defineProperty(Array.prototype,"insert",{enumerable:false,value:function(t,e){if(t>=0&&t<this.length){this.splice(t,0,e)}else{this.push(e)}return this}});Object.defineProperty(Array.prototype,"indexOf",{enumerable:false,value:function(t){var e=this.length;for(var i=0;i<e;++i){if(this[i]===t){return i}}return-1}});Object.defineProperty(Array.prototype,"find",{enumerable:false,value:function(t){var e=this.length;for(var i=0;i<e;++i){var n=this[i];if(t(n)){return n}}return null}});Object.defineProperty(Array.prototype,"binarySearch",{enumerable:false,value:function(t,e){var i=0;var n=0;var r=0;var o=this.length-1;while(n<=o){i=n+o>>1;r=e(this[i],t);if(r<0){n=i+1;continue}if(r>0){o=i-1;continue}return i}return-1}});Object.defineProperty(Array.prototype,"has",{enumerable:false,value:function(t){return this.indexOf(t)>=0}});Object.defineProperty(Array.prototype,"destroyData",{enumerable:false,value:function(){for(var t=0;t<this.length;t++){var e=this[t];if(!e||typeof e!="object"){continue}if(e.destroy&&typeof e.destroy=="function"){e.destroy()}}this.length=0;return this}});Object.defineProperty(Array.prototype,"clear",{enumerable:false,value:function(t){if(t){this.destroyData()}this.length=0;return this}});Object.defineProperty(Array.prototype,"copy",{enumerable:false,value:function(t){this.clear();for(var e=0;e<t.length;++e){var i=t[e];if(i&&i.dup){i=i.dup()}this.push(i)}return this}});function makeUniqRandArray(t,e){if(t>=e){return null}var i=[];var n=e-t+1;for(var r=0;r<n;r++){do{var o=t+Math.floor(Math.random()*n);if(!i.has(o)){i.push(o);break}}while(1)}return i}function fixRect(t){if(t.w<0){t.x=t.x+t.w;t.w=-t.w}if(t.h<0){t.y=t.y+t.h;t.h=-t.h}return t}function isPointInRect(t,e){return t.x>=e.x&&t.y>=e.y&&t.x<e.x+e.w&&t.y<e.y+e.h}function cantkAddEventListener(t,e){if(window.attachEvent){window.attachEvent(t,e)}else if(window.addEventListener){window.addEventListener(t,e)}else{document.addEventListener(t,e,true)}return}String.prototype.replaceAll=function(t,e,i){if(!RegExp.prototype.isPrototypeOf(t)){return this.replace(new RegExp(t,i?"gi":"g"),e)}else{return this.replace(t,e)}};function fixJson(t){var e=0;var i="";t=t.replaceAll("<br>","");var n=t.length;for(e=0;e<n;e++){var r=t.charAt(e);if(r==="“"||r==="”"){r='"'}i=i+r}return i}String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$|^\n+|\n+$/g,"")};String.prototype.startWith=function(t){var e=this;return e.indexOf(t)==0};String.prototype.endWith=function(t){var e=this;return e.substring(e.length-t.length,e.length)==t};String.prototype.isImageFileName=function(){var t=this.toLowerCase();return t.endWith(".png")||t.endWith(".jpg")||t.endWith("jpeg")};function drawDashedRect(t,e,i,n,r){var o=8;var a=4;t.beginPath();drawDashedLine(t,{x:e,y:i},{x:n+e,y:i},o,a);drawDashedLine(t,{x:e,y:r+i},{x:n+e,y:r+i},o,a);drawDashedLine(t,{x:e,y:i},{x:e,y:r+i},o,a);drawDashedLine(t,{x:n+e,y:i},{x:n+e,y:r+i},o,a);return}function drawDashedLine(t,e,i,n,r){if(!t||!e||!i||!n)return;var o=e.x;var a=e.y;t.moveTo(o,a);if(!r){t.lineTo(i.x,i.y);return}var s=i.x-e.x;var l=i.y-e.y;var h=Math.sqrt(s*s+l*l);var u=Math.atan(l/s);t.save();t.translate(e.x,e.y);t.rotate(u);if(i.x<e.x){t.translate(-h,0)}t.moveTo(0,0);o=0;while(o<h){o+=n;if(o>h){o=h}t.lineTo(o,0);if(o==h){break}o+=r;if(o>h){o=h}t.moveTo(o,0)}t.restore();return}var C_ARROW_NONE=0;var C_ARROW_NORMAL=1;var C_ARROW_CIRCLE=2;var C_ARROW_RECT=3;var C_ARROW_DIAMOND=4;var C_ARROW_TRI=5;var C_ARROW_FILL_CIRCLE=1<<8|C_ARROW_CIRCLE;var C_ARROW_FILL_RECT=1<<8|C_ARROW_RECT;var C_ARROW_FILL_DIAMOND=1<<8|C_ARROW_DIAMOND;var C_ARROW_FILL_TRI=1<<8|C_ARROW_TRI;function drawArrowHeaderNormal(t,e){t.translate(-e/2,0);t.moveTo(-e/2,-e/2);t.lineTo(e/2,0);t.lineTo(-e/2,e/2);t.stroke();t.beginPath();return}function drawArrowHeaderTri(t,e){t.translate(-e/2,0);t.moveTo(e/2,0);t.lineTo(-e/2,-e/2);t.lineTo(-e/2,e/2);t.lineTo(e/2,0);return}function drawArrowHeaderCircle(t,e){t.translate(-e/2,0);t.arc(0,0,e/2,Math.PI*2,0);return}function drawArrowHeaderRect(t,e){t.translate(-e/2,0);t.rect(-e/2,-e/2,e,e);return}function drawArrowHeaderRRect(t,e){t.translate(-e/2,0);t.rotate(Math.PI/4);t.rect(-e/2,-e/2,e,e);return}var arrow_draw_header=[null,drawArrowHeaderNormal,drawArrowHeaderCircle,drawArrowHeaderRect,drawArrowHeaderRRect,drawArrowHeaderTri];function drawArrow(t,e,i,n,r){var o=10;if(!t||!i||!n)return;var a=e>>8;e=e&255;if(e<=0||e>=arrow_draw_header.length){return}if(r){o=r}var s=(n.y-i.y)/(n.x-i.x);var l=Math.atan(s);if(n.x<i.x){l=l+Math.PI}var h=t.fillStyle;var u=t.strokeStyle;t.save();t.translate(n.x,n.y);t.rotate(l);t.beginPath();o=o+t.lineWidth-1;arrow_draw_header[e](t,o);t.closePath();if(a){t.fillStyle=u}else{t.fillStyle="White"}if(e>1){t.fill()}t.stroke();t.restore();t.fillStyle=h;t.strokeStyle=u;return}var gCacheCanvas=null;function CacheCanvasGet(t,e){if(!gCacheCanvas){gCacheCanvas=document.createElement("canvas");gCacheCanvas.type="backend_canvas";gCacheCanvas.width=t;gCacheCanvas.height=e}if(gCacheCanvas){if(gCacheCanvas.width<t){gCacheCanvas.width=t}if(gCacheCanvas.height<e){gCacheCanvas.height=e}}return gCacheCanvas}if(isWebkit()){drawNinePatchEx=function(t,e,i,n,r,o,a,s,l,h){var u=0;var p=0;var c=0;var f=0;var m=0;var d=0;var y=0;var g=0;if(!e){t.fillRect(a,s,l,h);return}if(!r||r>e.width){r=e.width}if(!o||o>e.height){o=e.height}if(l<r&&h<o){t.drawImage(e,i,n,r,o,a,s,l,h);return}c=Math.floor(r/3);f=Math.floor(o/3);m=r-c-c;d=o-f-f;y=l-c-c;g=h-f-f;t.drawImage(e,i,n,c,f,a,s,c,f);t.drawImage(e,i+r-c,n,c,f,a+l-c,s,c,f);t.drawImage(e,i,n+o-f,c,f,a,s+h-f,c,f);t.drawImage(e,i+r-c,n+o-f,c,f,a+l-c,s+h-f,c,f);if(y>0){t.drawImage(e,i+c,n,m,f,a+c,s,y,f);t.drawImage(e,i+c,n+o-f,m,f,a+c,s+h-f,y,f)}if(g>0){t.drawImage(e,i,n+f,c,d,a,s+f,c,g);t.drawImage(e,i+r-c,n+f,c,d,a+l-c,s+f,c,g)}if(y>0&&g>0){t.drawImage(e,i+c,n+f,m,d,a+c,s+f,y,g)}return}}else{drawNinePatchEx=function(t,e,i,n,r,o,a,s,l,h){var u=0;var p=0;var c=0;var f=0;var m=0;var d=0;var y=0;var g=0;if(!e){t.fillRect(a,s,l,h);return}if(!r||r>e.width){r=e.width}if(!o||o>e.height){o=e.height}if(l<r&&h<o){t.drawImage(e,i,n,r,o,a,s,l,h);return}c=Math.floor(r/3);f=Math.floor(o/3);m=r-c-c;d=o-f-f;y=l-c-c;g=h-f-f;t.drawImage(e,i,n,c,f,a,s,c,f);t.drawImage(e,i+r-c,n,c,f,a+l-c,s,c,f);t.drawImage(e,i,n+o-f,c,f,a,s+h-f,c,f);t.drawImage(e,i+r-c,n+o-f,c,f,a+l-c,s+h-f,c,f);if(y>0){t.drawImage(e,i+c,n,m,f,a+c-1,s,y+2,f);t.drawImage(e,i+c,n+o-f,m,f,a+c-1,s+h-f,y+2,f)}if(g>0){t.drawImage(e,i,n+f,c,d,a,s+f-.5,c,g+1);t.drawImage(e,i+r-c,n+f,c,d,a+l-c,s+f-.5,c,g+1)}if(y>0&&g>0){t.drawImage(e,i+c,n+f,m,d,a+c-1,s+f-1,y+2,g+2)}return}}function drawNinePatch(t,e,i,n,r,o){if(!e){t.fillRect(i,n,r,o);return}return drawNinePatchEx(t,e,0,0,e.width,e.height,i,n,r,o)}function drawNinePatchIcon(t,e,i,n,r,o){var a=e.getImage();var s=e.getX();var l=e.getY();var h=e.getWidth();var u=e.getHeight();if(!a){t.fillRect(i,n,r,o);return}return drawNinePatchEx(t,a,s,l,h,u,i,n,r,o)}function RoundRect(){}RoundRect.TL=1;RoundRect.TR=2;RoundRect.BL=4;RoundRect.BR=8;function drawRoundRect(t,e,i,n,r){var o=e>>1;var a=i>>1;if(e<0||i<0){return}if(!r){r=RoundRect.TL|RoundRect.TR|RoundRect.BL|RoundRect.BR}if((n>=o||n>=a)&&r===(RoundRect.TL|RoundRect.TR|RoundRect.BL|RoundRect.BR)){t.arc(o,a,Math.min(a,o),0,Math.PI*2);return}if(n){if(r&RoundRect.TL){t.arc(n,n,n,Math.PI,1.5*Math.PI,false)}else{t.moveTo(0,0)}if(r&RoundRect.TR){t.lineTo(e-n,0);t.arc(e-n,n,n,1.5*Math.PI,2*Math.PI,false)}else{t.lineTo(e,0)}if(r&RoundRect.BR){t.lineTo(e,i-n);t.arc(e-n,i-n,n,0,.5*Math.PI,false)}else{t.lineTo(e,i)}if(r&RoundRect.BL){t.lineTo(n,i);t.arc(n,i-n,n,.5*Math.PI,Math.PI,false)}else{t.lineTo(0,i)}if(r&RoundRect.TL){t.lineTo(0,n)}else{t.lineTo(0,0)}}else{t.rect(0,0,e,i)}return}function cantkGetViewPort(){return CantkRT.getViewPort()}if(!window.orgViewPort){window.orgViewPort=cantkGetViewPort()}function layoutText(t,e,i,n,r){if(n<=0||!i){return[]}var o=0;var a=0;var s=0;var l=0;var h="";var u=[];var p=i.split("\n");var c=new TextLayout(t);for(o=0;o<p.length;o++){var f=p[o];if(f){c.setText(f);while(c.hasNext()){var m=c.nextLine(n,e,r);u.push(m.text)}}else{u.push(" ")}}return u}function codeIsLetter(t){return t>=97&&t<=122||t>=65&&t<=90}function TextLayout(t){this.canvas=t;this.setText=function(t){this.str=t;this.startOffset=0;this.lineInfo={text:"",width:0};return};this.canBreakBefore=function(t){if(t===" "||t==="	"||t==="."||t==="]"||t===")"||t==="}"||t===","||t==="?"||t===";"||t===":"||t==="!"||t==='"'||t==="'"||t==="。"||t==="？"||t==="、"||t==="”"||t==="’"||t==="】"||t==="》"||t==="〉"||t==="〕"||t==="）"||t==="："||t==="；"||t==="，"){return false}return true};this.hasNext=function(){return this.startOffset<this.str.length};this.nextLine=function(e,i,n){var r=false;var o="";var a=this.str;var s=this.startOffset;var l=a.length;var h=Math.floor(e/i*.75);var u=l-this.startOffset;if(u<1){this.lineInfo.text="";this.lineInfo.width=0;return null}if(u<h){o=a.substr(this.startOffset,u);this.lineInfo.text=o;this.lineInfo.width=t.measureText(o).width;this.startOffset=this.startOffset+o.length;return this.lineInfo}if(h>3){h=h-3}o=a.substr(this.startOffset,h);var p=0;var c=null;var f=0;var m=null;var d=t.measureText(o).width;var n=n?n:Math.floor(e*.3);var y=2*i;var g=e+n;var v=e-y;for(s=this.startOffset+h;s<l;s++){c=a.charAt(s);p=a.charCodeAt(s);if(c==="	"){c=" "}o+=c;f=t.measureText(c).width;d=d+1+f;if(c=="'"){continue}if(d>g){break}if(d<v){continue}if(codeIsLetter(p)){continue}if(p==32){if(d>=e){break}var _=0;for(var I=s+1;I<l;I++){p=a.charCodeAt(I);if(codeIsLetter(p)){_++}else{break}}if(_>7){break}else{continue}}if(s+1<l){m=a.charAt(s+1);if(d>=e&&this.canBreakBefore(m)){break}}}this.lineInfo.text=o;this.lineInfo.width=t.measureText(o).width;this.startOffset=this.startOffset+o.length;return this.lineInfo};return this}function getXMLHttpRequest(){if(typeof window==="undefined"){throw new Error("no window object present")}else if(window.XMLHttpRequest){return window.XMLHttpRequest}else if(window.ActiveXObject){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];for(var e=0;e<t.length;e++){try{var i=new window.ActiveXObject(t[e]);return function(){if(i){var n=i;i=null;return n}else{return new window.ActiveXObject(t[e])}}}catch(n){}}throw new Error("ajax not supported in this browser")}else{throw new Error("ajax not supported in this browser")}}function createXMLHttpRequest(){if(!window.XMLHttpRequest){window.XMLHttpRequest=getXMLHttpRequest()}return new XMLHttpRequest}function httpDownloadFile(t,e,i){var n={};n.url=t;n.method="GET";n.responseType="blob";n.autoProxy=i;n.onDone=function(i,n,r){saveAs(r,t.basename());if(e){e(i,n,r)}};httpDoRequest(n);return}function httpDoRequest(t){var e=createXMLHttpRequest();if(!t||!t.url){return false}var i=t.url;var n=t.data;var r=t.method?t.method:"GET";var o=i.indexOf("http")===0&&i.indexOf(window.location.hostname)<0;if(o){if(t.autoProxy){i="/proxy.php?url="+window.btoa(encodeURIComponent(i));console.log("use proxy:"+i)}else{e.crossOrigin="Anonymous";if(t.withCredentials){e.withCredentials=true;console.log("cross domain info.withCredentials=true")}}}if(t.responseType){e.responseType=t.responseType}if(t.dataType){e.dataType=t.dataType}e.open(r,i,true);if(t.noCache){e.setRequestHeader("If-Modified-Since","0")}if(t.headers){for(var a in t.headers){var s=t.headers[a];e.setRequestHeader(a,s)}}if(e){if(!e.onprogress){e.onreadystatechange=function(){if(t.onProgress){t.onProgress(e)}if(e.readyState===4){if(t.onDone){if(t.responseType&&t.responseType.toLowerCase()==="blob"){t.onDone(true,e,e.response)}else{t.onDone(true,e,e.responseText)}}}return}}else{e.onprogress=function(i){var n=i.total;if(t.onProgress){t.onProgress(e)}console.log("get:"+n)};e.onload=function(i){if(t.onDone){t.onDone(true,e,i.target.responseText)}};e.onerror=function(i){if(t.onDone){t.onDone(false,e,e.responseText)}}}e.send(t.data?t.data:null)}return true}function httpGetURL(t,e,i,n){var r={};r.url=t;r.onDone=e;r.autoProxy=i;r.withCredentials=n;httpDoRequest(r);return}function httpPostURL(t,e,i,n,r){var o={};o.url=t;o.onDone=i;o.method="POST";o.data=e;o.autoProxy=n;o.withCredentials=r;httpDoRequest(o);return}function httpGetJSON(t,e,i,n){httpGetURL(t,function(i,n,r){var o=null;if(i){try{o=JSON.parse(r)}catch(a){console.log("JSON.parse failed： url="+t+" data:"+r)}}e(o)},i,n);return}function cantkRestoreViewPort(){cantkInitViewPort(1);return}function cantkSetViewPortWidth(t){var e="";var i=document.getElementsByTagName("head")[0];var n=document.querySelector("meta[name=viewport]");if(!n){n=document.createElement("meta");n.name="viewport";i.appendChild(n)}var r="width="+t+"; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;";n.setAttribute("content",r);return}function cantkInitViewPort(t){var e="";var i=document.createElement("meta");var n=document.getElementsByTagName("head")[0];if(window.devicePixelRatio&&window.devicePixelRatio>2){window.realDevicePixelRatio=window.devicePixelRatio;window.devicePixelRatio=2}var r=window.devicePixelRatio?window.devicePixelRatio:1;t=t?t:1/r;var o="initial-scale="+t+", minimum-scale="+t+", maximum-scale="+t+", user-scalable=0";if(isIPhone()){e="width=device-width, "+o}else if(isAndroid()){var a=browserVersion();if(a<537||isWeiXin()||isWeiBo()||isQQ()){window.devicePixelRatio=window.realDevicePixelRatio;e="target-densitydpi=device-dpi, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"}else{e="width=device-width, "+o}}else if(isFirefoxMobile()){var s=cantkGetViewPort();e="width="+s.width+", "+o}else{e="width=device-width, "+o}i.name="viewport";i.content=e;console.log("viewport: "+e);n.appendChild(i);return}function cantkLog(t){console.log(t);return}var gDelayScripts=new Array;function cantkDelayLoadScript(t){gDelayScripts.push(t);return}function loadDelayScriptsNow(){var t=0;var e=null;var i=null;var n=document.head?document.head:document.body;for(t=0;t<gDelayScripts.length;t++){i=gDelayScripts[t];e=document.createElement("script");e.src=i;n.appendChild(e);console.log("Load: "+i)}gDelayScripts.clear();return}function loadScriptOnce(t){var e=document.scripts;if(e){for(var i=0;i<e.length;i++){var n=e[i];if(n.src&&n.src.indexOf(t)>=0){console.log("script is loaded: "+t);return}}}var r=document.head?document.head:document.body;var o=document.createElement("script");o.src=t;r.appendChild(o);console.log("load script: "+t);return}setTimeout(function(){loadDelayScriptsNow();return},800);function delayLoadScripts(t){if(t){dappSetResHostName(t)}return}function getScriptByUrl(t){var e=document.getElementsByTagName("script");if(e){for(var i=0;i<e.length;i++){var n=e[i];var r=n.src;if(r.indexOf(t)>=0){return n}}}return null}function isScriptLoaded(t){return getScriptByUrl(t)!=null}Locales={};Locales.getLanguageName=function(){var t="";if(navigator.language){t=navigator.language}else if(navigator.userLanguage){t=navigator.userLanguage}t=t.toLowerCase();return t};function cantkGetLocale(){return Locales.getLanguageName()}var requestAnimFrame=CantkRT.requestAnimFrame;function getQueryParameter(t){var t=t+"=";var e=window.location.search.substring(1);if(e.length>0){begin=e.indexOf(t);if(begin!=-1){begin+=t.length;end=e.indexOf("&",begin);if(end==-1){end=e.length}var i=e.substring(begin,end);return decodeURI(i)}}return null}function cantkGetQueryParam(t){return getQueryParameter(t)}function getFontSizeInFont(t){var e=12;var i=t.match(/\d+px/g);if(i){e=parseInt(i[0])}else{var n=t.match(/\d+pt/g);if(n){e=parseInt(n[0])*1.5}}return e}function basename(t){return t.replace(/\\/g,"/").replace(/.*\//,"")}function dirname(t){return t.replace(/\\/g,"/").replace(/\/[^\/]*$/,"")}String.prototype.basename=function(t){var e=this.replace(/\\/g,"/").replace(/.*\//,"");if(t){var i=e.lastIndexOf(".");if(i>=0){e=e.substr(0,i)}}return e};String.prototype.extname=function(){var t="";var e=this.lastIndexOf(".");if(e>=0){t=this.substr(e+1)}return t};String.prototype.dirname=function(){return this.replace(/\\/g,"/").replace(/\/[^\/]*$/,"")};function cantkIsFullscreen(){return document.fullscreenElement||document.mozFullScreen||document.webkitIsFullScreen}function cantkRequestFullscreen(t){function e(e){if(t){t(cantkIsFullscreen())}console.log("fullscreenchange:"+cantkIsFullscreen());return true}if(cantkIsFullscreen()){e();return true}var i=document.documentElement;if(document.documentElement.requestFullscreen){i.addEventListener("fullscreenchange",e,true);return i.requestFullscreen()}else if(document.documentElement.mozRequestFullScreen){i.addEventListener("mozfullscreenchange",e,true);return i.mozRequestFullScreen()}else if(document.documentElement.webkitRequestFullScreen){i.addEventListener("webkitfullscreenchange",e,true);return i.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}return false}function saveStrToFile(t,e){function i(){return window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder}try{var n=i();var r=new n;r.append(e);saveAs(r.getBlob("text/plain;charset="+document.characterSet),t)}catch(o){var r=new Blob([e],{type:"text/plain;charset="+document.characterSet});saveAs(r,t)}return}function readLocalTextFile(t,e){function i(i){try{var n=new FileReader;n.onload=function(e){var i=e.target.result;if(t){t(i)}return};n.onerror=function(t){if(e){e(t)}return};n.readAsText(i);n=null}catch(r){if(e){e(null)}}}var n=document.createElement("input");n.type="file";n.multiple=false;n.onchange=function(t){if(this.files&&this.files.length){var e=this.files[0];if(e&&(!e.type||e.type.indexOf("text")>=0)){i(e)}else{console.log("Not text file.")}}};n.click();n=null;return}Math.distanceBetween=function(t,e){var i=e.x-t.x;var n=e.y-t.y;var r=Math.sqrt(i*i+n*n);return r};Math.lineAngle=function(t,e){var i=e.x-t.x;var n=e.y-t.y;var r=Math.sqrt(i*i+n*n);if(i==0&&n==0){return 0}if(i==0){if(n<0){return 1.5*Math.PI}else{return.5*Math.PI}}if(n==0){if(i<0){return Math.PI}else{return 0}}if(i>0){if(n>0){return Math.asin(n/r)}else{return 2*Math.PI-Math.asin(Math.abs(n)/r)}}else{if(n>0){return Math.PI-Math.asin(Math.abs(n)/r)}else{return Math.PI+Math.asin(Math.abs(n)/r)}}};Math.translatePoint=function(t,e,i){var n=t.x;var r=t.y;if(e<.5*Math.PI){n=n+i*Math.cos(e);r=r+i*Math.sin(e)}else if(e<Math.PI){var o=Math.PI-e;n=n-i*Math.cos(o);r=r+i*Math.sin(o)}else if(e<1.5*Math.PI){var o=e-Math.PI;n=n-i*Math.cos(o);r=r-i*Math.sin(o)}else{var o=2*Math.PI-e;n=n+i*Math.cos(o);r=r-i*Math.sin(o)}return{x:n,y:r}};Math.rotatePoint=function(t,e){var i={};i.x=t.x*Math.cos(e)+t.y*Math.sin(e);i.y=t.y*Math.cos(e)-t.x*Math.sin(e);return i};function dataURLToBlob(t){var e=";base64,";if(t.indexOf(e)==-1){var i=t.split(",");var n=i[0].split(":")[1];var r=decodeURIComponent(i[1]);return new Blob([r],{type:n})}var i=t.split(e);var n=i[0].split(":")[1];var r=window.atob(i[1]);var o=r.length;var a=new Uint8Array(o);for(var s=0;s<o;++s){a[s]=r.charCodeAt(s)}return new Blob([a],{type:n})}window.makeUniqRandArray=makeUniqRandArray;window.cantkGetQueryParam=cantkGetQueryParam;function isWebAudioSupported(){return typeof AudioContext!=="undefined"||typeof webkitAudioContext!=="undefined"}window.sendStatistics=function(t){window.magicData=t;return};window.setStatisticsData=function(t){window.magicData=t;return}(function(t){"use strict";function e(t,e){var i=(t&65535)+(e&65535),n=(t>>16)+(e>>16)+(i>>16);return n<<16|i&65535}function i(t,e){return t<<e|t>>>32-e}function n(t,n,r,o,a,s){return e(i(e(e(n,t),e(o,s)),a),r)}function r(t,e,i,r,o,a,s){return n(e&i|~e&r,t,e,o,a,s)}function o(t,e,i,r,o,a,s){return n(e&r|i&~r,t,e,o,a,s)}function a(t,e,i,r,o,a,s){return n(e^i^r,t,e,o,a,s)}function s(t,e,i,r,o,a,s){return n(i^(e|~r),t,e,o,a,s)}function l(t,i){t[i>>5]|=128<<i%32;t[(i+64>>>9<<4)+14]=i;var n,l,h,u,p,c=1732584193,f=-271733879,m=-1732584194,d=271733878;for(n=0;n<t.length;n+=16){l=c;h=f;u=m;p=d;c=r(c,f,m,d,t[n],7,-680876936);d=r(d,c,f,m,t[n+1],12,-389564586);m=r(m,d,c,f,t[n+2],17,606105819);f=r(f,m,d,c,t[n+3],22,-1044525330);c=r(c,f,m,d,t[n+4],7,-176418897);d=r(d,c,f,m,t[n+5],12,1200080426);m=r(m,d,c,f,t[n+6],17,-1473231341);f=r(f,m,d,c,t[n+7],22,-45705983);c=r(c,f,m,d,t[n+8],7,1770035416);d=r(d,c,f,m,t[n+9],12,-1958414417);m=r(m,d,c,f,t[n+10],17,-42063);f=r(f,m,d,c,t[n+11],22,-1990404162);c=r(c,f,m,d,t[n+12],7,1804603682);d=r(d,c,f,m,t[n+13],12,-40341101);m=r(m,d,c,f,t[n+14],17,-1502002290);f=r(f,m,d,c,t[n+15],22,1236535329);c=o(c,f,m,d,t[n+1],5,-165796510);d=o(d,c,f,m,t[n+6],9,-1069501632);m=o(m,d,c,f,t[n+11],14,643717713);f=o(f,m,d,c,t[n],20,-373897302);c=o(c,f,m,d,t[n+5],5,-701558691);d=o(d,c,f,m,t[n+10],9,38016083);m=o(m,d,c,f,t[n+15],14,-660478335);f=o(f,m,d,c,t[n+4],20,-405537848);c=o(c,f,m,d,t[n+9],5,568446438);d=o(d,c,f,m,t[n+14],9,-1019803690);m=o(m,d,c,f,t[n+3],14,-187363961);f=o(f,m,d,c,t[n+8],20,1163531501);c=o(c,f,m,d,t[n+13],5,-1444681467);d=o(d,c,f,m,t[n+2],9,-51403784);m=o(m,d,c,f,t[n+7],14,1735328473);f=o(f,m,d,c,t[n+12],20,-1926607734);c=a(c,f,m,d,t[n+5],4,-378558);d=a(d,c,f,m,t[n+8],11,-2022574463);m=a(m,d,c,f,t[n+11],16,1839030562);f=a(f,m,d,c,t[n+14],23,-35309556);c=a(c,f,m,d,t[n+1],4,-1530992060);d=a(d,c,f,m,t[n+4],11,1272893353);m=a(m,d,c,f,t[n+7],16,-155497632);f=a(f,m,d,c,t[n+10],23,-1094730640);c=a(c,f,m,d,t[n+13],4,681279174);d=a(d,c,f,m,t[n],11,-358537222);m=a(m,d,c,f,t[n+3],16,-722521979);f=a(f,m,d,c,t[n+6],23,76029189);c=a(c,f,m,d,t[n+9],4,-640364487);d=a(d,c,f,m,t[n+12],11,-421815835);m=a(m,d,c,f,t[n+15],16,530742520);f=a(f,m,d,c,t[n+2],23,-995338651);c=s(c,f,m,d,t[n],6,-198630844);d=s(d,c,f,m,t[n+7],10,1126891415);m=s(m,d,c,f,t[n+14],15,-1416354905);f=s(f,m,d,c,t[n+5],21,-57434055);c=s(c,f,m,d,t[n+12],6,1700485571);d=s(d,c,f,m,t[n+3],10,-1894986606);m=s(m,d,c,f,t[n+10],15,-1051523);f=s(f,m,d,c,t[n+1],21,-2054922799);c=s(c,f,m,d,t[n+8],6,1873313359);d=s(d,c,f,m,t[n+15],10,-30611744);m=s(m,d,c,f,t[n+6],15,-1560198380);f=s(f,m,d,c,t[n+13],21,1309151649);c=s(c,f,m,d,t[n+4],6,-145523070);d=s(d,c,f,m,t[n+11],10,-1120210379);m=s(m,d,c,f,t[n+2],15,718787259);f=s(f,m,d,c,t[n+9],21,-343485551);c=e(c,l);f=e(f,h);m=e(m,u);d=e(d,p)}return[c,f,m,d]}function h(t){var e,i="";for(e=0;e<t.length*32;e+=8){i+=String.fromCharCode(t[e>>5]>>>e%32&255)}return i}function u(t){var e,i=[];i[(t.length>>2)-1]=undefined;for(e=0;e<i.length;e+=1){i[e]=0}for(e=0;e<t.length*8;e+=8){i[e>>5]|=(t.charCodeAt(e/8)&255)<<e%32}return i}function p(t){return h(l(u(t),t.length*8))}function c(t,e){var i,n=u(t),r=[],o=[],a;r[15]=o[15]=undefined;if(n.length>16){n=l(n,t.length*8)}for(i=0;i<16;i+=1){r[i]=n[i]^909522486;o[i]=n[i]^1549556828}a=l(r.concat(u(e)),512+e.length*8);return h(l(o.concat(a),512+128))}function f(t){var e="0123456789abcdef",i="",n,r;for(r=0;r<t.length;r+=1){n=t.charCodeAt(r);i+=e.charAt(n>>>4&15)+e.charAt(n&15)}return i}function m(t){return unescape(encodeURIComponent(t))}function d(t){return p(m(t))}function y(t){return f(d(t))}function g(t,e){return c(m(t),m(e))}function v(t,e){return f(g(t,e))}function _(t,e,i){if(!e){if(!i){return y(t)}return d(t)}if(!i){return v(e,t)}return g(e,t)}if(typeof define==="function"&&define.amd){define(function(){return _})}else{t.md5=_}window.md5=_;window.sum=_}(this));function showFileDialog(t,e,i,n){var r=document.createElement("input");var o=document.getElementById("defform");if(!o){o=document.createElement("form");o.id="defform";document.body.appendChild(o)}o.appendChild(r);r.type="file";r.accept=t;r.multiple=e;r.capture=i;r.onchange=function(t){if(n){n(this.files)}o.removeChild(r)};r.click()}window.Promise=window.Promise||function(t){function e(t){if(typeof t!=="function"){throw new TypeError("func must a function")}this.state=e.STATE_UNFULFILLED;this.outcome=void 0;this.queue=[];if(t!==i){e.resolveThenable(this,t)}}e.STATE_RESOLVE="resolve";e.STATE_REJECT="reject";e.STATE_UNFULFILLED="unfulfilled";function i(){}e.resolveThenable=function(t,i){var n=false;function r(i){if(!n){n=true;e.doResolve(t,i)}}function o(i){if(!n){n=true;e.doReject(t,i)}}function a(){i(r,o)}var s=e.safeCall(a);if(s.state==="error"){o(s.value)}};e.getThen=function(t){var e=t&&t.then;return typeof t==="object"&&typeof e==="function"&&function(){e.apply(t,arguments)}};e.safeCall=function(t,e){var i={};try{i.value=t(e);i.state="success"}catch(n){i.value=n;i.state="error"}return i};e.doResolve=function(t,i){var n=e.safeCall(e.getThen,i);if(n.state==="error"){return e.doReject(t,n.value)}if(n.value){e.resolveThenable(t,n.value)}else{t.state=e.STATE_RESOLVE;t.outcome=i;t.queue.forEach(function(t){if(typeof t.onResolve==="function"){e.callNextTick(t.promise,t.onResolve,i)}else{e.doResolve(t.promise,i)}})}return t};e.doReject=function(t,i){t.state=e.STATE_REJECT;t.outcome=i;t.queue.forEach(function(t){if(typeof t.onReject==="function"){e.callNextTick(t.promise,t.onReject,i)}else{e.doReject(t.promise,i)}});return t};e.callNextTick=function(t,i,n){setTimeout(function(){var r;try{r=i(n)}catch(o){return e.doReject(t,o)}if(r===t){e.doReject(t,new TypeError("Cannot resolve promise with itself"))}else{e.doResolve(t,r)}},0)};e.prototype.then=function(t,n){if(typeof t!=="function"&&this.state===e.STATE_RESOLVE||typeof n!=="function"&&this.state===e.STATE_REJECT){return this}var r=new this.constructor(i);if(this.state!==e.STATE_UNFULFILLED){var o=this.state===e.STATE_REJECT?n:t;e.callNextTick(r,o,this.outcome)}else{this.queue.push({promise:r,onResolve:t,onReject:n})}return r};e.prototype.catch=function(t){return this.then(null,t)};e.resolve=function(t){if(t instanceof this){return t}var n=new this(i);return e.doResolve(n,t)};e.reject=function(t){var n=new this(i);return e.doReject(n,t)};e.optimizeThumb=function(t){return function(n){if(!Array.isArray(n)){return e.reject(new TypeError("iterable must be array"))}if(!n.length){return e.resolve([])}var r=new e(i);t(r,n);return r}};e.all=e.optimizeThumb(function(t,i){var n=[],r=false,o=i.length;for(var a=0;a<o;a++){var s=i[a];e.resolve(s).then(function(i){n.push(i);if(!r&&n.length===o){r=true;e.doResolve(t,n)}},function(i){if(!r){r=true;e.doReject(t,i)}})}});e.race=e.optimizeThumb(function(t,i){var n=false;for(var r=0;r<i.length;r++){var o=i[r];e.resolve(o).then(function(i){if(!n){n=true;e.doResolve(t,i)}},function(i){if(!n){n=true;e.doReject(t,i)}})}});return e}(this);window.Deferred=window.Deferred||function(t){var e=t.Promise;function i(){if(!(this instanceof i)){return new i}var t=this;this.promise=new e(function(e,i){t.reject=i;t.resolve=e})}i.prototype.makeResolver=function(){var t=this;return function(e,i){if(e){t.reject(e)}else if(arguments.length>2){t.resolve(Array.prototype.slice.call(arguments,1))}else{t.resolve(i)}}};return i}(this);void function(t){var e=function(t){return t===true||t===false||Object.prototype.toString.call(t)==="[Object Boolean]";
};t.unique=function(t,i,n,r){if(!e(i)){r=n;n=i;i=false}var o=[],a=[];for(var s=0;s<t.length;s++){var l=t[s],h=n?n.call(r,l,s,t):l;if(i){if(!s||a!==h){o.push(h)}a=h}else if(n){if(a.indexOf(h)===-1){a.push(h);o.push(l)}}else if(o.indexOf(l)===-1){o.push(l)}}return o}}(this);function Rect(t,e,i,n){this.x=t;this.y=e;this.w=i;this.h=n;return this}Rect.prototype.clone=Rect.prototype.dup=function(){return new Rect(this.x,this.y,this.w,this.h)};function Point(t,e){this.x=t;this.y=e;return this}Point.prototype.dup=function(){return new Point(this.x,this.y)};Point.prototype.copy=function(t){this.x=t.x;this.y=t.y;return};function pointEqual(t,e){return t.x===e.x&&t.y===e.y}Rect.intersection=function(t,e){var i=Math.max(t.x,e.x);var n=Math.min(t.x+t.w,e.x+e.w);if(i<=n){var r=Math.max(t.y,e.y);var o=Math.min(t.y+t.h,e.y+e.h);if(r<=o){return new Rect(i,r,n-i,o-r)}}return null};Rect.hasIntersection=function(t,e){var i=Math.max(t.x,e.x);var n=Math.min(t.x+t.w,e.x+e.w);if(i<=n){var r=Math.max(t.y,e.y);var o=Math.min(t.y+t.h,e.y+e.h);if(r<=o){return true}}return false};Rect.difference=function(t,e){var i=Rect.intersection(t,e);if(!i||!i.h||!i.w){return[t.clone()]}var n=[];var r=t.y;var o=t.h;var a=t.x+t.w;var s=t.y+t.h;var l=e.x+e.w;var h=e.y+e.h;if(e.y>t.y){n.push(new Rect(t.x,t.y,t.w,e.y-t.y));r=e.y;o-=e.y-t.y}if(h<s){n.push(new Rect(t.x,h,t.w,s-h));o=h-r}if(e.x>t.x){n.push(new Rect(t.x,r,e.x-t.x,o))}if(l<a){n.push(new Rect(l,r,a-l,o))}return n};Rect.subtract2=function(t,e,i){var n=[];var r=Rect.difference(t,e);for(var o=0;o<r.length;o++){var a=Rect.difference(r[o],i);n=n.concat(a)}return n};if(typeof KeyEvent==="undefined"){var KeyEvent={DOM_VK_CANCEL:3,DOM_VK_HELP:6,DOM_VK_BACK_SPACE:8,DOM_VK_TAB:9,DOM_VK_CLEAR:12,DOM_VK_RETURN:13,DOM_VK_ENTER:14,DOM_VK_SHIFT:16,DOM_VK_CONTROL:17,DOM_VK_ALT:18,DOM_VK_PAUSE:19,DOM_VK_CAPS_LOCK:20,DOM_VK_ESCAPE:27,DOM_VK_SPACE:32,DOM_VK_PAGE_UP:33,DOM_VK_PAGE_DOWN:34,DOM_VK_END:35,DOM_VK_HOME:36,DOM_VK_LEFT:37,DOM_VK_UP:38,DOM_VK_RIGHT:39,DOM_VK_DOWN:40,DOM_VK_PRINTSCREEN:44,DOM_VK_INSERT:45,DOM_VK_DELETE:46,DOM_VK_0:48,DOM_VK_1:49,DOM_VK_2:50,DOM_VK_3:51,DOM_VK_4:52,DOM_VK_5:53,DOM_VK_6:54,DOM_VK_7:55,DOM_VK_8:56,DOM_VK_9:57,DOM_VK_SEMICOLON:59,DOM_VK_EQUALS:61,DOM_VK_A:65,DOM_VK_B:66,DOM_VK_C:67,DOM_VK_D:68,DOM_VK_E:69,DOM_VK_F:70,DOM_VK_G:71,DOM_VK_H:72,DOM_VK_I:73,DOM_VK_J:74,DOM_VK_K:75,DOM_VK_L:76,DOM_VK_M:77,DOM_VK_N:78,DOM_VK_O:79,DOM_VK_P:80,DOM_VK_Q:81,DOM_VK_R:82,DOM_VK_S:83,DOM_VK_T:84,DOM_VK_U:85,DOM_VK_V:86,DOM_VK_W:87,DOM_VK_X:88,DOM_VK_Y:89,DOM_VK_Z:90,DOM_VK_CONTEXT_MENU:93,DOM_VK_NUMPAD0:96,DOM_VK_NUMPAD1:97,DOM_VK_NUMPAD2:98,DOM_VK_NUMPAD3:99,DOM_VK_NUMPAD4:100,DOM_VK_NUMPAD5:101,DOM_VK_NUMPAD6:102,DOM_VK_NUMPAD7:103,DOM_VK_NUMPAD8:104,DOM_VK_NUMPAD9:105,DOM_VK_MULTIPLY:106,DOM_VK_ADD:107,DOM_VK_SEPARATOR:108,DOM_VK_SUBTRACT:109,DOM_VK_DECIMAL:110,DOM_VK_DIVIDE:111,DOM_VK_BACK_BUTTON:115,DOM_VK_MENU_BUTTON:118,DOM_VK_SEARCH_BUTTON:120,DOM_VK_F1:112,DOM_VK_F2:113,DOM_VK_F3:114,DOM_VK_F4:115,DOM_VK_F5:116,DOM_VK_F6:117,DOM_VK_F7:118,DOM_VK_F8:119,DOM_VK_F9:120,DOM_VK_F10:121,DOM_VK_F11:122,DOM_VK_F12:123,DOM_VK_F13:124,DOM_VK_F14:125,DOM_VK_F15:126,DOM_VK_F16:127,DOM_VK_F17:128,DOM_VK_F18:129,DOM_VK_F19:130,DOM_VK_F20:131,DOM_VK_F21:132,DOM_VK_F22:133,DOM_VK_F23:134,DOM_VK_F24:135,DOM_VK_NUM_LOCK:144,DOM_VK_SCROLL_LOCK:145,DOM_VK_COMMA:188,DOM_VK_PERIOD:190,DOM_VK_SLASH:191,DOM_VK_BACK_QUOTE:192,DOM_VK_OPEN_BRACKET:219,DOM_VK_BACK_SLASH:220,DOM_VK_CLOSE_BRACKET:221,DOM_VK_QUOTE:222,DOM_VK_META:224}}KeyEvent.DOM_VK_BACK=225;var C_EVT_POINTER_DOWN=1;var C_EVT_POINTER_MOVE=0;var C_EVT_POINTER_UP=-1;var C_EVT_KEY_DOWN=2;var C_EVT_KEY_UP=3;var C_EVT_DOUBLE_CLICK=4;var C_EVT_CONTEXT_MENU=5;var C_EVT_LONG_PRESS=6;var C_EVT_SCALE=7;var gCancelDefaultAction=false;function canvasAttachManager(t,e,i){if(window.cantkRTV8){window.pointer.emitPointers(t)}else if(!t.isNative){window.pointer.emitPointers(t)}function n(t){return t?t:window.event}function r(t){t=n(t);var i=t.keyCode;if(i===KeyEvent.DOM_VK_F5||i===KeyEvent.DOM_VK_F12||i===KeyEvent.DOM_VK_F11){return true}if(targetIsEditor(t)){return true}if(!e.preprocessEvent(C_EVT_KEY_DOWN,t,i)){return true}e.onKeyDown(i);if(i===KeyEvent.DOM_VK_F8){var r={scale:1,rotation:0};r.isStart=true;e.onGesture(r);r.isStart=false;r.isChange=true;e.onGesture(r);r.isChange=false;r.isEnd=true;e.onGesture(r)}return returnDefaultAction(t)}function o(t){t=n(t);var i=t.keyCode;if(i===KeyEvent.DOM_VK_F5||i===KeyEvent.DOM_VK_F12||i===KeyEvent.DOM_VK_F11){return true}if(targetIsEditor(t)){return true}if(!e.preprocessEvent(C_EVT_KEY_UP,t,i)){return true}e.onKeyUp(i);return returnDefaultAction(t)}if(isTizen()){document.addEventListener("tizenhwkey",function(t){if(t.keyName=="back"){e.onKeyDown(KeyEvent.DOM_VK_BACK_BUTTON);e.onKeyUp(KeyEvent.DOM_VK_BACK_BUTTON);console.log("tizenhwkey back button.")}else if(t.keyName=="menu"){e.onKeyDown(KeyEvent.DOM_VK_MENU_BUTTON);e.onKeyUp(KeyEvent.DOM_VK_MENU_BUTTON);console.log("tizenhwkey menu button.")}})}else if(isPhoneGap()){function a(){e.onKeyDown(KeyEvent.DOM_VK_BACK_BUTTON);e.onKeyUp(KeyEvent.DOM_VK_BACK_BUTTON);return true}function s(){e.onKeyDown(KeyEvent.DOM_VK_MENU_BUTTON);e.onKeyUp(KeyEvent.DOM_VK_MENU_BUTTON);return true}function l(){e.onKeyDown(KeyEvent.DOM_VK_SEARCH_BUTTON);e.onKeyUp(KeyEvent.DOM_VK_SEARCH_BUTTON);return true}document.addEventListener("backbutton",a,false);document.addEventListener("menubutton",s,false);document.addEventListener("searchbutton",l,false)}else if(!isMobile()){cantkAddEventListener("keyup",o);cantkAddEventListener("keydown",r);function h(t){t=window.event||t;if(EditorElement.imeOpen)return true;if(t&&t.target&&t.target.localName!=="canvas"){return cancelDefaultAction(t)}var i=t.wheelDelta?t.wheelDelta:0;if(i){if(e.onWheel(i)){return cancelDefaultAction(t)}}return true}cantkAddEventListener("mousewheel",h);cantkAddEventListener("DOMMouseScroll",h)}function u(t){var e=Math.max(t.pageX,t.x);var i=Math.max(t.pageY,t.y);return{x:e,y:i}}function p(t){return t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches.length>1}function c(){var t={};t.x=e.lastPointerPoint.x;t.y=e.lastPointerPoint.y;return t}function f(t){var i=t.getPointerList();if(p(t)){console.log("onPointerDown Multi touch.");return cancelDefaultAction(t)}if(isRightMouseEvent(t.originalEvent)){console.log("Right button.");return cancelDefaultAction(t)}var n=i[0];var r=u(n);var o=n.identifier||0;if(e.preprocessEvent(C_EVT_POINTER_DOWN,t,r)){e.onPointerDown(r)}return cancelDefaultAction(t)}function m(t){var i=t.getPointerList();if(p(t)){console.log("onPointerMove Multi touch.");return cancelDefaultAction(t)}if(isRightMouseEvent(t.originalEvent)){console.log("Right button.");return cancelDefaultAction(t)}var n=i[0];var r=u(n);if(e.preprocessEvent(C_EVT_POINTER_MOVE,t,r)){e.onPointerMove(r)}return cancelDefaultAction(t)}function d(t){if(p(t)){console.log("onPointerUp Multi touch.");return cancelDefaultAction(t)}var i=c();if(isRightMouseEvent(t.originalEvent)){console.log("Right mouse up");if(e.preprocessEvent(C_EVT_CONTEXT_MENU,t,i)){e.onContextMenu(i)}return true}else{if(e.preprocessEvent(C_EVT_POINTER_UP,t,i)){e.onPointerUp(i)}}return cancelDefaultAction(t)}t.addEventListener("pointerdown",f,false);t.addEventListener("pointermove",m,false);t.addEventListener("pointerup",d,false);function y(t){var i=t.scale;var n={scale:i,rotation:0};n.isChange=false;n.isStart=t.scaleStart;n.isEnd=t.scaleEnd;if(n.isStart){console.log("scaleStart")}if(n.isEnd){console.log("scaleEnd")}e.onGesture(n);console.log("onGestureScale:"+i);return}function g(t){var i={};i.x=e.lastPointerPoint.x;i.y=e.lastPointerPoint.y;e.onLongPress(i);console.log("onGestureLongPress");return cancelDefaultAction(t)}function v(t){var i=c();e.onDoubleClick(i);console.log("onGestureDoubleTap");return cancelDefaultAction(t)}if(i.type==AppBase.TYPE_WEBAPP||i.type==AppBase.TYPE_PREVIEW){document.oncontextmenu=function(t){var i=t.target;if(i&&i.tagName==="CANVAS"){var n={};n.x=t.x+getScrollLeft();n.y=t.y+getScrollTop();e.onPointerDown(n);e.onLongPress(n);e.onPointerUp(n);console.log("onGestureLongPress");return cancelDefaultAction(t)}else{return true}}}t.addEventListener("gesturedoubletap",v);t.addEventListener("gesturelongpress",g);t.addEventListener("gesturescale",y);var _=cantkGetViewPort();var I=screen.height;function w(){}function x(){}function S(){var t=cantkGetViewPort();if(_.width!=t.width||_.height!=t.height){if(_.width===t.width){if(_.height<t.height){x()}else{w()}return}i.onSizeChanged();_=t}}window.onresize=function(t){setTimeout(S,50);return};var T=window.orientation;function C(){if(T!==window.orientation){i.onSizeChanged();T=window.orientation}}window.onorientationchange=function(t){setTimeout(C,50);return};document.ontouchend=function(t){return true};return}function cancelDefaultAction(t){var e=t?t:window.event;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}return false}function filterResults(t,e,i){var n=t?t:0;if(e&&(!n||n>e))n=e;return i&&(!n||n>i)?i:n}function getScrollLeft(){return filterResults(window.pageXOffset?window.pageXOffset:0,document.documentElement?document.documentElement.scrollLeft:0,document.body?document.body.scrollLeft:0)}function getScrollTop(){return filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}function isRightMouseEvent(t){var e=false;if(t.which===null){e=t.button>2&&t.button!==4}else{e=t.which>2&&t.which!==2}return e}function setCancelDefaultAction(t){gCancelDefaultAction=t;return}function returnDefaultAction(t){return gCancelDefaultAction?cancelDefaultAction(t):true}function targetIsEditor(t){var e=t.srcElement?t.srcElement:t.target;var i=e.localName?e.localName:e.tagName;i=i.toLowerCase();if(i!="body"&&i!="canvas"){return true}return false}function targetIsCanvas(t){var e=t.srcElement?t.srcElement:t.target;var i=e.localName?e.localName:e.tagName;i=i.toLowerCase();if(i==="canvas"){return true}return false}window.Modernizr=function(t,e,i){var n="2.5.3",r={},o=e.documentElement,a="modernizr",s=e.createElement(a),l=s.style,h,u={}.toString,p=" -webkit- -moz- -o- -ms- ".split(" "),c={},f={},m={},d=[],y=d.slice,g,v=function(t,i,n,r){var s,l,h,u=e.createElement("div"),p=e.body,c=p?p:e.createElement("body");if(parseInt(n,10)){while(n--){h=e.createElement("div");h.id=r?r[n]:a+(n+1);u.appendChild(h)}}s=["&#173;","<style>",t,"</style>"].join("");u.id=a;(p?u:c).innerHTML+=s;c.appendChild(u);if(!p){c.style.background="";o.appendChild(c)}l=i(u,t);!p?c.parentNode.removeChild(c):u.parentNode.removeChild(u);return!!l},_={}.hasOwnProperty,I;if(!S(_,"undefined")&&!S(_.call,"undefined")){I=function(t,e){return _.call(t,e)}}else{I=function(t,e){return e in t&&S(t.constructor.prototype[e],"undefined")}}if(!Function.prototype.bind){Function.prototype.bind=function E(t){var e=this;if(typeof e!="function"){throw new TypeError}var i=y.call(arguments,1),n=function(){if(this instanceof n){var r=function(){};r.prototype=e.prototype;var o=new r;var a=e.apply(o,i.concat(y.call(arguments)));if(Object(a)===a){return a}return o}else{return e.apply(t,i.concat(y.call(arguments)))}};return n}}function w(t){l.cssText=t}function x(t,e){return w(p.join(t+";")+(e||""))}function S(t,e){return typeof t===e}function T(t,e){return!!~(""+t).indexOf(e)}function C(t,e,n){for(var r in t){var o=e[t[r]];if(o!==i){if(n===false)return t[r];if(S(o,"function")){return o.bind(n||e)}return o}}return false}var b=function(i,n){var o=i.join(""),a=n.length;v(o,function(i,n){var o=e.styleSheets[e.styleSheets.length-1],s=o?o.cssRules&&o.cssRules[0]?o.cssRules[0].cssText:o.cssText||"":"",l=i.childNodes,h={};while(a--){h[l[a].id]=l[a]}r["touch"]="ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch||(h["touch"]&&h["touch"].offsetTop)===9},a,n)}([,["@media (",p.join("touch-enabled),("),a,")","{#touch{top:9px;position:absolute}}"].join("")],[,"touch"]);c["touch"]=function(){return r["touch"]};for(var D in c){if(I(c,D)){g=D.toLowerCase();r[g]=c[D]();d.push((r[g]?"":"no-")+g)}}w("");s=h=null;r._version=n;r._prefixes=p;r.testStyles=v;return r}(this,this.document);(function(t){var e=1;function i(t,e,i){this.screenX=i.screenX||0;this.screenY=i.screenY||0;this.pageX=i.pageX||0;this.pageY=i.pageY||0;this.x=i.x||0;this.y=i.y||0;this.clientX=i.clientX||0;this.clientY=i.clientY||0;this.tiltX=i.tiltX||0;this.tiltY=i.tiltY||0;this.pressure=i.pressure||0;this.hwTimestamp=i.hwTimestamp||0;this.pointerType=e;this.identifier=t}var n={TOUCH:"touch",MOUSE:"mouse",PEN:"pen"};function r(t){t.target.mouseEvent=t}function o(t){t.target.mouseEvent=null}function a(t){t.target.touchList=t.targetTouches}function s(){var t=[];var r;if(this.touchList){for(var o=0;o<this.touchList.length;o++){var a=this.touchList[o];r=new i(a.identifier+2,n.TOUCH,a);t.push(r)}}else if(this.msPointerList){for(var s in this.msPointerList){if(!this.msPointerList.hasOwnProperty(s))continue;r=this.msPointerList[s];r=new i(s,r.textPointerType,r);t.push(r)}}if(this.mouseEvent){t.push(new i(e,n.MOUSE,this.mouseEvent))}return t}function l(t,e,i){var n={};for(var r in i){n[r]=i[r]}n.type=t;n.target=e;if(e.dispatchCustomEvent){e.dispatchCustomEvent(n)}else{e.dispatchEvent(n)}}function h(t){t.preventDefault();r(t);var e={pointerType:"mouse",getPointerList:s.bind(this),originalEvent:t};l("pointerdown",t.target,e)}function u(t){t.preventDefault();r(t);var e={pointerType:"mouse",getPointerList:s.bind(this),originalEvent:t};l("pointermove",t.target,e)}function p(t){t.preventDefault();r(t);var e={pointerType:"mouse",getPointerList:s.bind(this),originalEvent:t};l("pointerup",t.target,e)}function c(t){t.preventDefault();a(t);var e={pointerType:"touch",getPointerList:s.bind(this),originalEvent:t};l("pointerdown",t.target,e)}function f(t){t.preventDefault();a(t);var e={pointerType:"touch",getPointerList:s.bind(this),originalEvent:t};l("pointermove",t.target,e)}function m(t){t.preventDefault();a(t);var e={pointerType:"touch",getPointerList:s.bind(this),originalEvent:t};l("pointerup",t.target,e)}function d(t){if(t.target.mouseEvent){t.preventDefault();var e={pointerType:"mouse",getPointerList:s.bind(this),originalEvent:t};l("pointerup",t.target,e)}}function y(t){if(t.pointerType==2){t.textPointerType=n.TOUCH}else if(t.pointerType==3){t.textPointerType=n.PEN}else if(t.pointerType==4){t.textPointerType=n.MOUSE}if(t.textPointerType==n.MOUSE){t.target.msMouseDown=true}if(!t.target.msPointerList)t.target.msPointerList={};t.target.msPointerList[t.pointerId]=t;var e={pointerType:t.textPointerType,getPointerList:s.bind(this),originalEvent:t};l("pointerdown",t.target,e)}function g(t){if(t.pointerType==2){t.textPointerType=n.TOUCH}else if(t.pointerType==3){t.textPointerType=n.PEN}else if(t.pointerType==4){t.textPointerType=n.MOUSE}if(t.textPointerType==n.MOUSE&&!t.target.msMouseDown){return}if(!t.target.msPointerList)t.target.msPointerList={};t.target.msPointerList[t.pointerId]=t;var e={pointerType:t.textPointerType,getPointerList:s.bind(this),originalEvent:t};l("pointermove",t.target,e)}function v(t){if(t.target.msPointerList){delete t.target.msPointerList[t.pointerId]}if(t.pointerType==2){t.textPointerType=n.TOUCH}else if(t.pointerType==3){t.textPointerType=n.PEN}else if(t.pointerType==4){t.textPointerType=n.MOUSE}if(t.textPointerType==n.MOUSE){t.target.msMouseDown=false}var e={pointerType:t.textPointerType,getPointerList:s.bind(this),originalEvent:t};l("pointerup",t.target,e)}function _(t){if(!t.isPointerEmitter){if(x()){t.addEventListener("pointerdown",y);t.addEventListener("pointermove",g);t.addEventListener("pointerup",v)}else if(w()){t.addEventListener("MSPointerDown",y);t.addEventListener("MSPointerMove",g);t.addEventListener("MSPointerUp",v)}else{if(I()){t.addEventListener("touchstart",c);t.addEventListener("touchmove",f);t.addEventListener("touchend",m)}if(!isAndroid()){t.addEventListener("mousedown",h);t.addEventListener("mousemove",u);t.addEventListener("mouseup",p);t.addEventListener("mouseout",d)}}t.listeners={};t.addEventListener=function(e,i,n){var r=t.listeners[e]?t.listeners[e]:[];r.push(i);t.listeners[e]=r;return};t.dispatchCustomEvent=function(e){var i=e.type;var n=t.listeners[i]?t.listeners[i]:[];for(var r=0;r<n.length;r++){var o=n[r];o(e)}return};for(var e in Gesture._gestureHandlers){var i=Gesture._gestureHandlers[e];if(i){i(t)}}t.isPointerEmitter=true}}function I(){return Modernizr.touch}function w(){return window.navigator.msPointerEnabled}function x(){return window.navigator.pointerEnabled}t.pointer={emitPointers:_};function S(t,e){var i=t.prototype.addEventListener;t.prototype.addEventListener=function(t,n,r){e.call(this,t,n,r);i.call(this,t,n,r)}}t._createCustomEvent=l;t._augmentAddEventListener=S;t.PointerTypes=n})(window);(function(t){function e(t,e,i){if(t.indexOf("gesture")===0){var n=Gesture._gestureHandlers[t];if(n){n(this)}else{console.error("Warning: no handler found for {{evt}}.".replace("{{evt}}",t))}}}t.Gesture=t.Gesture||{};t.Gesture._gestureHandlers=t.Gesture._gestureHandlers||{}})(window);(function(t){var e=isMobile()?500:300;var i=30;function n(t){this.x=t.clientX;this.y=t.clientY}n.prototype.calculateSquaredDistance=function(t){var e=this.x-t.clientX;var i=this.y-t.clientY;return e*e+i*i};function r(t){var r=t.getPointerList();if(r.length!=1)return;var o=new Date;var a=t.originalEvent&&isRightMouseEvent(t.originalEvent);if(o-this.lastDownTime<e&&this.lastPosition&&this.lastPosition.calculateSquaredDistance(r[0])<i*i&&!a){this.isDoubleTap=true;this.eTarget=t.target}this.lastPosition=new n(r[0]);this.lastDownTime=o}function o(t){if(this.isDoubleTap){this.isDoubleTap=false;this.lastDownTime=0;this.lastPosition=null;var e={};clearTimeout(this.longPressTimer);window._createCustomEvent("gesturedoubletap",this.eTarget,e)}}function a(t){t.addEventListener("pointerdown",r);t.addEventListener("pointerup",o)}t.Gesture._gestureHandlers.gesturedoubletap=a})(window);(function(t){var e=600;var i=5;function n(t){this.x=t.clientX;this.y=t.clientY}n.prototype.calculateSquaredDistance=function(t){var e=this.x-t.clientX;var i=this.y-t.clientY;return e*e+i*i};function r(t){clearTimeout(this.longPressTimer);var i=t.getPointerList();if(i.length===1){t.target.longpressInitPosition=new n(i[0]);this.longPressTimer=setTimeout(function(){payload={};window._createCustomEvent("gesturelongpress",t.target,payload)},e)}}function o(t){var e=t.getPointerList();if(t.pointerType===PointerTypes.MOUSE){clearTimeout(this.longPressTimer)}else if(e.length===1){var n=t.target.longpressInitPosition;if(n&&n.calculateSquaredDistance(e[0])>i*i){clearTimeout(this.longPressTimer)}}}function a(t){clearTimeout(this.longPressTimer)}function s(t){t.addEventListener("pointerdown",r);t.addEventListener("pointermove",o);t.addEventListener("pointerup",a)}t.Gesture._gestureHandlers.gesturelongpress=s})(window);(function(t){var e=.2;function i(t,e){this.p1=t;this.p2=e}i.prototype.center=function(){return[(this.p1.pageX+this.p2.pageX)/2,(this.p1.pageY+this.p2.pageY)/2]};i.prototype.span=function(){var t=this.p1.pageX-this.p2.pageX;var e=this.p1.pageY-this.p2.pageY;return Math.sqrt(t*t+e*e)};i.prototype.scaleSince=function(t){var e=this.span();var i=t.span();if(i===0){return 0}else return e/i};function n(t){var e=t.getPointerList();if(e.length==2){t.target.scaleReferencePair=new i(e[0],e[1]);var n={scale:1,scaleStart:true};window._createCustomEvent("gesturescale",t.target,n);this.isGestureScale=true}else{this.isGestureScale=false}}function r(t){var n=t.getPointerList();if(n.length==2&&t.target.scaleReferencePair){var r=new i(n[0],n[1]);var o=r.scaleSince(t.target.scaleReferencePair);if(Math.abs(1-o)>e){var a={scale:o,centerX:(t.target.scaleReferencePair.p1.clientX+t.target.scaleReferencePair.p2.clientX)/2,centerY:(t.target.scaleReferencePair.p1.clientY+t.target.scaleReferencePair.p2.clientY)/2};window._createCustomEvent("gesturescale",t.target,a)}}}function o(t){if(this.isGestureScale){var e={scale:1,scaleEnd:true};window._createCustomEvent("gesturescale",t.target,e)}t.target.scaleReferencePair=null}function a(t){t.addEventListener("pointerdown",n);t.addEventListener("pointermove",r);t.addEventListener("pointerup",o)}t.Gesture._gestureHandlers.gesturescale=a})(window);(function(){"use strict";var t=null;var e=true;var i=false;f();if(e){var n=typeof t.createGain==="undefined"?t.createGainNode():t.createGain();n.gain.value=1;n.connect(t.destination)}var r=function(){this.init()};r.prototype={init:function(){var n=this||o;n._codecs={};n._howls=[];n._muted=false;n._volume=1;n.mobileAutoEnable=true;n.noAudio=i;n.usingWebAudio=e;n.ctx=t;if(!i){n._setupCodecs()}return n},volume:function(t){var i=this||o;t=parseFloat(t);if(typeof t!=="undefined"&&t>=0&&t<=1){i._volume=t;if(e){n.gain.value=t}for(var r=0;r<i._howls.length;r++){if(!i._howls[r]._webAudio){var a=i._howls[r]._getSoundIds();for(var s=0;s<a.length;s++){var l=i._howls[r]._soundById(a[s]);if(l&&l._node){l._node.volume=l._volume*t}}}}return i}return i._volume},mute:function(t){var i=this||o;i._muted=t;if(e){n.gain.value=t?0:i._volume}for(var r=0;r<i._howls.length;r++){if(!i._howls[r]._webAudio){var a=i._howls[r]._getSoundIds();for(var s=0;s<a.length;s++){var l=i._howls[r]._soundById(a[s]);if(l&&l._node){l._node.muted=t?true:l._muted}}}}return i},unload:function(){var t=this||o;for(var e=t._howls.length-1;e>=0;e--){t._howls[e].unload()}return t},codecs:function(t){return(this||o)._codecs[t]},_setupCodecs:function(){var t=this||o;var e=new Audio;var i=e.canPlayType("audio/mpeg;").replace(/^no$/,"");var n=/OPR\//.test(navigator.userAgent);t._codecs={mp3:!!(!n&&(i||e.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!i,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")};return t},_enableMobileAudio:function(){var e=this||o;var i=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk/i.test(navigator.userAgent);var n=!!("ontouchend"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0);if(t&&(e._mobileEnabled||!i||!n)){return}e._mobileEnabled=false;var r=function(){var i=t.createBuffer(1,1,22050);var n=t.createBufferSource();n.buffer=i;n.connect(t.destination);if(typeof n.start==="undefined"){n.noteOn(0)}else{n.start(0)}n.onended=function(){e._mobileEnabled=true;e.mobileAutoEnable=false;document.removeEventListener("touchend",r,true)}};document.addEventListener("touchend",r,true);return e}};var o=new r;var a=function(t){var e=this;if(!t.src||t.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}e.init(t)};a.prototype={init:function(i){var n=this;n._autoplay=i.autoplay||false;n._ext=i.ext||null;n._html5=i.html5||false;n._muted=i.mute||false;n._loop=i.loop||false;n._pool=i.pool||5;n._preload=typeof i.preload==="boolean"?i.preload:true;n._rate=i.rate||1;n._sprite=i.sprite||{};n._src=typeof i.src!=="string"?i.src:[i.src];n._volume=i.volume!==undefined?i.volume:1;n._duration=0;n._loaded=false;n._sounds=[];n._endTimers={};n._onend=i.onend?[{fn:i.onend}]:[];n._onfaded=i.onfaded?[{fn:i.onfaded}]:[];n._onload=i.onload?[{fn:i.onload}]:[];n._onloaderror=i.onloaderror?[{fn:i.onloaderror}]:[];n._onpause=i.onpause?[{fn:i.onpause}]:[];n._onplay=i.onplay?[{fn:i.onplay}]:[];n._onstop=i.onstop?[{fn:i.onstop}]:[];n._webAudio=e&&!n._html5;if(typeof t!=="undefined"&&t&&o.mobileAutoEnable){o._enableMobileAudio()}o._howls.push(n);if(n._preload){n.load()}return n},load:function(){var t=this;var e=null;if(i){t._emit("loaderror",null,"No audio support.");return}if(typeof t._src==="string"){t._src=[t._src]}for(var n=0;n<t._src.length;n++){var r,a;if(t._ext&&t._ext[n]){r=t._ext[n]}else{a=t._src[n];r=/^data:audio\/([^;,]+);/i.exec(a);if(!r){r=/\.([^.]+)$/.exec(a)}if(r){r=r[1].toLowerCase()}}if(o.codecs(r)){e=t._src[n];break}}if(!e){t._emit("loaderror",null,"No codec support for selected audio sources.");return}t._src=e;new s(t);if(t._webAudio){h(t)}return t},play:function(e){var i=this;var n=arguments;var r=null;if(typeof e==="number"){r=e;e=null}else if(typeof e==="undefined"){e="__default";var a=0;for(var s=0;s<i._sounds.length;s++){if(i._sounds[s]._paused&&!i._sounds[s]._ended){a++;r=i._sounds[s]._id}}if(a===1){e=null}else{r=null}}var l=r?i._soundById(r):i._inactiveSound();if(!l){return null}if(r&&!e){e=l._sprite||"__default"}if(!i._loaded&&!i._sprite[e]){i.once("load",function(){i.play(i._soundById(l._id)?l._id:undefined)});return l._id}if(r&&!l._paused){return l._id}var h=l._seek>0?l._seek:i._sprite[e][0]/1e3;var u=(i._sprite[e][0]+i._sprite[e][1])/1e3-h;var p=u*1e3/Math.abs(l._rate);i._endTimers[l._id]=setTimeout(i._ended.bind(i,l),p);l._paused=false;l._ended=false;l._sprite=e;l._seek=h;l._start=i._sprite[e][0]/1e3;l._stop=(i._sprite[e][0]+i._sprite[e][1])/1e3;l._loop=!!(l._loop||i._sprite[e][2]);var c=l._node;if(i._webAudio){var f=function(){i._refreshBuffer(l);var e=l._muted||i._muted?0:l._volume*o.volume();c.gain.setValueAtTime(e,t.currentTime);l._playStart=t.currentTime;if(typeof c.bufferSource.start==="undefined"){l._loop?c.bufferSource.noteGrainOn(0,h,86400):c.bufferSource.noteGrainOn(0,h,u)}else{l._loop?c.bufferSource.start(0,h,86400):c.bufferSource.start(0,h,u)}if(!i._endTimers[l._id]){i._endTimers[l._id]=setTimeout(i._ended.bind(i,l),p)}if(!n[1]){setTimeout(function(){i._emit("play",l._id)},0)}};if(i._loaded){f()}else{i.once("load",f);i._clearTimer(l._id)}}else{var m=function(){c.currentTime=h;c.muted=l._muted||i._muted||o._muted||c.muted;c.volume=l._volume*o.volume();c.playbackRate=l._rate;setTimeout(function(){c.play();if(!n[1]){i._emit("play",l._id)}},0)};if(c.readyState===4||!c.readyState&&navigator.isCocoonJS){m()}else{var d=function(){i._endTimers[l._id]=setTimeout(i._ended.bind(i,l),p);m();c.removeEventListener("canplaythrough",d,false)};c.addEventListener("canplaythrough",d,false);i._clearTimer(l._id)}}return l._id},pause:function(t){var e=this;if(!e._loaded){e.once("play",function(){e.pause(t)});return e}var i=e._getSoundIds(t);for(var n=0;n<i.length;n++){e._clearTimer(i[n]);var r=e._soundById(i[n]);if(r&&!r._paused){r._seek=e.seek(i[n]);r._paused=true;e._stopFade(i[n]);if(e._webAudio){if(!r._node.bufferSource){return e}if(typeof r._node.bufferSource.stop==="undefined"){r._node.bufferSource.noteOff(0)}else{r._node.bufferSource.stop(0)}r._node.bufferSource=null}else if(!isNaN(r._node.duration)){r._node.pause()}if(!arguments[1]){e._emit("pause",r._id)}}}return e},stop:function(t){var e=this;if(!e._loaded){if(typeof e._sounds[0]._sprite!=="undefined"){e.once("play",function(){e.stop(t)})}return e}var i=e._getSoundIds(t);for(var n=0;n<i.length;n++){e._clearTimer(i[n]);var r=e._soundById(i[n]);if(r&&!r._paused){r._seek=r._start||0;r._paused=true;r._ended=true;e._stopFade(i[n]);if(e._webAudio&&r._node){if(!r._node.bufferSource){return e}if(typeof r._node.bufferSource.stop==="undefined"){r._node.bufferSource.noteOff(0)}else{r._node.bufferSource.stop(0)}r._node.bufferSource=null}else if(r._node&&!isNaN(r._node.duration)){r._node.pause();r._node.currentTime=r._start||0}e._emit("stop",r._id)}}return e},mute:function(e,i){var n=this;if(!n._loaded){n.once("play",function(){n.mute(e,i)});return n}if(typeof i==="undefined"){if(typeof e==="boolean"){n._muted=e}else{return n._muted}}var r=n._getSoundIds(i);for(var a=0;a<r.length;a++){var s=n._soundById(r[a]);if(s){s._muted=e;if(n._webAudio&&s._node){s._node.gain.setValueAtTime(e?0:s._volume*o.volume(),t.currentTime)}else if(s._node){s._node.muted=o._muted?true:e}}}return n},volume:function(){var e=this;var i=arguments;var n,r;if(i.length===0){return e._volume}else if(i.length===1){var a=e._getSoundIds();var s=a.indexOf(i[0]);if(s>=0){r=parseInt(i[0],10)}else{n=parseFloat(i[0])}}else if(i.length>=2){n=parseFloat(i[0]);r=parseInt(i[1],10)}var l;if(typeof n!=="undefined"&&n>=0&&n<=1){if(!e._loaded){e.once("play",function(){e.volume.apply(e,i)});return e}if(typeof r==="undefined"){e._volume=n}r=e._getSoundIds(r);for(var h=0;h<r.length;h++){l=e._soundById(r[h]);if(l){l._volume=n;if(!i[2]){e._stopFade(r[h])}if(e._webAudio&&l._node&&!l._muted){l._node.gain.setValueAtTime(n*o.volume(),t.currentTime)}else if(l._node&&!l._muted){l._node.volume=n*o.volume()}}}}else{l=r?e._soundById(r):e._sounds[0];return l?l._volume:0}return e},fade:function(e,i,n,r){var o=this;if(!o._loaded){o.once("play",function(){o.fade(e,i,n,r)});return o}o.volume(e,r);var a=o._getSoundIds(r);for(var s=0;s<a.length;s++){var l=o._soundById(a[s]);if(l){if(o._webAudio&&!l._muted){var h=t.currentTime;var u=h+n/1e3;l._volume=e;l._node.gain.setValueAtTime(e,h);l._node.gain.linearRampToValueAtTime(i,u);l._timeout=setTimeout(function(e,n){delete n._timeout;setTimeout(function(){n._volume=i;o._emit("faded",e)},u-t.currentTime>0?Math.ceil((u-t.currentTime)*1e3):0)}.bind(o,a[s],l),n)}else{var p=Math.abs(e-i);var c=e>i?"out":"in";var f=p/.01;var m=n/f;(function(){var t=e;l._interval=setInterval(function(e,n){t+=c==="in"?.01:-.01;t=Math.max(0,t);t=Math.min(1,t);t=Math.round(t*100)/100;o.volume(t,e,true);if(t===i){clearInterval(n._interval);delete n._interval;o._emit("faded",e)}}.bind(o,a[s],l),m)})()}}}return o},_stopFade:function(e){var i=this;var n=i._soundById(e);if(n._interval){clearInterval(n._interval);delete n._interval;i._emit("faded",e)}else if(n._timeout){clearTimeout(n._timeout);delete n._timeout;n._node.gain.cancelScheduledValues(t.currentTime);i._emit("faded",e)}return i},loop:function(){var t=this;var e=arguments;var i,n,r;if(e.length===0){return t._loop}else if(e.length===1){if(typeof e[0]==="boolean"){i=e[0];t._loop=i}else{r=t._soundById(parseInt(e[0],10));return r?r._loop:false}}else if(e.length===2){i=e[0];n=parseInt(e[1],10)}var o=t._getSoundIds(n);for(var a=0;a<o.length;a++){r=t._soundById(o[a]);if(r){r._loop=i;if(t._webAudio&&r._node&&r._node.bufferSource){r._node.bufferSource.loop=i}}}return t},rate:function(){var t=this;var e=arguments;var i,n;if(e.length===0){n=t._sounds[0]._id}else if(e.length===1){var r=t._getSoundIds();var o=r.indexOf(e[0]);if(o>=0){n=parseInt(e[0],10)}else{i=parseFloat(e[0])}}else if(e.length===2){i=parseFloat(e[0]);n=parseInt(e[1],10)}var a;if(typeof i==="number"){if(!t._loaded){t.once("load",function(){t.rate.apply(t,e)});return t}if(typeof n==="undefined"){t._rate=i}n=t._getSoundIds(n);for(var s=0;s<n.length;s++){a=t._soundById(n[s]);if(a){a._rate=i;if(t._webAudio&&a._node&&a._node.bufferSource){a._node.bufferSource.playbackRate.value=i}else if(a._node){a._node.playbackRate=i}var l=t.seek(n[s]);var h=(t._sprite[a._sprite][0]+t._sprite[a._sprite][1])/1e3-l;var u=h*1e3/Math.abs(a._rate);t._clearTimer(n[s]);t._endTimers[n[s]]=setTimeout(t._ended.bind(t,a),u)}}}else{a=t._soundById(n);return a?a._rate:t._rate}return t},seek:function(){var e=this;var i=arguments;var n,r;if(i.length===0){r=e._sounds[0]._id}else if(i.length===1){var o=e._getSoundIds();var a=o.indexOf(i[0]);if(a>=0){r=parseInt(i[0],10)}else{r=e._sounds[0]._id;n=parseFloat(i[0])}}else if(i.length===2){n=parseFloat(i[0]);r=parseInt(i[1],10)}if(typeof r==="undefined"){return e}if(!e._loaded){e.once("load",function(){e.seek.apply(e,i)});return e}var s=e._soundById(r);if(s){if(n>=0){var l=e.playing(r);if(l){e.pause(r,true)}s._seek=n;e._clearTimer(r);if(l){e.play(r,true)}}else{if(e._webAudio){return s._seek+(e.playing(r)?t.currentTime-s._playStart:0)}else{return s._node.currentTime}}}return e},playing:function(t){var e=this;var i=e._soundById(t)||e._sounds[0];return i?!i._paused:false},duration:function(){return this._duration},unload:function(){var t=this;var e=t._sounds;for(var i=0;i<e.length;i++){
if(!e[i]._paused){t.stop(e[i]._id);t._emit("end",e[i]._id)}if(!t._webAudio){e[i]._node.src="";e[i]._node.removeEventListener("error",e[i]._errorFn,false);e[i]._node.removeEventListener("canplaythrough",e[i]._loadFn,false)}delete e[i]._node;t._clearTimer(e[i]._id);var n=o._howls.indexOf(t);if(n>=0){o._howls.splice(n,1)}}if(l){delete l[t._src]}t=null;return null},on:function(t,e,i,n){var r=this;var o=r["_on"+t];if(typeof e==="function"){o.push(n?{id:i,fn:e,once:n}:{id:i,fn:e})}return r},off:function(t,e,i){var n=this;var r=n["_on"+t];if(e){for(var o=0;o<r.length;o++){if(e===r[o].fn&&i===r[o].id){r.splice(o,1);break}}}else{n["on"+t]=[]}return n},once:function(t,e,i){var n=this;n.on(t,e,i,1);return n},_emit:function(t,e,i){var n=this;var r=n["_on"+t];for(var o=0;o<r.length;o++){if(!r[o].id||r[o].id===e){setTimeout(function(t){t.call(this,e,i)}.bind(n,r[o].fn),0);if(r[o].once){n.off(t,r[o].fn,r[o].id)}}}return n},_ended:function(e){var i=this;var n=e._sprite;var r=!!(e._loop||i._sprite[n][2]);i._emit("end",e._id);if(!i._webAudio&&r){i.stop(e._id).play(e._id)}if(i._webAudio&&r){i._emit("play",e._id);e._seek=e._start||0;e._playStart=t.currentTime;var o=(e._stop-e._start)*1e3/Math.abs(e._rate);i._endTimers[e._id]=setTimeout(i._ended.bind(i,e),o)}if(i._webAudio&&!r){e._paused=true;e._ended=true;e._seek=e._start||0;i._clearTimer(e._id);e._node.bufferSource=null}if(!i._webAudio&&!r){i.stop(e._id)}return i},_clearTimer:function(t){var e=this;if(e._endTimers[t]){clearTimeout(e._endTimers[t]);delete e._endTimers[t]}return e},_soundById:function(t){var e=this;for(var i=0;i<e._sounds.length;i++){if(t===e._sounds[i]._id){return e._sounds[i]}}return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++){if(t._sounds[e]._ended){return t._sounds[e].reset()}}return new s(t)},_drain:function(){var t=this;var e=t._pool;var i=0;var n=0;if(t._sounds.length<e){return}for(n=0;n<t._sounds.length;n++){if(t._sounds[n]._ended){i++}}for(n=t._sounds.length-1;n>=0;n--){if(i<=e){return}if(t._sounds[n]._ended){if(t._webAudio&&t._sounds[n]._node){t._sounds[n]._node.disconnect(0)}t._sounds.splice(n,1);i--}}},_getSoundIds:function(t){var e=this;if(typeof t==="undefined"){var i=[];for(var n=0;n<e._sounds.length;n++){i.push(e._sounds[n]._id)}return i}else{return[t]}},_refreshBuffer:function(e){var i=this;e._node.bufferSource=t.createBufferSource();e._node.bufferSource.buffer=l[i._src];if(e._panner){e._node.bufferSource.connect(e._panner)}else{e._node.bufferSource.connect(e._node)}e._node.bufferSource.loop=e._loop;if(e._loop){e._node.bufferSource.loopStart=e._start||0;e._node.bufferSource.loopEnd=e._stop}e._node.bufferSource.playbackRate.value=i._rate;return i}};var s=function(t){this._parent=t;this.init()};s.prototype={init:function(){var t=this;var e=t._parent;t._muted=e._muted;t._loop=e._loop;t._volume=e._volume;t._muted=e._muted;t._rate=e._rate;t._seek=0;t._paused=true;t._ended=true;t._id=Math.round(Date.now()*Math.random());e._sounds.push(t);t.create();return t},create:function(){var e=this;var i=e._parent;var r=o._muted||e._muted||e._parent._muted?0:e._volume*o.volume();if(i._webAudio){e._node=typeof t.createGain==="undefined"?t.createGainNode():t.createGain();e._node.gain.setValueAtTime(r,t.currentTime);e._node.paused=true;e._node.connect(n)}else{e._node=new Audio;e._errorFn=e._errorListener.bind(e);e._node.addEventListener("error",e._errorFn,false);e._loadFn=e._loadListener.bind(e);e._node.addEventListener("canplaythrough",e._loadFn,false);e._node.src=i._src;e._node.preload="auto";e._node.volume=r;e._node.load()}return e},reset:function(){var t=this;var e=t._parent;t._muted=e._muted;t._loop=e._loop;t._volume=e._volume;t._muted=e._muted;t._rate=e._rate;t._seek=0;t._paused=true;t._ended=true;t._sprite=null;t._id=Math.round(Date.now()*Math.random());return t},_errorListener:function(){var t=this;if(t._node.error&&t._node.error.code===4){o.noAudio=true}t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0);t._node.removeEventListener("error",t._errorListener,false)},_loadListener:function(){var t=this;var e=t._parent;e._duration=Math.ceil(t._node.duration*10)/10;if(Object.keys(e._sprite).length===0){e._sprite={__default:[0,e._duration*1e3]}}if(!e._loaded){e._loaded=true;e._emit("load")}if(e._autoplay){e.play()}t._node.removeEventListener("canplaythrough",t._loadFn,false)}};if(e){var l={};var h=function(t){var e=t._src;if(l[e]){t._duration=l[e].duration;c(t);return}if(/^data:[^;]+;base64,/.test(e)){window.atob=window.atob||function(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var i=String(t).replace(/=+$/,"");for(var n=0,r,o,a=0,s="";o=i.charAt(a++);~o&&(r=n%4?r*64+o:o,n++%4)?s+=String.fromCharCode(255&r>>(-2*n&6)):0){o=e.indexOf(o)}return s};var i=atob(e.split(",")[1]);var n=new Uint8Array(i.length);for(var r=0;r<i.length;++r){n[r]=i.charCodeAt(r)}p(n.buffer,t)}else{var o=new XMLHttpRequest;o.crossOrigin="Anonymous";o.open("GET",e,true);o.responseType="arraybuffer";o.onload=function(){p(o.response,t)};o.onerror=function(){if(t._webAudio){t._html5=true;t._webAudio=false;t._sounds=[];delete l[e];t.load()}};u(o)}};var u=function(t){try{t.send()}catch(e){t.onerror()}};var p=function(e,i){t.decodeAudioData(e,function(t){if(t){l[i._src]=t;c(i,t)}},function(){i._emit("loaderror",null,"Decoding audio data failed.")})};var c=function(t,e){if(e&&!t._duration){t._duration=e.duration}if(Object.keys(t._sprite).length===0){t._sprite={__default:[0,t._duration*1e3]}}if(!t._loaded){t._loaded=true;t._emit("load")}if(t._autoplay){t.play()}}}function f(){try{if(typeof AudioContext!=="undefined"){t=new AudioContext}else if(typeof webkitAudioContext!=="undefined"){t=new webkitAudioContext}else{e=false}}catch(n){e=false}if(!e){if(typeof Audio!=="undefined"){try{new Audio}catch(n){i=true}}else{i=true}}try{var r=new Audio;if(r.muted){i=true}}catch(n){}}if(typeof define==="function"&&define.amd){define("howler",function(){return{Howler:o,Howl:a}})}if(typeof exports!=="undefined"){exports.Howler=o;exports.Howl=a}if(typeof window!=="undefined"){window.HowlerGlobal=r;window.Howler=o;window.Howl=a;window.Sound=s}})();var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(t){if(t==null)return"";var e="";var i,n,r,o,a,s,l;var h=0;t=LZString.compress(t);while(h<t.length*2){if(h%2==0){i=t.charCodeAt(h/2)>>8;n=t.charCodeAt(h/2)&255;if(h/2+1<t.length)r=t.charCodeAt(h/2+1)>>8;else r=NaN}else{i=t.charCodeAt((h-1)/2)&255;if((h+1)/2<t.length){n=t.charCodeAt((h+1)/2)>>8;r=t.charCodeAt((h+1)/2)&255}else n=r=NaN}h+=3;o=i>>2;a=(i&3)<<4|n>>4;s=(n&15)<<2|r>>6;l=r&63;if(isNaN(n)){s=l=64}else if(isNaN(r)){l=64}e=e+LZString._keyStr.charAt(o)+LZString._keyStr.charAt(a)+LZString._keyStr.charAt(s)+LZString._keyStr.charAt(l)}return e},decompressFromBase64:function(t){if(t==null)return"";var e="",i=0,n,r,o,a,s,l,h,u,p=0,c=LZString._f;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(p<t.length){s=LZString._keyStr.indexOf(t.charAt(p++));l=LZString._keyStr.indexOf(t.charAt(p++));h=LZString._keyStr.indexOf(t.charAt(p++));u=LZString._keyStr.indexOf(t.charAt(p++));r=s<<2|l>>4;o=(l&15)<<4|h>>2;a=(h&3)<<6|u;if(i%2==0){n=r<<8;if(h!=64){e+=c(n|o)}if(u!=64){n=a<<8}}else{e=e+c(n|r);if(h!=64){n=o<<8}if(u!=64){e+=c(n|a)}}i+=3}return LZString.decompress(e)},compressToUTF16:function(t){if(t==null)return"";var e="",i,n,r,o=0,a=LZString._f;t=LZString.compress(t);for(i=0;i<t.length;i++){n=t.charCodeAt(i);switch(o++){case 0:e+=a((n>>1)+32);r=(n&1)<<14;break;case 1:e+=a(r+(n>>2)+32);r=(n&3)<<13;break;case 2:e+=a(r+(n>>3)+32);r=(n&7)<<12;break;case 3:e+=a(r+(n>>4)+32);r=(n&15)<<11;break;case 4:e+=a(r+(n>>5)+32);r=(n&31)<<10;break;case 5:e+=a(r+(n>>6)+32);r=(n&63)<<9;break;case 6:e+=a(r+(n>>7)+32);r=(n&127)<<8;break;case 7:e+=a(r+(n>>8)+32);r=(n&255)<<7;break;case 8:e+=a(r+(n>>9)+32);r=(n&511)<<6;break;case 9:e+=a(r+(n>>10)+32);r=(n&1023)<<5;break;case 10:e+=a(r+(n>>11)+32);r=(n&2047)<<4;break;case 11:e+=a(r+(n>>12)+32);r=(n&4095)<<3;break;case 12:e+=a(r+(n>>13)+32);r=(n&8191)<<2;break;case 13:e+=a(r+(n>>14)+32);r=(n&16383)<<1;break;case 14:e+=a(r+(n>>15)+32,(n&32767)+32);o=0;break}}return e+a(r+32)},decompressFromUTF16:function(t){if(t==null)return"";var e="",i,n,r=0,o=0,a=LZString._f;while(o<t.length){n=t.charCodeAt(o)-32;switch(r++){case 0:i=n<<1;break;case 1:e+=a(i|n>>14);i=(n&16383)<<2;break;case 2:e+=a(i|n>>13);i=(n&8191)<<3;break;case 3:e+=a(i|n>>12);i=(n&4095)<<4;break;case 4:e+=a(i|n>>11);i=(n&2047)<<5;break;case 5:e+=a(i|n>>10);i=(n&1023)<<6;break;case 6:e+=a(i|n>>9);i=(n&511)<<7;break;case 7:e+=a(i|n>>8);i=(n&255)<<8;break;case 8:e+=a(i|n>>7);i=(n&127)<<9;break;case 9:e+=a(i|n>>6);i=(n&63)<<10;break;case 10:e+=a(i|n>>5);i=(n&31)<<11;break;case 11:e+=a(i|n>>4);i=(n&15)<<12;break;case 12:e+=a(i|n>>3);i=(n&7)<<13;break;case 13:e+=a(i|n>>2);i=(n&3)<<14;break;case 14:e+=a(i|n>>1);i=(n&1)<<15;break;case 15:e+=a(i|n);r=0;break}o++}return LZString.decompress(e)},compress:function(t){if(t==null)return"";var e,i,n={},r={},o="",a="",s="",l=2,h=3,u=2,p="",c=0,f=0,m,d=LZString._f;for(m=0;m<t.length;m+=1){o=t.charAt(m);if(!Object.prototype.hasOwnProperty.call(n,o)){n[o]=h++;r[o]=true}a=s+o;if(Object.prototype.hasOwnProperty.call(n,a)){s=a}else{if(Object.prototype.hasOwnProperty.call(r,s)){if(s.charCodeAt(0)<256){for(e=0;e<u;e++){c=c<<1;if(f==15){f=0;p+=d(c);c=0}else{f++}}i=s.charCodeAt(0);for(e=0;e<8;e++){c=c<<1|i&1;if(f==15){f=0;p+=d(c);c=0}else{f++}i=i>>1}}else{i=1;for(e=0;e<u;e++){c=c<<1|i;if(f==15){f=0;p+=d(c);c=0}else{f++}i=0}i=s.charCodeAt(0);for(e=0;e<16;e++){c=c<<1|i&1;if(f==15){f=0;p+=d(c);c=0}else{f++}i=i>>1}}l--;if(l==0){l=Math.pow(2,u);u++}delete r[s]}else{i=n[s];for(e=0;e<u;e++){c=c<<1|i&1;if(f==15){f=0;p+=d(c);c=0}else{f++}i=i>>1}}l--;if(l==0){l=Math.pow(2,u);u++}n[a]=h++;s=String(o)}}if(s!==""){if(Object.prototype.hasOwnProperty.call(r,s)){if(s.charCodeAt(0)<256){for(e=0;e<u;e++){c=c<<1;if(f==15){f=0;p+=d(c);c=0}else{f++}}i=s.charCodeAt(0);for(e=0;e<8;e++){c=c<<1|i&1;if(f==15){f=0;p+=d(c);c=0}else{f++}i=i>>1}}else{i=1;for(e=0;e<u;e++){c=c<<1|i;if(f==15){f=0;p+=d(c);c=0}else{f++}i=0}i=s.charCodeAt(0);for(e=0;e<16;e++){c=c<<1|i&1;if(f==15){f=0;p+=d(c);c=0}else{f++}i=i>>1}}l--;if(l==0){l=Math.pow(2,u);u++}delete r[s]}else{i=n[s];for(e=0;e<u;e++){c=c<<1|i&1;if(f==15){f=0;p+=d(c);c=0}else{f++}i=i>>1}}l--;if(l==0){l=Math.pow(2,u);u++}}i=2;for(e=0;e<u;e++){c=c<<1|i&1;if(f==15){f=0;p+=d(c);c=0}else{f++}i=i>>1}while(true){c=c<<1;if(f==15){p+=d(c);break}else f++}return p},decompress:function(t){if(t==null)return"";if(t=="")return null;var e=[],i,n=4,r=4,o=3,a="",s="",l,h,u,p,c,f,m,d=LZString._f,y={string:t,val:t.charCodeAt(0),position:32768,index:1};for(l=0;l<3;l+=1){e[l]=l}u=0;c=Math.pow(2,2);f=1;while(f!=c){p=y.val&y.position;y.position>>=1;if(y.position==0){y.position=32768;y.val=y.string.charCodeAt(y.index++)}u|=(p>0?1:0)*f;f<<=1}switch(i=u){case 0:u=0;c=Math.pow(2,8);f=1;while(f!=c){p=y.val&y.position;y.position>>=1;if(y.position==0){y.position=32768;y.val=y.string.charCodeAt(y.index++)}u|=(p>0?1:0)*f;f<<=1}m=d(u);break;case 1:u=0;c=Math.pow(2,16);f=1;while(f!=c){p=y.val&y.position;y.position>>=1;if(y.position==0){y.position=32768;y.val=y.string.charCodeAt(y.index++)}u|=(p>0?1:0)*f;f<<=1}m=d(u);break;case 2:return""}e[3]=m;h=s=m;while(true){if(y.index>y.string.length){return""}u=0;c=Math.pow(2,o);f=1;while(f!=c){p=y.val&y.position;y.position>>=1;if(y.position==0){y.position=32768;y.val=y.string.charCodeAt(y.index++)}u|=(p>0?1:0)*f;f<<=1}switch(m=u){case 0:u=0;c=Math.pow(2,8);f=1;while(f!=c){p=y.val&y.position;y.position>>=1;if(y.position==0){y.position=32768;y.val=y.string.charCodeAt(y.index++)}u|=(p>0?1:0)*f;f<<=1}e[r++]=d(u);m=r-1;n--;break;case 1:u=0;c=Math.pow(2,16);f=1;while(f!=c){p=y.val&y.position;y.position>>=1;if(y.position==0){y.position=32768;y.val=y.string.charCodeAt(y.index++)}u|=(p>0?1:0)*f;f<<=1}e[r++]=d(u);m=r-1;n--;break;case 2:return s}if(n==0){n=Math.pow(2,o);o++}if(e[m]){a=e[m]}else{if(m===r){a=h+h.charAt(0)}else{return null}}s+=a;e[r++]=h+a.charAt(0);n--;h=a;if(n==0){n=Math.pow(2,o);o++}}}};if(typeof module!=="undefined"&&module!=null){module.exports=LZString}function strCompress(t){var e="";try{e=t?LZString.compress(t):""}catch(i){console.log("strCompress: "+i.message)}return e}function strDecompress(t){var e="";try{e=t?LZString.decompress(t):""}catch(i){console.log("strDecompress: "+i.message)}return e}var QRCode;(function(){function t(t){this.mode=i.MODE_8BIT_BYTE;this.data=t;this.parsedData=[];for(var e=0,n=this.data.length;e<n;e++){var r=[];var o=this.data.charCodeAt(e);if(o>65536){r[0]=240|(o&1835008)>>>18;r[1]=128|(o&258048)>>>12;r[2]=128|(o&4032)>>>6;r[3]=128|o&63}else if(o>2048){r[0]=224|(o&61440)>>>12;r[1]=128|(o&4032)>>>6;r[2]=128|o&63}else if(o>128){r[0]=192|(o&1984)>>>6;r[1]=128|o&63}else{r[0]=o}this.parsedData.push(r)}this.parsedData=Array.prototype.concat.apply([],this.parsedData);if(this.parsedData.length!=this.data.length){this.parsedData.unshift(191);this.parsedData.unshift(187);this.parsedData.unshift(239)}}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,i=this.parsedData.length;e<i;e++){t.put(this.parsedData[e],8)}}};function e(t,e){this.typeNumber=t;this.errorCorrectLevel=e;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}e.prototype={addData:function(e){var i=new t(e);this.dataList.push(i);this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e){throw new Error(t+","+e)}return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(false,this.getBestMaskPattern())},makeImpl:function(t,i){this.moduleCount=this.typeNumber*4+17;this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[n][r]=null}}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(t,i);if(this.typeNumber>=7){this.setupTypeNumber(t)}if(this.dataCache==null){this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)}this.mapData(this.dataCache,i)},setupPositionProbePattern:function(t,e){for(var i=-1;i<=7;i++){if(t+i<=-1||this.moduleCount<=t+i)continue;for(var n=-1;n<=7;n++){if(e+n<=-1||this.moduleCount<=e+n)continue;if(0<=i&&i<=6&&(n==0||n==6)||0<=n&&n<=6&&(i==0||i==6)||2<=i&&i<=4&&2<=n&&n<=4){this.modules[t+i][e+n]=true}else{this.modules[t+i][e+n]=false}}}},getBestMaskPattern:function(){var t=0;var e=0;for(var i=0;i<8;i++){this.makeImpl(true,i);var n=o.getLostPoint(this);if(i==0||t>n){t=n;e=i}}return e},createMovieClip:function(t,e,i){var n=t.createEmptyMovieClip(e,i);var r=1;this.make();for(var o=0;o<this.modules.length;o++){var a=o*r;for(var s=0;s<this.modules[o].length;s++){var l=s*r;var h=this.modules[o][s];if(h){n.beginFill(0,100);n.moveTo(l,a);n.lineTo(l+r,a);n.lineTo(l+r,a+r);n.lineTo(l,a+r);n.endFill()}}}return n},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++){if(this.modules[t][6]!=null){continue}this.modules[t][6]=t%2==0}for(var e=8;e<this.moduleCount-8;e++){if(this.modules[6][e]!=null){continue}this.modules[6][e]=e%2==0}},setupPositionAdjustPattern:function(){var t=o.getPatternPosition(this.typeNumber);for(var e=0;e<t.length;e++){for(var i=0;i<t.length;i++){var n=t[e];var r=t[i];if(this.modules[n][r]!=null){continue}for(var a=-2;a<=2;a++){for(var s=-2;s<=2;s++){if(a==-2||a==2||s==-2||s==2||a==0&&s==0){this.modules[n+a][r+s]=true}else{this.modules[n+a][r+s]=false}}}}}},setupTypeNumber:function(t){var e=o.getBCHTypeNumber(this.typeNumber);for(var i=0;i<18;i++){var n=!t&&(e>>i&1)==1;this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=n}for(var i=0;i<18;i++){var n=!t&&(e>>i&1)==1;this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=n}},setupTypeInfo:function(t,e){var i=this.errorCorrectLevel<<3|e;var n=o.getBCHTypeInfo(i);for(var r=0;r<15;r++){var a=!t&&(n>>r&1)==1;if(r<6){this.modules[r][8]=a}else if(r<8){this.modules[r+1][8]=a}else{this.modules[this.moduleCount-15+r][8]=a}}for(var r=0;r<15;r++){var a=!t&&(n>>r&1)==1;if(r<8){this.modules[8][this.moduleCount-r-1]=a}else if(r<9){this.modules[8][15-r-1+1]=a}else{this.modules[8][15-r-1]=a}}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){var i=-1;var n=this.moduleCount-1;var r=7;var a=0;for(var s=this.moduleCount-1;s>0;s-=2){if(s==6)s--;while(true){for(var l=0;l<2;l++){if(this.modules[n][s-l]==null){var h=false;if(a<t.length){h=(t[a]>>>r&1)==1}var u=o.getMask(e,n,s-l);if(u){h=!h}this.modules[n][s-l]=h;r--;if(r==-1){a++;r=7}}}n+=i;if(n<0||this.moduleCount<=n){n-=i;i=-i;break}}}}};e.PAD0=236;e.PAD1=17;e.createData=function(t,i,n){var r=h.getRSBlocks(t,i);var a=new u;for(var s=0;s<n.length;s++){var l=n[s];a.put(l.mode,4);a.put(l.getLength(),o.getLengthInBits(l.mode,t));l.write(a)}var p=0;for(var s=0;s<r.length;s++){p+=r[s].dataCount}if(a.getLengthInBits()>p*8){throw new Error("code length overflow. ("+a.getLengthInBits()+">"+p*8+")")}if(a.getLengthInBits()+4<=p*8){a.put(0,4)}while(a.getLengthInBits()%8!=0){a.putBit(false)}while(true){if(a.getLengthInBits()>=p*8){break}a.put(e.PAD0,8);if(a.getLengthInBits()>=p*8){break}a.put(e.PAD1,8)}return e.createBytes(a,r)};e.createBytes=function(t,e){var i=0;var n=0;var r=0;var a=new Array(e.length);var s=new Array(e.length);for(var h=0;h<e.length;h++){var u=e[h].dataCount;var p=e[h].totalCount-u;n=Math.max(n,u);r=Math.max(r,p);a[h]=new Array(u);for(var c=0;c<a[h].length;c++){a[h][c]=255&t.buffer[c+i]}i+=u;var f=o.getErrorCorrectPolynomial(p);var m=new l(a[h],f.getLength()-1);var d=m.mod(f);s[h]=new Array(f.getLength()-1);for(var c=0;c<s[h].length;c++){var y=c+d.getLength()-s[h].length;s[h][c]=y>=0?d.get(y):0}}var g=0;for(var c=0;c<e.length;c++){g+=e[c].totalCount}var v=new Array(g);var _=0;for(var c=0;c<n;c++){for(var h=0;h<e.length;h++){if(c<a[h].length){v[_++]=a[h][c]}}}for(var c=0;c<r;c++){for(var h=0;h<e.length;h++){if(c<s[h].length){v[_++]=s[h][c]}}}return v};var i={MODE_NUMBER:1<<0,MODE_ALPHA_NUM:1<<1,MODE_8BIT_BYTE:1<<2,MODE_KANJI:1<<3};var n={L:1,M:0,Q:3,H:2};var r={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var o={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1<<10|1<<8|1<<5|1<<4|1<<2|1<<1|1<<0,G18:1<<12|1<<11|1<<10|1<<9|1<<8|1<<5|1<<2|1<<0,G15_MASK:1<<14|1<<12|1<<10|1<<4|1<<1,getBCHTypeInfo:function(t){var e=t<<10;while(o.getBCHDigit(e)-o.getBCHDigit(o.G15)>=0){e^=o.G15<<o.getBCHDigit(e)-o.getBCHDigit(o.G15)}return(t<<10|e)^o.G15_MASK},getBCHTypeNumber:function(t){var e=t<<12;while(o.getBCHDigit(e)-o.getBCHDigit(o.G18)>=0){e^=o.G18<<o.getBCHDigit(e)-o.getBCHDigit(o.G18)}return t<<12|e},getBCHDigit:function(t){var e=0;while(t!=0){e++;t>>>=1}return e},getPatternPosition:function(t){return o.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,i){switch(t){case r.PATTERN000:return(e+i)%2==0;case r.PATTERN001:return e%2==0;case r.PATTERN010:return i%3==0;case r.PATTERN011:return(e+i)%3==0;case r.PATTERN100:return(Math.floor(e/2)+Math.floor(i/3))%2==0;case r.PATTERN101:return e*i%2+e*i%3==0;case r.PATTERN110:return(e*i%2+e*i%3)%2==0;case r.PATTERN111:return(e*i%3+(e+i)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){var e=new l([1],0);for(var i=0;i<t;i++){e=e.multiply(new l([1,a.gexp(i)],0))}return e},getLengthInBits:function(t,e){if(1<=e&&e<10){switch(t){case i.MODE_NUMBER:return 10;case i.MODE_ALPHA_NUM:return 9;case i.MODE_8BIT_BYTE:return 8;case i.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}}else if(e<27){switch(t){case i.MODE_NUMBER:return 12;case i.MODE_ALPHA_NUM:return 11;case i.MODE_8BIT_BYTE:return 16;case i.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}}else if(e<41){switch(t){case i.MODE_NUMBER:return 14;case i.MODE_ALPHA_NUM:return 13;case i.MODE_8BIT_BYTE:return 16;case i.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}else{throw new Error("type:"+e)}},getLostPoint:function(t){var e=t.getModuleCount();var i=0;for(var n=0;n<e;n++){for(var r=0;r<e;r++){var o=0;var a=t.isDark(n,r);for(var s=-1;s<=1;s++){if(n+s<0||e<=n+s){continue}for(var l=-1;l<=1;l++){if(r+l<0||e<=r+l){continue}if(s==0&&l==0){continue}if(a==t.isDark(n+s,r+l)){o++}}}if(o>5){i+=3+o-5}}}for(var n=0;n<e-1;n++){for(var r=0;r<e-1;r++){var h=0;if(t.isDark(n,r))h++;if(t.isDark(n+1,r))h++;if(t.isDark(n,r+1))h++;if(t.isDark(n+1,r+1))h++;if(h==0||h==4){i+=3}}}for(var n=0;n<e;n++){for(var r=0;r<e-6;r++){if(t.isDark(n,r)&&!t.isDark(n,r+1)&&t.isDark(n,r+2)&&t.isDark(n,r+3)&&t.isDark(n,r+4)&&!t.isDark(n,r+5)&&t.isDark(n,r+6)){i+=40}}}for(var r=0;r<e;r++){for(var n=0;n<e-6;n++){if(t.isDark(n,r)&&!t.isDark(n+1,r)&&t.isDark(n+2,r)&&t.isDark(n+3,r)&&t.isDark(n+4,r)&&!t.isDark(n+5,r)&&t.isDark(n+6,r)){i+=40}}}var u=0;for(var r=0;r<e;r++){for(var n=0;n<e;n++){if(t.isDark(n,r)){u++}}}var p=Math.abs(100*u/e/e-50)/5;i+=p*10;return i}};var a={glog:function(t){if(t<1){throw new Error("glog("+t+")")}return a.LOG_TABLE[t]},gexp:function(t){while(t<0){t+=255}while(t>=256){t-=255}return a.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var s=0;s<8;s++){a.EXP_TABLE[s]=1<<s}for(var s=8;s<256;s++){a.EXP_TABLE[s]=a.EXP_TABLE[s-4]^a.EXP_TABLE[s-5]^a.EXP_TABLE[s-6]^a.EXP_TABLE[s-8]}for(var s=0;s<255;s++){a.LOG_TABLE[a.EXP_TABLE[s]]=s}function l(t,e){if(t.length==undefined){throw new Error(t.length+"/"+e)}var i=0;while(i<t.length&&t[i]==0){i++}this.num=new Array(t.length-i+e);for(var n=0;n<t.length-i;n++){this.num[n]=t[n+i]}}l.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){var e=new Array(this.getLength()+t.getLength()-1);for(var i=0;i<this.getLength();i++){for(var n=0;n<t.getLength();n++){e[i+n]^=a.gexp(a.glog(this.get(i))+a.glog(t.get(n)))}}return new l(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0){return this}var e=a.glog(this.get(0))-a.glog(t.get(0));var i=new Array(this.getLength());for(var n=0;n<this.getLength();n++){i[n]=this.get(n)}for(var n=0;n<t.getLength();n++){i[n]^=a.gexp(a.glog(t.get(n))+e)}return new l(i,0).mod(t)}};function h(t,e){this.totalCount=t;this.dataCount=e}h.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];h.getRSBlocks=function(t,e){var i=h.getRsBlockTable(t,e);if(i==undefined){throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e)}var n=i.length/3;var r=[];for(var o=0;o<n;o++){var a=i[o*3+0];var s=i[o*3+1];var l=i[o*3+2];for(var u=0;u<a;u++){r.push(new h(s,l))}}return r};h.getRsBlockTable=function(t,e){switch(e){case n.L:return h.RS_BLOCK_TABLE[(t-1)*4+0];case n.M:return h.RS_BLOCK_TABLE[(t-1)*4+1];case n.Q:return h.RS_BLOCK_TABLE[(t-1)*4+2];case n.H:return h.RS_BLOCK_TABLE[(t-1)*4+3];default:return undefined}};function u(){this.buffer=[];this.length=0}u.prototype={get:function(t){var e=Math.floor(t/8);return(this.buffer[e]>>>7-t%8&1)==1},put:function(t,e){for(var i=0;i<e;i++){this.putBit((t>>>e-i-1&1)==1)}},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);if(this.buffer.length<=e){this.buffer.push(0)}if(t){this.buffer[e]|=128>>>this.length%8}this.length++}};var p=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];function c(){return typeof CanvasRenderingContext2D!="undefined"}function f(){var t=false;var e=navigator.userAgent;if(/android/i.test(e)){t=true;aMat=e.toString().match(/android ([0-9]\.[0-9])/i);if(aMat&&aMat[1]){t=parseFloat(aMat[1])}}return t}var m=function(){var t=function(t,e){this._el=t;this._htOption=e};t.prototype.draw=function(t){var e=this._htOption;var i=this._el;var n=t.getModuleCount();var r=Math.floor(e.width/n);var o=Math.floor(e.height/n);this.clear();function a(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg",t);for(var n in e)if(e.hasOwnProperty(n))i.setAttribute(n,e[n]);return i}var s=a("svg",{viewBox:"0 0 "+String(n)+" "+String(n),width:"100%",height:"100%",fill:e.colorLight});s.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");i.appendChild(s);s.appendChild(a("rect",{fill:e.colorDark,width:"1",height:"1",id:"template"}));for(var l=0;l<n;l++){for(var h=0;h<n;h++){if(t.isDark(l,h)){var u=a("use",{x:String(l),y:String(h)});u.setAttributeNS("http://www.w3.org/1999/xlink","href","#template");s.appendChild(u)}}}};t.prototype.clear=function(){while(this._el.hasChildNodes())this._el.removeChild(this._el.lastChild)};return t}();var d=document.documentElement.tagName.toLowerCase()==="svg";var y=d?m:!c()?function(){var t=function(t,e){this._el=t;this._htOption=e};t.prototype.draw=function(t){var e=this._htOption;var i=this._el;var n=t.getModuleCount();var r=Math.floor(e.width/n);var o=Math.floor(e.height/n);var a=['<table style="border:0;border-collapse:collapse;">'];for(var s=0;s<n;s++){a.push("<tr>");for(var l=0;l<n;l++){a.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+r+"px;height:"+o+"px;background-color:"+(t.isDark(s,l)?e.colorDark:e.colorLight)+';"></td>')}a.push("</tr>")}a.push("</table>");i.innerHTML=a.join("");var h=i.childNodes[0];var u=(e.width-h.offsetWidth)/2;var p=(e.height-h.offsetHeight)/2;if(u>0&&p>0){h.style.margin=p+"px "+u+"px"}};t.prototype.clear=function(){this._el.innerHTML=""};return t}():function(){function t(){this._elImage.src=this._elCanvas.toDataURL("image/png");this._elImage.style.display="block";this._elCanvas.style.display="none"}if(this._android&&this._android<=2.1){var e=1/window.devicePixelRatio;var i=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(t,n,r,o,a,s,l,h,u){if("nodeName"in t&&/img/i.test(t.nodeName)){for(var p=arguments.length-1;p>=1;p--){arguments[p]=arguments[p]*e}}else if(typeof h=="undefined"){arguments[1]*=e;arguments[2]*=e;arguments[3]*=e;arguments[4]*=e}i.apply(this,arguments)}}function n(t,e){var i=this;i._fFail=e;i._fSuccess=t;if(i._bSupportDataURI===null){var n=document.createElement("img");var r=function(){i._bSupportDataURI=false;if(i._fFail){_fFail.call(i)}};var o=function(){i._bSupportDataURI=true;if(i._fSuccess){i._fSuccess.call(i)}};n.onabort=r;n.onerror=r;n.onload=o;n.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==";return}else if(i._bSupportDataURI===true&&i._fSuccess){i._fSuccess.call(i)}else if(i._bSupportDataURI===false&&i._fFail){i._fFail.call(i)}}var r=function(t,e){this._bIsPainted=false;this._android=f();this._htOption=e;this._elCanvas=document.createElement("canvas");this._elCanvas.width=e.width;this._elCanvas.height=e.height;t.appendChild(this._elCanvas);this._el=t;this._oContext=this._elCanvas.getContext("2d");this._bIsPainted=false;this._elImage=document.createElement("img");this._elImage.alt="Scan me!";this._elImage.style.display="none";this._el.appendChild(this._elImage);this._bSupportDataURI=null};r.prototype.draw=function(t){var e=this._elImage;var i=this._oContext;var n=this._htOption;var r=t.getModuleCount();var o=n.width/r;var a=n.height/r;var s=Math.round(o);var l=Math.round(a);e.style.display="none";this.clear();for(var h=0;h<r;h++){for(var u=0;u<r;u++){var p=t.isDark(h,u);var c=u*o;var f=h*a;i.strokeStyle=p?n.colorDark:n.colorLight;i.lineWidth=1;i.fillStyle=p?n.colorDark:n.colorLight;i.fillRect(c,f,o,a);i.strokeRect(Math.floor(c)+.5,Math.floor(f)+.5,s,l);i.strokeRect(Math.ceil(c)-.5,Math.ceil(f)-.5,s,l)}}this._bIsPainted=true};r.prototype.makeImage=function(){if(this._bIsPainted){n.call(this,t)}};r.prototype.isPainted=function(){return this._bIsPainted};r.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height);this._bIsPainted=false};r.prototype.round=function(t){if(!t){
return t}return Math.floor(t*1e3)/1e3};return r}();function g(t,e){var i=1;var r=v(t);for(var o=0,a=p.length;o<=a;o++){var s=0;switch(e){case n.L:s=p[o][0];break;case n.M:s=p[o][1];break;case n.Q:s=p[o][2];break;case n.H:s=p[o][3];break}if(r<=s){break}else{i++}}if(i>p.length){throw new Error("Too long data")}return i}function v(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}QRCode=function(t,e){this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:n.H};if(typeof e==="string"){e={text:e}}if(e){for(var i in e){this._htOption[i]=e[i]}}if(typeof t=="string"){t=document.getElementById(t)}if(!t){t=document.createElement("div")}this._android=f();this._el=t;this._oQRCode=null;this._oDrawing=new y(this._el,this._htOption);if(this._htOption.text){this.makeCode(this._htOption.text)}};QRCode.prototype.makeCode=function(t){this._oQRCode=new e(g(t,this._htOption.correctLevel),this._htOption.correctLevel);this._oQRCode.addData(t);this._oQRCode.make();this._el.title=t;this._oDrawing.draw(this._oQRCode);this.makeImage()};QRCode.prototype.getImageSrc=function(){return this._oDrawing._elCanvas.toDataURL("image/png")};QRCode.makeImageDataURL=function(t,e,i){var n=new QRCode(null,{text:t,width:e,height:i});var r=n.getImageSrc();n._oDrawing._elImage=null;n._oDrawing._elCanvas=null;n._oDrawing=null;n=null;return r};QRCode.prototype.makeImage=function(){if(typeof this._oDrawing.makeImage=="function"&&(!this._android||this._android>=3)){this._oDrawing.makeImage()}};QRCode.prototype.clear=function(){this._oDrawing.clear()};QRCode.CorrectLevel=n;window.QRCode=QRCode})();function AppBase(t,e){this.win=null;this.view=null;this.type=e;this.minHeight=0;AppBase.type=e;this.getView=function(){return this.view};this.setMinHeight=function(t){this.minHeight=t;return};this.exec=function(t){t.doit();delete t;return};this.init=function(){if(this.type===AppBase.TYPE_INLINE_EDITOR){this.isInlineEdit=true}else{this.isInlineEdit=false}this.canvas=CantkRT.getMainCanvas();this.adjustCanvasSize();this.manager=WWindowManager.create(this,this.canvas);canvasAttachManager(this.canvas,this.manager,this);return};this.onShapeSelected=function(t){return};this.onSizeChanged=function(){return};this.adjustCanvasSize=function(){var t=0;var e=0;var i=this.canvas;var n=cantkGetViewPort();switch(this.type){case AppBase.TYPE_GENERAL:{t=n.width-20;e=n.height;break}case AppBase.TYPE_WEBAPP:{t=n.width;e=n.height;break}case AppBase.TYPE_PREVIEW:{t=n.width;e=n.height;this.setMinHeight(1500);break}default:{if(!this.minHeight){this.setMinHeight(800)}t=n.width-20;e=n.height;break}}e=Math.max(e,this.minHeight);this.resizeCanvasTo(t,e);return};this.resizeCanvasTo=function(t,e){var i=this.canvas;i.width=t;i.height=e;i.style.top=0;i.style.left=0;i.style.position="absolute";return};this.loadData=function(t){return this.view.loadFromJson(t)};this.exitApp=function(){console.log("exitApp");return};this.init();return this}AppBase.isDevApp=function(){return AppBase.type===AppBase.TYPE_PC_EDITOR||AppBase.type===AppBase.TYPE_MOBILE_EDITOR||AppBase.type===AppBase.TYPE_INLINE_EDITOR};AppBase.TYPE_GENERAL=0;AppBase.TYPE_WEBAPP=1;AppBase.TYPE_PREVIEW=2;AppBase.TYPE_PC_VIEWER=3;AppBase.TYPE_PC_EDITOR=4;AppBase.TYPE_MOBILE_EDITOR=5;AppBase.TYPE_INLINE_EDITOR=6;function PList(){this.options={}}PList.ST_NONE=0;PList.ST_TEXT=1;PList.ST_END_TAG=2;PList.ST_START_TAG=3;PList.prototype.onStateChanged=function(t,e){switch(this._parseState){case PList.ST_START_TAG:{this.tagName=e;break}case PList.ST_END_TAG:{this.tagName=null;break}case PList.ST_TEXT:{if(this.tagName==="key"){this._propName=e}else if(this.tagName==="real"){this.options[this._propName]=parseFloat(e)}else if(this.tagName==="integer"){this.options[this._propName]=parseInt(e)}else if(this.tagName==="string"){this.options[this._propName]=e}break}}this._parseState=t};PList.prototype.dump=function(){console.log(JSON.stringify(this.options,null,"	"))};PList.prototype.get=function(t){if(t){return this.options[t]}else{return this.options}};PList.prototype.parse=function(t){var e="";var i=t.length;this.options={};this._parseState=PList.ST_NONE;for(var n=0;n<i;n++){var r=t[n];if(r==="<"){if(t[n+1]==="/"){n++;this.onStateChanged(PList.ST_END_TAG,e)}else{this.onStateChanged(PList.ST_START_TAG,e)}e=""}else if(r===">"){this.onStateChanged(PList.ST_TEXT,e);e=""}else{e+=r}}return this.options};function WImage(t,e){if(t){this.setImageSrc(t,e)}return}WImage.nullImage=new Image;WImage.nullWImage=new WImage;WImage.onload=function(){};WImage.prototype.initFromJson=function(t,e,i){var n=t.indexOf("#");var r=t.substr(0,n);var o=t.substr(n+1);var a=dirname(r);var s=e.file?e.file:e.meta.image;var l=a+"/"+s;var h=e.frames[o];if(!h){console.log("not found src: "+t);return}var u=h.frame||h;if(!u){alert("Invalid src: "+t);return}this.rotated=h.rotated;if(h.trimmed){u.trimmed=true;u.ox=h.spriteSourceSize.x;u.oy=h.spriteSourceSize.y;u.rw=h.sourceSize.w;u.rh=h.sourceSize.h}else{u.trimmed=false;u.ox=0;u.oy=0;u.rw=0;u.rh=0}var p=this;this.rect=u;WImage.onload();ResLoader.loadImage(l,function(t){p.image=t;if(i){i(t)}});return};WImage.prototype.initFromRowColIndex=function(t,e,i){var n=this;var r=parseInt(e[1]);var o=parseInt(e[2]);var a=parseInt(e[3]);e=null;this.image=ResLoader.loadImage(t,function(t){var e=Math.round(t.width/o);var s=Math.round(t.height/r);var l=Math.floor(t.width/o);var h=Math.floor(t.height/r);var u=a%o;var p=Math.floor(a/o);n.rect={};n.rect.x=u*e;n.rect.y=p*s;n.rect.w=l;n.rect.h=h;n.image=t;if(i){i(t)}WImage.onload()});return};WImage.prototype.initFromXYWH=function(t,e,i){var n=this;var r=parseInt(e[1]);var o=parseInt(e[2]);var a=parseInt(e[3]);var s=parseInt(e[4]);e=null;this.image=ResLoader.loadImage(t,function(t){n.rect={};n.rect.x=r;n.rect.y=o;n.rect.w=a;n.rect.h=s;n.image=t;if(i){i(t)}WImage.onload()});return};WImage.prototype.setImage=function(t){this.image=t;return this};WImage.prototype.setImageSrc=function(t,e){if(!t){this.src=t;this.image=WImage.nullImage;return}if(t.indexOf("data:")===0){this.src=t;this.rect=null;this.image=CantkRT.createImage(t,e);return}t=ResLoader.toAbsURL(t);this.src=t;var i=this;var n=t.indexOf("#");if(n>0){var r=t.substr(n+1);var o=r.match(/r([0-9]+)c([0-9]+)i([0-9]+)/i);var a=r.match(/x([0-9]+)y([0-9]+)w([0-9]+)h([0-9]+)/i);if(!o&&!a){var s=t.substr(0,n);ResLoader.loadJson(s,function(n){i.initFromJson(t,n,e)})}else{t=t.substr(0,n);if(o){this.initFromRowColIndex(t,o,e)}if(a){this.initFromXYWH(t,a,e)}o=null;a=null}}else{this.image=ResLoader.loadImage(t,function(t){i.rect={};i.rect.x=0;i.rect.y=0;i.rect.w=t.width;i.rect.h=t.height;i.image=t;if(e){e(t)}WImage.onload()})}return};WImage.prototype.getImageRect=function(){if(!this.rect){this.rect={x:0,y:0,w:0,h:0}}if(!this.rect.w&&this.image){this.rect.w=this.image.width;this.rect.h=this.image.height}return this.rect};WImage.prototype.getImageSrc=function(){return this.src};WImage.prototype.getRealImageSrc=function(){return this.image?this.image.src:this.src};WImage.prototype.getImage=function(){var t=this.image;return t&&t.width>0?t:null};WImage.isValid=function(t){return t&&t.image&&t.image.width&&t.image.height};WImage.caches={};WImage.create=function(t,e){if(!t){return WImage.nullWImage}t=ResLoader.toAbsURL(t);var i=WImage.caches[t];if(i){if(e){e(i.getImage())}}else{i=new WImage(t,e);WImage.caches[t]=i}return i};WImage.createWithImage=function(t){if(!t){return WImage.nullWImage}var e=new WImage;e.setImage(t);return e};function cantkSetOnImageLoad(t){if(t){WImage.onload=t}return}WImage.DISPLAY_CENTER=0;WImage.DISPLAY_TILE=1;WImage.DISPLAY_9PATCH=2;WImage.DISPLAY_SCALE=3;WImage.DISPLAY_AUTO=4;WImage.DISPLAY_DEFAULT=5;WImage.DISPLAY_SCALE_KEEP_RATIO=6;WImage.DISPLAY_TILE_V=7;WImage.DISPLAY_TILE_H=8;WImage.DISPLAY_AUTO_SIZE_DOWN=9;WImage.DISPLAY_FIT_WIDTH=10;WImage.DISPLAY_FIT_HEIGHT=11;WImage.prototype.draw=function(t,e,i,n,r,o){var a=this.getImage();var s=this.getImageRect();return WImage.draw(t,a,e,i,n,r,o,s)};WImage.draw=function(t,e,i,n,r,o,a,s){if(!e)return;if(!s){s={};s.x=0;s.y=0;s.w=e.width;s.h=e.height}if(!s.ox){s.ox=0}if(!s.oy){s.oy=0}if(!s.rw){s.rw=s.w}if(!s.rh){s.rh=s.h}var l=s.rw;var h=s.rh;if(l<=0||h<=0){return}var u=0;var p=0;var c=s.w;var f=s.h;var m=s.x;var d=s.y;var y=s.ox;var g=s.oy;if(s.trimmed){y=s.ox;g=s.oy}switch(i){case WImage.DISPLAY_CENTER:{u=Math.floor(n+(o-l>>1))+y;p=Math.floor(r+(a-h>>1))+g;t.drawImage(e,m,d,c,f,u,p,c,f);break}case WImage.DISPLAY_AUTO_SIZE_DOWN:{var v=Math.min(Math.min(o/l,a/h),1);var _=l*v;var I=h*v;u=n+(o-_>>1);p=r+(a-I>>1);u+=Math.round(y*v);p+=Math.round(g*v);o=Math.round(c*v);a=Math.round(f*v);t.drawImage(e,m,d,c,f,u,p,o,a);break}case WImage.DISPLAY_SCALE:{var w=o/l;var x=a/h;u=Math.round(n+y*w);p=Math.round(r+g*x);o=Math.round(c*w);a=Math.round(f*x);t.drawImage(e,m,d,c,f,u,p,o,a);break}case WImage.DISPLAY_AUTO:{var v=Math.min(o/l,a/h);var _=Math.round(l*v);var I=Math.round(h*v);u=n+(o-_>>1);p=r+(a-I>>1);u+=Math.round(y*v);p+=Math.round(g*v);o=Math.round(c*v);a=Math.round(f*v);t.drawImage(e,m,d,c,f,u,p,o,a);break}case WImage.DISPLAY_9PATCH:{u=n+y;p=r+g;o-=l-c;a-=h-f;if(l>=o&&h>=a){t.drawImage(e,m,d,c,f,u,p,o,a)}else{drawNinePatchEx(t,e,m,d,c,f,u,p,o,a)}break}case WImage.DISPLAY_SCALE_KEEP_RATIO:{var v=Math.max(o/l,a/h);u=Math.round(n+y*v);p=Math.round(r+g*v);o=Math.round(c*v);a=Math.round(f*v);t.drawImage(e,m,d,c,f,u,p,o,a);break}case WImage.DISPLAY_TILE:{u=n;p=r;l=c;h=f;var S=n+o;var T=r+a;while(p<T){u=n;f=Math.min(T-p,h);while(u<S){c=Math.min(S-u,l);t.drawImage(e,m,d,c,f,u,p,c,f);u=u+c}p=p+f}break}case WImage.DISPLAY_TILE_H:{var S=n+o;u=n;l=c;h=f;f=Math.min(a,h);while(u<S){c=Math.min(S-u,l);t.drawImage(e,m,d,c,f,u,r,c,f);u=u+c}break}case WImage.DISPLAY_TILE_V:{var T=r+a;p=r;l=c;h=f;c=Math.min(o,l);while(p<T){f=Math.min(T-p,h);t.drawImage(e,m,d,c,f,n,p,c,f);p=p+f}break}case WImage.DISPLAY_FIT_WIDTH:{var v=o/l;u=Math.round(n+y*v);p=Math.round(r+g*v);o=Math.round(c*v);a=Math.round(f*v);t.drawImage(e,m,d,c,f,u,p,o,a);break}case WImage.DISPLAY_FIT_HEIGHT:{var v=a/h;u=Math.round(n+y*v);p=Math.round(r+g*v);o=Math.round(c*v);a=Math.round(f*v);t.drawImage(e,m,d,c,f,u,p,o,a);break}default:{u=n+y;p=r+g;t.drawImage(e,m,d,c,f,u,p,c,f);break}}return};function WWidget(){}WWidget.STATE_NORMAL="state-normal";WWidget.STATE_ACTIVE="state-active";WWidget.STATE_OVER="state-over";WWidget.STATE_DISABLE="state-disable";WWidget.STATE_DISABLE_SELECTED="state-disable-selected";WWidget.STATE_SELECTED="state-selected";WWidget.STATE_NORMAL_CURRENT="state-normal-current";WWidget.TYPE_NONE=0;WWidget.TYPE_USER=13;WWidget.TYPE_FRAME="frame";WWidget.TYPE_FRAMES="frames";WWidget.TYPE_TOOLBAR="toolbar";WWidget.TYPE_TITLEBAR="titlebar";WWidget.TYPE_MINIMIZE_BUTTON="button.minimize";WWidget.TYPE_FLOAT_MENU_BAR="float-menubar";WWidget.TYPE_POPUP="popup";WWidget.TYPE_DIALOG="dialog";WWidget.TYPE_WINDOW="window";WWidget.TYPE_VBOX="vbox";WWidget.TYPE_HBOX="hbox";WWidget.TYPE_MENU="menu";WWidget.TYPE_MENU_BAR="menu-bar";WWidget.TYPE_MENU_BUTTON="menubar.button";WWidget.TYPE_GRID_ITEM="grid-item";WWidget.TYPE_MENU_ITEM="menu.item";WWidget.TYPE_MENU_BAR_ITEM="menubar.item";WWidget.TYPE_CONTEXT_MENU_ITEM="contextmenu.item";WWidget.TYPE_CONTEXT_MENU_BAR="contextmenu-bar";WWidget.TYPE_VSCROLL_BAR="vscroll-bar";WWidget.TYPE_HSCROLL_BAR="hscroll-bar";WWidget.TYPE_SCROLL_VIEW="scroll-view";WWidget.TYPE_GRID_VIEW="grid-view";WWidget.TYPE_LIST_VIEW="list-view";WWidget.TYPE_LIST_ITEM="list-item";WWidget.TYPE_IMAGE_VIEW="image-view";WWidget.TYPE_TREE_VIEW="tree-view";WWidget.TYPE_TREE_ITEM="tree-item";WWidget.TYPE_ACCORDION="accordion";WWidget.TYPE_ACCORDION_ITEM="accordion-item";WWidget.TYPE_PROPERTY_TITLE="property-title";WWidget.TYPE_PROPERTY_SHEET="property-sheet";WWidget.TYPE_PROPERTY_SHEETS="property-sheets";WWidget.TYPE_VIEW_BASE="view-base";WWidget.TYPE_COMPONENT_MENU_ITEM="menuitem.component";WWidget.TYPE_WINDOW_MENU_ITEM="menuitem.window";WWidget.TYPE_MESSAGE_BOX="messagebox";WWidget.TYPE_ICON_TEXT="icon-text";WWidget.TYPE_BUTTON="button";WWidget.TYPE_LABEL="label";WWidget.TYPE_LINK="link";WWidget.TYPE_EDIT="edit";WWidget.TYPE_TEXT_AREA="text-area";WWidget.TYPE_COMBOBOX="combobox";WWidget.TYPE_SLIDER="slider";WWidget.TYPE_PROGRESSBAR="progressbar";WWidget.TYPE_RADIO_BUTTON="radio-button";WWidget.TYPE_CHECK_BUTTON="check-button";WWidget.TYPE_COLOR_BUTTON="color-button";WWidget.TYPE_COLOR_TILE="color-tile";WWidget.TYPE_TAB_BUTTON="tab-button";WWidget.TYPE_TAB_CONTROL="tab-control";WWidget.TYPE_TAB_BUTTON_GROUP="tab-button-group";WWidget.TYPE_TIPS="tips";WWidget.TYPE_HLAYOUT="h-layout";WWidget.TYPE_VLAYOUT="v-layout";WWidget.TYPE_BUTTON_GROUP="button-group";WWidget.TYPE_COMBOBOX_POUP="combobox-popup";WWidget.TYPE_COMBOBOX_POUP_ITEM="combobox-popup-item";WWidget.TYPE_COLOR_EDIT="color-edit";WWidget.TYPE_RANGE_EDIT="range-edit";WWidget.TYPE_FILENAME_EDIT="filename-edit";WWidget.TYPE_FILENAMES_EDIT="filenames-edit";WWidget.TYPE_CANVAS_IMAGE="canvas-image";WWidget.TYPE_ICON_BUTTON="icon-button";WWidget.BORDER_STYLE_NONE=0;WWidget.BORDER_STYLE_LEFT=1;WWidget.BORDER_STYLE_RIGHT=2;WWidget.BORDER_STYLE_TOP=4;WWidget.BORDER_STYLE_BOTTOM=8;WWidget.BORDER_STYLE_ALL=65535;WWidget.prototype={};WWidget.prototype.init=function(t,e,i,n,r){this.text="";this.tag=null;this.tips=null;this.enable=true;this.visible=true;this.parent=t;this.checkEnable=null;this.children=[];this.point={x:0,y:0};this.rect={x:e,y:i,w:n,h:r};this.setState(WWidget.STATE_NORMAL);this.imageDiplay=WImage.DISPLAY_9PATCH;this.borderStyle=WWidget.BORDER_STYLE_ALL;if(this.parent!==null){var o=t.border?t.border:0;var a=t.rect.w-2*o;var s=t.rect.h-2*o;if(e>0&&e<1){this.rect.x=a*e+o}if(n>0&&n<=1){this.rect.w=a*n}if(i>0&&i<1){this.rect.y=s*i+o}if(r>0&&r<=1){this.rect.h=s*r}t.appendChild(this)}return this};WWidget.prototype.useTheme=function(t){this.themeType=t;return this};WWidget.prototype.setSelectable=function(t){this.selectable=t;return true};WWidget.prototype.setNeedRelayout=function(t){this.needRelayout=t;return};WWidget.prototype.onAppendChild=function(t){};WWidget.prototype.appendChild=function(t){t.parent=this;this.children.push(t);this.onAppendChild(t);this.needRelayout=true;return};WWidget.prototype.getWindowManager=function(){return WWindowManager.getInstance()};WWidget.prototype.getFrameRate=function(){return WWindowManager.getInstance().getFrameRate()};WWidget.prototype.showFPS=function(t){return WWindowManager.getInstance().showFPS(t)};WWidget.prototype.isPointerDown=function(){return WWindowManager.getInstance().isPointerDown()};WWidget.prototype.isClicked=function(){var t=this.getWindow();if(t){return t.isClicked()}else{return WWindowManager.getInstance().isClicked()}};WWidget.prototype.isAltDown=function(){return WWindowManager.getInstance().isAltDown()};WWidget.prototype.isCtrlDown=function(){return WWindowManager.getInstance().isCtrlDown()};WWidget.prototype.getApp=function(){return WWindowManager.getInstance().getApp()};WWidget.prototype.getCanvas2D=function(){return WWindowManager.getInstance().getCanvas2D()};WWidget.prototype.getCanvas=function(){return WWindowManager.getInstance().getCanvas()};WWidget.prototype.getLastPointerPoint=function(){return WWindowManager.getInstance().getLastPointerPoint()};WWidget.prototype.getTopWindow=function(){return this.getWindow()};WWidget.prototype.getWindow=function(){if(this.parent){return this.parent.getWindow()}return this};WWidget.prototype.getParent=function(){return this.parent};WWidget.prototype.getX=function(){return this.rect.x};WWidget.prototype.getY=function(){return this.rect.y};WWidget.prototype.getWidth=function(){return this.rect.w};WWidget.prototype.getHeight=function(){return this.rect.h};WWidget.prototype.getPositionInView=function(){var t=this.getX();var e=this.getY();var i={x:0,y:0};var n=this.getParent();while(n!=null){t+=n.getX();e+=n.getY();if(n.isScrollView){t=t-n.xOffset;e=e-n.yOffset}n=n.getParent()}i.x=t;i.y=e;return i};WWidget.prototype.getAbsPosition=function(){var t=this.rect.x;var e=this.rect.y;for(var i=this.parent;i;i=i.parent){t=t+i.rect.x;e=e+i.rect.y}return{x:t,y:e}};WWidget.prototype.translatePoint=function(t){var e=this.getAbsPosition();return{x:t.x-e.x,y:t.y-e.y}};WWidget.prototype.postRedrawAll=function(){WWindowManager.getInstance().postRedraw(null);return};WWidget.prototype.postRedraw=function(t){WWindowManager.getInstance().postRedraw(null);return};WWidget.prototype.redraw=function(t){var e=this.getAbsPosition();if(!t){t={x:0,y:0,w:this.rect.w,h:this.rect.h}}t.x=e.x+t.x;t.y=e.y+t.y;WWindowManager.getInstance().redraw(t);return};WWidget.prototype.isPointIn=function(t){return isPointInRect(t,this.rect)};WWidget.prototype.findTargetWidgetEx=function(t,e){if(!this.visible||!this.isPointIn(t)){return null}if(e&&this.children.length>0){var i=this.children.length-1;var n=this.point;n.x=t.x-this.rect.x;n.y=t.y-this.rect.y;for(var r=i;r>=0;r--){var o=this.children[r];var a=o.findTargetWidget(n);if(a!==null){return a}}}return this};WWidget.prototype.findTargetWidget=function(t){return this.findTargetWidgetEx(t,true)};WWidget.widgetsPool={};WWidget.getWidget=function(t){var e=WWidget.widgetsPool[t];if(e&&e.length){return e.pop()}return null};WWidget.putWidget=function(t){if(t){var e=t.type;var i=WWidget.widgetsPool[e];if(!i){WWidget.widgetsPool[e]=[];i=WWidget.widgetsPool[e]}t.themeType=null;t.userData=null;t.handleGesture=null;t.handleClicked=null;t.handleLongPressed=null;t.handleDoubleClicked=null;t.handleContextMenu=null;t.handleKeyUp=null;t.handleKeyDown=null;t.handleWheel=null;t.onChanged=null;t.onChanging=null;t.clickHandler=null;t.stateChangedHandler=null;if(t.onBeforePaint){t.onBeforePaint=null}if(t.onAfterPaint){t.onAfterPaint=null}if(t.onGetText){t.onGetText=null}i.push(t)}return};WWidget.prototype.onRemoved=function(){};WWidget.prototype.removeChild=function(t){t.remove();return this};WWidget.prototype.remove=function(){var t=this.parent;if(t){t.children.remove(this);if(t.target===this){t.target=null}this.parent=null;this.onRemoved();t.setNeedRelayout(true)}return this};WWidget.prototype.cleanUp=function(){};WWidget.prototype.destroy=function(){if(this.children.length){this.destroyChildren()}this.remove();this.cleanUp();WWidget.putWidget(this);return};WWidget.prototype.destroyChildren=function(){var t=this.children.length;for(var e=0;e<t;e++){var i=this.children[0];i.destroy()}this.target=null;this.children.length=[];this.setNeedRelayout(true);return};WWidget.prototype.forEachChild=function(t){var e=this.children.length;for(var i=0;i<e;i++){var n=this.children[i];t(n)}return};WWidget.prototype.setTextOf=function(t,e,i){var n=this.lookup(t,true);if(n){n.setText(e,i)}else{console.log("not found "+t)}return n};WWidget.prototype.setValueOf=function(t,e,i){var n=this.lookup(t,true);if(n){n.setValue(e,i)}else{console.log("not found "+t)}return n};WWidget.prototype.setVisibleOf=function(t,e){var i=this.lookup(t,true);if(i){i.setVisible(e)}else{console.log("not found "+t)}return i};WWidget.prototype.setValue=function(t){return this.setText(t)};WWidget.prototype.getValue=function(){return this.getText()};WWidget.prototype.setText=function(t){this.text=t||t===0?t.toString():"";this.setNeedRelayout(true);return this};WWidget.prototype.getText=function(){if(this.onGetText){return this.onGetText()}return this.text};WWidget.prototype.setTips=function(t){this.tips=t;return this};WWidget.prototype.getTips=function(){return this.tips};WWidget.prototype.setInputTips=function(t){this.inputTips=t;return this};WWidget.prototype.getInputTips=function(){return this.inputTips};WWidget.prototype.drawInputTips=function(t){var e=this.rect.h;var i=this.rect.w;var n=this.rect.h>>1;var r=this.leftMargin||2;var o=this.getText();var a=this.getInputTips();if(o||!a||this.type!==WWidget.TYPE_EDIT||this.editing){return}var s=this.getStyle();t.save();t.font=s.font;t.fillStyle="#E0E0E0";t.beginPath();t.rect(0,0,i-r,e);t.clip();t.textAlign="left";t.textBaseline="middle";t.fillText(a,r,n);t.restore();return};WWidget.prototype.drawTips=function(t){var e=this.getTips();if(e){var i=this.getStyle();var n=this.rect.w>>1;var r=this.rect.h>>1;t.textAlign="center";t.textBaseline="middle";t.font=i.font?i.font:"10pt bold sans-serif";t.fillStyle=i.textColor?i.textColor:"Black";t.fillText(e,n,r)}return this};WWidget.prototype.setID=function(t){this.id=t;return this};WWidget.prototype.getID=function(){return this.id};WWidget.prototype.setName=function(t){this.name=t;return this};WWidget.prototype.getName=function(){return this.name};WWidget.prototype.setTag=function(t){this.tag=t;return this};WWidget.prototype.getTag=function(){return this.tag};WWidget.prototype.setUserData=function(t){this.userData=t;return this};WWidget.prototype.getUserData=function(){return this.userData};WWidget.prototype.setEnable=function(t){this.enable=t;return this};WWidget.prototype.onStateChanged=function(t){if(this.stateChangedHandler){this.stateChangedHandler(t)}return this};WWidget.prototype.setState=function(t){if(this.state!==t){this.state=t;this.onStateChanged(t);if(t===WWidget.STATE_OVER){WWindowManager.getInstance().setTipsWidget(this)}}return this};WWidget.prototype.measure=function(t){return};WWidget.prototype.onMoved=function(){};WWidget.prototype.move=function(t,e){this.rect.x=t;this.rect.y=e;this.onMoved();return this};WWidget.prototype.moveToCenter=function(t,e){var i=this.parent.rect.w;var n=this.parent.rect.h;if(t){this.rect.x=i-this.rect.w>>1}if(e){this.rect.y=n-this.rect.h>>1}return this};WWidget.prototype.moveToBottom=function(t){var e=this.parent.rect.h;this.rect.y=e-this.rect.h-t;return this};WWidget.prototype.moveDelta=function(t,e){this.rect.x=this.rect.x+t;this.rect.y=this.rect.y+e;this.onMoved();return this};WWidget.prototype.onSized=function(t,e){};WWidget.prototype.resize=function(t,e){this.rect.w=t;this.rect.h=e;this.onSized();this.setNeedRelayout(true);return this};WWidget.prototype.setStateChangedHandler=function(t){this.stateChangedHandler=t;return this};WWidget.prototype.setClickedHandler=function(t){this.clickHandler=t;return this};WWidget.prototype.setKeyDoneHandler=function(t){this.handleKeyDown=t;return this};WWidget.prototype.setKeyUpHandler=function(t){this.handleKeyUp=t;return this};WWidget.prototype.onClicked=function(t){if(this.handleClicked){this.handleClicked(t)}if(this.clickHandler){this.clickHandler(this,t)}this.postRedraw();return this.clickHandler!=null};WWidget.prototype.lookup=function(t,e){var i=this.children.length;for(var n=0;n<i;n++){var r=this.children[n];if(r.id===t){return r}}if(e){for(var n=0;n<i;n++){var r=this.children[n];var o=r.lookup(t,e);if(o){return o}}}return null};WWidget.prototype.relayout=function(t,e){return this};WWidget.prototype.setLineWidth=function(t){this.lineWidth=t;return this};WWidget.prototype.getLineWidth=function(t){return this.lineWidth?this.lineWidth:t.lineWidth};WWidget.prototype.setRoundRadius=function(t){this.roundRadius=t;return this};WWidget.prototype.ensureTheme=function(){if(this.themeType){this.theme=WThemeManager.get(this.themeType)}else{this.theme=WThemeManager.get(this.type)}return this};WWidget.prototype.getStyle=function(t){var e=null;this.ensureTheme();var i=t?t:this.state;if(this.enable){e=this.theme[i]}else{if(i===WWidget.STATE_SELECTED){e=this.theme[WWidget.STATE_DISABLE_SELECTED]}if(!e){e=this.theme[WWidget.STATE_DISABLE]}}if(!e){e=this.theme[WWidget.STATE_NORMAL]}return e};WWidget.prototype.setImageDisplay=function(t){this.imageDiplay=t;return this};WWidget.prototype.setBorderStyle=function(t){this.borderStyle=t;return this};WWidget.prototype.paintBackground=function(t){var e=this.rect;var i=this.getStyle();if(!i)return;if(i.bgImage){var n=i.bgImage.getImage();var r=i.bgImage.getImageRect();if(n){i.bgImage.draw(t,this.imageDiplay,0,0,e.w,e.h,r)}}else{t.beginPath();if(this.roundRadius){drawRoundRect(t,e.w,e.h,this.roundRadius)}else{t.rect(0,0,e.w,e.h)}if(i.fillColor){t.fillStyle=i.fillColor;t.fill()}var o=this.getLineWidth(i);if(!o||!i.lineColor||this.borderStyle===WWidget.BORDER_STYLE_NONE){}else{var a=function(e,i){t.moveTo(e.x,e.y);t.lineTo(i.x,i.y)};t.beginPath();if(this.borderStyle&WWidget.BORDER_STYLE_LEFT){if(o===1){t.translate(.5,0)}a({x:0,y:0},{x:0,y:e.h})}if(this.borderStyle&WWidget.BORDER_STYLE_RIGHT){if(o===1){t.translate(-.5,0)}a({x:e.w,y:0},{x:e.w,y:e.h})}if(this.borderStyle&WWidget.BORDER_STYLE_TOP){if(o===1){t.translate(0,.5)}a({x:0,y:0},{x:e.w,y:0})}if(this.borderStyle&WWidget.BORDER_STYLE_BOTTOM){if(o===1){t.translate(0,-.5)}a({x:0,y:e.h},{x:e.w,y:e.h})}t.lineWidth=o;t.strokeStyle=i.lineColor;t.stroke()}t.beginPath()}return};WWidget.prototype.paintSelf=function(t){return this};WWidget.prototype.beforePaint=function(t){if(this.onBeforePaint){this.onBeforePaint(t)}return this};WWidget.prototype.afterPaint=function(t){if(this.onAfterPaint){this.onAfterPaint(t)}return this};WWidget.prototype.setPaintFocusLater=function(t){this.paintFocusLater=t;return this};WWidget.prototype.paintChildren=function(t){if(this.paintFocusLater){this.paintChildrenFocusLater(t)}else{this.paintChildrenDefault(t)}return this};WWidget.prototype.paintChildrenDefault=function(t){var e=this.children.length;for(var i=0;i<e;i++){var n=this.children[i];n.draw(t)}return};WWidget.prototype.paintChildrenFocusLater=function(t){var e=null;var i=this.children.length;for(var n=0;n<i;n++){var r=this.children[n];if(r.state===WWidget.STATE_OVER){e=r}else{r.draw(t)}}if(e){e.draw(t)}return};WWidget.prototype.ensureImages=function(){return};WWidget.prototype.draw=function(t){if(!this.visible){return}if(this.checkEnable){this.setEnable(this.checkEnable())}this.ensureImages();t.save();this.relayout(t,false);t.translate(this.rect.x,this.rect.y);this.beforePaint(t);this.paintBackground(t);this.paintSelf(t);this.paintChildren(t);this.drawInputTips(t);this.afterPaint(t);t.closePath();t.restore();return};WWidget.prototype.setVisible=function(t){this.visible=t;return this};WWidget.prototype.isVisible=function(){return this.visible};WWidget.prototype.onShow=function(t){return true};WWidget.prototype.show=function(t){var t=!!t;if(t!=this.visible){this.visible=t;this.onShow(t)}return this};WWidget.prototype.showAll=function(t){var e=this.children.length;this.show(t);for(var i=0;i<e;i++){var n=this.children[i];n.showAll(t)}if(!this.parent){this.postRedraw()}return this};WWidget.prototype.selectAllChildren=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i.checkable){i.setChecked(t)}}return this};WWidget.prototype.closeWindow=function(t){this.getWindow().close(t);return this};WWidget.prototype.findTarget=function(t){var e=this.getAbsPosition();this.point.x=t.x-e.x;this.point.y=t.y-e.y;var i=this.children.length;if(i>0){for(var n=i-1;n>=0;n--){var r=this.children[n];if(!r.visible){continue}if(isPointInRect(this.point,r.rect)){return r}}}return null};WWidget.prototype.onPointerDown=function(t){if(!this.enable)return false;var e=this.findTarget(t);if(this.target){if(this.target!==e){this.target.setState(WWidget.STATE_NORMAL)}}if(e){e.setState(WWidget.STATE_ACTIVE);e.onPointerDown(t)}else{if(this.state!==WWidget.STATE_DISABLE){this.setState(WWidget.STATE_ACTIVE)}}this.target=e;return true};WWidget.prototype.onPointerMove=function(t){if(!this.enable)return false;var e=this.findTarget(t);this.pointerOverr=isPointInRect(t,this.rect);if(this.target){if(this.target.state===WWidget.STATE_OVER||this.target.state===WWidget.STATE_ACTIVE){if(this.target!==e){this.target.setState(WWidget.STATE_NORMAL)}}this.target.onPointerMove(t)}if(e){if(this.isPointerDown()){e.setState(WWidget.STATE_ACTIVE)}else{e.setState(WWidget.STATE_OVER)}}if(this.target!==e){this.postRedraw();this.target=e;if(this.target){this.target.onPointerMove(t)}}return true};WWidget.prototype.onPointerUp=function(t){if(this.enable){var e=this.target;if(e){if(e.state!==WWidget.STATE_DISABLE){e.onPointerUp(t)}}if(this.isClicked()){try{this.onClicked(t)}catch(i){console.debug("stack:",i.stack);console.debug("this.onClicked:"+i.message)}}}if(this.selectable){this.setState(WWidget.STATE_SELECTED)}else{this.setState(WWidget.STATE_OVER)}return true};WWidget.prototype.onKeyDown=function(t){if(this.target){this.target.onKeyDown(t)}if(this.handleKeyDown){this.handleKeyDown(t)}console.log("onKeyUp WWidget:"+this.type+" code="+t);return};WWidget.prototype.onKeyUp=function(t){if(this.target){this.target.onKeyUp(t)}if(this.handleKeyUp){this.handleKeyUp(t)}console.log("onKeyUp WWidget:"+this.type+" code="+t);return};WWidget.prototype.onWheel=function(t){if(this.target){return this.target.onWheel(t)}if(this.handleWheel){return this.handleWheel(t)}return false};WWidget.prototype.onDoubleClick=function(t){var e=null;if(this.grabWidget){e=this.grabWidget}else{e=this.findTarget(t)}if(e){e.onDoubleClick(t);this.target=e}if(this.state!==WWidget.STATE_DISABLE&&this.handleDoubleClicked){this.handleDoubleClicked(t)}return};WWidget.prototype.onContextMenu=function(t){var e=this.findTarget(t);if(e){e.onContextMenu(t);this.target=e}if(this.state!==WWidget.STATE_DISABLE&&this.handleContextMenu){this.handleContextMenu(t)}return};WWidget.prototype.onLongPress=function(t){var e=this.findTarget(t);if(e){e.onLongPress(t);this.target=e}if(this.state!==WWidget.STATE_DISABLE&&this.handleLongPressed){this.handleLongPressed(t)}return};WWidget.prototype.onGesture=function(t){var e=this.findTarget(point);if(e){e.onGesture(t)}if(this.state!==WWidget.STATE_DISABLE&&this.handleGesture){this.handleGesture(t)}return};function WThemeManager(){}WThemeManager.newStyle=function(t,e,i,n,r){var o={};if(t){o.font=t}if(r){o.bgImage=r}if(e){o.fillColor=e}if(i){o.textColor=i}if(n){o.lineColor=n}return o};WThemeManager.newTheme=function(){var t={};t[WWidget.STATE_NORMAL]=WThemeManager.newStyle("13pt bold sans-serif ",null,"#000000","#000000");t[WWidget.STATE_ACTIVE]=WThemeManager.newStyle("13pt bold sans-serif ",null,"#000000");t[WWidget.STATE_OVER]=WThemeManager.newStyle("13pt bold sans-serif ",null,"#000000");t[WWidget.STATE_DISABLE]=WThemeManager.newStyle("13pt bold sans-serif ",null,"Gray");t[WWidget.STATE_SELECTED]=WThemeManager.newStyle("13pt bold sans-serif ",null,"Gray");return t};WThemeManager.themes={};WThemeManager.imagesURL=null;WThemeManager.defaultTheme=WThemeManager.newTheme();WThemeManager.themeURL="/ide/images/light/theme.json";WThemeManager.setImagesURL=function(t){WThemeManager.imagesURL=t;return};WThemeManager.getIconImageURL=function(){return WThemeManager.imagesURL};WThemeManager.getBgImageURL=function(){return WThemeManager.imagesURL};WThemeManager.imagesCache={};WThemeManager.getImage=function(t){var e=WThemeManager.imagesCache[t];if(!e){e=WImage.create(t)}return e};WThemeManager.getIconImage=function(t){if(!WThemeManager.imagesURL){return null}var e=WThemeManager.imagesURL+"#"+t+".png";return this.getImage(e)};WThemeManager.getBgImage=function(t){if(!WThemeManager.imagesURL){return null}var e=WThemeManager.imagesURL+"#"+t;return this.getImage(e)};WThemeManager.setTheme=function(t){WebStorage.set("wtkTheme",t);location.href=location.href;return};WThemeManager.getThemeURL=function(){var t=getQueryParameter("theme-url");if(t){return t}var e=getQueryParameter("theme");if(e){return"/ide/images/"+e+"/theme.json"}var i=WebStorage.get("wtkTheme");if(i){return"/ide/images/"+i+"/theme.json"}return WThemeManager.themeURL};WThemeManager.loadTheme=function(t,e){var i=dirname(t);var n=i+"/"+(e.imagesURL?e.imagesURL:"images.json");WThemeManager.setImagesURL(n);var r=e.widgets;for(var o in r){var a=r[o];for(var s in a){var l=a[s];if(l.bgImage){l.bgImage=WThemeManager.getBgImage(l.bgImage)}if(l.fgImage){l.fgImage=WThemeManager.getBgImage(l.fgImage)}if(l.bgImageTips){l.bgImageTips=WThemeManager.getBgImage(l.bgImageTips)}if(l.font){l.fontSize=getFontSizeInFont(l.font);if(l.fontSize){l.fontSize=12}}}}WThemeManager.themes=r;WThemeManager.themesLoaded=true;WThemeManager.jqueryTheme=e.jqueryTheme;WThemeManager.codeEditorTheme=e.codeEditorTheme;if(WThemeManager.overrideThemeData){WThemeManager.mergeTheme(WThemeManager.overrideThemeData)}return};WThemeManager.setOverrideThemeData=function(t){
if(WThemeManager.themesLoaded){WThemeManager.mergeTheme(t)}else{WThemeManager.overrideThemeData=t}return};WThemeManager.mergeTheme=function(t){for(var e in t){var i=t[e];for(var n in i){var r=i[n];if(r.bgImage){r.bgImage=WThemeManager.getImage(r.bgImage)}if(r.fgImage){r.fgImage=WThemeManager.getImage(r.fgImage)}if(r.bgImageTips){r.bgImageTips=WThemeManager.getImage(r.bgImageTips)}if(r.font){r.fontSize=getFontSizeInFont(r.font);if(r.fontSize){r.fontSize=12}}}WThemeManager.themes[e]=t[e]}return};WThemeManager.getCodeEditorTheme=function(){return WThemeManager.codeEditorTheme};WThemeManager.getJQueryTheme=function(){return WThemeManager.jqueryTheme};WThemeManager.loadThemeURL=function(t){if(!t){t=WThemeManager.getThemeURL()}httpGetJSON(t,function e(i){WThemeManager.loadTheme(t,i);var n=WWindowManager.getInstance();if(n){n.postRedraw()}});return};WThemeManager.exist=function(t){return WThemeManager.themes[t]!=null};WThemeManager.dump=function(){var t=JSON.stringify(WThemeManager.themes,null,"	");console.log(t);return};WThemeManager.get=function(t,e){t=t.toString();var i=WThemeManager.themes[t];if(!i){if(e){WThemeManager.themes[t]=WThemeManager.newTheme();i=WThemeManager.themes[t]}else{i=WThemeManager.defaultTheme}}return i};WThemeManager.set=function(t,e,i,n,r,o,a){if(e===null){WThemeManager.setOneState(t,WWidget.STATE_NORMAL,i,n,r,o,a);WThemeManager.setOneState(t,WWidget.STATE_ACTIVE,i,n,r,o,a);WThemeManager.setOneState(t,WWidget.STATE_OVER,i,n,r,o,a);WThemeManager.setOneState(t,WWidget.STATE_SELECTED,i,n,r,o,a);WThemeManager.setOneState(t,WWidget.STATE_DISABLE,i,n,r,o,a)}else{WThemeManager.setOneState(t,e,i,n,r,o,a)}return};WThemeManager.setOneState=function(t,e,i,n,r,o,a){t=t.toString();var s=WThemeManager.themes[t];if(!s){s=WThemeManager.newTheme();WThemeManager.themes[t]=s}if(i){s[e].font=i}if(n){s[e].textColor=n}if(bgColor){s[e].fillColor=bgColor}if(o){s[e].lineColor=o}if(a){s[e].bgImage=a}return};function WWindow(){}WWindow.prototype=new WWidget;WWindow.prototype.init=function(t,e,i,n,r){this.type=this.type?this.type:WWidget.TYPE_WINDOW;WWidget.prototype.init.call(this,null,e,i,n,r);this.grabWidget=null;this.manager=t?t:WWindowManager.getInstance();var o=this;setTimeout(function(){o.manager.addWindow(o)},0);this.pointerDownPosition={x:0,y:0};this.pointerUpPosition={x:0,y:0};this.pointerLastPosition={x:0,y:0};return this};WWindow.prototype.grab=function(t){this.grabWidget=t;this.manager.grab(this);return this};WWindow.prototype.ungrab=function(){this.grabWidget=null;this.manager.ungrab(this);return this};WWindow.prototype.moveToCenter=function(){var t=cantkGetViewPort();var e=Math.min(this.manager.w,t.width);var i=Math.min(this.manager.h,t.height);var n=(e-this.rect.w)/2;var r=(i-this.rect.h)/2+getScrollTop();this.rect.x=n;this.rect.y=r;return this};WWindow.prototype.onPointerDown=function(t){this.pointerDown=true;this.pointerDownPosition.x=t.x;this.pointerDownPosition.y=t.y;this.pointerLastPosition.x=t.x;this.pointerLastPosition.y=t.y;if(this.grabWidget){this.grabWidget.onPointerDown(t)}else{WWidget.prototype.onPointerDown.call(this,t)}this.postRedraw();return};WWindow.prototype.onPointerMove=function(t){this.pointerLastPosition.x=t.x;this.pointerLastPosition.y=t.y;if(this.grabWidget){this.grabWidget.onPointerMove(t)}else{WWidget.prototype.onPointerMove.call(this,t)}this.postRedraw();return};WWindow.prototype.onPointerUp=function(t){if(!this.pointerDown){}this.pointerUpPosition.x=t.x;this.pointerUpPosition.y=t.y;if(this.grabWidget){this.grabWidget.onPointerUp(t)}else{WWidget.prototype.onPointerUp.call(this,t)}this.pointerDown=false;this.postRedraw();return};WWindow.prototype.isClicked=function(){var t=this.pointerLastPosition.x-this.pointerDownPosition.x;var e=this.pointerLastPosition.y-this.pointerDownPosition.y;return Math.abs(t)<5&&Math.abs(e)<5};WWindow.prototype.onContextMenu=function(t){if(this.grabWidget){this.grabWidget.onContextMenu(t)}else{WWidget.prototype.onContextMenu.call(this,t)}return};WWindow.prototype.onKeyDown=function(t){if(this.grabWidget){this.grabWidget.onKeyDown(t)}else{WWidget.prototype.onKeyDown.call(this,t)}return};WWindow.prototype.onKeyUp=function(t){if(this.grabWidget){this.grabWidget.onKeyUp(t)}else{WWidget.prototype.onKeyUp.call(this,t)}return};WWindow.prototype.beforePaint=function(t){t.beginPath();t.rect(0,0,this.rect.w,this.rect.h);t.clip();t.beginPath();return};WWindow.prototype.show=function(t){WWidget.prototype.show.call(this,t);return this};WWindow.prototype.close=function(t){var e=this;setTimeout(function(){e.closeSync(t)},10);return this};WWindow.prototype.closeSync=function(t){if(this.onClosed){this.onClosed(t)}this.manager.ungrab(this);this.manager.removeWindow(this);this.destroy();return};WWindow.create=function(t,e,i,n,r){var o=new WWindow;this.onClosed=null;return o.init(t,e,i,n,r)};function WViewBase(){}WViewBase.prototype=new WWidget;WViewBase.prototype.init=function(t,e,i,n,r){WWidget.prototype.init.call(this,t,e,i,n,r);this.xscale=1;this.yscale=1;this.allShapes=[];this.autoResize=false;this.pointerDownPosition={x:0,y:0};this.lastPointerPosition={x:0,y:0};this.style=WThemeManager.newStyle("13pt bold sans-serif","White","Black","Black",null);this.md="ma"+"gic"+"Da"+"ta";return this};WViewBase.prototype.getStyle=function(){return this.style};WViewBase.prototype.getScale=function(){return this.xscale};WViewBase.prototype.getViewScale=function(){return this.getScale()};WViewBase.prototype.onShapeSelected=function(t){this.getApp().onShapeSelected(t);return};WViewBase.prototype.setAutoResize=function(){this.autoResize=true;return};WViewBase.prototype.initPage=function(t,e){var i={};i.index=t?t:0;i.shapes=e?e:[];return i};WViewBase.prototype.getPages=function(){return this.pages};WViewBase.prototype.newPage=function(){var t=this.getPageNr();var e=this.currentPage+1;var i=this.initPage(e,null);this.pages.push(i);this.saveCurrentPage();if(t>1){for(var n=t;n>e;n--){this.pages[n]=this.pages[n-1]}this.pages[e]=i}this.currentPage=e;this.showCurrentPage();this.getApp().updateContextMenu();return};WViewBase.prototype.removeCurrentPage=function(){var t=this.getPageNr();if(t>1){this.removePage(this.currentPage)}else{this.allShapes.clear()}this.getApp().updateContextMenu();return};WViewBase.prototype.removePage=function(t){var e=this.getPageNr();if(t<0||t>=e){t=this.currentPage}var i=this.pages[t];if(this.pages.length>1){this.pages.remove(i)}if(t<=this.currentPage&&this.currentPage>=0){this.currentPage--}this.showCurrentPage();this.getApp().updateContextMenu();return};WViewBase.prototype.saveCurrentPage=function(){var t=new Array;for(var e=0;e<this.allShapes.length;e++){var i=this.allShapes[e];t.push(i.toJson())}this.pages[this.currentPage]=this.initPage(this.currentPage,t);return};WViewBase.prototype.setMetaInfo=function(t){this.meta=t;return};WViewBase.prototype.getMetaInfo=function(){return this.meta};WViewBase.prototype.getAppIcon=function(){return this.meta.general.appIcon};WViewBase.prototype.getAppName=function(){return this.meta.general.appname};WViewBase.prototype.getAppDesc=function(){return this.meta.general.appdesc};WViewBase.prototype.getAppID=function(){return this.meta.general.appid};WViewBase.prototype.setAppID=function(t){this.meta.general.appid=t;return this};WViewBase.generateDocID=function(){return Math.round(Math.random()*100)+""+Date.now()};WViewBase.prototype.getDocID=function(){return this.docid?this.docid:WViewBase.generateDocID()};WViewBase.prototype.saveAsJsonObj=function(){var t={};var e=null;var i=new Date;var n=ShapeFactory.getInstance().getDiagramTypes();this.saveCurrentPage();t.w=this.rect.w;t.h=this.rect.h;t.version=1;t.magic="drawapps";t.scale=this.xscale;t.type=this.type?this.type:n[0].name;t.docid=this.getDocID();t.meta=this.meta;t.pages=this.pages;t.saveDate=i.toLocaleString();return t};WViewBase.prototype.saveAsJson=function(){var t=this.saveAsJsonObj();var e=JSON.stringify(t,null,"	");return e};WViewBase.prototype.parseJson=function(t){if(!t){return null}var e=null;try{e=JSON.parse(t);if(!e.magic){console.log("Not supported type");return null}}catch(i){console.log("JSON.parse failed:"+i.message);console.log("JSON.parse failed:"+t)}return e};WViewBase.prototype.beforeLoad=function(t){WViewBase.notifyBeforeLoad(this,t);return};WViewBase.prototype.afterLoad=function(t){var e=this;WViewBase.notifyAfterLoad(this,t);cantkSetOnImageLoad(function(){e.postRedraw()});window[this.md]=window.sum(getQueryParameter("ap"+"p"+"id"));window["st"+"ur"+"l"]="/stati"+"stics.p"+"hp";return};WViewBase.prototype.loadJson=function(t){var e=null;if(!t||!t.pages){this.pages=new Array;this.pages.push(this.initPage(0,null));this.currentPage=0;this.showCurrentPage();return}this.beforeLoad(t);if(this.autoResize){this.xscale=this.rect.w/t.w;this.yscale=this.rect.h/t.h;this.xscale=this.xscale<this.yscale?this.xscale:this.yscale;this.yscale=this.xscale}else{this.xscale=1;this.yscale=1}this.docid=t.docid?t.docid:this.getDocID();this.meta=t.meta;this.pages=t.pages;this.currentPage=0;this.loading=true;this.showCurrentPage();this.afterLoad(t);this.loading=false;return};WViewBase.prototype.loadFromJson=function(t){var e=null;if(typeof t==="object"){e=t}else{e=this.parseJson(t)}this.reset();if(e){this.loadJson(e)}this.postRedraw();return};WViewBase.prototype.onPageShow=function(){};WViewBase.prototype.showCurrentPage=function(){var t=null;var e=this.pages[this.currentPage].shapes;if(!e){e=this.pages[this.currentPage].glyphs}this.allShapes.clear();if(e){var i=ShapeFactory.getInstance();for(var n=0;n<e.length;n++){var r=e[n];var o=r.type?r.type:r.id;t=i.createShape(o,C_CREATE_FOR_PROGRAM);if(t){t.fromJson(r);this.addShape(t)}else{console.log("createShape "+r.type+" fail.")}}}this.onPageShow();this.postRedraw();return};WViewBase.prototype.autoScale=function(){return};WViewBase.prototype.getPageNr=function(){return this.pages?this.pages.length:0};WViewBase.prototype.gotoPrevPage=function(){var t=this.pages.length;var e=this.currentPage-1;if(e<0){e=e+t}this.gotoPage(e);return};WViewBase.prototype.gotoNextPage=function(){var t=this.pages.length;var e=this.currentPage+1;if(e>=t){e=e-t}this.gotoPage(e);return};WViewBase.prototype.gotoPage=function(t){if(t<0||t>=this.getPageNr()){return}if(t===this.currentPage){return}this.saveCurrentPage();this.currentPage=t;this.showCurrentPage();return};WViewBase.prototype.reset=function(){this.allShapes.clear();this.postRedraw();this.pages=[];this.pages.push(this.initPage(0,null));this.meta=null;this.currentPage=0;this.docid=null;return};WViewBase.prototype.translatePoint=function(t){var e={x:t.x-this.rect.x,y:t.y-this.rect.y};e.x=Math.round(e.x/this.xscale);e.y=Math.round(e.y/this.yscale);return e};WViewBase.prototype.onNewShape=function(t){};WViewBase.prototype.addShape=function(t){this.allShapes.push(t);t.setView(this);t.setApp(this.getApp());if(this.creatingShape){this.removeShape(this.creatingShape);this.creatingShape=null}if(t.state!==Shape.STAT_NORMAL){this.creatingShape=t}if(t.mode!=Shape.MODE_RUNNING&&t.isUIDevice){this.autoScale()}this.onNewShape(this.creatingShape);return};WViewBase.prototype.removeShape=function(t){this.allShapes.remove(t);t.setView(null);t.onRemoved();return};WViewBase.prototype.getSelectedShapes=function(t){var e=[];for(var i=0;i<this.allShapes.length;i++){var n=this.allShapes[i];if(n.selected){e.push(n);continue}if(t&&n.isContainer){n.findSelectedShapes(e)}}return e};WViewBase.prototype.countShape=function(t){if(!this.allShapes){return 0}var e=this.allShapes.length;if(t){var i=this.getSelectedShapes(true);e=i.length}return e};WViewBase.prototype.getSelectedShape=function(){var t=this.getSelectedShapes(true);if(t.length){return t[0]}return null};WViewBase.prototype.selectAll=function(t){for(var e=0;e<this.allShapes.length;e++){var i=this.allShapes[e];i.setSelected(t)}this.postRedraw();return};WViewBase.prototype.beforePaint=function(t){return};WViewBase.prototype.afterPaint=function(t){return};WViewBase.prototype.drawSelf=function(t){this.postRedraw();return};WViewBase.prototype.shouldShowLogo=function(){return false};WViewBase.prototype.drawLogo=function(){};WViewBase.prototype.showPageIndicator=function(){};WViewBase.prototype.paintSelf=function(t){var e=this.rect.w;var i=this.rect.h;var n=null;t.save();t.beginPath();t.rect(0,0,e,i);t.clip();t.beginPath();t.save();this.beforePaint(t);t.shadowBlur=null;this.drawLogo(t);t.scale(this.xscale,this.yscale);for(var r=0;r<this.allShapes.length;r++){var o=this.allShapes[r];if(o.selected&&!n&&o.isLine){n=o}else{o.paint(t)}}if(n){n.paint(t)}this.afterPaint(t);t.restore();t.restore();var a=i/30;if(a>10){a=10}this.showPageIndicator(t);return};WViewBase.prototype.selectShapeByPoint=function(t,e){for(var i=this.allShapes.length-1;i>=0;i--){var n=this.allShapes[i];if(n.hitTest(t)){if(n.isContainer){n=n.findShapeByPoint(t,e)}this.postRedraw();this.targetShape=null;if(n.parentShape){n.parentShape.selected=false}if(!n.selected){n.setSelected(false)}n.setSelected(!n.selected);return n}}return null};WViewBase.prototype.getMoveDeltaX=function(){return this.moveDeltaX};WViewBase.prototype.getMoveDeltaY=function(){return this.moveDeltaY};WViewBase.prototype.getMoveAbsDeltaX=function(){return this.moveAbsDeltaX};WViewBase.prototype.getMoveAbsDeltaY=function(){return this.moveAbsDeltaY};WViewBase.prototype.updateLastPointerPoint=function(t){this.moveDeltaX=t.x-this.lastPointerPosition.x;this.moveDeltaY=t.y-this.lastPointerPosition.y;this.moveAbsDeltaX=t.x-this.pointerDownPosition.x;this.moveAbsDeltaY=t.y-this.pointerDownPosition.y;this.lastPointerPosition.x=t.x;this.lastPointerPosition.y=t.y;return};WViewBase.prototype.onDoubleClick=function(t){var e=this.translatePoint(t);var i=this.targetShape;if(i){i.onDoubleClick(e)}return};WViewBase.prototype.onContextMenu=WViewBase.prototype.onLongPress=function(t){var e=this.translatePoint(t);var i=this.targetShape;if(i){i.onLongPress(e)}return};WViewBase.prototype.onGesture=function(t){var e=this.targetShape;if(e){e.onGesture(t)}return};WViewBase.beforeLoadCallBacks=[];WViewBase.afterLoadCallBacks=[];function registerViewBeforeLoadListener(t){if(t){WViewBase.beforeLoadCallBacks.push(t)}return}function registerViewAfterLoadListener(t){if(t){WViewBase.afterLoadCallBacks.push(t)}return}WViewBase.notifyBeforeLoad=function(t,e){for(var i=0;i<WViewBase.beforeLoadCallBacks.length;i++){WViewBase.beforeLoadCallBacks[i](t,e)}return};WViewBase.notifyAfterLoad=function(t,e){for(var i=0;i<WViewBase.afterLoadCallBacks.length;i++){WViewBase.afterLoadCallBacks[i](this,e)}return};WViewBase.prototype.getCreatingShape=function(){return null};function WWindowManager(){return}WWindowManager.create=function(t,e){WWindowManager.instance=new WWindowManager;return WWindowManager.instance.init(t,e)};WWindowManager.getInstance=function(){return WWindowManager.instance};WWindowManager.prototype.init=function(t,e){this.app=t;this.canvas=e;this.w=e.width;this.h=e.height;this.last_point=0;this.pointerDown=0;this.target=null;this.drawCount=0;this.requestCount=0;this.startTime=Date.now();this.windows=new Array;this.grabWindows=new Array;this.eventLogging=false;this.pointerDownPoint={x:0,y:0};this.lastPointerPoint={x:0,y:0};this.enablePaint=true;this.beforeDrawHandlers=[];return this};WWindowManager.prototype.getApp=function(){return this.app};WWindowManager.prototype.preprocessEvent=function(t,e,i){this.currentEvent=e.originalEvent?e.originalEvent:e;return true};WWindowManager.prototype.getCanvas2D=function(){var t=this.canvas.getContext("2d");t["imageSmoothingEnabled"]=true;t["webkitImageSmoothingEnabled"]=true;t["mozImageSmoothingEnabled"]=true;t["msImageSmoothingEnabled"]=true;return t};WWindowManager.prototype.getCanvas=function(){return this.canvas};WWindowManager.prototype.getWidth=function(){return this.canvas.width};WWindowManager.prototype.getHeight=function(){return this.canvas.height};WWindowManager.prototype.findTargetWin=function(t){var e=null;var i=this.grabWindows.length;if(i>0){for(var n=i-1;n>=0;n--){e=this.grabWindows[n];if(!e.visible){continue}return e}}i=this.windows.length;for(var n=i-1;n>=0;n--){var r=this.windows[n];if(!r.visible){continue}if(isPointInRect(t,r.rect)){e=r;break}}return e};WWindowManager.prototype.resize=function(t,e){this.w=t;this.h=e;this.postRedraw();return};WWindowManager.prototype.grab=function(t){this.grabWindows.push(t);return};WWindowManager.prototype.ungrab=function(t){this.grabWindows.remove(t);return};WWindowManager.prototype.onDoubleClick=function(t){this.target=this.findTargetWin(t);if(this.target){this.target.onDoubleClick(t)}else{console.log("Window Manager: no target for x="+t.x+" y="+t.y)}return};WWindowManager.prototype.onLongPress=function(t){this.target=this.findTargetWin(t);if(this.target){this.target.onLongPress(t)}else{console.log("Window Manager: no target for x="+t.x+" y="+t.y)}return};WWindowManager.prototype.onGesture=function(t){cantkHideAllInput();var e={x:this.w/2,y:this.h/2};this.target=this.findTargetWin(e);if(this.target){this.target.onGesture(t);console.log("WWindowManager.prototype.onGesture: scale="+t.scale+" rotation="+t.rotation)}else{console.log("Window Manager: no target for x="+e.x+" y="+e.y)}return};WWindowManager.setInputScale=function(t,e){WWindowManager.xInputScale=t;WWindowManager.yInputScale=e;return};WWindowManager.prototype.translatePoint=function(t){if(WWindowManager.xInputScale){t.x=Math.round(t.x*WWindowManager.xInputScale)}if(WWindowManager.yInputScale){t.y=Math.round(t.y*WWindowManager.yInputScale)}return t};WWindowManager.prototype.onPointerDown=function(t){cantkHideAllInput();this.translatePoint(t);this.target=this.findTargetWin(t);for(var e=0;e<this.windows.length;e++){var i=this.windows[e];if(i.state===WWidget.STATE_SELECTED&&i!==this.target){i.setState(WWidget.STATE_NORMAL)}}this.pointerDown=true;this.pointerDownPoint.x=t.x;this.pointerDownPoint.y=t.y;this.lastPointerPoint.x=t.x;this.lastPointerPoint.y=t.y;if(this.target){t.time=Date.now();this.target.onPointerDown(t)}else{console.log("Window Manager: no target for x="+t.x+" y="+t.y)}return};WWindowManager.prototype.onPointerMove=function(t){this.translatePoint(t);var e=this.findTargetWin(t);this.lastPointerPoint.x=t.x;this.lastPointerPoint.y=t.y;if(this.target&&e!=this.target){this.target.onPointerMove(t)}this.target=e;if(this.target){t.time=Date.now();this.target.onPointerMove(t)}return};WWindowManager.prototype.onPointerUp=function(t){this.translatePoint(t);t=this.lastPointerPoint;this.target=this.findTargetWin(t);if(this.target){t.time=Date.now();this.target.onPointerUp(t)}else{console.log("Window Manager: no target for x="+t.x+" y="+t.y)}this.pointerDown=false;return};WWindowManager.prototype.getLastPointerPoint=function(){return this.lastPointerPoint};WWindowManager.prototype.isPointerDown=function(){return this.pointerDown};WWindowManager.prototype.isClicked=function(){var t=Math.abs(this.lastPointerPoint.x-this.pointerDownPoint.x);var e=Math.abs(this.lastPointerPoint.y-this.pointerDownPoint.y);return t<10&&e<10};WWindowManager.prototype.isCtrlDown=function(){return this.currentEvent&&this.currentEvent.ctrlKey};WWindowManager.prototype.isAltDown=function(){return this.currentEvent&&this.currentEvent.altKey};WWindowManager.prototype.onContextMenu=function(t){this.target=this.findTargetWin(t);if(this.target){this.target.onContextMenu(t)}else{console.log("Window Manager: no target for x="+t.x+" y="+t.y)}return};WWindowManager.prototype.onKeyDown=function(t){if(!this.target){this.target=this.findTargetWin({x:50,y:50});console.log("onKeyDown: findTargetWin="+this.target)}if(this.target!==null){this.target.onKeyDown(t)}return};WWindowManager.prototype.onKeyUp=function(t){if(this.target!==null){this.target.onKeyUp(t)}return};WWindowManager.prototype.onWheel=function(t){if(!this.target){this.target=this.findTargetWin({x:50,y:50});console.log("onWheel : findTargetWin="+this.target)}if(this.target!==null){return this.target.onWheel(t)}return false};WWindowManager.prototype.dispatchPointerMoveOut=function(){this.onPointerMove({x:-1,y:-1});this.target=null;return this};WWindowManager.prototype.addWindow=function(t){this.dispatchPointerMoveOut();this.windows.push(t);this.postRedraw();return};WWindowManager.prototype.removeWindow=function(t){this.ungrab(t);if(this.target===t){this.target=null}this.windows.remove(t);this.postRedraw();return};WWindowManager.prototype.getFrameRate=function(){var t=Date.now()-this.startTime;var e=Math.round(1e3*this.drawCount/t);if(t>1e4){this.drawCount=0;this.startTime=Date.now()}return e};WWindowManager.prototype.setMaxFPSMode=function(t){this.maxFpsMode=t;return this};WWindowManager.prototype.showFPS=function(t){this.drawCount=1;this.startTime=Date.now();this.shouldShowFPS=t;return this};WWindowManager.prototype.getPaintEnable=function(){return this.enablePaint};WWindowManager.prototype.setPaintEnable=function(t){this.enablePaint=t;console.log("setPaintEnable:"+t);if(t){this.postRedraw()}return this};WWindowManager.onDraw=function(){var t=WWindowManager.getInstance();t.drawCount++;t.requestCount=0;t.draw();return};WWindowManager.prototype.postRedraw=function(t){if(!this.enablePaint){return}this.requestCount++;if(this.requestCount<2){requestAnimFrame(WWindowManager.onDraw)}return};WWindowManager.prototype.setTipsWidget=function(t){this.tipsWidget=t;return};WWindowManager.prototype.drawTips=function(t){var e=this.tipsWidget;if(!e||!e.parent)return;var i=e.getPositionInView();t.save();t.translate(i.x,i.y);e.drawTips(t);t.restore();return};WWindowManager.prototype.drawWindows=function(t){var e=this.windows.length;for(var i=0;i<e;i++){var n=this.windows[i];n.draw(t)}this.drawTips(t);return};WWindowManager.prototype.redrawRect=function(t){var e=this.getCanvas2D();e.save();if(t){e.beginPath();e.rect(t.x,t.y,t.w,t.h);e.clip()}this.drawWindows(e);e.restore();return};WWindowManager.prototype.draw=function(){var t=this.getCanvas2D();t.animating=0;t.needRedraw=0;t.now=Date.now();t.lastUpdateTime=this.lastUpdateTime;t.timeStep=t.now-(t.lastUpdateTime||0);WWindowManager.dispatchTimers(t.now);t.save();this.drawWindows(t);t.restore();if(this.shouldShowFPS){var e="fps:"+this.getFrameRate();t.save();t.textAlign="left";t.textBaseline="top";t.font="20px Sans";t.fillStyle="Green";t.fillText(e,10,10);t.restore()}if(window.cantkRTV8||this.maxFpsMode||t.needRedraw>0){this.postRedraw()}this.canvas.flush();this.lastUpdateTime=t.now;return};WWindowManager.timerID=1e3;WWindowManager.timerFuncs=[];WWindowManager.intervalFuncs=[];WWindowManager.dispatchTimers=function(t){var e=WWindowManager.timerFuncs;var i=e.length;if(i>0){WWindowManager.timerFuncs=[];for(var n=0;n<i;n++){var r=e[id];if(r.removed)continue;if(r.timeout<=t){callback.call(window)}else{WWindowManager.timerFuncs.push(r)}}}e=WWindowManager.intervalFuncs;i=e.length;if(i>0){WWindowManager.intervalFuncs=[];for(var n=0;n<i;n++){var r=e[id];if(r.removed)continue;if(r.timeout<=t){callback.call(window);r.timeout=t+r.duration}WWindowManager.timerFuncs.push(r)}}return};WWindowManager.setTimeout=function(t,e){if(!t)return;var i=WWindowManager.timerID++;var n={id:i,callback:t};n.timeout=Date.now()+e/1e3;WWindowManager.timerFuncs.push(n);return i};WWindowManager.setInterval=function(t,e){if(!t)return;var i=WWindowManager.timerID++;var n={id:i,callback:t};n.duration=e/1e3;n.timeout=Date.now()+n.duration;WWindowManager.intervalFuncs.push(n);return i};WWindowManager.removeTimerInArr=function(t,e){var i=t.length;for(var n=0;n<i;n++){var r=t[n];if(r.id===e){r.removed=true;break}}return};WWindowManager.clearTimeout=function(t){WWindowManager.removeTimerInArr(WWindowManager.timerFuncs,t)};WWindowManager.clearInterval=function(t){WWindowManager.removeTimerInArr(WWindowManager.intervalFuncs,t)};var Aes={};Aes.cipher=function(t,e){var i=4;var n=e.length/i-1;var r=[[],[],[],[]];for(var o=0;o<4*i;o++)r[o%4][Math.floor(o/4)]=t[o];r=Aes.addRoundKey(r,e,0,i);for(var a=1;a<n;a++){r=Aes.subBytes(r,i);r=Aes.shiftRows(r,i);r=Aes.mixColumns(r,i);r=Aes.addRoundKey(r,e,a,i)}r=Aes.subBytes(r,i);r=Aes.shiftRows(r,i);r=Aes.addRoundKey(r,e,n,i);var s=new Array(4*i);for(var o=0;o<4*i;o++)s[o]=r[o%4][Math.floor(o/4)];return s};Aes.keyExpansion=function(t){var e=4;var i=t.length/4;var n=i+6;var r=new Array(e*(n+1));var o=new Array(4);for(var a=0;a<i;a++){var s=[t[4*a],t[4*a+1],t[4*a+2],t[4*a+3]];r[a]=s}for(var a=i;a<e*(n+1);a++){r[a]=new Array(4);for(var l=0;l<4;l++)o[l]=r[a-1][l];if(a%i==0){o=Aes.subWord(Aes.rotWord(o));for(var l=0;l<4;l++)o[l]^=Aes.rCon[a/i][l]}else if(i>6&&a%i==4){o=Aes.subWord(o)}for(var l=0;l<4;l++)r[a][l]=r[a-i][l]^o[l]}return r};Aes.subBytes=function(t,e){for(var i=0;i<4;i++){for(var n=0;n<e;n++)t[i][n]=Aes.sBox[t[i][n]]}return t};Aes.shiftRows=function(t,e){var i=new Array(4);for(var n=1;n<4;n++){for(var r=0;r<4;r++)i[r]=t[n][(r+n)%e];for(var r=0;r<4;r++)t[n][r]=i[r]}return t};Aes.mixColumns=function(t,e){for(var i=0;i<4;i++){var n=new Array(4);var r=new Array(4);for(var o=0;o<4;o++){n[o]=t[o][i];r[o]=t[o][i]&128?t[o][i]<<1^283:t[o][i]<<1}t[0][i]=r[0]^n[1]^r[1]^n[2]^n[3];t[1][i]=n[0]^r[1]^n[2]^r[2]^n[3];t[2][i]=n[0]^n[1]^r[2]^n[3]^r[3];t[3][i]=n[0]^r[0]^n[1]^n[2]^r[3]}return t};Aes.addRoundKey=function(t,e,i,n){for(var r=0;r<4;r++){for(var o=0;o<n;o++)t[r][o]^=e[i*4+o][r]}return t};Aes.subWord=function(t){for(var e=0;e<4;e++)t[e]=Aes.sBox[t[e]];return t};Aes.rotWord=function(t){var e=t[0];for(var i=0;i<3;i++)t[i]=t[i+1];t[3]=e;return t};Aes.sBox=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22];Aes.rCon=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]];Aes.Ctr={};Aes.Ctr.encrypt=function(t,e,i){var n=16;if(!(i==128||i==192||i==256))return"";t=Utf8.encode(t);e=Utf8.encode(e);var r=i/8;var o=new Array(r);for(var a=0;a<r;a++){o[a]=isNaN(e.charCodeAt(a))?0:e.charCodeAt(a)}var s=Aes.cipher(o,Aes.keyExpansion(o));s=s.concat(s.slice(0,r-16));var l=new Array(n);var h=(new Date).getTime();var u=h%1e3;var p=Math.floor(h/1e3);var c=Math.floor(Math.random()*65535);for(var a=0;a<2;a++)l[a]=u>>>a*8&255;for(var a=0;a<2;a++)l[a+2]=c>>>a*8&255;for(var a=0;a<4;a++)l[a+4]=p>>>a*8&255;var f="";for(var a=0;a<8;a++)f+=String.fromCharCode(l[a]);var m=Aes.keyExpansion(s);var d=Math.ceil(t.length/n);var y=new Array(d);for(var g=0;g<d;g++){for(var v=0;v<4;v++)l[15-v]=g>>>v*8&255;for(var v=0;v<4;v++)l[15-v-4]=g/4294967296>>>v*8;var _=Aes.cipher(l,m);var I=g<d-1?n:(t.length-1)%n+1;var w=new Array(I);for(var a=0;a<I;a++){w[a]=_[a]^t.charCodeAt(g*n+a);w[a]=String.fromCharCode(w[a])}y[g]=w.join("")}var x=f+y.join("");x=Base64.encode(x);return x};Aes.Ctr.decrypt=function(t,e,i){var n=16;if(!(i==128||i==192||i==256))return"";t=Base64.decode(t);e=Utf8.encode(e);var r=i/8;var o=new Array(r);for(var a=0;a<r;a++){o[a]=isNaN(e.charCodeAt(a))?0:e.charCodeAt(a)}var s=Aes.cipher(o,Aes.keyExpansion(o));s=s.concat(s.slice(0,r-16));var l=new Array(8);ctrTxt=t.slice(0,8);for(var a=0;a<8;a++)l[a]=ctrTxt.charCodeAt(a);var h=Aes.keyExpansion(s);var u=Math.ceil((t.length-8)/n);var p=new Array(u);for(var c=0;c<u;c++)p[c]=t.slice(8+c*n,8+c*n+n);t=p;var f=new Array(t.length);for(var c=0;c<u;c++){for(var m=0;m<4;m++)l[15-m]=c>>>m*8&255;for(var m=0;m<4;m++)l[15-m-4]=(c+1)/4294967296-1>>>m*8&255;var d=Aes.cipher(l,h);var y=new Array(t[c].length);for(var a=0;a<t[c].length;a++){y[a]=d[a]^t[c].charCodeAt(a);y[a]=String.fromCharCode(y[a])}f[c]=y.join("")}var g=f.join("");g=Utf8.decode(g);return g};var Base64={};Base64.code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";Base64.encode=function(t,e){e=typeof e=="undefined"?false:e;var i,n,r,o,a,s,l,h,u=[],p="",c,f,m;var d=Base64.code;f=e?t.encodeUTF8():t;c=f.length%3;if(c>0){while(c++<3){p+="=";f+="\x00"}}for(c=0;c<f.length;c+=3){i=f.charCodeAt(c);n=f.charCodeAt(c+1);r=f.charCodeAt(c+2);o=i<<16|n<<8|r;a=o>>18&63;s=o>>12&63;l=o>>6&63;h=o&63;u[c/3]=d.charAt(a)+d.charAt(s)+d.charAt(l)+d.charAt(h)}m=u.join("");m=m.slice(0,m.length-p.length)+p;return m};Base64.decode=function(t,e){e=typeof e=="undefined"?false:e;var i,n,r,o,a,s,l,h,u=[],p,c;var f=Base64.code;c=e?t.decodeUTF8():t;for(var m=0;m<c.length;m+=4){o=f.indexOf(c.charAt(m));a=f.indexOf(c.charAt(m+1));s=f.indexOf(c.charAt(m+2));l=f.indexOf(c.charAt(m+3));h=o<<18|a<<12|s<<6|l;i=h>>>16&255;n=h>>>8&255;r=h&255;u[m/4]=String.fromCharCode(i,n,r);if(l==64)u[m/4]=String.fromCharCode(i,n);if(s==64)u[m/4]=String.fromCharCode(i)}p=u.join("");return e?p.decodeUTF8():p};var Utf8={};Utf8.encode=function(t){var e=t.replace(/[\u0080-\u07ff]/g,function(t){var e=t.charCodeAt(0);return String.fromCharCode(192|e>>6,128|e&63)});e=e.replace(/[\u0800-\uffff]/g,function(t){var e=t.charCodeAt(0);return String.fromCharCode(224|e>>12,128|e>>6&63,128|e&63)});return e};Utf8.decode=function(t){var e=t.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(t){var e=(t.charCodeAt(0)&15)<<12|(t.charCodeAt(1)&63)<<6|t.charCodeAt(2)&63;return String.fromCharCode(e)});e=e.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(t){var e=(t.charCodeAt(0)&31)<<6|t.charCodeAt(1)&63;return String.fromCharCode(e)});return e};var saveAs=saveAs||typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(t){"use strict";if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var e=t.document,i=function(){return t.URL||t.webkitURL||t},n=e.createElementNS("http://www.w3.org/1999/xhtml","a"),r=!t.externalHost&&"download"in n,o=function(i){var n=e.createEvent("MouseEvents");n.initMouseEvent("click",true,false,t,0,0,0,0,0,false,false,false,false,0,null);i.dispatchEvent(n)},a=t.webkitRequestFileSystem,s=t.requestFileSystem||a||t.mozRequestFileSystem,l=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},h="application/octet-stream",u=0,p=[],c=function(){var t=p.length;while(t--){var e=p[t];if(typeof e==="string"){i().revokeObjectURL(e)}else{e.remove()}}p.length=0},f=function(t,e,i){e=[].concat(e);var n=e.length;while(n--){var r=t["on"+e[n]];if(typeof r==="function"){try{r.call(t,i||t)}catch(o){l(o)}}}},m=function(e,l){var c=this,m=e.type,d=false,y,g,v=function(){var t=i().createObjectURL(e);p.push(t);return t},_=function(){f(c,"writestart progress write writeend".split(" "))},I=function(){if(d||!y){y=v(e)}if(g){g.location.href=y}else{window.open(y,"_blank")}c.readyState=c.DONE;_()},w=function(t){return function(){if(c.readyState!==c.DONE){return t.apply(this,arguments)}}},x={create:true,exclusive:false},S;c.readyState=c.INIT;if(!l){l="download"}if(r){y=v(e);n.href=y;n.download=l;o(n);c.readyState=c.DONE;_();return}if(t.chrome&&m&&m!==h){S=e.slice||e.webkitSlice;e=S.call(e,0,e.size,h);d=true}if(a&&l!=="download"){l+=".download"}if(m===h||a){g=t}if(!s){I();return}u+=e.size;s(t.TEMPORARY,u,w(function(t){t.root.getDirectory("saved",x,w(function(t){var i=function(){t.getFile(l,x,w(function(t){t.createWriter(w(function(i){i.onwriteend=function(e){g.location.href=t.toURL();p.push(t);c.readyState=c.DONE;f(c,"writeend",e)};i.onerror=function(){var t=i.error;if(t.code!==t.ABORT_ERR){I()}};"writestart progress write abort".split(" ").forEach(function(t){i["on"+t]=c["on"+t]});i.write(e);c.abort=function(){i.abort();c.readyState=c.DONE};c.readyState=c.WRITING;
}),I)}),I)};t.getFile(l,{create:false},w(function(t){t.remove();i()}),w(function(t){if(t.code===t.NOT_FOUND_ERR){i()}else{I()}}))}),I)}),I)},d=m.prototype,y=function(t,e){return new m(t,e)};d.abort=function(){var t=this;t.readyState=t.DONE;f(t,"abort")};d.readyState=d.INIT=0;d.WRITING=1;d.DONE=2;d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null;t.addEventListener("unload",c,false);y.unload=function(){c();t.removeEventListener("unload",c,false)};return y}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content);if(typeof module!=="undefined"&&module!==null){module.exports=saveAs}else if(typeof define!=="undefined"&&define!==null&&define.amd!=null){define([],function(){return saveAs})}function WebStorage(){}WebStorage.nameSpace="";WebStorage.setNameSapce=function(t){WebStorage.nameSpace=t;return};WebStorage.getNameSapceKey=function(t){if(WebStorage.nameSpace){return WebStorage.nameSpace+"-"+t}else{return t}};WebStorage.getStorage=function(){if(window.localStorage){return window.localStorage}return{}};WebStorage.set=function(t,e,i){var n=WebStorage.getStorage();t=WebStorage.getNameSapceKey(t);if(i&&!isIE()){n[t]=strCompress(e)}else{n[t]=e}return};WebStorage.get=function(t,e){var i=WebStorage.getStorage();t=WebStorage.getNameSapceKey(t);if(e&&!isIE()){return strDecompress(i[t])}else{return i[t]}};WebStorage.remove=function(t){var e=WebStorage.getStorage();t=WebStorage.getNameSapceKey(t);delete e[t];return};WebStorage.getInt=function(t){var e=0;var i=WebStorage.get(t);if(i){e=parseInt(i)}return e};WebStorage.getSessionStorage=function(){if(window.sessionStorage){return window.sessionStorage}return{}};WebStorage.setSession=function(t,e,i){var n=WebStorage.getSessionStorage();t=WebStorage.getNameSapceKey(t);if(i&&!isIE()){n[t]=strCompress(e)}else{n[t]=e}return};WebStorage.getSession=function(t,e){var i=WebStorage.getSessionStorage();t=WebStorage.getNameSapceKey(t);if(e&&!isIE()){return strDecompress(i[t])}else{return i[t]}};WebStorage.removeSession=function(t){var e=WebStorage.getSessionStorage();t=WebStorage.getNameSapceKey(t);delete e[t];return};WebStorage.reset=function(){for(var t in localStorage){delete localStorage[t]}};WebStorage.dump=function(){for(var t in localStorage){console.log(t+":"+localStorage[t])}};function EditorElement(){this.element=null}EditorElement.prototype.setElement=function(t){this.element=t;return};EditorElement.prototype.setWrap=function(t){this.element.wrap=t;return};EditorElement.prototype.showBorder=function(t){if(t){this.element.style.background="white";this.element.style.border="1px solid";this.element.style.outline="1px"}else{this.element.style.background="transparent";this.element.style.border="0px solid";this.element.style.outline="none"}return};EditorElement.prototype.setOnChangedHandler=function(t){var e=this;this.onChanged=t;this.element.onblur=function(){if(e.onChanged){e.onChanged(this.value)}};return this};EditorElement.prototype.setOnChangeHandler=function(t){var e=this;this.onChange=t;this.element.onchange=function(){if(e.onChange){e.onChange(this.value)}};this.element.onkeyup=function(){if(e.onChange){e.onChange(this.value)}};return this};EditorElement.prototype.selectText=function(){if(this.element){this.element.select()}return this};EditorElement.prototype.setZIndex=function(t){this.element.style["z-index"]=t;return};EditorElement.prototype.setFontSize=function(t){this.element.style["font-size"]=t+"pt";return};EditorElement.prototype.setScrollType=function(t){this.element.style["overflow-y"]=t;this.element.style["overflow-x"]=t;return};EditorElement.prototype.show=function(){this.isVisibile=true;this.element.style.visibility="visible";this.element.style.zIndex=8;this.element.style.opacity=1;if(!isMobile()){this.showBorder(false)}this.element.focus();EditorElement.imeOpen=true;return};EditorElement.prototype.setInputType=function(t){this.element.type=t;return};EditorElement.getMainCanvas=function(){if(typeof UIElement!=="undefined"){return UIElement.getMainCanvas()}else{return CantkRT.getMainCanvas()}return};EditorElement.getMainCanvasScale=function(t){if(typeof UIElement!=="undefined"){return UIElement.getMainCanvasScale()}else{if(!EditorElement.canvasScale||t){var e=1;var i=1;EditorElement.canvasScale={};var n=EditorElement.getMainCanvas();if(n.style.width&&n.style.height){e=n.width/parseFloat(n.style.width);i=n.height/parseFloat(n.style.height)}EditorElement.canvasScale.x=e;EditorElement.canvasScale.y=i}return EditorElement.canvasScale}return};function setElementPosition(t,e,i){var n=EditorElement.getMainCanvasScale();e=e/n.x;i=i/n.y;t.style.position="absolute";t.style.left=Math.round(e)+"px";t.style.top=Math.round(i)+"px";t.style["opacity"]=1;return}EditorElement.prototype.blur=function(){this.element.blur()};EditorElement.prototype.hide=function(){this.isVisibile=false;this.element.style.opacity=0;this.element.style.zIndex=0;this.element.style.visibility="hidden";this.element.blur();this.element.onchange=null;EditorElement.imeOpen=false;setElementPosition(EditorElement.getMainCanvas(),0,0);if(this.onHide){this.onHide()}if(this.shape){this.shape.editing=false}return};EditorElement.prototype.move=function(t,e){this.element.style.position="absolute";this.element.style.left=t+"px";this.element.style.top=e+"px";return};EditorElement.prototype.setFontSize=function(t){this.element.style.fontSize=t+"px";return};EditorElement.prototype.resize=function(t,e){this.element.style.width=t+"px";this.element.style.height=e-6+"px";return};EditorElement.prototype.getText=function(){return this.element.value};EditorElement.prototype.setText=function(t){this.element.value=t;return};EditorElement.prototype.setShape=function(t){if(this.shape){this.hide()}this.shape=t;if(this.shape){this.shape.editing=true;this.show()}return};EditorElement.create=function(t,e){var i=new EditorElement;t.id=e;i.setElement(t);i.setFontSize(14);return i};var gCanTkInput=null;function cantkShowInput(t,e,i,n,r,o,a){n=Math.round(n);r=Math.round(r);o=Math.round(o);a=Math.round(a);if(!gCanTkInput){gCanTkInput=EditorElement.createSingleLineEdit()}gCanTkInput.setInputType(t);gCanTkInput.setFontSize(e);gCanTkInput.setText(i);gCanTkInput.move(n,r);gCanTkInput.resize(o,a);gCanTkInput.show();return gCanTkInput}var gCanTkTextArea=null;function cantkShowTextArea(t,e,i,n,r,o){i=Math.round(i);n=Math.round(n);r=Math.round(r);o=Math.round(o);if(!gCanTkTextArea){gCanTkTextArea=EditorElement.createMultiLineEdit()}gCanTkTextArea.move(i,n);gCanTkTextArea.resize(r,o);gCanTkTextArea.setFontSize(e);gCanTkTextArea.setText(t);gCanTkTextArea.show();return gCanTkTextArea}function cantkMoveEditorWhenResize(){if(gCanTkInput&&gCanTkInput.isVisibile&&gCanTkInput.shape&&gCanTkInput.shape.isUIElement){var t=gCanTkInput.shape;var e=t.getEditorRect();var i=e.x;var n=e.y;var r=e.w;var o=e.h;gCanTkInput.move(i,n);gCanTkInput.resize(r,o);console.log("Move Input To: ("+i+", "+n+")")}if(gCanTkTextArea&&gCanTkTextArea.isVisibile&&gCanTkTextArea.shape&&gCanTkTextArea.shape.isUIElement){var t=gCanTkTextArea.shape;var e=t.getEditorRect();var i=e.x;var n=e.y;var r=e.w;var o=e.h;gCanTkTextArea.move(i,n);gCanTkTextArea.resize(r,o);console.log("Move TextArea To: ("+i+", "+n+")")}return}function cantkIsEditorActive(){if(gCanTkInput&&gCanTkInput.isVisibile){return true}if(gCanTkTextArea&&gCanTkTextArea.isVisibile){return true}return false}function cantkHideAllInput(){if(gCanTkInput&&gCanTkInput.isVisibile){if(gCanTkInput.element.onchange){gCanTkInput.element.onchange()}gCanTkInput.hide()}if(gCanTkTextArea&&gCanTkTextArea.isVisibile){if(gCanTkTextArea.element.onchange){gCanTkTextArea.element.onchange()}gCanTkTextArea.hide()}return}EditorElement.createSingleLineEdit=function(){var t="singlelineedit";var e=document.createElement("input");document.body.appendChild(e);return EditorElement.create(e,t)};EditorElement.createMultiLineEdit=function(){var t="multilineedit";var e=document.createElement("textarea");document.body.appendChild(e);return EditorElement.create(e,t)};function ResLoader(){}ResLoader.total=0;ResLoader.finished=0;ResLoader.reset=function(){ResLoader.total=0;ResLoader.finished=0;return};ResLoader.toLoadInc=function(){ResLoader.total++;return};ResLoader.setOnChangedListener=function(t){ResLoader.onChanged=t};ResLoader.setOnLoadFinishListener=function(t){ResLoader.onLoadFinished=t;return};ResLoader.loadedInc=function(){ResLoader.finished++;var t=ResLoader.getPercent();if(ResLoader.onChanged){ResLoader.onChanged(t,ResLoader.finished,ResLoader.total)}if(t>=99){if(ResLoader.onLoadFinished){ResLoader.onLoadFinished()}console.log("All resource loaded:"+ResLoader.total)}return};ResLoader.getTotal=function(){return ResLoader.total};ResLoader.getFinished=function(){return ResLoader.finished};ResLoader.getPercent=function(){if(!ResLoader.total){return 100}return ResLoader.finished/ResLoader.total*100};ResLoader.cache={};ResLoader.addToCache=function(t,e){ResLoader.cache[t]=e};ResLoader.dump=function(){var t=0;for(var e in ResLoader.cache){var i=ResLoader.cache[e];var n=t+" : "+e.substr(0,255)+" status="+(i.pending?"pending":"loaded");console.log(n);t++}};setTimeout(function(){ResLoader.dump()},15e3);ResLoader.getFromCache=function(t){return ResLoader.cache[t]};ResLoader.resRoot=null;ResLoader.setResRoot=function(t){ResLoader.resRoot=t;return};ResLoader.toAbsURL=function(t){if(!t||t.indexOf("://")>0||t.indexOf("data:")===0){return t}var e=t;if(ResLoader.resRoot){e=ResLoader.resRoot+t}else if(t[0]==="/"){e=location.protocol+"//"+location.host+t}else{var i=location.protocol+"//"+location.host+location.pathname;var n=dirname(i);e=n+"/"+t}return e};function ResProxy(t,e,i){this.src=t;this.obj=null;this.pending=true;this.onSuccessList=[e];this.onFailList=[i];if(t){ResLoader.toLoadInc();ResLoader.addToCache(t,this)}else{console.log("WARNNING: load null url.")}return}ResProxy.prototype.onDone=function(t){this.obj=t;delete this.pending;ResLoader.loadedInc();try{if(t){this.callOnSuccess()}else{this.callOnFail();console.log("load "+this.src+" failed:")}}catch(e){console.log("ResProxy.prototype.onDone:"+e.message)}return};ResProxy.prototype.callOnSuccess=function(){var t=this.obj;for(var e=0;e<this.onSuccessList.length;e++){var i=this.onSuccessList[e];if(i){i(t)}}this.onFailList=[];this.onSuccessList=[];return};ResProxy.prototype.callOnFail=function(){var t=this.src;for(var e=0;e<this.onFailList.length;e++){var i=this.onFailList[e];if(i){i(t)}}this.onFailList=[];this.onSuccessList=[];return};ResProxy.prototype.onHitCache=function(t,e){if(this.pending){this.onSuccessList.push(t);this.onFailList.push(e)}else if(this.obj){ResLoader.callFunc(t,this.obj)}else{ResLoader.callFunc(e,null)}return this.obj};ResLoader.callFunc=function(t,e){if(t){try{t(e)}catch(i){console.log("ResLoader.callFunc:"+i.message)}}return};ResLoader.loadImage=function(t,e,i){var n=ResLoader.toAbsURL(t);var r=ResLoader.getFromCache(n);if(r){return r.onHitCache(e,i)}r=new ResProxy(n,e,i);function o(t){r.onDone(t)}function a(t){r.onDone(null)}var s=CantkRT.createImage(n,o,a);return s};ResLoader.loadAudio=function(t,e,i){var n=ResLoader.toAbsURL(t);var r=ResLoader.getFromCache(n);if(r){return r.onHitCache(e,i)}var o=new Audio;r=new ResProxy(n,e,i);o.volume=.8;o.addEventListener("loadstart",function(e){console.log("load start:"+t)});o.addEventListener("canplay",function(e){console.log("canplay:"+t)});o.addEventListener("canplaythrough",function(e){console.log("canplaythrough:"+t);r.onDone(o)});o.addEventListener("error",function(e){console.log("error:"+t);r.onDone(null)});o.src=n;o.load();return o};ResLoader.loadJson=function(t,e,i){var n=ResLoader.toAbsURL(t);var r=ResLoader.getFromCache(n);if(r){return r.onHitCache(e,i)}r=new ResProxy(n,e,i);httpGetJSON(n,function(t){r.onDone(t)});return};ResLoader.loadData=function(t,e,i){var n=ResLoader.toAbsURL(t);var r=ResLoader.getFromCache(n);if(r){return r.onHitCache(e,i)}r=new ResProxy(n,e,i);httpGetURL(n,function(t,e,i){r.onDone(i)});return};ResLoader.loadScript=function(t,e,i,n){var r=null;var o=document.scripts;var a=document.head?document.head:document.body;var s="timestamp="+Date.now();if(t.indexOf("?")<0){s="?"+s}else{s="&"+s}if(o){for(var l=0;l<o.length;l++){var h=o[l];if(h.src&&h.src.indexOf(t)>=0){r=h;if(i){i()}if(e){document.head.removeChild(r);break}else{return}}}}ResLoader.toLoadInc();r=document.createElement("script");r.onload=function(){if(i){i()}ResLoader.loadedInc()};r.onerror=r.onabort=r.oncancel=function(t){if(n){n()}ResLoader.loadedInc()};if(!e){r.src=t}else{r.src=t+s}a.appendChild(r);return};function WebIndexDB(t){this.iDBDatabase}WebIndexDB.prototype.get=function(t,e,i,n){var r=this.iDBDatabase.transaction(t,"readonly");var o=r.objectStore(t);var a=o.get(e);a.onsuccess=function(t){i(t.target.result)};a.onerror=function(t){n(t.target.result)}};WebIndexDB.prototype.getAll=function(t,e,i){var n=this.iDBDatabase.transaction(t,"readonly");var r=n.objectStore(t);var o=r.openCursor();var a=[];o.onsuccess=function(t){var i=t.target.result;if(i){a.push(i.value);i.continue()}else{e(a)}};o.onerror=function(t){i(t.target.result)}};WebIndexDB.prototype.put=function(t,e,i,n){var r=this.iDBDatabase.transaction(t,"readwrite");var o=r.objectStore(t);var a=o.put(e);a.onsuccess=function(t){i(t.target.result)};a.onerror=function(t){n(t.target.result)}};WebIndexDB.prototype.delete=function(t,e,i,n){var r=this.iDBDatabase.transaction(t,"readwrite");var o=r.objectStore(t);var a=o.delete(e);a.onsuccess=function(t){i(t.target.result)};a.onerror=function(t){n(t.target.result)}};WebIndexDB.asyncCreate=function(t,e,i,n){try{var r=WebIndexDB.getIndexedDBFactory().open(t)}catch(o){n(o)}r.onsuccess=function(t){i(new WebIndexDB(r.result))};r.onerror=function(t){n(t.target)};r.onupgradeneeded=function(t){for(var i=0;i<e.length;i++){r.result.createObjectStore(e[i].nameStorage,{keyPath:e[i].keyPath,autoIncrement:e[i].autoIncrement})}}};WebIndexDB.getIndexedDBFactory=function(){if(undefined!==window.indexedDB){return window.indexedDB}else if(undefined!==window.webkitIndexedDB){return window.webkitIndexedDB}else if(undefined!==window.mozIndexedDB){return window.mozIndexedDB}else if(undefined!==window.msIndexedDB){return window.msIndexedDB}throw new Error("Could not access IndexedDB Factory")};WebIndexDB.test=function(){};function BasePath(){return}BasePath.prototype.getPosition=function(t){return{x:0,y:0}};BasePath.prototype.getDirection=function(t){var e=this.getPosition(t);var i=this.getPosition(t+.1);return BasePath.angleOf(e,i)};BasePath.prototype.getStartPoint=function(){return this.startPoint?this.startPoint:this.getPosition(0)};BasePath.prototype.getEndPoint=function(){return this.endPoint?this.endPoint:this.getPosition(this.duration)};BasePath.prototype.getSamples=function(){return this.samples};BasePath.prototype.draw=function(t){var e=this.getSamples();var i=this.getStartPoint();t.moveTo(i.x,i.y);for(var n=0;n<=e;n++){var r=this.duration*n/e;var i=this.getPosition(r);t.lineTo(i.x,i.y)}return this};BasePath.angleOf=function(t,e){var i=e.x-t.x;var n=e.y-t.y;var r=Math.sqrt(i*i+n*n);if(i==0&&n==0){return 0}if(i==0){if(n<0){return 1.5*Math.PI}else{return.5*Math.PI}}if(n==0){if(i<0){return Math.PI}else{return 0}}var o=Math.asin(Math.abs(n)/r);if(i>0){if(n>0){return o}else{return 2*Math.PI-o}}else{if(n>0){return Math.PI-o}else{return Math.PI+o}}};function LinePath(t,e,i,n,r,o){this.dx=r-i;this.dy=o-n;this.x1=i;this.x2=r;this.y1=n;this.y2=o;this.duration=t;this.interpolator=e;this.angle=BasePath.angleOf({x:i,y:n},{x:r,y:o});this.startPoint={x:this.x1,y:this.y1};this.endPoint={x:this.x2,y:this.y2};return}LinePath.prototype=new BasePath;LinePath.prototype.getPosition=function(t){var e=t;var i=Math.min(e/this.duration,1);var n=this.interpolator?this.interpolator.get(i):i;var r=this.x1+this.dx*n;var o=this.y1+this.dy*n;return{x:r,y:o}};LinePath.prototype.getDirection=function(t){return this.angle};LinePath.prototype.draw=function(t){t.moveTo(this.x1,this.y1);t.lineTo(this.x2,this.y2);return this};LinePath.create=function(t,e,i,n,r,o){return new LinePath(t,e,i,n,r,o)};function ArcPath(t,e,i,n,r,o,a){this.xo=i;this.yo=n;this.r=r;this.sAngle=o;this.eAngle=a;this.duration=t;this.interpolator=e;this.angleRange=a-o;this.startPoint=this.getPosition(0);this.endPoint=this.getPosition(t);return}ArcPath.prototype=new BasePath;ArcPath.prototype.getPosition=function(t){var e=t;var i=Math.min(e/this.duration,1);var n=this.interpolator?this.interpolator.get(i):i;var r=this.sAngle+n*this.angleRange;var o=this.xo+this.r*Math.cos(r);var a=this.yo+this.r*Math.sin(r);return{x:o,y:a}};ArcPath.prototype.getDirection=function(t){var e=Math.min(t/this.duration,1);var i=this.interpolator?this.interpolator.get(e):e;var n=this.sAngle+i*this.angleRange+Math.PI*.5;return n};ArcPath.prototype.draw=function(t){t.arc(this.xo,this.yo,this.r,this.sAngle,this.eAngle,this.sAngle>this.eAngle);return this};ArcPath.create=function(t,e,i,n,r,o,a){return new ArcPath(t,e,i,n,r,o,a)};function ParaPath(t,e,i,n,r,o,a,s){this.x1=i;this.y1=n;this.ax=r;this.ay=o;this.vx=a;this.vy=s;this.duration=t;this.interpolator=e;this.startPoint=this.getPosition(0);this.endPoint=this.getPosition(t);var l=Math.abs(this.endPoint.x-this.startPoint.x);var h=Math.abs(this.endPoint.y-this.startPoint.y);this.samples=Math.max(l,h);return}ParaPath.prototype=new BasePath;ParaPath.prototype.getPosition=function(t){var e=t;var i=Math.min(e/this.duration,1);var n=this.interpolator?this.interpolator.get(i):i;e=n*this.duration/1e3;var r=.5*this.ax*e*e+this.vx*e+this.x1;var o=.5*this.ay*e*e+this.vy*e+this.y1;return{x:r,y:o}};ParaPath.create=function(t,e,i,n,r,o,a,s){return new ParaPath(t,e,i,n,r,o,a,s)};function SinPath(t,e,i,n,r,o,a,s){this.x1=i;this.y1=n;this.v=o;this.amplitude=a;this.waveLenth=r;this.duration=t;this.phaseOffset=s?s:0;this.interpolator=e;this.range=2*Math.PI*(o*t*.001)/r;this.startPoint=this.getPosition(0);this.endPoint=this.getPosition(t);var l=Math.abs(this.endPoint.x-this.startPoint.x);var h=Math.abs(this.endPoint.y-this.startPoint.y);this.samples=Math.max(l,h);return}SinPath.prototype=new BasePath;SinPath.prototype.getPosition=function(t){var e=t;var i=Math.min(e/this.duration,1);var n=this.interpolator?this.interpolator.get(i):i;e=n*this.duration;var r=e*this.v/1e3+this.x1;var o=this.amplitude*Math.sin(n*this.range+this.phaseOffset)+this.y1;return{x:r,y:o}};SinPath.create=function(t,e,i,n,r,o,a,s){return new SinPath(t,e,i,n,r,o,a,s)};function Bezier3Path(t,e,i,n,r,o,a,s,l,h){this.x1=i;this.y1=n;this.x2=r;this.y2=o;this.x3=a;this.y3=s;this.x4=l;this.y4=h;this.duration=t;this.interpolator=e;this.startPoint=this.getPosition(0);this.endPoint=this.getPosition(t);return}Bezier3Path.prototype=new BasePath;Bezier3Path.prototype.getPosition=function(t){var e=t;var i=Math.min(e/this.duration,1);var n=this.interpolator?this.interpolator.get(i):i;e=n;var r=e*e;var o=r*e;var a=1-n;var s=a*a;var l=s*a;var h=this.x1*l+3*e*this.x2*s+3*this.x3*a*r+this.x4*o;var u=this.y1*l+3*e*this.y2*s+3*this.y3*a*r+this.y4*o;return{x:h,y:u}};Bezier3Path.prototype.draw=function(t){t.moveTo(this.x1,this.y1);t.bezierCurveTo(this.x2,this.y2,this.x3,this.y3,this.x4,this.y4)};Bezier3Path.create=function(t,e,i,n,r,o,a,s,l,h){return new Bezier3Path(t,e,i,n,r,o,a,s,l,h)};function Bezier2Path(t,e,i,n,r,o,a,s){this.x1=i;this.y1=n;this.x2=r;this.y2=o;this.x3=a;this.y3=s;this.duration=t;this.interpolator=e;this.startPoint=this.getPosition(0);this.endPoint=this.getPosition(t);return}Bezier2Path.prototype=new BasePath;Bezier2Path.prototype.getPosition=function(t){var e=t;var i=Math.min(e/this.duration,1);var n=this.interpolator?this.interpolator.get(i):i;e=n;var r=e*e;var o=1-n;var a=o*o;var s=this.x1*a+2*this.x2*e*o+this.x3*r;var l=this.y1*a+2*this.y2*e*o+this.y3*r;return{x:s,y:l}};Bezier2Path.prototype.draw=function(t){t.moveTo(this.x1,this.y1);t.quadraticCurveTo(this.x2,this.y2,this.x3,this.y3)};Bezier2Path.create=function(t,e,i,n,r,o,a,s){return new Bezier2Path(t,e,i,n,r,o,a,s)};function PathAnimation(t,e){this.startPoint={x:t,y:e};this.reset();return}PathAnimation.prototype.getStartPoint=function(){return this.startPoint};PathAnimation.prototype.getEndPoint=function(){return this.endPoint};PathAnimation.prototype.reset=function(){this.endPoint={x:this.startPoint.x,y:this.startPoint.y};this.duration=0;this.paths=[];return this};PathAnimation.prototype.addPath=function(t){this.paths.push({path:t,startTime:this.duration});this.endPoint=t.getEndPoint();this.duration+=t.duration;return this};PathAnimation.prototype.addLine=function(t,e,i,n){return this.addPath(LinePath.create(t,e,i.x,i.y,n.x,n.y))};PathAnimation.prototype.addArc=function(t,e,i,n,r,o){return this.addPath(ArcPath.create(t,e,i.x,i.y,n,r,o))};PathAnimation.prototype.addPara=function(t,e,i,n,r){return this.addPath(ParaPath.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y))};PathAnimation.prototype.addSin=function(t,e,i,n,r,o,a){return this.addPath(SinPath.create(t,e,i.x,i.y,n,r,o,a))};PathAnimation.prototype.addBezier=function(t,e,i,n,r,o){return this.addPath(Bezier3Path.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y,o.x,o.y))};PathAnimation.prototype.addQuad=function(t,e,i,n,r){return this.addPath(Bezier2Path.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y))};PathAnimation.prototype.getDuration=function(){return this.duration};PathAnimation.prototype.getPathInfoByTime=function(t){var e=0;var i=this.paths;var n=i.length;for(var r=0;r<n;r++){var o=i[r];var a=o.path;var s=o.startTime;if(t>=s&&t<s+a.duration){return o}}return null};PathAnimation.prototype.getPosition=function(t){var e=this.getPathInfoByTime(t);return e?e.path.getPosition(t-e.startTime):this.endPoint};PathAnimation.prototype.getDirection=function(t){var e=this.getPathInfoByTime(t);return e?e.path.getDirection(t-e.startTime):0};PathAnimation.prototype.draw=function(t){var e=this.paths;var i=e.length;for(var n=0;n<i;n++){var r=e[n];t.beginPath();r.path.draw(t);t.stroke()}return this};PathAnimation.prototype.forEach=function(t){var e=this.paths;var i=e.length;for(var n=0;n<i;n++){t(e[n])}return this};function Command(){this.count=0;this.doit=function(){this.count=this.count+1;console.log("command: doit "+this.count);return};this.undo=function(){this.count=this.count-1;console.log("command: undo "+this.count);return}}function CompositeCommand(){}CompositeCommand.prototype.init=function(){this.cmds=[];return this};CompositeCommand.prototype.addCommand=function(t){this.cmds.push(t);return this};CompositeCommand.prototype.destroy=function(){return this.clear()};CompositeCommand.prototype.clear=function(){this.cmds.clear();return this};CompositeCommand.prototype.doit=function(){for(var t=0;t<this.cmds.length;t++){var e=this.cmds[t];e.doit()}return this};CompositeCommand.prototype.undo=function(){for(var t=0;t<this.cmds.length;t++){var e=this.cmds[t];e.undo()}return this};CompositeCommand.create=function(){var t=new CompositeCommand;return t.init()};function CommandHistory(){this.listeners=new Array;this.redos=[];this.undos=[];this.maxUndos=20;this.setMaxUndos=function(t){this.maxUndos=t;return};this.clear=function(){this.redos.clear();this.undos.clear();return};this.notify=function(){for(var t=0;t<this.listeners.length;t++){var e=this.listeners[t];e.onChanged(this.redos.length,this.undos.length)}return};this.exec=function(t){t.doit();this.undos.push(t);this.redos.clear();this.notify();if(this.undos.length>this.maxUndos){var t=this.undos.shift();delete t}return};this.redo=function(){if(this.redos.length>0){var t=this.redos.pop();t.doit();this.undos.push(t);this.notify()}return};this.undo=function(){if(this.undos.length>0){var t=this.undos.pop();t.undo();this.redos.push(t);this.notify()}return};this.countRedo=function(){return this.redos.length};this.countUndo=function(){return this.undos.length};this.addListener=function(t){this.listeners.push(t);return};this.removeListener=function(t){this.listeners.remove(t);return};return}(function(){var root=this;if(!root.CanTK){root.CanTK={}}var gCantkBuildDate="2016年 01月 05日 星期二 15:07:18 CST";console.log("cantk build date: "+gCantkBuildDate);function webappInit(t){cantkRegisterUIElements();if(t===AppBase.TYPE_PREVIEW){document.body.style.overflow="scroll"}else{document.body.style.overflow="hidden"}return}function WebApp(t){var e=["main_canvas",t];AppBase.apply(this,e);webappInit(t);this.onCanvasSized=function(t,e){this.win.resize(t,e);this.view.resize(t,e);return};this.onSizeChanged=function(){var t=cantkGetViewPort();if(t.width===this.viewPort.width&&t.height===this.viewPort.height){console.log("onSizeChanged: size is not changed.");return}this.adjustCanvasSize();var e=this.canvas.width;var i=this.canvas.height;console.log("onSizeChanged: w="+e+" h="+i);this.manager.resize(e,i);this.win.resize(e,i);this.view.resize(e,i);this.view.resizeWindowManager(e,i);this.view.moveEditor();this.viewPort=t};this.exitApp=function(){if(isTizen()){tizen.application.getCurrentApplication().exit()}else if(navigator.app){navigator.app.exitApp()}console.log("exitApp");return};this.viewPort=cantkGetViewPort();return this}WebApp.prototype.runWithURL=function(t){var e={};var i=this;e.url=t;e.headers={};e.method="GET";e.noCache=true;e.onDone=function(t,e,n){var r=e.responseText;i.runWithData(r);return};httpDoRequest(e);console.log("dataURL:"+t);return};WebApp.prototype.createWindow=function(){var t=0;var e=0;var i=this.canvas.width;var n=this.canvas.height;this.win=WWindow.create(this.manager,0,0,i,n);this.view=WAppView.create(this.win,t,e,i,n,this);this.view.forPreview=this.type===AppBase.TYPE_PREVIEW;this.win.paintBackground=function(t){};if(!this.view.forPreview){this.view.paintBackground=function(t){}}var r=this.view;this.win.onGesture=function(t){return r.onGesture(t)};return};WebApp.prototype.showWindow=function(){this.view.showIt();this.win.showAll(1);var t=this.view.getMeta();if(t&&t.general){var e=t.general.appname;document.title=e;if(isIPhone()||isIPad()){var i=document.getElementsByTagName("title");if(i&&i.length){var n=i[0];n.innerHTML=e}}}return};WebApp.prototype.runWithData=function(t){this.createWindow();this.view.loadFromJson(t);this.showWindow();return};WebApp.prototype.previewWithDeviceData=function(t){this.createWindow();this.view.beforeLoad(t);this.view.fixDeviceConfig(t);this.view.meta=t.meta;this.view.device=ShapeFactoryGet().createShape(t.type,C_CREATE_FOR_PROGRAM);this.view.deviceJson=t;this.view.afterLoad(t);this.showWindow();return};WebApp.prototype.runWithDeviceData=function(t){this.createWindow();this.view.fixDeviceConfig(t);this.view.device=t;this.view.meta=t.meta;this.view.createWindowManager=function(){var e=null;var i=this.getWindowManager();e=i;this.beforeLoad(t);i=ShapeFactoryGet().createShape(e.type,C_CREATE_FOR_PROGRAM);i.fromJson(e);this.afterLoad(t);return i};this.showWindow();return};function webappRunWithData(t){var e=new WebApp(AppBase.TYPE_WEBAPP);e.runWithData(t);return e}function webappRunWithDeviceData(t){var e=new WebApp(AppBase.TYPE_WEBAPP);e.runWithDeviceData(t);return e}function webappPreviewWithDeviceData(t){var e=new WebApp(AppBase.TYPE_PREVIEW);e.previewWithDeviceData(t);return e}function webappPreviewWithData(t){var e=new WebApp(AppBase.TYPE_PREVIEW);e.runWithData(t);return e}function webappRunWithURL(t){var e=new WebApp(AppBase.TYPE_WEBAPP);e.runWithURL(t);return e}function webappPreviewWithURL(t){var e=new WebApp(AppBase.TYPE_PREVIEW);e.runWithURL(t);return e}function shapeFixImagePath(t,e,i){var n=e.version;var r=e.platform;var o=e.lcdDensity;var a=i.version;var s=i.platform;var l=i.lcdDensity;for(var h in t.images){var u=t.images[h];if(h==="display"){continue}var p=u;if(p){p=p.replaceAll("/"+n+"/","/"+a+"/");p=p.replaceAll("/"+r+"/","/"+s+"/");p=p.replaceAll("/"+o+"/","/"+l+"/");t.images[h]=p}}if(t.children){for(var c=0;c<t.children.length;c++){shapeFixImagePath(t.children[c],e,i)}}return}function WAppView(){}WAppView.prototype=new WViewBase;WAppView.prototype.init=function(t,e,i,n,r,o){this.app=o;this.type="app-view";WViewBase.prototype.init.call(this,t,e,i,n,r);this.forPreview=false;this.platform="windowphone";if(isAndroid()){this.platform="android"}else if(isIPhone()){this.platform="iphone"}return this};WAppView.prototype.paintSelf=function(t){var e=this.allShapes;if(!e.length){return}var i=e[0];t.save();i.paint(t);t.restore();var n=i.x;var r=i.y;var o=i.w;var a=i.h;var s=this.rect.w;var l=this.rect.h;t.beginPath();if(r>0){t.rect(0,0,s,r)}if(n>0){t.rect(0,0,n,l)}var h=n+o;var u=s-h;if(u>0){t.rect(h,0,u,l)}var p=r+a;var c=l-p;if(c>0){t.rect(0,p,s,c)}if(r>0||n>0||u>0||c>0){if(i.isUIDevice){t.fillStyle="White"}else{t.fillStyle=i.style.fillColor}t.fill()}return};WAppView.prototype.onGesture=function(t){if(this.windowManager){var e=this.windowManager.getCurrentFrame();if(e){e.onGesture(t)}}return};WAppView.prototype.setTarget=function(t){for(var e=this.allShapes.length-1;e>=0;e--){var i=this.allShapes[e];if(t!==i){i.setSelected(false)}}this.targetShape=t;return};WAppView.prototype.onPointerDown=function(t){var e=this.translatePoint(t);this.pointerDownPosition.x=e.x;this.pointerDownPosition.y=e.y;this.lastPointerPosition.x=e.x;this.lastPointerPosition.y=e.y;this.updateLastPointerPoint(e);for(var i=this.allShapes.length-1;i>=0;i--){var n=this.allShapes[i];if(n.onPointerDown(e)){this.setTarget(n);break}}this.postRedraw();return};WAppView.prototype.onPointerMove=function(t){var e=this.translatePoint(t);this.updateLastPointerPoint(e);if(this.targetShape){this.targetShape.onPointerMove(e);if(this.targetShape.pointerDown){this.postRedraw()}return}return};WAppView.prototype.onPointerUp=function(t){var e=this.translatePoint(t);this.updateLastPointerPoint(e);if(this.targetShape){this.targetShape.onPointerUp(e);this.postRedraw()}return};WAppView.prototype.onKeyDown=function(t){if(!this.targetShape&&this.allShapes&&this.allShapes.length){this.targetShape=this.allShapes[0]}if(this.targetShape){this.targetShape.onKeyDown(t);this.postRedraw()}return};WAppView.prototype.onKeyUp=function(t){if(this.targetShape){this.targetShape.onKeyUp(t);this.postRedraw()}return};WAppView.prototype.extractDevices=function(t){this.devices=[];for(var e=0;e<t.pages.length;e++){var i=t.pages[e];for(var n=0;n<i.shapes.length;n++){var r=i.shapes[n];if(r.type==="ui-device"){if(!this.forPreview){r.images={display:0};this.fixDeviceConfig(r)}var o=ShapeFactoryGet().createShape(r.type,C_CREATE_FOR_PROGRAM);if(o){o.fromJson(r)}this.devices.push(o)}}}return this.devices.length};WAppView.prototype.getDevice=function(){if(!this.device){for(var t=0;t<this.devices.length;t++){var e=this.devices[t];var i=e.config;if(!e.config)continue;if(i.platform!=this.platform)continue;this.device=e}if(!this.device){this.device=this.devices[0]}}return this.device};WAppView.prototype.getScreen=function(){if(!this.screen){var t=this.getDevice();for(var e=0;e<t.children.length;e++){var i=t.children[e];if(i.isUIScreen){this.screen=i}}}return this.screen};WAppView.prototype.getWindowManager=function(t){if(!this.windowManager){var e=this.getScreen();for(var i=0;i<e.children.length;i++){var n=e.children[i];if(n.isUIWindowManager){this.windowManager=n;if(t){e.children.remove(n);n.parentShape=null}break}}}return this.windowManager};WAppView.prototype.detectDeviceConfig=function(){if(this.detectedDeviceConfig){return this.detectedDeviceConfig}var t=cantkDetectDeviceConfig();t.screenW=this.rect.w;t.screenH=this.rect.h;this.detectedDeviceConfig=t;console.log("deviceConfig.lcdDensity:"+t.lcdDensity);console.log("deviceConfig.platform:"+t.platform);console.log("deviceConfig.screenW:"+t.screenW);console.log("deviceConfig.screenH:"+t.screenH);return t};WAppView.prototype.showIt=function(){if(this.forPreview){this.showDevice()}else{this.showWindowManager()}this.targetShape=this.getWindowManager();console.log("Set targetShape: "+this.targetShape.type);var t=this;setTimeout(function(){t.postRedraw()},500);setTimeout(function(){t.postRedraw()},1e3);setTimeout(function(){t.postRedraw()},2e3);setTimeout(function(){t.postRedraw()},3e3);return};WAppView.prototype.showDevice=function(){var t=0;var e=0;var i=this.rect.w;var n=this.rect.h;
var r=this.getDevice();UIElement.disableGetRelativePathOfURL=true;var o=this.deviceJson?this.deviceJson:r.toJson();UIElement.disableGetRelativePathOfURL=false;var a=null;for(var s=0;s<o.children.length;s++){var l=o.children[s];if(l.type==="ui-screen"){a=l}}o.children.clear();o.children.push(a);this.device=r=ShapeFactoryGet().createShape(o.type,C_CREATE_FOR_PROGRAM);r.fromJson(o);var h=cantkGetViewPort();if(r.h<h.height&&r.w<h.width){e=(h.height-r.h)/2;document.body.style.overflow="hidden"}t=(i-r.w)/2;r.move(t,e);r.setMode(Shape.MODE_RUNNING,true);this.addShape(r);var u=this.getWindowManager();this.runApp(u);return};WAppView.prototype.getDeviceConfig=function(){var t=this.getDevice();return t?t.config:null};WAppView.prototype.resizeWindowManager=function(t,e){if(this.windowManager){this.windowManager.resize(t,e);console.log("this.windowManager.x="+this.windowManager.x);console.log("this.windowManager.y="+this.windowManager.y);console.log("this.windowManager.w="+this.windowManager.w);console.log("this.windowManager.h="+this.windowManager.h);var i=this.windowManager;setTimeout(function(){i.relayoutChildren();i.postRedraw()},200)}return};WAppView.prototype.moveEditor=function(){setTimeout(function(){cantkMoveEditorWhenResize()},300);cantkMoveEditorWhenResize();return};WAppView.prototype.createWindowManager=function(){return this.getWindowManager(true)};WAppView.prototype.fixDeviceConfig=function(t){var e=t.config;var i=this.detectDeviceConfig();if(this.app.type===AppBase.TYPE_PREVIEW){i.lcdDensity=e.lcdDensity;console.log("run in preview mode.")}if(i.platform!==e.platform&&i.version!==e.version&&i.lcdDensity!==e.lcdDensity){shapeFixImagePath(t,e,i)}return};WAppView.prototype.loadUserScripts=function(){if(this.meta){var t=this.meta.extlibs;var e=window.location.href.indexOf("appid=preview")>0;if(!t){t=[]}t.push(HolaSDK.getSDKURL());if(t){t=window.unique(t);for(var i=0;i<t.length;i++){var n=t[i];if(n.indexOf("res.wx.qq.com")>=0&&!isWeiXin()){console.log("not weixin browser skip weixin jssdk");continue}else{console.log("load user script "+n)}ResLoader.loadScript(n,e)}}}return};WAppView.prototype.runApp=function(t){this.loadUserScripts();t.systemInit();t.postRedraw();return};WAppView.prototype.showWindowManager=function(){var t=null;var e=this.rect.w;var i=this.rect.h;var n=this.detectDeviceConfig();t=this.createWindowManager();t.deviceConfig=this.getDeviceConfig();if(this.app.type===AppBase.TYPE_PREVIEW){n.lcdDensity=t.deviceConfig.lcdDensity}if(this.meta&&this.meta.general){var r=this.meta.general;var o=r.orientation;t.forcePortrait=false;t.forceLandscape=false;if(o==="landscape"&&t.w>t.h){t.forceLandscape=true}else if(o==="portrait"&&t.h>t.w){t.forcePortrait=true}t.screenScaleMode=r.screenscale}this.addShape(t);t.setDeviceConfig(n);t.setMode(Shape.MODE_RUNNING,true);t.move(0,0);t.resize(e,i);this.runApp(t);this.windowManager=t;console.log("w:"+e+" h:"+i);return};WAppView.prototype.getMeta=function(){return this.meta};WAppView.prototype.loadJson=function(t){this.meta=t?t.meta:null;this.beforeLoad(t);if(!t||!t.pages||!this.extractDevices(t)){console.log("It is not a valid webapp.");return}this.afterLoad(t);return;var e=t.docid;var i=document.createElement("script");i.src="http://appusage.duapp.com/count?appid="+e;var n=document.head?document.head:document.body;n.appendChild(i);return};WAppView.create=function(t,e,i,n,r,o){var a=new WAppView;return a.init(t,e,i,n,r,o)};function dappGetText(t){return t}function dappIsEditorApp(){return false}if(isWeiXin()){document.addEventListener("WeixinJSBridgeReady",function t(){})}window.webappGetText=webappGetText;window.webappSetLocaleStrings=webappSetLocaleStrings;window.webappPreviewWithURL=webappPreviewWithURL;window.webappPreviewWithData=webappPreviewWithData;window.webappPreviewWithDeviceData=webappPreviewWithDeviceData;window.webappRunWithURL=webappRunWithURL;window.webappRunWithData=webappRunWithData;window.webappRunWithDeviceData=webappRunWithDeviceData;var gCanTKLogoImageSrc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAACXCAYAAADqD16ZAAAABGdBTUEAALGPC/xhBQAACjtpQ0NQUGhvdG9zaG9wIElDQyBwcm9maWxlAABIiZ2Wd1RT2RaHz703vVCSEIqU0GtoUgJIDb1IkS4qMQkQSsCQACI2RFRwRFGRpggyKOCAo0ORsSKKhQFRsesEGUTUcXAUG5ZJZK0Z37x5782b3x/3fmufvc/dZ+991roAkPyDBcJMWAmADKFYFOHnxYiNi2dgBwEM8AADbADgcLOzQhb4RgKZAnzYjGyZE/gXvboOIPn7KtM/jMEA/5+UuVkiMQBQmIzn8vjZXBkXyTg9V5wlt0/JmLY0Tc4wSs4iWYIyVpNz8ixbfPaZZQ858zKEPBnLc87iZfDk3CfjjTkSvoyRYBkX5wj4uTK+JmODdEmGQMZv5LEZfE42ACiS3C7mc1NkbC1jkigygi3jeQDgSMlf8NIvWMzPE8sPxc7MWi4SJKeIGSZcU4aNkxOL4c/PTeeLxcwwDjeNI+Ix2JkZWRzhcgBmz/xZFHltGbIiO9g4OTgwbS1tvijUf138m5L3dpZehH/uGUQf+MP2V36ZDQCwpmW12fqHbWkVAF3rAVC7/YfNYC8AirK+dQ59cR66fF5SxOIsZyur3NxcSwGfaykv6O/6nw5/Q198z1K+3e/lYXjzkziSdDFDXjduZnqmRMTIzuJw+Qzmn4f4Hwf+dR4WEfwkvogvlEVEy6ZMIEyWtVvIE4gFmUKGQPifmvgPw/6k2bmWidr4EdCWWAKlIRpAfh4AKCoRIAl7ZCvQ730LxkcD+c2L0ZmYnfvPgv59V7hM/sgWJH+OY0dEMrgSUc7smvxaAjQgAEVAA+pAG+gDE8AEtsARuAAP4AMCQSiIBHFgMeCCFJABRCAXFIC1oBiUgq1gJ6gGdaARNIM2cBh0gWPgNDgHLoHLYATcAVIwDp6AKfAKzEAQhIXIEBVSh3QgQ8gcsoVYkBvkAwVDEVAclAglQ0JIAhVA66BS"+"qByqhuqhZuhb6Ch0GroADUO3oFFoEvoVegcjMAmmwVqwEWwFs2BPOAiOhBfByfAyOB8ugrfAlXADfBDuhE/Dl+ARWAo/gacRgBAROqKLMBEWwkZCkXgkCREhq5ASpAJpQNqQHqQfuYpIkafIWxQGRUUxUEyUC8ofFYXiopahVqE2o6pRB1CdqD7UVdQoagr1EU1Ga6LN0c7oAHQsOhmdiy5GV6Cb0B3os+gR9Dj6FQaDoWOMMY4Yf0wcJhWzArMZsxvTjjmFGcaMYaaxWKw61hzrig3FcrBibDG2CnsQexJ7BTuOfYMj4nRwtjhfXDxOiCvEVeBacCdwV3ATuBm8Et4Q74wPxfPwy/Fl+EZ8D34IP46fISgTjAmuhEhCKmEtoZLQRjhLuEt4QSQS9YhOxHCigLiGWEk8RDxPHCW+JVFIZiQ2KYEkIW0h7SedIt0ivSCTyUZkD3I8WUzeQm4mnyHfJ79RoCpYKgQo8BRWK9QodCpcUXimiFc0VPRUXKyYr1iheERxSPGpEl7JSImtxFFapVSjdFTphtK0MlXZRjlUOUN5s3KL8gXlRxQsxYjiQ+FRiij7KGcoY1SEqk9lU7nUddRG6lnqOA1DM6YF0FJppbRvaIO0KRWKip1KtEqeSo3KcRUpHaEb0QPo6fQy+mH6dfo7VS1VT1W+6ibVNtUrqq/V5qh5qPHVStTa1UbU3qkz1H3U09S3qXep39NAaZhphGvkauzROKvxdA5tjssc7pySOYfn3NaENc00IzRXaO7THNCc1tLW8tPK0qrSOqP1VJuu7aGdqr1D+4T2pA5Vx01HoLND56TOY4YKw5ORzqhk9DGmdDV1/XUluvW6g7ozesZ6UXqFeu169/QJ+iz9JP0d+r36UwY6BiEGBQatBrcN8YYswxTDXYb9hq+NjI1ijDYYdRk9MlYzDjDON241vmtCNnE3WWbSYHLNFGPKMk0z3W162Qw2szdLMasxGzKHzR3MBea7zYct0BZOFkKLBosbTBLTk5nDbGWOWtIt"+"gy0LLbssn1kZWMVbbbPqt/pobW+dbt1ofceGYhNoU2jTY/OrrZkt17bG9tpc8lzfuavnds99bmdux7fbY3fTnmofYr/Bvtf+g4Ojg8ihzWHS0cAx0bHW8QaLxgpjbWadd0I7eTmtdjrm9NbZwVnsfNj5FxemS5pLi8ujecbz+PMa54256rlyXOtdpW4Mt0S3vW5Sd113jnuD+wMPfQ+eR5PHhKepZ6rnQc9nXtZeIq8Or9dsZ/ZK9ilvxNvPu8R70IfiE+VT7XPfV8832bfVd8rP3m+F3yl/tH+Q/zb/GwFaAdyA5oCpQMfAlYF9QaSgBUHVQQ+CzYJFwT0hcEhgyPaQu/MN5wvnd4WC0IDQ7aH3wozDloV9H44JDwuvCX8YYRNRENG/gLpgyYKWBa8ivSLLIu9EmURJonqjFaMTopujX8d4x5THSGOtYlfGXorTiBPEdcdj46Pjm+KnF/os3LlwPME+oTjh+iLjRXmLLizWWJy++PgSxSWcJUcS0YkxiS2J7zmhnAbO9NKApbVLp7hs7i7uE54Hbwdvku/KL+dPJLkmlSc9SnZN3p48meKeUpHyVMAWVAuep/qn1qW+TgtN25/2KT0mvT0Dl5GYcVRIEaYJ+zK1M/Myh7PMs4qzpMucl+1cNiUKEjVlQ9mLsrvFNNnP1IDERLJeMprjllOT8yY3OvdInnKeMG9gudnyTcsn8n3zv16BWsFd0VugW7C2YHSl58r6VdCqpat6V+uvLlo9vsZvzYG1hLVpa38otC4sL3y5LmZdT5FW0ZqisfV+61uLFYpFxTc2uGyo24jaKNg4uGnupqpNH0t4JRdLrUsrSt9v5m6++JXNV5VffdqStGWwzKFsz1bMVuHW69vctx0oVy7PLx/bHrK9cwdjR8mOlzuX7LxQYVdRt4uwS7JLWhlc2V1lULW16n11SvVIjVdNe61m7aba17t5u6/s8djTVqdVV1r3bq9g7816v/rOBqOGin2YfTn7HjZGN/Z/zfq6uUmjqbTpw37hfumB"+"iAN9zY7NzS2aLWWtcKukdfJgwsHL33h/093GbKtvp7eXHgKHJIcef5v47fXDQYd7j7COtH1n+F1tB7WjpBPqXN451ZXSJe2O6x4+Gni0t8elp+N7y+/3H9M9VnNc5XjZCcKJohOfTuafnD6Vderp6eTTY71Leu+ciT1zrS+8b/Bs0Nnz53zPnen37D953vX8sQvOF45eZF3suuRwqXPAfqDjB/sfOgYdBjuHHIe6Lztd7hmeN3ziivuV01e9r567FnDt0sj8keHrUddv3ki4Ib3Ju/noVvqt57dzbs/cWXMXfbfkntK9ivua9xt+NP2xXeogPT7qPTrwYMGDO2PcsSc/Zf/0frzoIflhxYTORPMj20fHJn0nLz9e+Hj8SdaTmafFPyv/XPvM5Nl3v3j8MjAVOzX+XPT806+bX6i/2P/S7mXvdNj0/VcZr2Zel7xRf3PgLett/7uYdxMzue+x7ys/mH7o+Rj08e6njE+ffgP3hPP74FSqLwAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH3wMbAh83mWfR6wAAFhxJREFUeNrtnXuMHVd9xz+/mbsPx7t+JE6c2F4nsWMHgsJLhfAohdBCiOMkJCoFSlFVUbVCILXiTyhqVP7gUZCgFVJR1QZREaWIV5K1eRYSoTSlpNAUaMImcZOs14/1c+31Pu69c779Y87dnb07c2fu9d2HnflJ48edmTPn/L6/95xzxiTtAy4D6oABNWKq+P8HwDngXWZ2igRJuhz4R2A78D4ze1ISZkYzSfoE8ArgI2b2jCQAzAxJBuwB/ha4x8y+1nTvTuCvgd2JfgLI968OPAR8wcyqiftC4OvAFYl7GmT+vmHgi2Y22fTMRt9uBP4OmAY+bGYH0sYoaRPwBeAq4BYzqyWvS7T3LuDjwD3ANwNgPeD8QAS82R9rfScF"+"bPKAzDXm6UPAncCr/EBSme/pNcDtwA8k7TGzRoca54eAlwK7Uu79EvB+oNf30xLCYcANwGeAW1KYvAd4gx/HrD9m/PEK4FPAW5of6Pu2Bvh7f/5W4JOSejPGuBZ4JXAz8Iik/sb4Esy/CfgacCNwTYOZ6yVdKmmjpEFJhySdlPRq/9ul/hprQvwqxfSgpAf8vz/WBFDy+vs0T1OS7kmcM0kf8Of+IuXeX/h7Xun7tFHShsSxV9I9knY13RdKOujHc40f36CkAUlrJX3aP/PdaRyVdJc//1FJ3/L/fmPG+LZI+q/EGD+X5JmkqyU9nTj/obR2kDQuaULSdRmdavz9P5KmJd0t6Trf6K8lXZFx3/2SnpP0N4lOfNYzyST9WQsA/kPSrKQdCcAGJa3zfwcp2tkAYEzSCUkbU9r9rH/me5rHKKlf0uP+/HoPviQ9kiZkHoBfStov6fv+2lt9WxVJX/K/fcX//eG2AUgw/48kOUnfSZz7sm/4E55BaQCc8B29TdJZf/19npF3FQBgp///9iZpatD7MzRAkn4l6b99W49K+s/EfbekjPGd/twHfTuDXtsl6W0pYDcAeFhSn9fYqqQrvYZK0tv82OcAqNAGeTu2AfiIt68VSZ8Eerx9xp/7JzN7LqWJPmCjme2T9LvAl4H3eif5vYTdzqMT3ilv9rb97d5GK+N6B4wAkfcTg8Bx4HPAMeDfG3baj7EP+BegCvwWcL1vu9+3d7+kLWY2m/Kc7WY2K+lPga8CDwA7fZDwA9/vbCpggt6tfLovRULul3RG0g3JKErSY/6eyRYa8DMvUZsz+vSBFhow5n3AVm9W3pmQzj0ZGn5/gTHe23TPFklPSPpNor2v+mvHJV3tf7snqQFByniSUUbzQNf58KnuvfgGYGPieANwGnivpBuaooUFbfqOHzOz1wPf8lFE4/nNFAJrgG9I+oGkHyaO7wN/5a+bzRhPjw+vZ8zs28C7vDbsk/R5D0xD+n8beAdw1kdm6xPjWwu8x2vDrZJuSoyx"+"Mb4wYTHeB4wBf2lmz6dEaKmDPQ0cylDnD3pz8SEze97MJszsdOJ4DPi0V/dvNN17zndGDXPWyAHM7G7gk/78TMpzPwM87WPsHcC1iWOnF4hHE2as2VwdAdQIC81snw9Pnwb+EPgHoFdSL/DHwBngY2Z20MzOJMY3ZWb/Cnzfm6c/8Pc0cpJRDxyJPGebmd2XiIiqvj9nyZDyrR6Yw2ZWbzq3w/9z1MxqGYlLnwepH3jWzJw/f5mXoMPN9yba2A6cMrOzKe1u8venCYYBB80sak5+gMZ4xhJ9abR5hfcHg8CvfFtbgTAr4fL39wHbvFaN+eeG3ic5MzvS9Jxkn9b5vOpYAwTSQrisCKjVtVm/5d1bpO1uU5FntDPGIm2n/W6je3dfksxyS1pWqlWAe32oVS/5sazUC+yreOnfUfJjZSjwkUBJK0PPBD4kKmll6GgAHC35sGI0XmpAqQEXKRVLZcYrPlW/YMmCtga8TJ2K/5Br2akJIKr4dPqULzZdOAKmmPmDV8W1L7lVBoCMs4dbplYnGgA44OSFBsAiibfVxX/nRFYtydPJBgARcQX0wra1q8gEycBFiv+RLRinABd4DThWes0uW6B8k3gciAKvASdLtnUXAUW5V51MAnCq5FqXzVC+BiwwQaUGdFMBGj6gIADRhZ4LrMa4oIAGHB4aHlEwNDwCMF6yrbtOIAeAKjAJ8y/lz5I+o6CkpfEB08STFOYAOEf6bISSOrRBOWWImWYNKAHoqvQLqWV2PtOsAZNeLUrqQgQUe+FcEzR5YQNgrKr6T3MSJrXs3pwPaExHmercBMX1Dp2dAFfHLFjysowRZy8KwQ1Y0dS/qz2wwY2xuKfM9XFSnF2FmQ3MNgNwruMoSA5kBNt3QaUHojq2HJLp4nJ0uLUfk3BaHoUQ8bRKd3wMXD3xQsJDExQqQ5wbGh6ZngNgaHhkenTv7nMd9Siqo8nT9H/phwSbN+d5/27ynwAYtHnGLJ+dD5j485eh2gzWP7A4B4iUZ4ION/6RnBHX"+"2avJSgWqs7j/exLbOoSOHWM5VEDOQRDApk3zZmm5opwTh9HUBKwZTBcOl6tEpwBG9+4mGN27u3HieEeCZAHUqujUClS0bWW8sDt9FM1MYWH6jE5FLcMg4cv/Q8MjNEoR+B/VERPqETrx4nm3704dgdosBCle1hQHBEYuAMkwFOKCXGemNDQ49eJ5p+NOj3sHnDZ1vRGRWSsATqQBcKQjAASEPbgGAGYXPQA6dTg92LA4OnBRLhuOpgHwv51pgKC3H06O+3Xr4cWvASePYD29i7hl5qPy1jGxvL9dBMCxjk1QTy+aOAEzVQhfBACcPgqV3nTuKjU3a6bFAAwNj5wkfjnTPvX2obOn0PRZrNJz8ZugiePQu2aRvJrFEZBcSxN0cmh4ZDxNAxp+oM3eKFbHs6dh8jQENi8G3TpWHQDHsN6+1BKFXK4deaaRA8wlYqN7d+PD0SPEKw/bjIIq6MxpENiafujv71qYr5pDJ8bjhG+1mKAzJ6DSt1g4LHbAOQCMN3KAZCmicw1oJGO9vdQffoBgxw0wPd2d1HTqLAztIth9I8y0XyusP/dLdPygLxd0QZMsjHOAqI6tWZudhFnLlwGHFhQSmk6OdlqQs81D1L74cZiegjDowmBBBxyVD76fvk99BU1Ptx3iztz7UWYeGCbc3gPdqlFVegiu3OnDHS0KcApUZQ+2AqDztQK1KnbldrpWGgsCsBHssis6b2LTVsKr+wiu2tW9erXwdib9VFwJbSkoLTVg7DwrZF30dPIj0nm2YcvnzBVPys1R1MMLhKSVepTUnsmkUYZoDcBYKwDK5Urnw39fhqBgGaIEoMsIyMU+oIUJqg8Nj5zIBMBnw7WSmx26gCjXZ40nk7A0DZi7qKROfL7yfP3RprwrFYByscb5BIGt7f8i3gZ5YVJJbZQo2swBsgAoHXHHPkB5FZgjRQAofcB55H05CIwXAeBQycrziIKs1IAVdcI5Jmi8BGDJzI8VyYILaUDphDtCIDcJmwJmkknYIgD8ybnFAyW1"+"54FzkrAJoJZMwtJKERBv3nem5GgHEVBrAM6QUuZJM0E1j1ZJRckSy5Ky6XQ7AJwuudoW/4u8izpdasBSakD+jKqJUgOWiv/m9wfqIgClBnSgATlJ2BlSdifOAqCMgtpEoIAPODo0PKJcABIz5EpqIwnLAaBOxo40QQt7VW7m3Q4GTq3ygGqWVckC4CTl5h1tJGG5y5JqNH+sIQeAMV+7KKlQEgByLV1wrV0NOF1qQPEQVM6vjs/GYLZdH3CWcnpKYXIOrPW7gMYHjAoDcKYEoI0cwDU+DZV51czQ8EhxHzA0PDJJuX9QQRM0vzVBC8p8yRV0clNJi01QTh3iGCycEZcJQOKiclv7omFoRB4CC5YlFcmE51ArqQAA9dy1B0c6MUGlBhTLwojq5C2fGi8BWKocwO+QaNZ9DSjniBZRAOedcBvLksooqMs5APkTso6VACyRDSqwRygk9oYofUB3FcCviml52cmh4ZGZtgEYGh6pUW5rX8gH5KTBR7OSsEwAEheXb8Zasx/niuUAaUlYJgCJi1d+qrrO5ys9WmL2N6akt3QALdde523qsLKhaN1ha9fH/q23P94Kp539IvoHIFraom6BELSlEOftAbNyGuAEV24l+slDVAcGCF/xemzbtdi6KwCH1WpQXezb3MkjuGMvUH/yMWq/+gm2advSbVOgQsuSDp8PAKMraHuwSwbRxHFq//wpamFIsPEKgpe/jvB1b4WXvIbgmp0x048fpP7rR6k98WPqv/kpOnU03sHlkkFszUDuTqod5wANJxx0zsPVqwEQLzvs6cPWx5sjqTpN/eEHqT94LwxsIHrTHs5dKmqPfxdNTmDrNsVMH1g/bxfc0uzq3ZgPWmBVzHlpwOrJBSzer97WbYD1l6Jajdq/fZ3atgp22RZsw5UxYMu8xVmBLSrHL1wNyIqKFEEQEFy5neDyEORQtPzTmOb2h7PONSAvClq9eYC8eXFuxb4jWSAJOwXMZiVhLQHwN9UpZ0q3UEYVqgFlJWF5pYiGnJVF"+"uSwAIuIdubIp961ikd31SgCywlCXx3+O5qXjeU54wU7fJcURj1X8dBTn8kLQXN4V2Q31SMl0sDA2N1FN1CdFbcYRVdX8CZkl0YBjLzZmLxBrQX1W1KagXo1wtcZaABGE1vbmHJ1owEVvgizwB4aLhKtBfUbxUW3ajNUgqEDBrYFPlhqQZ8vxZmVK1GZFfdrFUo6w0OLrOt8I+FCrEDQ3CvI3P3cxmRYLIAjjjTVmTonJIxFnD0VMjjtmJqK4tFCBoGLn+zGQOgW2fChigs74jG7jhRYmWmAYmvuuS1T1pmU2tuWNOZ0WQtBT2KwUpUITnIsA8BvgZn+8HXgLsGY1liYs9ObCz1iOZuOjNi2iquLM1X960ViSr62cBX4MfBd4BP+tgPMFoDo0PPIE8ATw+dG9u/s9CHcBe4EtKy7sYWwyopqoTUN9xlGfdvHLMPloJYhj9yWg54B9wDeAR4eGR6pN5Zw8RS1OiQ89JH+7xWvGzcDl/uhbcoF3sa0e3FwhmnFUp+OoJaqDSdj52/A0mvFByVEv6fuHhkcezuNR1wDIAacCvBTYDdzkj1cDA8sBhuRDye4zfQJ43B8/9Sb5ybRF1x26qq4wfwHqo3t3h57x64HXALcDdwIblsL2L8GHJI8D3wYeBH7hA5HJoeER16mkL7kGFDRXdwK/703WOqCHVl/dXR6q++ME8D3ga0PDI987H7OyKgAoANBrgd/xx7XA1cDgMj1+AngeOOCjlUeGhkd+sULR8rIzvtlcAWz3ALzcO/O3LkHecRT4kWf4L4EXhoZHDi6XpK86DcgAw4Be4BLg94C7vf9Y2+EjTns7/k3P+CnijfO0kkxfNQC0AdQbgHcC7wCu8g6++WNl0z77HPNx+beHhkcevwAS9lXN+EXSefD263fLeC3iJqRXAQ6znwseC8x+tu3Bpw6stFm5KGn09usXx4p7dm86duvuyxZde8f1F1LJanXSgduuY8e+haWUsVt2WK0nsJAgtMCCKIirOaFzkaTIybmrh59Z"+"NBXuwN6d7Bh+tgQgSc/fdh1X73sm5fedKAgtDIJ4DxhnoRmBTKERhCYFLi6jB6a5crrDcAZOmBOKLP4yrJPJQeCcHOYibd/3bOG+XFQAvLBnF9v3P73o96fevoW1fYOBAswUM1XxR9KDOElTgMxAgd+TKgDU2KcndVBmQkgmZ5gkIg9QJMPJcEGEpqem3a4fvVC4rxeFBhy6bZfVKhYYFgSxBIeKGR9iMmSBDDMpnvKhBcUGtTGu+D7/L18Jjd8MyCQjMsOBRQ45mVxPTW7L/qd1QWjAc3uu45r9C9X2uVt3YJWQgABD4BQzMwgaUh0iAkSAEcSzamyex9nT/NTE2IWMnmd1c4UotVJkFj/TNPdSXQinwGsJOCDCyZmTCOPdgOpyEEVc850Dyw/A2J5dbG1Sy5E3bWPNuj4UBGZBYDgMFJgsIPDMhkCxGcGQealuV6JzR5DcPNvaF634loYsYJIJw5z3LxEO57yfIUARTkHNafv+xT5l7NZdbP3O093XgMM3baF6+RoLrccUEuBkJsKYoQow88xe0LalSDIp0toOScLCHqN/wJAhV8dcXfGshmhu/a5wC3XD0kfe3IfFfbbGJDhziHharnlwAkSEq6uu/kNndNXPjyUE9zq27n+mMwCeffMlhJV+qwxcGUA0J9E4NSrvQbxSRPOKvEwkQdhnDGwIsJ55DWh8z9FF8fKhqC5cXSjyE6mbNaUTbWkYPrP4283xgipZMKcxTrKoMjUZXfXD0c414ODdN0LkKorqfWaE8QjNZAv2yFyRyeENANauTwBgKYz1ywliUGJAVCf+O/Lfee6C+YqfZbH1wpAssjCcJaC+7Vu/zry55TthuTrIBXEI6BdFxYqd5SAL8y/l+qx2irevVImQhRBWsFBGj8x/9zeOh1wkXF3m6gnNaWw/oPmettAWzf8pL6MACqTIrPV2ljkv5esufrYhKXftT7uaoC79XgyQpNjMzYSDEIudrgC/5svVRTRnwhKguCZQLFs9fdBreWzLhGf0jt0N"+"KPtAFbS6yhapJqgLEZU1BbuNT9RGdXB1h4sS5qvVjumGkNWBWTOx7aGR9n3A6B27DUcvRmWllgEtKwBZgDRplXOx2509J6pTrSTT6maqbnso+wV+axMUlwBaJUJp2ScZSZAKZK7ZyVb2/ynYbvvPUZNbsdgcByFYaFR6oTYjiOLf09rJMxyVIkKQcLsqaNPb3eBBLYDK+387fub8nqOENHofYHOud/F9PlptKTBBIRlabdT4aFrk5icFrUAXfFbUImrQeWuASavA+kvzM2nlDzMU9MYDdBFysR2Ym521RLO0Fkiv5c++y5PwVAAO3vkStj3w1IJgYMWYX6/Hi7CDAHr7sYF12KWbCa7YSu+WbfQO9mITh4jGR4lOHkbnJqA6HQNW6cHCyhIi0HLtgMem9TK+1N5te+Apxu56qbmas5TKYpHajTJqKs33Z7U1Vx61jZss2HotNnQdwebtBJu3YpdvQQMb1Ltug/UNrCWMqmjiuKLjY6bx54mOHCA6NEI09gyaPNWJHc0foxqKZvh6RPO4VID/2SYoqjsC5tIIdcG5Zt2f3lYUiZ4egpe/Tr13/Als3QFhBSxAclCvoUpFVHqhpxfrH6Cy+RrxsjfSA3DkAFMPfpHaz/b7rQ3Cjsx8S/tssWJicRKXiIQK+9CgpfOde52RCUAzI9VmhNPc1sJnWQCXDErrNqKeHqk6K82cEzNToladT1MX3hsf6y5TsGYQWcq57GdmjSn9MGQBssXtkShMMHr79da2BlhCzaSWzC8SJuaB4FJzBimuCdSqolZtMLuYlFanUVRrZQDUZh/TY3RvgrTQ2CiZEbRy1JVWrcfNLpsD7vJzlid+DnywJetsRNkmyDkzVlsBYvWRmeWuolRHeYBZYzcQlTC0AKARimbETXnhVCUnAyuZXwiAnPJUi0w9aKE2sgtj7u4KI9B6N824SmftAzA/36OkltmaxZXRrBqtcrxApaXjKO1/G6Fopi1vmQ0HSxwYauVldGn7pcZeEpbN/5p6M5/3/0AEyIegdW3GAAAAAElFTkSuQmCC";var gCanTkProgressBarBgSrc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAYCAYAAAA/OUfnAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAAlSURBVHjaYvj//z8DDDPQi8PAwPAfCZPOGRBXI3MAAAAA//8DAGr0uUcMH0twAAAAAElFTkSuQmCC";var gCanTKProgressBarFgSrc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAVCAYAAACDp1Q5AAAACXBIWXMAAC4jAAAuIwF4pT92AAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAABESURBVHjaYvz//z8DDDA+D1NkgXFYGBgYWJE57Dg5HMgcTpwcXMq0GfYiOFcZnJGVfUfm/MApg1vZT5yc33BvI4cBYAAdfxGoWJfDUwAAAABJRU5ErkJggg==";if(!window.CanTK){window.CanTK={}}window.CanTK.config={logoImageSrc:gCanTKLogoImageSrc,progressBarBgSrc:gCanTkProgressBarBgSrc,progressBarFgSrc:gCanTKProgressBarFgSrc};function Shape(){return}Shape.MODE_EDITING=0;Shape.MODE_RUNNING=1;Shape.MODE_PREVIEW=2;Shape.HIT_TEST_NONE=0;Shape.HIT_TEST_TL=1;Shape.HIT_TEST_TM=2;Shape.HIT_TEST_TR=3;Shape.HIT_TEST_ML=4;Shape.HIT_TEST_MR=5;Shape.HIT_TEST_BL=6;Shape.HIT_TEST_BM=7;Shape.HIT_TEST_BR=8;Shape.HIT_TEST_HANDLE=9;Shape.HIT_TEST_WORKAREA=10;Shape.HIT_TEST_ROTATION=11;Shape.HIT_TEST_MOVE=12;Shape.HIT_TEST_MAX=13;Shape.HIT_TEST_MM=-1;Shape.ALIGN_LEFT=1;Shape.ALIGN_RIGHT=2;Shape.ALIGN_TOP=3;Shape.ALIGN_BOTTOM=4;Shape.ALIGN_CENTER=5;Shape.ALIGN_MIDDLE=6;Shape.ALIGN_TO_SAME_WIDTH=7;Shape.ALIGN_TO_SAME_HEIGHT=8;Shape.ALIGN_DIST_VER=9;Shape.ALIGN_DIST_HOR=10;Shape.STAT_CREATING_0=0;Shape.STAT_CREATING_1=1;Shape.STAT_CREATING_2=2;Shape.STAT_NORMAL=3;Shape.TEXT_NONE=0;Shape.TEXT_INPUT=1;Shape.TEXT_TEXTAREA=2;Shape.prototype.setNearRange=function(t){this.nearRange=t;return this};Shape.prototype.getNearRange=function(){return this.nearRange?this.nearRange:20};Shape.prototype.findNear=function(t){return null};Shape.prototype.getCreatingShape=function(){return this.view?this.view.getCreatingShape():null};Shape.prototype.getTextCookie=function(t){return 0};Shape.isTransparentColor=function(t){return!t||t==="rgba(0,0,0,0)"};Shape.prototype.isFillColorTransparent=function(){return Shape.isTransparentColor(this.style.fillColor)};Shape.prototype.isStrokeColorTransparent=function(){return Shape.isTransparentColor(this.style.lineColor)};Shape.prototype.isTextColorTransparent=function(){return Shape.isTransparentColor(this.style.textColor)};Shape.prototype.setParent=function(t){this.parentShape=t;return this};Shape.prototype.getParent=function(t){if(t){for(var e=this.parentShape;e!=null;e=e.parentShape){if(e.name===t||e.type===t){return e}}}return t?null:this.parentShape};Shape.prototype.textEditable=function(t){return true};Shape.prototype.setInputType=function(t){this.inputType=t;return this};Shape.prototype.editText=function(t){if(this.textType&&this.textEditable(t)){var e=this.getPositionInView();var i=this.getRealScale();var n=this.view.rect.x;var r=this.view.rect.y;var o=e.x*i+n;var a=this.getWidth()*i;var s=this.getHeight()*i;var l=this.getTextCookie(t);var h=this;var u=null;var p=this.text;var c=this.inputType?this.inputType:"text";var f=this.style.fontSize?this.style.fontSize*i:16;if(this.textType===Shape.TEXT_INPUT){var m=e.y*i+s/3+r;if(a<60){a=60}u=cantkShowInput(c,f,p,o,m,a,f+12)}else{var m=e.y*i+r;if(s<60){s=60}u=cantkShowTextArea(p,f,o,m,a,s)}u.showBorder(true);h.editing=true;function d(t){if(h.text!==t){h.exec(new SetTextCommand(h,t,0));h.postRedraw()}u.hide();h.editing=false;u.setOnChangedHandler(null);return}u.setOnChangedHandler(d)}return};Shape.prototype.exec=function(t){if(this.app){this.app.exec(t)}else{t.doit();delete t}return};Shape.prototype.setTextTitle=function(t){this.textTitle=t;return this};Shape.prototype.initShape=function(t,e,i,n,r){this.w=i;this.h=n;this._x=t;this._y=e;this._left=t;this._top=e;this.type=r;this.text="";this.app=null;this.view=null;this.rotation=0;this.saveDx=0;this.saveDy=0;this.scaleX=1;this.scaleY=1;this.parentShape=null;this.pointerDown=false;this.selected=false;this.userMovable=true;this.userResizable=true;this.hignlighted=false;this.state=Shape.STAT_NORMAL;this.hitTestResult=Shape.HIT_TEST_NONE;this.lastPosition=new Point(0,0);this.selectMarkPoint=new Point(0,0);this.textType=Shape.TEXT_INPUT;this.setDefaultStyle();this.setTextAlignV("middle");this.setTextAlignH("center");return};Shape.prototype.setDefaultStyle=function(){this.style=new ShapeStyle;this.setStyle(Shape.getDefaultStyle());return this};Shape.prototype.setState=function(t){this.state=t;return this};Shape.prototype.setTextType=function(t){this.textType=t;return this};Shape.prototype.isSelected=function(){return this.selected};Shape.prototype.userRemovable=function(){return true};Shape.prototype.intersectWithRect=function(t){var e=false;var i=this.getX();var n=this.getY();var r=this.getWidth();var o=this.getHeight();var a={x:i,y:n};var s={x:i+r,y:n+o};var l={x:i+r,y:n};var h={x:i,y:n+o};return isPointInRect(a,t)||isPointInRect(s,t)||isPointInRect(l,t)||isPointInRect(h,t)};Shape.prototype.isThisInRect=function(t){var e=false;var i=this.getX();var n=this.getY();var r=this.getWidth();var o=this.getHeight();if(i>=t.x&&i<t.x+t.w&&(n>=t.y&&n<t.y+t.h)){e=true}return e};Shape.prototype.snapToGrid=function(t,e){var i=t;var n=e;if(this.view){return this.view.snapToGrid(t,e)}else{return{x:i,y:n}}};Shape.prototype.isClicked=function(){if(this.view){return this.view.isClicked()}return false};Shape.prototype.isAltDown=function(){if(this.view){return this.view.isAltDown()}return false};Shape.prototype.isCtrlDown=function(){if(this.view){return this.view.isCtrlDown()}return false};Shape.prototype.showIconPreview=function(t){return true};Shape.prototype.onMoving=function(){};Shape.prototype.onMoved=function(){};Shape.prototype.onSized=function(){};Shape.prototype.onUserMoved=function(t,e){};Shape.prototype.onUserResized=function(){};Shape.prototype.fixChildPosition=function(t){var e=this.w;var i=this.h;var n=t.left>=0?t.left:0;var r=t.top>=0?t.top:0;if(n+t.w>e){n=e-t.w}if(r+t.h>i){r=i-t.h}t.left=n;t.top=r;return};Shape.prototype.fixPosition=function(){if(!this.parentShape){return}this.parentShape.fixChildPosition(this);return};Shape.prototype.move=function(t,e){if(this.left!==t||this.top!==e){this.setLeftTop(t,e);if(!this.isIcon){this.fixPosition();this.onMoved()}}return this};Shape.prototype.moveDelta=function(t,e){return this.move(this.left+t,this.top+e)};Shape.prototype.getWidth=function(){return this.w};Shape.prototype.getHeight=function(){return this.h};Shape.prototype.getPositionInScreen=function(){var t={x:0,y:0};var e=this.getRealScale();var i=this.getPositionInView();if(this.view){t=this.view.getAbsPosition()}i.x=t.x+i.x*e;i.y=t.y+i.y*e;return i};Shape.prototype.getRealScale=function(){return this.view?this.view.getScale():1};Shape.prototype.getAbsPosition=function(){var t=this.getPositionInView();if(this.view){var e=this.view.getAbsPosition();t.x=t.x+e.x;t.y=t.y+e.y}return t};Shape.prototype.getPositionInView=function(){var t=this.getX();var e=this.getY();var i={x:0,y:0};var n=this.parentShape;while(n!=null){t+=n.left;e+=n.top;n=n.parentShape}i.x=t;i.y=e;return i};Shape.prototype.getXinView=function(){var t=this.getPositionInView().x;return t};Shape.prototype.getYinView=function(){var t=this.getPositionInView().y;return t};Shape.prototype.getX=function(){return this.x};Shape.prototype.getY=function(){return this.y};Shape.prototype.setX=function(t){this.x=t;return this};Shape.prototype.setY=function(t){this.y=t;return this};Shape.prototype.align=function(t,e){return};Shape.prototype.setRotatable=function(t){this.rotatable=t;return this};Shape.prototype.setScaleX=function(t){this.scaleX=t;return this};Shape.prototype.setScaleY=function(t){this.scaleY=t;return this};Shape.prototype.getScale=Shape.prototype.getScaleX=function(){return this.scaleX!==undefined?this.scaleX:this.scale};Shape.prototype.getScaleY=function(){return this.scaleY!==undefined?this.scaleY:this.scale};Shape.prototype.setScale=function(t,e){e=e?e:t;if(t)this.scaleX=t;if(e)this.scaleY=e;return this};Shape.prototype.getRotation=function(){return this.rotation};Shape.prototype.setRotation=function(t){this.rotation=t;return this};Shape.prototype.getOpacity=function(){return this.opacity};Shape.prototype.setOpacity=function(t){this.opacity=Math.max(0,t);this.opacity=Math.min(1,this.opacity);return this};Shape.prototype.setStyle=function(t){this.style.copy(t);this.textNeedRelayout=true;return this};Shape.prototype.getStyle=function(){return this.style};Shape.prototype.setName=function(t){this.name=t;return this};Shape.prototype.getName=function(){return this.name};Shape.prototype.getLocaleText=function(t){return t};Shape.prototype.getLocaleInputTips=function(t){return dappGetText(t)};Shape.prototype.setNeedRelayoutText=function(){this.textNeedRelayout=true;return this};Shape.prototype.setTextAlignH=function(t){this.hTextAlign=t;return this};Shape.prototype.setTextAlignV=function(t){this.vTextAlign=t;return this};Shape.prototype.getTextAlignH=function(){var t=this.hTextAlign?this.hTextAlign:"left";return t};Shape.prototype.getTextAlignV=function(){var t=this.vTextAlign?this.vTextAlign:"top";return t};Shape.prototype.toText=function(t){if(t!==null&&t!=undefined){return t+""}else{return""}};Shape.prototype.setText=function(t){this.text=this.toText(t);this.textNeedRelayout=true;return this};Shape.prototype.setText2=function(t){this.text2=t;return this};Shape.prototype.setText3=function(t){this.text3=t;return this};Shape.prototype.getText=function(){return this.text};Shape.prototype.getApp=function(){return this.app};Shape.prototype.getView=function(){return this.view};Shape.prototype.setApp=function(t){this.app=t;return this};Shape.prototype.setView=function(t){this.view=t;return this;
};Shape.prototype.redrawSelf=function(){if(this.view){var t=this.getRealScale();var e=this.getPositionInView();var i={x:e.x*t,y:e.y*t,w:this.w*t,h:this.h*t};this.view.redraw(i)}return};Shape.prototype.postRedraw=function(t){if(this.view){this.view.postRedraw(t)}return};Shape.prototype.beforePropertyChanged=function(){return};Shape.prototype.afterPropertyChanged=function(){return};Shape.prototype.showProperty=function(){return};Shape.prototype.setSelectedMarkSize=function(t){this.selectedMarkSize=t;return};Shape.prototype.createSelectedMark=function(t,e,i,n){var r=this.selectedMarkSize?this.selectedMarkSize:10;if(this.w<40||this.h<40){r=5}if(n){r=r+r}t.rect(e-r,i-r,r*2,r*2);return};Shape.prototype.isInSelectedMark=function(t,e,i,n){t.beginPath();this.createSelectedMark(t,e,i);return t.isPointInPath(n.x,n.y)};Shape.prototype.paint=function(t){this.paintSelf(t);if(this.near){var e=this.near.point;var i=this.getNearRange();t.beginPath();t.arc(e.x,e.y,4,0,Math.PI*2);t.fillStyle="Red";t.fill();t.beginPath();t.lineWidth=2;t.arc(e.x,e.y,i,0,Math.PI*2);t.strokeStyle="Black";t.stroke()}return};Shape.prototype.paintSelf=function(t){return};Shape.prototype.setSelected=function(t){if(t){this.selectedTime=Date.now()}if(this.selected===t){return}this.selected=t;if(this.view&&this.view.onShapeSelected){this.view.onShapeSelected(this)}return};Shape.prototype.isVisible=function(){return true};Shape.prototype.findNearPoint=function(t){var e=null;for(var i=0;i<100;i++){e=this.getNearPoint(i);if(!e){break}if(isPointInRect(e,t)){var n={shape:this};n.nearPointIndex=i;n.point={x:e.x,y:e.y};return n}}return null};Shape.prototype.dup=function(){var t=ShapeFactoryGet().createShape(this.type,C_CREATE_FOR_PROGRAM);t.fromJson(this.toJson());t.state=Shape.STAT_NORMAL;return t};Shape.prototype.hitTest=function(t){return Shape.HIT_TEST_NONE};Shape.prototype.showProperty=function(){return};Shape.prototype.onLongPress=function(t){return};Shape.prototype.onGesture=function(t){};Shape.prototype.onDoubleClick=function(t){if(this.textType!=Shape.TEXT_NONE){this.editText(t)}else{this.showProperty()}return true};Shape.prototype.onPointerDown=function(t){this.pointerDown=true;this.hitTestResult=this.hitTest(t);if(!this.hitTestResult){return false}this.setSelected(true);this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.handlePointerEvent(t,C_EVT_POINTER_DOWN);return true};Shape.prototype.handlePointerEvent=function(t,e){return false};Shape.prototype.onPointerMove=function(t){if(this.hitTestResult){this.handlePointerEvent(t,C_EVT_POINTER_MOVE);return true}return false};Shape.prototype.onPointerUp=function(t){if(this.hitTestResult){this.handlePointerEvent(t,C_EVT_POINTER_UP);this.hitTestResult=Shape.HIT_TEST_NONE;return true}this.pointerDown=false;return false};Shape.prototype.onKeyDown=function(t){console.log("onKeyUp Widget: code="+t);return};Shape.prototype.onKeyUp=function(t){console.log("onKeyUp Widget: code="+t);return};Shape.prototype.canBeComponent=function(){return false};Shape.prototype.shouldShowContextMenu=function(){return true};Shape.prototype.toJson=function(){return null};Shape.prototype.fromJson=function(t){return this};Shape.prototype.afterApplyFormat=function(){return};Shape.prototype.applyFormat=function(t){if(!t){return}for(var e in t){var i=t[e];var n=typeof i;if(n==="function"||n==="object"||n==="undefined"){continue}if(e=="type"){continue}if(n==="number"||n==="string"||n==="boolean"){this[e]=i}}if(t.images){for(var e in t.images){var i=t.images[e];if(e==="display"){this.images[e]=i}else{var r=i.getImageSrc();this.setImage(e,r)}}}if(t.style){this.style.fromJson(t.style)}if(t.animations){this.animations=JSON.parse(t.animations);this.defaultAnimationName=t.defaultAnimationName}this.afterApplyFormat();this.textNeedRelayout=true;return};Shape.prototype.setUserMovable=function(t){this.userMovable=t;return this};Shape.prototype.setUserResizable=function(t){this.userResizable=t;return this};Shape.prototype.isUserMovable=function(){return this.userMovable&&!this.isLocked()};Shape.prototype.isUserResizable=function(){return this.userResizable};function splitText(t){t=t.replaceAll("\r\n","\n");t=t.replaceAll("\r","\n");return t.split("\n--\n")}Shape.onRestacked=function(t,e){};function restackShapeInArray(t,e){var i=0;var n=0;var r=null;var o=0;var a=null;for(var s=0;s<t.length;s++){r=t[s];if(r.selected){i++;if(!a){a=r;n=s}}}if(i>1||!a){return}o=n+e;if(o<0||o>=t.length){return}t[n]=t[o];t[o]=a;Shape.onRestacked(t,a);return}function getParentShapeOfShape(t,e){var i=t.parentShape?t.parentShape:t.container;if(!i){i=e}return i}function getParentShapeOfShapes(t){if(!t||t.length===0){return null}var e=t[0];var i=e.parentShape;for(var n=0;n<t.length;n++){var r=t[n];if(r.parentShape!=i){return null}}return i?i:e.view}Shape.prototype.getTextColor=function(t){return this.style.textColor};Shape.prototype.getBgColor=function(t){return this.style.fillColor};Shape.prototype.getLineColor=function(t){return this.style.lineColor};Shape.prototype.defaultDrawText=function(t){var e=this.getWidth(true);var i=this.getLocaleText(this.text);if(!i||this.editing){return}t.save();t.beginPath();t.lineWidth=1;t.font=this.style.getFont();t.fillStyle=this.getTextColor();t.strokeStyle=this.getLineColor();var n=i.split(/\n/);if(n.length<2){if(t.measureText(i).width<1.2*e){this.draw1LText(t)}else{this.drawMLText(t)}}else{this.drawMLText(t)}t.restore();return};Shape.prototype.draw1LText=function(t,e){var i=this.getLocaleText(this.text);if(!i||this.editing){return}var n=0;var r=0;var o=this.hMargin;var a=this.getWidth(true);var s=this.getTextAlignH();var l=this.getTextAlignV();var h=this.style.textU;var u=this.style.fontSize;var p=t.measureText(i).width;var c=0;var f=0;var m=Math.min(p,a);switch(l){case"middle":{r=this.h>>1;t.textBaseline="middle";if(h){f=Math.floor(r+u*.8)}break}case"bottom":{r=this.h-this.vMargin;t.textBaseline="bottom";if(h){f=r}break}default:{r=this.vMargin;t.textBaseline="top";if(h){f=Math.floor(r+u*1.5)}break}}switch(s){case"center":{n=this.w>>1;t.textAlign="center";if(h){c=Math.max(this.w-p>>1,0)}break}case"right":{n=this.w-this.hMargin;t.textAlign="right";if(h){c=Math.max(this.w-p-o,0)}break}default:{n=this.hMargin;t.textAlign="left";if(h){c=n}break}}if(h){t.moveTo(c,f);t.lineTo(c+m,f);t.stroke()}t.fillText(i,n,r,a);return p};Shape.prototype.drawMLText=function(t,e){this.layoutText(t);if(!this.lines){return}var i=0;var n=0;var r=0;var o=0;var a=0;var s=this.vMargin;var l=this.hMargin;var h=this.getWidth(true);var u=this.getTextAlignH();var p=this.getTextAlignV();var c=this.style.textU;var f=this.style.fontSize;var m=this.getTextLineHeight();var d=this.getTextHeight();t.textBaseline="top";switch(p){case"middle":{n=this.h-d>>1;break}case"bottom":{n=this.h-d-s;break}default:{n=s;break}}n=n<0?0:n;for(var y=0;y<this.lines.length;y++){var g=this.lines[y];if(!g||g==" "){n+=f;continue}if(n+m>=this.h&&!e){break}var v=t.measureText(g).width;a=Math.min(v,h);o=Math.floor(n+(f+m)/2);switch(u){case"center":{i=this.w>>1;t.textAlign="center";if(c){r=Math.max(this.w-v>>1,0)}break}case"right":{i=this.w-l;t.textAlign="right";if(c){r=Math.max(this.w-v-l,0)}break}default:{i=l;t.textAlign="left";if(c){r=i}break}}if(c){t.moveTo(r,o);t.lineTo(r+a,o);t.stroke()}t.fillText(g,i,n,h);n+=m}return};Shape.prototype.getTextHeight=function(){var t=0;var e=this.style.fontSize;var i=this.getTextLineHeight();if(!this.text||!this.lines){return i}for(var n=0;n<this.lines.length;n++){var r=this.lines[n];if(!r||r==" "){t+=e}else{t+=i}}return t};Shape.prototype.getTextLineHeight=function(){return Math.floor(this.style.fontSize*1.5)};Shape.prototype.setTextShadow=function(t){this.textShadow=t;return this};Shape.prototype.isValid=function(){return!this.isInvalid};Shape.prototype.canCopy=function(){return true};Shape.prototype.onDestroy=function(){};Shape.prototype.onRemoved=function(t){};Shape.prototype.destroy=function(){var t=this.parentShape;if(t){if(t.targetShape===this){t.targetShape=null}if(t.pointerEventTarget===this){t.pointerEventTarget=null}this.parentShape=null}if(this.container){this.container=null}this.app=null;this.view=null;if(this.children){this.children.clear(true);this.children=null}if(this.images){this.images=null}if(this.events){this.events=null}if(this.style){this.style=null}this.onDestroy();this.isInvalid=true;this.jsonData=null;return};var C_LINE_STYLE_0=255<<8|0;var C_LINE_STYLE_1=2<<8|4;var C_LINE_STYLE_2=4<<8|4;var C_LINE_STYLE_3=8<<8|8;var C_LINE_STYLE_4=10<<8|10;function resetShapeStyle(t){t.lineStyle=65280;t.lineWidth=2;t.lineColor="Orange";t.fillColor="White";t.textColor="Blue";t.fontSize=24;t.fontFamily="sans";t.arrowSize=12;t.firstArrowType=0;t.secondArrowType=0;t.textB=0;t.textI=0;t.textU=0;t.enableShadow=false;t.shadow={x:0,y:0,blur:8,color:"Black"};t.listener=null;return t}function createShapeStyle(){var t=new ShapeStyle;return resetShapeStyle(t)}function ShapeStyle(){}ShapeStyle.prototype.getFont=function(){var t="";if(this.textI){t="italic  "}if(this.textB){t=t+"bold "}t=t+this.fontSize+'pt "'+this.fontFamily+'"';return t};ShapeStyle.prototype.setListener=function(t){this.listener=t;return};ShapeStyle.prototype.notify=function(){if(this.listener){this.listener.setNewStyle(this)}return};ShapeStyle.prototype.setLineStyle=function(t){this.lineStyle=t;return};ShapeStyle.prototype.setLineWidth=function(t){this.lineWidth=t>0?t:1;return};ShapeStyle.prototype.setLineColor=function(t){this.lineColor=t;return};ShapeStyle.prototype.setFillColor=function(t){this.fillColor=t;return};ShapeStyle.prototype.setTextColor=function(t){this.textColor=t;return};ShapeStyle.prototype.setFontSize=function(t){var e=Math.max(t,6);this.fontSize=e;return};ShapeStyle.prototype.setFontFamily=function(t){this.fontFamily=t?t:"serif";return};ShapeStyle.prototype.setFirstArrowType=function(t){this.firstArrowType=t;return};ShapeStyle.prototype.setSecondArrowType=function(t){this.secondArrowType=t;return};ShapeStyle.prototype.setArrowSize=function(t){this.arrowSize=t;return};ShapeStyle.prototype.setTextB=function(t){this.textB=t;return};ShapeStyle.prototype.setTextU=function(t){this.textU=t;return};ShapeStyle.prototype.setTextI=function(t){this.textI=t;return};ShapeStyle.prototype.setShadow=function(t,e){this.enableShadow=t;this.shadow=e;return};ShapeStyle.prototype.getStrokeStyle=function(t){var e=this.strokeColor;return e};ShapeStyle.prototype.getGradFillStyle=function(t,e,i,n,r){var o=this.fillColor;if(!o){return"White"}if(typeof o==="string"){return o}else if(o.data){return o.data[0]}else{return"White"}};ShapeStyle.prototype.copy=function(t){var e=t.toJson();this.fromJson(e);return};ShapeStyle.prototype.toJson=function(){var t=new Object;for(var e in this){var i=this[e];var n=typeof i;if(n==="function"||n==="object"||n==="undefined"){continue}if(n==="number"||n==="string"||n==="boolean"){t[e]=i}}if(this.enableShadow){t.shadow=this.shadow}else{delete t.enableShadow}delete t.enableGradient;if(!this.textI){delete t.textI}if(!this.textU){delete t.textU}if(!this.textB){delete t.textB}delete t.textAlignment;return t};ShapeStyle.prototype.fromJson=function(t){resetShapeStyle(this);if(t.ls){this.lineStyle=t.ls;this.lineWidth=t.lw;this.lineColor=t.lc;this.fillColor=t.fc;this.textColor=t.tc;this.fontSize=t.fs;this.fontFamily=t.fm!=undefined?t.fm:"serif";this.arrowSize=t.as;this.firstArrowType=t.fat;this.secondArrowType=t.sat;this.textB=t.b;this.textI=t.i;this.textU=t.u;this.enableShadow=t.es}else{for(var e in t){var i=t[e];var n=typeof i;if(n==="function"||n==="undefined"){continue}this[e]=i}}if(this.enableShadow){this.shadow=t.shadow;if(!this.shadow){this.enableShadow=false}}return};ShapeStyle.prototype.dup=function(){var t=new ShapeStyle;t.copy(this);return t};ShapeStyle.prototype.equalTo=function(t){var e=JSON.stringify(this.toJson());var i=JSON.stringify(t.toJson());return e===i};Shape.defaultStyle=null;Shape.getDefaultStyle=function(){if(Shape.defaultStyle){return Shape.defaultStyle}Shape.defaultStyle=createShapeStyle();return Shape.defaultStyle};Shape.saveDefaultStyle=function(){var t=Shape.getDefaultStyle();var e=t.toJson();WebStorage.set("defaultShapeStyle",JSON.stringify(e));return};Shape.loadDefaultStyle=function(){var t=false;var e=Shape.getDefaultStyle();if(WebStorage.get("defaultShapeStyle")){var i=JSON.parse(WebStorage.get("defaultShapeStyle"));e.fromJson(i);t=true}return t};ShapeStyle.createFromJson=function(t){var e=new ShapeStyle;for(var i in t){var n=t[i];var r=typeof n;if(r==="function"||r==="undefined"){continue}e[i]=n}return e};Shape.iconShapeStyle=null;Shape.getIconShapeStyle=function(){if(!Shape.iconShapeStyle){Shape.iconShapeStyle=createShapeStyle();Shape.iconShapeStyle.setLineWidth(1);Shape.iconShapeStyle.setFontSize(8);Shape.iconShapeStyle.setLineColor("Black");Shape.iconShapeStyle.setFillColor("White");Shape.iconShapeStyle.setTextColor("Black")}return Shape.iconShapeStyle};function RShape(){return}RShape.selectMarkColor="Orange";RShape.setSelectMarkColor=function(t){RShape.selectMarkColor=t;return};RShape.prototype=new Shape;RShape.prototype.MIN_SIZE=10;RShape.prototype.isRect=true;RShape.prototype.getX=function(){if(this.anchor){return this._x}else{return this._left}};RShape.prototype.getY=function(){if(this.anchor){return this._y}else{return this._top}};RShape.prototype.setX=function(t){return this.setPosition(t,this.getY())};RShape.prototype.setY=function(t){return this.setPosition(this.getX(),t)};RShape.prototype.getLeft=function(){return this._left};RShape.prototype.getTop=function(){return this._top};RShape.prototype.setLeft=function(t){this._left=t;return this};RShape.prototype.setTop=function(t){this._top=t;return this};RShape.prototype.setLeftTop=function(t,e){this._left=t;this._top=e;return this};RShape.prototype.setPivot=function(t,e){this.pivotX=t;this.pivotY=e;return this};RShape.prototype.getPivot=function(){return{x:this.pivotX,y:this.pivotY}};RShape.prototype.onPositionChanged=function(){};RShape.prototype.getAnchorX=function(){return this.getAnchor().x};RShape.prototype.getAnchorY=function(){return this.getAnchor().y};RShape.prototype.setAnchorX=function(t){return this.setAnchor(t,this.getAnchorY())};RShape.prototype.setAnchorY=function(t){return this.setAnchor(this.getAnchorX(),t)};RShape.prototype.setAnchor=function(t,e){var i=this.getAnchor();i.x=t;i.y=e;this.pivotX=t;this.pivotY=e;this._x=this._left+this.w*t;this._y=this._top+this.h*e;return this};RShape.prototype.getAnchor=function(){if(!this.anchor){this.anchor={x:0,y:0};this._x=this._left;this._y=this._top}return this.anchor};RShape.prototype.getPosition=function(){var t={};if(!this.anchor){t.x=this._left;t.y=this._top}else{t.x=this._x;t.y=this._y}return t};RShape.prototype.setPosition=function(t,e){this._x=t;this._y=e;if(this.anchor){var i=this._x-this.w*this.anchor.x;var n=this._y-this.h*this.anchor.y;this.setLeftTop(i,n)}else{this.setLeftTop(this._x,this._y)}this.onPositionChanged();return this};RShape.prototype.realResize=RShape.prototype.setSize=function(t,e){if(this.w!==t||this.h!==e){var i=Math.max(Math.round(t),4);var n=Math.max(Math.round(e),4);if(this.anchor){this._left=this._x-i*this.anchor.x;this._top=this._y-n*this.anchor.y}this.w=i;this.h=n;this.textNeedRelayout=true}return this};RShape.prototype.initRShape=function(t,e,i,n,r){this.initShape(t,e,i,n,r);this.w=i;this.h=i;this.opacity=1;this.hMargin=0;this.vMargin=0;this.rotation=0;this.image=null;this.imageUrl="";this.defWidth=i;this.defHeight=i;this.enable=true;this.visible=true;this.events={};this.pivotX=.5;this.pivotY=.5;this.text="";this.pointerDown=false;this.lastPosition={x:0,y:0};this.pointerDownPosition={x:0,y:0};if(i===0||n===0){this.w=this.MIN_SIZE;this.h=this.MIN_SIZE;this.setState(Shape.STAT_CREATING_0)}return};RShape.prototype.onPointerDown=function(t){this.pointerDownPosition.x=t.x;this.pointerDownPosition.y=t.y;this.postRedraw();if(this.onPointerDownCreating(t)){return true}return this.onPointerDownNormal(t)};RShape.prototype.onPointerMove=function(t){if(this.isLocked()){return false}if(this.onPointerMoveCreating(t)){return true}return this.onPointerMoveNormal(t)};RShape.prototype.onPointerUp=function(t){var e=false;if(this.onPointerUpCreating(t)){e=true}else{e=this.onPointerUpNormal(t)}this.pointerDown=false;this.postRedraw();return e};RShape.prototype.onPointerDownCreating=function(t){if(this.state===Shape.STAT_CREATING_0){this.state=Shape.STAT_CREATING_1;this.setLeftTop(t.x,t.y);this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.postRedraw();this.pointerDown=true;return true}return false};RShape.prototype.onPointerUpCreating=function(t){if(this.state!==Shape.STAT_NORMAL){var e=t.x-this.lastPosition.x;var i=t.y-this.lastPosition.y;if(this.isClicked()||!this.pointerDown){this.resize(this.defWidth,this.defHeight)}else{this.resizeDelta(e,i)}this.state=Shape.STAT_NORMAL;this.setSelected(true);this.postRedraw()}return false};RShape.prototype.onPointerMoveCreating=function(t){if(this.state===Shape.STAT_CREATING_0){this.setLeftTop(t.x,t.y);this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.postRedraw();return true}else if(this.state===Shape.STAT_CREATING_1){var e=t.x-this.view.pointerDownPosition.x;var i=t.y-this.view.pointerDownPosition.y;this.resize(e,i);this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.postRedraw();return true}return false};RShape.prototype.onPointerDownNormal=function(t){this.hitTestResult=this.hitTest(t);if(!this.hitTestResult){return false}this.pointerDown=true;this.setSelected(true);this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.handlePointerEvent(t,1);return true};RShape.prototype.onPointerMoveNormal=function(t){if(this.hitTestResult){this.handlePointerEvent(t,0);return true}return false};RShape.prototype.onPointerUpNormal=function(t){if(this.hitTestResult){this.handlePointerEvent(t,-1);this.hitTestResult=Shape.HIT_TEST_NONE;return true}return false};RShape.prototype.fixSize=function(){if(this.w<this.MIN_SIZE){this.w=this.MIN_SIZE}if(this.h<this.MIN_SIZE){this.h=this.MIN_SIZE}if(this.wMin&&this.w<this.wMin){this.w=this.wMin}if(this.wMax&&this.w>this.wMax){this.w=this.wMax}if(this.hMax&&this.h>this.hMax){this.h=this.hMax}if(this.hMin&&this.h<this.hMin){this.h=this.hMin}if(this.whRadio){if(this.whRadio>1){this.h=Math.floor(this.w/this.whRadio)}else{this.w=Math.floor(this.h*this.whRadio)}}if(this.parentShape){this.parentShape.fixChildSize(this)}return};RShape.prototype.fixChildSize=function(t){var e=this.w;var i=this.h;if(t.x+t.w>e){t.w=e-t.x}if(t.y+t.h>i){t.h=i-t.y}return};RShape.prototype.setDefSize=function(t,e){this.defWidth=t;this.defHeight=e;this.w=t;this.h=e;return this};RShape.prototype.setSizeLimit=function(t,e,i,n,r){this.wMin=t;this.wMax=i;this.hMin=e;this.hMax=n;this.whRadio=r;return this};RShape.prototype.resizeDelta=function(t,e){this.resize(this.w+t,this.h+e);return};RShape.prototype.resize=function(t,e){if(this.w!==t||this.h!==e){this.setSize(t,e);if(!this.isIcon){this.onSized();this.fixSize()}}return this};RShape.prototype.translate=function(t){t.translate(this.getLeft(),this.getTop());return};RShape.prototype.setClipRect=function(t,e,i,n){if(arguments.length>3){var r={};r.x=t;r.y=e;r.w=i;r.h=n;this.clipInfo=r}else{this.clipInfo=null}return this};RShape.prototype.setClipCircle=function(t,e,i){if(arguments.length>2){circle={};circle.x=t;circle.y=e;circle.r=i;this.clipInfo=circle}else{this.clipInfo=null}return this};RShape.prototype.onClip=function(t){if(this.clipInfo){var e=this.clipInfo;t.beginPath();if(e.r){t.arc(e.x,e.y,e.r,0,Math.PI*2)}else{t.rect(e.x,e.y,e.w,e.h)}t.clip();t.beginPath()}};RShape.prototype.applyScale=function(t){var e=this.getScaleX();var i=this.getScaleY();if(Math.abs(e-1)>1e-4||Math.abs(i-1)>1e-4){var n=this.w*this.pivotX;var r=this.h*this.pivotY;t.translate(n,r);t.scale(e,i);t.translate(-n,-r)}};RShape.prototype.applyRotation=function(t){if(Math.abs(this.rotation)>1e-4){var e=this.w*this.pivotX;var i=this.h*this.pivotY;t.translate(e,i);t.rotate(this.rotation);t.translate(-e,-i)}};RShape.prototype.applyTransform=function(t){if(!t.animating&&t.globalAlpha!==this.opacity){t.globalAlpha=this.opacity}else{t.globalAlpha*=this.opacity}if(this.offsetX){t.translate(this.offsetX,0)}if(this.offsetY){t.translate(0,this.offsetY)}this.applyRotation(t);this.applyScale(t);this.onClip(t);return};RShape.prototype.isPointIn=function(t,e){return isPointInRect(e,this)};RShape.prototype.getMoreSelectMark=function(t,e){return false};RShape.prototype.getRotateSelectMark=function(t,e){if(t===Shape.HIT_TEST_ROTATION){e.x=this.w>>1;e.y=-50;return true}return false};RShape.prototype.drawRotateSelectMark=function(t,e,i){var n=i?15:10;t.arc(e.x,e.y,n,0,Math.PI*2);t.moveTo(e.x,e.y+n);t.lineTo(e.x,0);return};RShape.prototype.getNearPoint=function(t){var e=this.getX();var i=this.getY();var n=this.getWidth();var r=this.getHeight();var o={x:0,y:0};switch(t){case 0:{o.x=e;o.y=i;break}case 1:{o.x=e+n/2;o.y=i;break}case 2:{o.x=e+n;o.y=i;break}case 3:{o.x=e+n;o.y=i+r/2;break}case 4:{o.x=e+n;o.y=i+r;break}case 5:{o.x=e+n/2;o.y=i+r;break}case 6:{o.x=e;o.y=i+r;break}case 7:{o.x=e;o.y=i+r/2;break}case 8:{o.x=e+n/2;o.y=i+r/2;break}default:{if(n>r){switch(t){case 9:{o.x=e+n/4;o.y=i;break}case 10:{o.x=e+3*n/4;o.y=i;break}case 11:{o.x=e+n/4;o.y=i+r;break}case 12:{o.x=e+3*n/4;o.y=i+r;break}default:{return null}}}else{return null}}}return o};RShape.prototype.getSelectMarkMobile=function(t,e){var i=true;switch(t){case Shape.HIT_TEST_TL:{e.x=0;e.y=0;break}case Shape.HIT_TEST_TR:{e.x=this.w;e.y=0;break}case Shape.HIT_TEST_BL:{e.x=0;e.y=this.h;break}case Shape.HIT_TEST_BR:{e.x=this.w;e.y=this.h;break}default:{i=this.getMoreSelectMark(t,e)}}return i};RShape.prototype.getSelectMarkPC=function(t,e){var i=true;switch(t){case Shape.HIT_TEST_TL:{e.x=0;e.y=0;break}case Shape.HIT_TEST_TM:{e.x=this.w>>1;e.y=0;break}case Shape.HIT_TEST_TR:{e.x=this.w;e.y=0;break}case Shape.HIT_TEST_ML:{e.x=0;e.y=this.h>>1;break}case Shape.HIT_TEST_MR:{e.x=this.w;e.y=this.h>>1;break}case Shape.HIT_TEST_BL:{e.x=0;e.y=this.h;break}case Shape.HIT_TEST_BM:{e.x=this.w>>1;e.y=this.h;break}case Shape.HIT_TEST_BR:{e.x=this.w;e.y=this.h;break}case Shape.HIT_TEST_ROTATION:{e.x=this.w>>1;e.y=this.h-100;break}default:{i=this.getMoreSelectMark(t,e)}}return i};RShape.prototype.getSelectMark=function(t,e){if(isMobile()){return this.getSelectMarkMobile(t,e)}else{return this.getSelectMarkPC(t,e)}};RShape.prototype.drawImage=function(t){return};RShape.prototype.paintShape=function(t){t.rect(0,0,this.w,this.h);return};RShape.prototype.setTextNeedRelayout=function(t){this.textNeedRelayout=t;return this};RShape.prototype.layoutText=function(t){if(!this.textNeedRelayout||this.textType===Shape.TEXT_NONE){return}t.font=this.style.getFont();var e=this.vMargin?this.vMargin:10;var i=this.w-2*e;if(i>0){this.lines=layoutText(t,this.style.fontSize,this.getLocaleText(this.text),i)}else{this.lines=[]}this.textNeedRelayout=false;return};RShape.prototype.drawTextUnderLine=function(t,e,i,n){var r=0;var o=0;var a=0;var s=0;if(!this.style.textU){return}s=t.measureText(n).width;if(this.textBaseline==="middle"){a=this.style.fontSize/2;if(this.textAlign==="center"){r=e-s/2}else if(this.textAlign==="left"){r=e}else{r=e-s}}else if(this.textBaseline==="top"){a=this.style.fontSize;if(this.textAlign==="center"){r=e-s/2}else if(this.textAlign==="left"){r=e}else{r=e-s}}else{if(this.textAlign==="center"){r=e-s/2}else if(this.textAlign==="left"){r=e}else{r=e-s}}o=i+a;t.moveTo(r,o);t.lineTo(r+s,o);t.lineWidth=1;t.stroke();return};RShape.prototype.needDrawTextTips=function(){return true};RShape.prototype.setInputTips=function(t){this.inputTips=t;return this};RShape.prototype.getTextTipsPosition=function(){var t={};t.x=this.getWidth()>>1;t.y=this.getHeight()>>1;t.textAlign="center";t.textBaseline="middle";return t};RShape.prototype.drawTextTips=function(t){if(this.text||this.isIcon||this.w<120||this.h<20||this.editing){return}var e=this.getTextTipsPosition();var i=e.x;var n=e.y;t.textAlign=e.textAlign;t.textBaseline=e.textBaseline;t.font=this.style.getFont();t.fillStyle="#E0E0E0";if(this.inputTips){t.fillText(this.getLocaleInputTips(this.inputTips),i,n,this.getWidth())}else{if(this.needDrawTextTips()&&this.selected&&!isMobile()){t.fillText(dappGetText("double click to edit text."),i,n,this.getWidth())}}return};RShape.prototype.getOneLineText=function(t,e){var i="";var n=this.getWidth(true);if(t.measureText(e).width<=n){return e}for(var r=0;r<e.length;r++){var o=e[r];n=n-t.measureText(o).width;if(n<0){break}i=i+o}return i};RShape.prototype.setMargin=function(t,e){this.vMargin=Math.floor(Math.min(t,.5*this.w));this.hMargin=Math.floor(Math.min(e,.5*this.h));return this};RShape.prototype.getVMargin=function(){return this.vMargin?this.vMargin:0};RShape.prototype.getHMargin=function(){return this.hMargin?this.hMargin:0};RShape.prototype.setWidth=function(t){return this.setSize(t,this.h)};RShape.prototype.setHeight=function(t){return this.setSize(this.w,t)};RShape.prototype.getWidth=function(t){if(t){return this.w-2*this.getHMargin()}else{return this.w}};RShape.prototype.getHeight=function(t){if(t){return this.h-2*this.getVMargin()}else{return this.h}};RShape.prototype.drawText=function(t){this.defaultDrawText(t);return};RShape.prototype.prepareStyle=function(t){var e=this.style;t.lineWidth=e.lineWidth;t.strokeStyle=e.lineColor;t.fillStyle=e.fillColor;return};RShape.prototype.resetStyle=function(t){t.shadowOffsetX=0;t.shadowOffsetY=0;t.shadowBlur=0;t.fillStyle="White";t.beginPath();return};RShape.prototype.strokeFill=function(t){if(this.style.enableShadow||isOldIE()){if(t.lineWidth>=1){if(!this.isStrokeColorTransparent()){t.stroke()}}if(!this.isFillColorTransparent()){t.fill()}}else{if(!this.isFillColorTransparent()){t.fill()}if(t.lineWidth>=1){if(!this.isStrokeColorTransparent()){t.stroke()}}}return};RShape.prototype.drawSizeTips=function(t){var e=Math.abs(this.w)+" x "+Math.abs(this.h);t.font="14px serif";t.textAlign="center";t.textBaseline="bottom";t.fillStyle=this.style.textColor;if(this.rotation){e+=" x r"+Math.round(this.rotation*180/Math.PI)}t.beginPath();t.fillText(e,this.w/2,0,this.w);t.fill();return};RShape.prototype.drawSelectMark=function(t,e,i,n){t.beginPath();if(e===Shape.HIT_TEST_ROTATION){this.drawRotateSelectMark(t,i,n)}else{this.createSelectedMark(t,i.x,i.y,n)}t.stroke();return};RShape.prototype.drawSelectedBox=function(t){t.beginPath();t.rect(0,0,this.w,this.h);t.closePath();t.stroke();return};RShape.prototype.drawSelectMarks=function(t){t.save();t.beginPath();t.globalAlpha=1;if(this.selected&&!this.hideSelectMark){var e=Math.floor(2/this.getRealScale());t.lineWidth=e;t.fillStyle=this.style.fillColor;t.strokeStyle=RShape.selectMarkColor;this.drawSelectedBox(t);for(var i=Shape.HIT_TEST_NONE+1;i<Shape.HIT_TEST_MAX;i++){if(this.getSelectMark(i,this.selectMarkPoint)){this.drawSelectMark(t,i,this.selectMarkPoint,i===this.hitTestResult)}}t.beginPath()}t.restore();return};RShape.prototype.paintSelf=function(t){t.save();this.translate(t);t.save();t.beginPath();this.prepareStyle(t);this.applyTransform(t);this.paintShape(t);t.closePath();this.strokeFill(t);t.restore();this.resetStyle(t);this.drawImage(t);if(this.drawText&&this.textType!==Shape.TEXT_NONE){this.drawText(t);this.drawTextTips(t)}if(this.hitTestResult!==Shape.HIT_TEST_NONE||this.state!==Shape.STAT_NORMAL){this.drawSizeTips(t)}this.drawSelectMarks(t);t.restore();return};RShape.prototype.getHitTestCanavs=function(){var t=this.view.getCanvas2D();if(CantkRT.isCantkRTCordova()){return t.getCanvasRenderingContext2D("2d")}else{return t}};RShape.prototype.hitTest=function(t){var e=Shape.HIT_TEST_NONE;var i=this.getHitTestCanavs();if(!this.enable&&this.mode!==Shape.MODE_EDITING){return e}var n=this;function r(t){n.translate(t);n.applyTransform(t)}if(this.selected){for(var o=Shape.HIT_TEST_NONE+1;o<Shape.HIT_TEST_MAX;o++){var a=this.selectMarkPoint;if(this.getSelectMark(o,a)){var s={};this.createSelectedMark({rect:function(t,e,i,n){s.x=t,s.y=e,s.w=i,s.h=n}},a.x,a.y);if(this.isPointInMatrix(s,t,r)){return o}}}if(this.isPointInMatrix({x:0,y:0,w:this.w,h:this.h},t,r)){e=Shape.HIT_TEST_MM}}else if(this.isPointInMatrix({x:0,y:0,w:this.w,h:this.h},t,r)){e=Shape.HIT_TEST_MM}return e};RShape.prototype.isLocked=function(){return this.locked};RShape.prototype.lock=function(){this.locked=true;return this};RShape.prototype.unlock=function(){this.locked=false;return this};RShape.prototype.execMoveResize=function(t,e,i,n){if(window.MoveResizeCommand){this.exec(new MoveResizeCommand(this,t,e,i,n))}else{if(t||t===0){this.setLeft(t)}if(e||e===0){this.setTop(e)}if(i||i===0){this.w=i}if(n||n===0){this.h=n}}return};RShape.prototype.onUserMoving=function(){};RShape.prototype.onUserResizing=function(){};RShape.prototype.onUserRotating=function(){};RShape.prototype.handlePointerEvent=function(t,e){if(e===C_EVT_POINTER_DOWN){this.saveLeft=this.getLeft();this.saveTop=this.getTop();this.saveW=this.w;this.saveH=this.h;this.saveRotation=this.rotation;return}var i=this.saveW;var n=this.saveH;var r=t.x-this.pointerDownPosition.x;var o=t.y-this.pointerDownPosition.y;var a=0;var s=0;var l=i;var h=n;switch(this.hitTestResult){case Shape.HIT_TEST_TL:{a=r;s=o;l=i-r;h=n-o;break}case Shape.HIT_TEST_TM:{s=o;h=n-o;break}case Shape.HIT_TEST_TR:{a=0;s=o;l=i+r;h=n-o;break}case Shape.HIT_TEST_ML:{a=r;l=i-r;break}case Shape.HIT_TEST_MR:{l=i+r;break}case Shape.HIT_TEST_BL:{a=r;l=i-r;h=n+o;break}case Shape.HIT_TEST_BM:{h=n+o;break}case Shape.HIT_TEST_BR:{l=i+r;h=n+o;break}case Shape.HIT_TEST_MOVE:case Shape.HIT_TEST_MM:{a=r;s=o;break}case Shape.HIT_TEST_ROTATION:{var u=(this.w>>1)+this.getLeft();var p=(this.h>>1)+this.getTop();var c=Math.lineAngle({x:u,y:p},t)+Math.PI*.5;if(c>Math.PI*2){c=c-Math.PI*2}this.setRotation(c);this.onUserRotating();if(e===C_EVT_POINTER_UP){var f=this.rotation;this.rotation=this.saveRotation;this.exec(AttributeCommand.create(this,"rotation",null,f))}break}default:break}if(e===C_EVT_POINTER_UP){if(!this.isUserMovable()){this.setLeftTop(this.saveLeft,this.saveTop)}if(!this.isUserResizable()){this.w=i;this.h=n}var m=this.w;var d=this.h;var y=this.getLeft();var g=this.getTop();if(y!==this.saveLeft||g!==this.saveTop||m!==i||d!==n){this.w=i;this.h=n;this.setLeftTop(this.saveLeft,this.saveTop);this.execMoveResize(y,g,m,d);this.onUserMoved();this.onUserResized()}}else{if(a||s){if(this.isUserMovable()){this.setLeftTop(this.saveLeft+a,this.saveTop+s);this.onUserMoving()}}if(i!==l||n!==h){if(this.isUserResizable()){this.w=l;this.h=h;this.onUserResizing()}}}if(this.hitTestResult===Shape.HIT_TEST_HANDLE){r=t.x-this.lastPosition.x;o=t.y-this.lastPosition.y;this.moveHandle(r,o)}this.postRedraw();this.lastPosition.x=t.x;this.lastPosition.y=t.y;return true};RShape.prototype.onKeyDown=function(t){return};RShape.prototype.onKeyUp=function(t){return};RShape.prototype.toJsonMore=function(t){return};RShape.prototype.toJson=function(){var t={};t.type="";t.name="";for(var e in this){if(e.indexOf("anchor")===0)continue;var i=this[e];var n=typeof i;if(e==="isRect"||e==="isContainer"){continue}if(n==="function"||n==="object"||n==="undefined"){continue}if(n==="number"||n==="string"||n==="boolean"){t[e]=i}}delete t._x;delete t._y;delete t._left;delete t._top;delete t.left;delete t.top;delete t.anchorX;delete t.anchorY;delete t.width;delete t.height;delete t.mode;delete t.state;delete t.MIN_SIZE;delete t.selected;delete t.animating;delete t.pointerDown;delete t.saveLeft;delete t.saveTop;delete t.saveW;delete t.saveH;delete t.saveRotation;delete t.hignlighted;delete t.textNeedRelayout;delete t.openPending;delete t.pointerDownTime;delete t.hitTestResult;delete t.pointerDownPosition;delete t.defWidth;delete t.defHeight;delete t.userMovable;delete t.userResizable;delete t.textX;delete t.textY;delete t.textAlign;delete t.textTitle;delete t.vAlign;delete t.hAlign;delete t.editing;delete t.textBaseline;delete t.selectedTime;delete t.animating;delete t.clipW;delete t.clipH;delete t.fixResolution;delete t.forcePortrait;delete t.forceLandscape;delete t.resLoadDone;delete t.saveDx;delete t.saveDy;delete t.initWindowIndex;delete t.timerID;if(!t.textType){delete t.vTextAlign;
delete t.hTextAlign}delete t.textType;if(!t.vMargin){delete t.vMargin}if(!t.hMargin){delete t.hMargin}if(!t.rotation){delete t.rotation}if(t.opacity===1){delete t.opacity}delete t.scale;delete t.scaleX;delete t.scaleY;delete t.needRelayout;delete t.rectSelectable;if(t.rotate==0){delete t.rotate}if(!t.imageUrl){delete t.imageUrl}if(t.offset){t.offset=0}t.x=Math.floor(this.getLeft());t.y=Math.floor(this.getTop());t.w=Math.floor(this.w);t.h=Math.floor(this.h);t.style=this.style.toJson();delete t.style.arrowSize;delete t.style.lineStyle;delete t.style.firstArrowType;delete t.style.secondArrowType;if(this.handle){t.handle=this.handle}if(this.settings){t.settings=this.settings}if(this.propertySheetDesc){t.propertySheetDesc=this.propertySheetDesc}this.toJsonMore(t);return t};RShape.prototype.fromJsonMore=function(t){return};RShape.prototype.onFromJsonDone=function(){};RShape.prototype.fromJson=function(t){this.isUnpacking=true;for(var e in t){var i=t[e];var n=typeof i;if(e==="x"){this.setLeft(i);continue}if(e==="y"){this.setTop(i);continue}if(n==="function"||n==="object"||n==="undefined"){continue}if(n==="number"||n==="string"||n==="boolean"){this[e]=i}}if(this.vAlign){this.vTextAlign=this.vAlign;delete this.vAlign}if(this.hAlign){this.hTextAlign=this.hAlign;delete this.hAlign}if(t.vMargin===undefined){this.vMargin=0}if(t.hMargin===undefined){this.hMargin=0}if(t.rotation===undefined){this.rotation=0}if(t.opacity===undefined){this.opacity=1}if(t.scaleX===undefined){this.scaleX=1}if(t.scaleX===undefined){this.scaleX=1}this.fromJsonMore(t);if(t.style){this.style.fromJson(t.style)}if(t.propertySheetDesc){this.propertySheetDesc=t.propertySheetDesc}if(t.handle){this.handle=t.handle}if(t.settings){this.settings=t.settings}this.setText(this.text);this.textNeedRelayout=true;this.state=Shape.STAT_NORMAL;delete this.isUnpacking;this.onFromJsonDone(t);return};RShape.prototype.setImage=function(t){if(t===this.imageUrl){return}this.imageUrl=t;this.image=new WImage(t);return this};RShape.prototype.asIcon=function(){this.setSize(36,36);if(!this.isIcon){this.setStyle(Shape.getIconShapeStyle())}this.isIcon=true;return};RShape.prototype.showProperty=function(){var t=this.getApp();if(t){t.showRShapePropertyDialog(this)}return};RShape.prototype.getMoveDeltaX=function(){return this.view?this.view.getMoveDeltaX():0};RShape.prototype.getMoveDeltaY=function(){return this.view?this.view.getMoveDeltaY():0};RShape.prototype.getMoveAbsDeltaX=function(){return this.view?this.view.getMoveAbsDeltaX():0};RShape.prototype.getMoveAbsDeltaY=function(){return this.view?this.view.getMoveAbsDeltaY():0};RShape.prototype.setRoundRadius=function(t){this.roundRadius=t;return this};RShape.prototype.setFillColor=function(t){this.style.setFillColor(t);return this};RShape.prototype.setLineColor=function(t){this.style.setLineColor(t);return this};RShape.prototype.setTextColor=function(t){this.style.setTextColor(t);return this};RShape.prototype.getFillColor=function(){return this.style.fillColor};RShape.prototype.getLineColor=function(){return this.style.lineColor};RShape.prototype.getTextColor=function(){return this.style.textColor};Object.defineProperty(RShape.prototype,"x",{get:function(){return this.getX()},set:function(t){this.setX(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"y",{get:function(){return this.getY()},set:function(t){this.setY(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"left",{get:function(){return this.getLeft()},set:function(t){this.setLeft(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"top",{get:function(){return this.getTop()},set:function(t){this.setTop(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"width",{get:function(){return this.getWidth()},set:function(t){this.setWidth(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"height",{get:function(){return this.getHeight()},set:function(t){this.setHeight(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"anchorX",{get:function(){return this.getAnchorX()},set:function(t){this.setAnchorX(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"anchorY",{get:function(){return this.getAnchorY()},set:function(t){this.setAnchorY(t)},enumerable:true,configurable:true});function RShapeInit(t,e){t.initRShape(0,0,40,40,e);return t}function LShape(){return}LShape.prototype=new Shape;LShape.prototype.initDefault=function(){return};LShape.prototype.isLine=true;LShape.prototype.resizeDelta=function(t,e){return};LShape.prototype.setOptions=function(t,e,i,n){this.firstArrowUnchangable=t;this.secondArrowUnchangable=e;this.lineStyleUnchangable=i;this.arrowSizeUnchangable=n;return};LShape.prototype.setStyle=function(t){var e=this.style.firstArrowType;var i=this.style.secondArrowType;var n=this.style.lineStyle;var r=this.style.arrowSize;this.style.copy(t);this.needRelayout=true;if(this.firstArrowUnchangable){this.style.setFirstArrowType(e)}if(this.secondArrowUnchangable){this.style.setSecondArrowType(i)}if(this.lineStyleUnchangable){this.style.setLineStyle(n)}if(this.arrowSizeUnchangable){this.style.setArrowSize(r)}return};LShape.prototype.getWidth=function(){var t=this.points[0].x;var e=this.points[0].x;for(var i=0;i<this.points.length;i++){var n=this.points[i];if(t>n.x){t=n.x}if(e<n.x){e=n.x}}return e-t};LShape.prototype.getHeight=function(){var t=this.points[0].y;var e=this.points[0].y;for(var i=0;i<this.points.length;i++){var n=this.points[i];if(t>n.y){t=n.y}if(e<n.y){e=n.y}}return e-t};LShape.prototype.getX=function(){var t=this.points[0].x;for(var e=0;e<this.points.length;e++){var i=this.points[e];if(t>i.x){t=i.x}}return t};LShape.prototype.getY=function(){var t=this.points[0].y;for(var e=0;e<this.points.length;e++){var i=this.points[e];if(t>i.y){t=i.y}}return t};LShape.prototype.updatePoint=function(t,e){return false};LShape.prototype.isPointIn=function(t,e){return false};LShape.prototype.getPoint=function(t){return t<this.points.length?this.points[t]:null};LShape.prototype.saveState=function(){if(!this.savePoints){this.savePoints=new Array}this.savePoints.copy(this.points);return};LShape.prototype.findNear=function(t){this.near=null;if(this.view){var e=this.getNearRange();var i=e+e;var n={x:t.x-e,y:t.y-e,w:i,h:i};this.near=this.view.findNear(this,n)}return this.near};LShape.prototype.getNearPoint=function(t){if(t<this.points.length){return this.points[t]}return null};LShape.prototype.initLShape=function(t,e){this.points=new Array;this.savePoints=new Array;this.initDefault();var i=this.getX();var n=this.getY();var r=this.getWidth();var o=this.getHeight();this.initShape(i,n,r,o,e);if(t){this.points.copy(t);this.state=Shape.STAT_NORMAL}else{this.state=Shape.STAT_CREATING_0}this.style.setLineWidth(2);return};LShape.prototype.onPointerDown=function(t){this.pointerDown=true;this.lastPosition.copy(t);if(this.state===Shape.STAT_NORMAL){this.hitTestResult=this.hitTest(t)}this.setSelected(this.hitTestResult);this.handlePointerEvent(t,C_EVT_POINTER_DOWN);this.postRedraw();this.saveState();return this.hitTestResult};LShape.prototype.move=function(t,e){var i=t-this.getX();var n=e-this.getY();this.moveDelta(i,n);return};LShape.prototype.moveDelta=function(t,e){for(var i in this.points){this.points[i].x+=t;this.points[i].y+=e}return};LShape.prototype.isPointInSegment=function(t,e,i,n){if(!e||!i){return}var r=false;var o=10;var a=i.x-e.x;var s=i.y-e.y;var l=Math.sqrt(a*a+s*s);var h=Math.atan(s/a);t.save();t.translate((e.x+i.x)/2,(e.y+i.y)/2);t.rotate(h);t.beginPath();t.rect(-l/2,-o,l,2*o);t.restore();r=t.isPointInPath(n.x,n.y);t.beginPath();return r};LShape.prototype.onPointerMove=function(t){var e=true;if(this.state===Shape.STAT_NORMAL){if(this.hitTestResult){if(this.hitTestResult===Shape.HIT_TEST_MM){var i=t.x-this.lastPosition.x;var n=t.y-this.lastPosition.y;this.moveDelta(i,n)}else{this.findNear(t);this.updatePoint(this.hitTestResult-1,t)}this.postRedraw()}}else{this.findNear(t)}this.handlePointerEvent(t,C_EVT_POINTER_MOVE);this.lastPosition.copy(t);this.onMoved();return this.hitTestResult};LShape.prototype.clearAttachedNearPoints=function(){this.observers=[];return};LShape.prototype.updateNearPoints=function(){for(var t=0;t<this.points.length;t++){var e=this.findNear(this.points[t]);this.attachToNearPoint(e,t);this.near=null}return};LShape.prototype.attachToNearPoint=function(t,e){if(!this.observers){this.observers=[]}for(var i=this.observers.length;i<e+1;i++){this.observers.push(null)}if(!t){this.observers[e]=null;return}var n=this;var r={};var o=t.shape;r.line=this;r.object=t.shape;r.pointIndex=e;r.observerPointIndex=t.nearPointIndex;this.points[e].copy(t.point);r.update=function(t){if(this.object!=t){return false}if(!this.line.view){return false}if(this.line.selected&&this.line.view.isPointerDown()){return true}var e=this.line.observers;for(var i=0;i<e.length;i++){var n=e[i];if(!n){continue}if(n.object===t){var r=t.getNearPoint(this.observerPointIndex);this.line.updatePoint(this.pointIndex,r);return true}}return false};this.observers[e]=null;this.observers[e]=r;o.registerChangedListener(r);return};LShape.prototype.onPointerUp=function(t){var e=this.state;this.handlePointerEvent(t,C_EVT_POINTER_UP);this.lastPosition.copy(t);this.postRedraw();this.pointerDown=false;if(this.hitTestResult>0){var i=this.hitTestResult-1;this.attachToNearPoint(this.near,i);if(this.near){this.updatePoint(i,this.near.point)}}else if(!this.isClicked()&&e===Shape.STAT_NORMAL){this.clearAttachedNearPoints()}this.hitTestResult=Shape.HIT_TEST_NONE;this.exec(new LineMoveCommand(this,this.savePoints,!this.near));this.near=null;if(!this.isClicked()){this.onMoved()}return this.hitTestResult};LShape.prototype.resize=function(t,e){return};LShape.prototype.translate=function(t){t.translate(this.x,this.y);return};LShape.prototype.drawSelectMarks=function(t){if(this.selected){t.beginPath();t.lineWidth=1;t.shadowBlur=0;t.strokeStyle=this.style.lineColor;for(var e=0;e<this.points.length;e++){var i=this.points[e];var n=e===this.hitTestResult-1;this.createSelectedMark(t,i.x,i.y,n)}t.stroke();t.beginPath()}return};LShape.prototype.drawTips=function(t){if(this.selected&&this.pointerDown){t.fillStyle=this.style.lineColor;for(var e=0;e<this.points.length;e++){var i=this.points[e];var n=Math.floor(i.x)+"x"+Math.floor(i.y);t.font="14px serif";t.textAlign="center";t.textBaseline="bottom";t.fillText(n,i.x,i.y,100)}}return};LShape.prototype.hitTest=function(t){var e=Shape.HIT_TEST_NONE;var i=this.view.getCanvas2D();i.save();this.translate(i);for(var n=0;n<this.points.length;n++){var r=this.points[n];if(this.isInSelectedMark(i,r.x,r.y,t)){i.restore();return this.selected?n+1:Shape.HIT_TEST_MM}}if(this.isPointIn(i,t)){e=Shape.HIT_TEST_MM}i.restore();return e};LShape.prototype.onKeyDown=function(t){return};LShape.prototype.onKeyUp=function(t){return};LShape.prototype.pointsToJson=function(){var t="";for(var e=0;e<this.points.length;e++){var i=this.points[e];if(e>0){t+=","}t+="{x:"+i.x+",y:"+i.y+"}"}return t};LShape.prototype.toJson=function(){var t=new Object;t.type=this.type;t.points=this.points;t.text=this.text;t.style=this.style.toJson();return t};LShape.prototype.pointsFromJson=function(t){for(var e=0;e<t.points.length;e++){var i=t.points[e];this.points.push(new Point(i.x,i.y))}return};LShape.prototype.fromJson=function(t){this.points.clear();this.text=t.text;this.style.fromJson(t.style);this.pointsFromJson(t);this.state=Shape.STAT_NORMAL;return};LShape.prototype.drawText=function(t){var e=this.getLocaleText(this.text);if(e){var i=(this.points[0].x+this.points[1].x)/2;var n=(this.points[0].y+this.points[1].y)/2;t.beginPath();t.textAlign="center";t.textBaseline="bottom";var r=this.style.getFont();t.font=r;t.fillStyle=this.style.textColor;t.fillText(e,i,n);t.fill()}return};LShape.prototype.prepareStyle=function(t){var e=this.style;t.lineWidth=e.lineWidth;t.strokeStyle=e.lineColor;t.fillStyle=e.fillColor;if(e.enableGradient){t.strokeStyle=e.getStrokeStyle(t)}else{t.strokeStyle=e.lineColor}if(e.enableShadow){t.shadowColor=e.shadow.color;t.shadowOffsetX=e.shadow.x;t.shadowOffsetY=e.shadow.y;t.shadowBlur=e.shadow.blur}return};LShape.prototype.resetStyle=function(t){t.shadowOffsetX=0;t.shadowOffsetY=0;t.shadowBlur=0;t.strokeStyle=this.style.lineColor;t.beginPath();return};LShape.prototype.showProperty=function(){var t=this.getApp();if(t){t.showLShapePropertyDialog(this)}return};LShape.prototype.asIcon=function(){this.isIcon=true;this.setStyle(Shape.getIconShapeStyle());return};var C_CREATE_FOR_USER=0;var C_CREATE_FOR_ICON=1;var C_CREATE_FOR_PROGRAM=2;function ShapeCreator(t,e,i,n){this.type=t;this.icon=i;this.name=e;this.visible=n;this.isVisibleToUser=function(){return this.visible};this.getID=function(){return this.type};this.getIcon=function(){return this.icon};this.getName=function(){return this.name};this.createIconShape=function(){if(!this.iconShape){this.iconShape=this.createShape(C_CREATE_FOR_ICON)}return this.iconShape};this.createShape=function(t){return null};return}function ShapeFactory(){this.defaultCategory=null;this.recentUsed=[];this.creators=[];this.categories={};this.categoryNames=[];this.diagramTypes=[];this.listeners=[];ShapeFactory.CATEGORY_RECENT_USED="Recent Used";ShapeFactory.CATEGORY_USER_COMPONENTS="User Component";this.setDefaultCategory=function(t){this.defaultCategory=t;return};this.getDiagramTypes=function(){return this.diagramTypes};this.addDiagramType=function(t,e){var i={name:t,defaultCategory:e};this.diagramTypes.push(i);return};this.removeCategoryName=function(t){this.categoryNames.remove(t);return};this.removeShapeCreator=function(t,e){var i=this.find(t);var n=this.categories[e];if(i){this.creators.remove(i);if(n){n.remove(i);this.notifyChanged("remove",e,i)}}return};this.isPlacehodler=function(t){return t==="---"};this.isUserComponents=function(t){return t===ShapeFactory.CATEGORY_USER_COMPONENTS};this.addPlaceholder=function(){this.categoryNames.push("---");return};this.loadRecentUsedShapeCreators=function(){var t=WebStorage.get("recentUsed");var e=t?JSON.parse(t):[];for(var i=0;i<e.length;i++){var n=e[i];var r=this.find(n);if(r){this.addShapeCreator(r,ShapeFactory.CATEGORY_RECENT_USED);this.recentUsed.push(n)}}return};this.addRecentUsedShapeCreator=function(t){var e=this.find(t);if(e){this.recentUsed.remove(t);this.recentUsed.push(t);if(this.recentUsed.length>10){this.recentUsed.shift()}WebStorage.set("recentUsed",JSON.stringify(this.recentUsed));this.addShapeCreator(e,ShapeFactory.CATEGORY_RECENT_USED)}};this.addShapeCreator=function(t,e){this.notifyChanged("add",e,t);if(e!=ShapeFactory.CATEGORY_RECENT_USED){this.creators.push(t)}if(e){if(!this.defaultCategory){this.setDefaultCategory(e)}if(!this.categories[e]){this.categories[e]=[];if(e==ShapeFactory.CATEGORY_RECENT_USED){this.categoryNames.unshift(e)}else{this.categoryNames.push(e)}}this.categories[e].remove(t);if(e==ShapeFactory.CATEGORY_RECENT_USED){this.categories[e].unshift(t)}else{this.categories[e].push(t)}}return};this.getCategoryNames=function(){return this.categoryNames};this.getDefaultCategory=function(){return this.categories[this.defaultCategory]};this.getByCategory=function(t){return this.categories[t]};this.find=function(t){for(var e=0;e<this.creators.length;e++){var i=this.creators[e];if(i.getID()===t){return i}}return null};this.createShapeByUser=function(t,e){return this.createShape(t,C_CREATE_FOR_USER,e)};this.createShapeByProgram=function(t,e){return this.createShape(t,C_CREATE_FOR_PROGRAM,e)};this.createShape=function(t,e,i){if(!t){return null}var n=this.find(t);if(n){return n.createShape(e)}console.log("not found type "+t+", create ui-unkown instead.");if(!i){n=this.find("ui-unkown");if(n){return n.createShape(e)}return null}};this.addListener=function(t){this.listeners.push(t);return this};this.removeListener=function(t){this.listeners.remove(t);return this};this.notifyChanged=function(t,e,i){var n=this.listeners;for(var r=0;r<n.length;r++){var o=n[r];if(o){o(t,e,i)}}return};return}ShapeFactory.instance=null;ShapeFactory.getInstance=function(){if(!ShapeFactory.instance){ShapeFactory.instance=new ShapeFactory;setTimeout(function(){ShapeFactory.instance.loadRecentUsedShapeCreators()},2e3)}return ShapeFactory.instance};function ShapeFactoryGet(){return ShapeFactory.getInstance()}function dappSetDefaultCategory(t){return ShapeFactory.getInstance().setDefaultCategory(t)}function cantkRegShapeCreator(t,e){return ShapeFactory.getInstance().addShapeCreator(t,e)}function dupDeviceConfig(t){var e={};e.name=t.name;e.bg=t.bg;e.platform=t.platform;e.version=t.version;e.lcdDensity=t.lcdDensity;e.width=t.width;e.height=t.height;e.screenX=t.screenX;e.screenY=t.screenY;e.screenW=t.screenW;e.screenH=t.screenH;e.hasMenuBar=t.hasMenuBar;return e}function cantkDetectDeviceConfig(){var t={version:4};if(isAndroid()){t.platform="android"}else if(isIPhone()||isIPad()){t.platform="iphone"}else if(isFirefoxOS()){t.platform="firefox"}else if(isWinPhone()){t.platform="winphone"}else if(isTizen()){t.platform="tizen"}else{t.platform="android"}if(window.devicePixelRatio>2.2){t.lcdDensity="xxhdpi"}else if(window.devicePixelRatio>1.5){t.lcdDensity="xhdpi"}else if(window.devicePixelRatio>1.1){t.lcdDensity="hdpi"}else if(window.devicePixelRatio>.8){t.lcdDensity="mdpi"}else if(!window.devicePixelRatio){var e=Math.min(window.orgViewPort.width,window.orgViewPort.height);if(e>600){t.lcdDensity="xhdpi"}else{t.lcdDensity="hdpi"}}else{t.lcdDensity="ldpi"}if(isFirefoxOS()){t.lcdDensity="mdpi"}if(!isMobile()){t.lcdDensity="hdpi"}console.log("deviceConfig.lcdDensity:"+t.lcdDensity);console.log("deviceConfig.platform:"+t.platform);return t}function isDeviceConfigEqual(t,e){var i=JSON.stringify(t);var n=JSON.stringify(e);return i===n}function cantkPreloadImage(t){var e=new WImage(t);return e}var gTempCanvas=null;function cantkGetTempCanvas(t,e){if(!gTempCanvas){gTempCanvas=document.createElement("canvas");gTempCanvas.type="backend_canvas";gTempCanvas.width=t;gTempCanvas.height=e}if(gTempCanvas){if(gTempCanvas.width!=t){gTempCanvas.width=t}if(gTempCanvas.height!=e){gTempCanvas.height=e}}return gTempCanvas}var gApp8LocaleStrings={"Loading...":"正在努力加载..."};function webappGetText(t){var e=null;if(!t){return""}if(gApp8LocaleStrings){e=gApp8LocaleStrings[t]}if(!e){e=t}return e}function webappSetLocaleStrings(t){gApp8LocaleStrings=t;return}var gDeviceConfigs=[];function cantkRegisterDevice(t){gDeviceConfigs.push(dupDeviceConfig(t));return}function cantkGetDeviceConfig(t){for(var e=0;e<gDeviceConfigs.length;e++){var i=gDeviceConfigs[e];if(i.name===t){return dupDeviceConfig(i)}}return null}function cantkGetAllDeviceConfig(){return gDeviceConfigs}function cantkLoadDefaultDeviceConfigs(){var t={name:"android-WVGA800",bg:"/drawapp8/images/devices/device_800x480.png",platform:"android",version:"4",lcdDensity:"hdpi",width:600,height:1126,screenX:60,screenY:198,screenW:480,screenH:800,hasMenuBar:true};var e={name:"tizen-WVGA800",bg:"/drawapp8/images/devices/device_800x480.png",platform:"tizen",version:"4",lcdDensity:"hdpi",width:600,height:1126,screenX:60,screenY:198,screenW:480,screenH:800};var i={name:"tizen-WXGA720",bg:"/drawapp8/images/devices/device_1280x720.png",platform:"tizen",version:"4",lcdDensity:"xhdpi",width:860,height:1802,screenX:74,screenY:268,screenW:720,screenH:1280};var n={name:"android-WXGA720",bg:"/drawapp8/images/devices/device_1280x720.png",platform:"android",version:"4",lcdDensity:"xhdpi",width:860,height:1802,screenX:74,screenY:268,screenW:720,screenH:1280,hasMenuBar:true};var r={name:"android-WXGA800",bg:"/drawapp8/images/devices/device.png",platform:"android",version:"4",lcdDensity:"mdpi",width:1400,height:964,screenX:60,screenY:82,screenW:1280,screenH:800,hasMenuBar:true};var o={name:"android-WSVGA",bg:"/drawapp8/images/devices/device.png",platform:"android",version:"4",lcdDensity:"mdpi",width:1130,height:764,screenX:60,screenY:82,screenW:1024,screenH:600,hasMenuBar:true};var a={name:"iphone4s",bg:"/drawapp8/images/devices/device_iphone4s.png",platform:"iphone",version:"4s",lcdDensity:"xhdpi",width:760,height:1487,screenX:65,screenY:265,screenW:640,screenH:960,hasMenuBar:false};var s={name:"iphone5",bg:"/drawapp8/images/devices/device_iphone5.png",platform:"iphone",version:"5",lcdDensity:"xhdpi",width:765,height:1600,screenX:65,screenY:238,screenW:640,screenH:1136,hasMenuBar:false};var l={name:"BlackBerry Q10",bg:"/drawapp8/images/devices/device_bb_q10.jpg",platform:"blackberry",version:"10",lcdDensity:"xhdpi",width:860,height:1520,screenX:66,screenY:246,screenW:720,screenH:720,hasMenuBar:false};var h={name:"BlackBerry Z10",bg:"/drawapp8/images/devices/device_bb_z10.jpg",platform:"blackberry",version:"10",lcdDensity:"xhdpi",width:920,height:1820,screenX:72,screenY:258,screenW:768,screenH:1280,hasMenuBar:false};var u={name:"Nokia Lumia 800",bg:"/drawapp8/images/devices/device_nokia_lumia_800.jpg",platform:"winphone",version:"8",lcdDensity:"hdpi",width:620,height:1170,screenX:86,screenY:146,screenW:480,screenH:800,hasMenuBar:false};var p={name:"Nokia Lumia 920",bg:"/drawapp8/images/devices/device_nokia_lumia_920.jpg",platform:"winphone",version:"8",lcdDensity:"xhdpi",width:1050,height:1780,screenX:136,screenY:192,screenW:768,screenH:1280,hasMenuBar:false};var c={name:"iPad Mini",bg:"/drawapp8/images/devices/device_ipad_mini.jpg",platform:"iphone",version:"5",lcdDensity:"mdpi",width:876,height:1290,screenX:52,screenY:132,screenW:768,screenH:1024,hasMenuBar:false};var f={name:"iPad 4",bg:"/drawapp8/images/devices/device_ipad_4.jpg",platform:"iphone",version:"5",lcdDensity:"hdpi",width:1942,height:2542,screenX:198,screenY:238,screenW:1536,screenH:2048,hasMenuBar:false};var m={name:"PC-General",bg:"/drawapp8/images/pc-general.png",platform:"android",version:"4",lcdDensity:"hdpi",width:856,height:668,screenX:30,screenY:32,screenW:800,screenH:600};var d={name:"PC-Portrait",bg:"/drawapp8/images/pc-480x720.png",platform:"android",version:"4",lcdDensity:"hdpi",width:600,height:840,screenX:60,screenY:70,screenW:480,screenH:720,hasMenuBar:false};var y={name:"480x720",bg:"/drawapp8/images/device.png",platform:"android",lcdDensity:"hdpi",width:552,height:878,screenX:36,screenY:80,screenW:480,screenH:720};var g={name:"480x800",bg:"/drawapp8/images/device.png",platform:"android",lcdDensity:"hdpi",width:552,height:974,screenX:36,screenY:88,screenW:480,screenH:800};var v={name:"720x1280",bg:"/drawapp8/images/device.png",platform:"android",lcdDensity:"hdpi",width:832,height:1500,screenX:56,screenY:112,screenW:720,screenH:1280};var _={name:"320x480",bg:"/drawapp8/images/device.png",platform:"android",lcdDensity:"mdpi",width:370,height:590,screenX:25,screenY:55,screenW:320,screenH:480};cantkRegisterDevice(y);cantkRegisterDevice(v);cantkRegisterDevice(g);cantkRegisterDevice(_);cantkRegisterDevice(m);return}cantkLoadDefaultDeviceConfigs();VelocityTracker.prototype.HISTORY_SIZE=20;VelocityTracker.prototype.HORIZON=200*1e6;VelocityTracker.prototype.MIN_DURATION=10*1e6;function Movement(){this.eventTime=0;this.point=new Point(0,0);this.getPoint=function(){return this.point};return this}function VelocityTracker(){this.clear();return this}VelocityTracker.prototype.clear=function(){this.index=0;var t=this.HISTORY_SIZE;if(!this.movements){this.movements=new Array;for(var e=0;e<t;e++){this.movements.push(new Movement)}}for(var e=0;e<t;e++){var i=this.movements[e];i.eventTime=0;i.point={x:0,y:0}}return};VelocityTracker.prototype.addMovement=function(t,e){if(++this.index==this.HISTORY_SIZE){this.index=0}this.movements[this.index].eventTime=t;this.movements[this.index].point=e;return};VelocityTracker.prototype.getVelocity=function(){var t={x:0,y:0};this.estimate();t.x=this.xVelocity;t.y=this.yVelocity;return t};VelocityTracker.prototype.estimate=function(){var t=this.HORIZON;var e=this.MIN_DURATION;var i=this.HISTORY_SIZE;var n=this.movements[this.index];var r=n.eventTime-t;var o=this.index;var a=1;do{var s=(o==0?i:o)-1;var l=this.movements[s];if(l.eventTime<r){break}o=s}while(++a<i);var h=0;var u=0;var p=o;var c=0;var f=this.movements[o];var m=f.getPoint();var d=0;while(a-- >1){if(++p==i){p=0}var y=this.movements[p];var g=y.eventTime-f.eventTime;if(g>=e){var v=y.getPoint();var _=1e9/g;var I=(v.x-m.x)*_;var w=(v.y-m.y)*_;h=(h*d+I*g)/(g+d);u=(u*d+w*g)/(g+d);d=g;c+=1}}if(c){this.xVelocity=h;this.yVelocity=u}else{this.xVelocity=0;this.yVelocity=0}return true};function testVelocityTracker(){var t=null;var e=new VelocityTracker;function i(t){return t*1e6}for(var n=0;n<20;n++){e.addMovement(i(10*n),{x:10*n,y:10*n*n/2})}t=e.getVelocity();console.log("xv: "+t.x+" yv: "+t.y);return}function Interpolator(){this.get=function(t){return 0};return this}function LinearInterpolator(){this.get=function(t){return t};return this}function BounceInterpolator(){function t(t){return 8*t*t}this.get=function(e){e*=1.1226;if(e<.3535)return t(e);else if(e<.7408)return t(e-.54719)+.7;else if(e<.9644)return t(e-.8526)+.9;else return t(e-1.0435)+.95};return this}function AccelerateInterpolator(){this.get=function(t){return t*t};return this}function AccDecelerateInterpolator(){this.get=function(t){return Math.cos((t+1)*Math.PI)/2+.5};return this}function DecelerateInterpolator(t){this.factor=t?t:2;this.get=function(t){if(this.factor===1){return 1-(1-t)*(1-t)}else{return 1-Math.pow(1-t,2*this.factor)}};return this}function SineAccelerateInterpolator(){this.get=function(t){return-Math.cos(t*(Math.PI/2))+1};return this}function SineAccDecelerateInterpolator(){this.get=function(t){return-.5*(Math.cos(Math.PI*t)-1)};return this}function SineDecelerateInterpolator(){this.get=function(t){return Math.sin(t*(Math.PI/2))};return this}function AnimationFactory(){this.createAnimation=function(t,e){UIElement.getMainCanvasScale(true);var i=isIPhone()?400:600;e=e?e:i;switch(t){case"anim-forward":{var n=new DecelerateInterpolator;animation=isAndroid()?new AnimationHTranslate(true):new AnimationHTranslate(true);animation.toLeft();animation.init(e,n);break}case"anim-backward":{var n=new DecelerateInterpolator;animation=isAndroid()?new AnimationHTranslate(false):new AnimationHTranslate(false);animation.toRight();animation.init(e,n);break}case"anim-upward":{var n=new DecelerateInterpolator;animation=new AnimationVTranslate(true);animation.init(e,n);break}case"anim-downward":{var n=new DecelerateInterpolator;animation=new AnimationVTranslate(false);animation.init(e,n);break}case"anim-scale-show-win":{var n=new DecelerateInterpolator(1);if(isMobile()){animation=new AnimationBrowserScaleWin(true);animation.setRange(1.2,1)}else{animation=new AnimationScale(true);animation.setRange(.9,1)}animation.init(e,n);break}case"anim-scale-hide-win":{var n=new AccelerateInterpolator;if(isMobile()){animation=new AnimationBrowserScaleWin(false);animation.setRange(.9,1)}else{animation=new AnimationScale(false);animation.setRange(1,.9)}animation.init(e,n);break}case"anim-scale-show-dialog":{e=e?e:300;var n=new DecelerateInterpolator;animation=isAndroid()?new AnimationBrowserScaleDialog(true):new AnimationScale(true);animation.setRange(.9,1);animation.init(e,n);break}case"anim-scale-hide-dialog":{e=e?e:300;var n=new AccelerateInterpolator;animation=isAndroid()?new AnimationBrowserScaleDialog(false):new AnimationScale(false);animation.setRange(1,.9);animation.init(e,n);break}case"anim-fade-in":{var n=new AccelerateInterpolator;animation=isAndroid()?new AnimationBrowserAlpha(true):new AnimationAlpha(true);animation.setRange(.6,1);animation.init(500,n);break}case"anim-fade-out":{var n=new AccelerateInterpolator;animation=isAndroid()?new AnimationBrowserAlpha(false):new AnimationAlpha(false);animation.setRange(1,.8);animation.init(300,n);break}case"anim-move-up":{var n=new DecelerateInterpolator;animation=isMobile()?new AnimationBrowserMove(true):new AnimationMove(true);animation.init(e,n);break}case"anim-move-down":{var n=new AccelerateInterpolator;animation=isMobile()?new AnimationBrowserMove(false):new AnimationMove(false);animation.init(e,n);break}case"anim-expand-up":case"anim-expand-left":case"anim-expand-right":case"anim-expand-down":{var n=new DecelerateInterpolator;animation=new Animation1Expand(true);animation.init(400,n);break}case"anim-collapse-up":case"anim-collapse-left":case"anim-collapse-right":case"anim-collapse-down":{var n=new AccelerateInterpolator;animation=new Animation1Expand(true);animation.init(400,n);break}case"anim-scale1-show-origin-topleft":case"anim-scale1-show-origin-center":case"anim-scale1-show-origin-bottomleft":case"anim-scale1-show-origin-topright":case"anim-scale1-show-origin-bottomright":case"anim-scale1-show":{var n=new DecelerateInterpolator;animation=new Animation1Scale(true);animation.init(400,n);break}case"anim-scale1-hide-origin-topleft":case"anim-scale1-hide-origin-center":case"anim-scale1-hide-origin-bottomleft":case"anim-scale1-hide-origin-topright":case"anim-scale1-hide-origin-bottomright":case"anim-scale1-hide":{var n=new AccelerateInterpolator;animation=new Animation1Scale(false);animation.init(400,n);break}case"anim-alpha1-show":{var n=new DecelerateInterpolator;animation=new Animation1Alpha(true);animation.init(400,n);break}case"anim-alpha1-hide":{var n=new AccelerateInterpolator;animation=new Animation1Alpha(false);animation.init(400,n);break}}return animation};return this}AnimationFactory.createInterpolator=function(t,e){switch(t){case"l":case"linear":{return new LinearInterpolator}case"b":case"bounce":{return new BounceInterpolator}case"a":case"accelerate":{return new AccelerateInterpolator}case"ad":case"accelerate-decelerate":{return new AccDecelerateInterpolator}case"sa":case"sine-accelerate":{return new SineAccelerateInterpolator}case"sd":case"sine-decelerate":{return new SineDecelerateInterpolator}case"sad":case"sine-accelerate-decelerate":{return new SineAccDecelerateInterpolator}default:{return new DecelerateInterpolator}}};AnimationFactory.create=function(t,e){if(!AnimationFactory.instance){AnimationFactory.instance=new AnimationFactory}return AnimationFactory.instance.createAnimation(t,e)};Animation.getCanvas=function(){if(!Animation.canvas){Animation.canvas=document.createElement("canvas");Animation.canvas.type="animation_canvas"}Animation.canvas.style.zIndex=9;Animation.canvas.style["opacity"]=1;scaleElement(Animation.canvas,1,1);return Animation.canvas};Animation.getOldWinCanvas=function(){if(!Animation.oldWnCanvas){Animation.oldWnCanvas=document.createElement("canvas");Animation.oldWnCanvas.type="animation_canvas"}Animation.oldWnCanvas.style.zIndex=9;Animation.oldWnCanvas.style["opacity"]=1;scaleElement(Animation.oldWnCanvas,1,1);return Animation.oldWnCanvas};Animation.getNewWinCanvas=function(){if(!Animation.newWinCanvas){Animation.newWinCanvas=document.createElement("canvas");Animation.newWinCanvas.type="animation_canvas"}Animation.newWinCanvas.style.zIndex=9;Animation.newWinCanvas.style["opacity"]=1;scaleElement(Animation.newWinCanvas,1,1);return Animation.newWinCanvas};Animation.getBackendCanvas=function(t,e){if(!Animation.backendCanvas){Animation.backendCanvas=document.createElement("canvas");Animation.backendCanvas.type="backend_canvas";Animation.backendCanvas.width=t;Animation.backendCanvas.height=e}if(Animation.backendCanvas){if(Animation.backendCanvas.width!=t){Animation.backendCanvas.width=t}if(Animation.backendCanvas.height!=e){Animation.backendCanvas.height=e}Animation.scaleCanvas(Animation.backendCanvas,t,e)}scaleElement(Animation.backendCanvas,1,1);return Animation.backendCanvas};function Animation(t){this.scale=1;this.visible=false;this.showWin=t;this.init=function(t,e){this.duration=t?t:500;this.interpolator=e;return};this.setRectOfFront=function(t,e,i,n){this.frontX=t;this.frontY=e;this.frontW=i;this.frontH=n;return};this.setScale=function(t){this.scale=t;return};this.prepare=function(t,e,i,n,r,o){this.x=Math.round(t);this.y=Math.round(e);this.w=Math.round(i);this.h=Math.round(n);this.onFinish=o;this.canvasImage=CantkRT.createImageFromCanvas(r);this.setRectOfFront(0,0,i,n);if(r){
this.sw=r.width;this.sh=r.height}this.show();return true};this.moveResizeCanvas=function(t,e,i,n,r){t.style.position="absolute";t.width=n;t.height=r;setElementPosition(t,e,i);t.style.visibility="visible";Animation.scaleCanvas(t,n,r);return};this.show=function(){var t=this.w*this.scale;var e=this.h*this.scale;this.visible=true;this.canvasElement=Animation.getCanvas();this.moveResizeCanvas(this.canvasElement,this.x,this.y,t,e);document.body.appendChild(this.canvasElement);return true};this.hide=function(){this.visible=false;if(this.canvasElement&&this.canvasElement.parentNode){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.getTimePercent=function(){var t=new Date;var e=t.getTime()-this.startTime;return e/this.duration};this.getPercent=function(t){return this.interpolator.get(t)};this.step=function(t){return true};this.beforeRun=function(){return true};this.afterRun=function(){return true};this.drawBackground=function(t){if(this.isFirstStep){this.canvas.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h)}else{var e=this.frontX;var i=this.frontY;var n=this.frontW;var r=this.frontH;this.canvas.drawImage(this.canvasImage,e,i,n,r,e,i,n,r)}return};this.doStep=function(t){this.canvas.save();this.canvas.scale(this.scale,this.scale);this.step(t);this.canvas.restore();return};this.run=function(){var t=new Date;var e=this;this.startTime=t.getTime();e.isFirstStep=true;this.beforeRun();WWindowManager.getInstance().setPaintEnable(false);function i(){var t=0;var n=e.getTimePercent();if(n<1){t=e.getPercent(n);e.doStep(t);requestAnimFrame(i)}else{e.cleanup();e.afterRun();WWindowManager.getInstance().setPaintEnable(true);console.log("Animation done.")}e.isFirstStep=false}i();return};this.cleanup=function(){var t=this;var e=this.onFinish;setTimeout(function(){t.hide()},100);if(e){e()}if(this.canvasImage&&this.canvasImage.unload){this.canvasImage.unload()}};this.hide();return this}function setElementPosition(t,e,i){var n=UIElement.getMainCanvasScale();e=e/n.x;i=i/n.y;t.style.position="absolute";t.style.left=Math.round(e)+"px";t.style.top=Math.round(i)+"px";t.style["opacity"]=1;return}Animation.scaleCanvas=function(t,e,i){var n=UIElement.getMainCanvasScale();t.style.width=Math.round(e/n.x)+"px";t.style.height=Math.round(i/n.y)+"px";return};function moveElement(t,e,i){setElementPosition(t,e,i);return}function alphaElement(t,e){t.style["opacity"]=e;return}function showElement(t){t.style["opacity"]=1}function hideElement(t){t.style["opacity"]=0}function scaleElement(t,e,i,n,r){var o=n&&r?n+" "+r:"50% 50%";var a=["transform","-ms-transform","-webkit-transform","-o-transform","-moz-transform"];t.style["transform-style"]="preserve-3d";for(var s=0;s<a.length;s++){var l=a[s];t.style[l+"-origin"]=o;t.style[l]="scale("+e+")"}t.style["opacity"]=i;return}function rotateElement(t,e){var i="50% 50%";var n=["transform","-ms-transform","-webkit-transform","-o-transform","-moz-transform"];t.style["transform-style"]="preserve-3d";for(var r=0;r<n.length;r++){var o=n[r];t.style[o+"-origin"]=i;t.style[o]="rotate("+e+"deg)"}return}function AnimationHTranslateAndroid(){Animation.apply(this,arguments);this.leftToRight=true;this.show=function(){document.body.appendChild(Animation.backendCanvas);Animation.backendCanvas.style.zIndex=9;this.canvasElement=Animation.backendCanvas;setElementPosition(Animation.backendCanvas,this.x,this.y);return true};this.hide=function(){if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.doStep=function(t){this.step(t);return};this.beforeRun=function(){var t=this.sw-this.w;this.range=t*.7;this.start=t-this.range;return};this.toLeft=function(){this.leftToRight=true;return};this.toRight=function(){this.leftToRight=false;return};this.step=function(t){var e=0;if(this.leftToRight){e=this.start+this.range*t}else{e=this.w-this.range*t-this.start}moveElement(Animation.backendCanvas,-e+this.x,this.y);return true}}function AnimationVTranslate(t){Animation.apply(this,arguments);this.beforeRun=function(){this.range=this.frontH;this.canvas=this.canvasElement.getContext("2d");return true};this.step=function(t){var e=this.frontX;var i=this.frontY;var n=this.frontW;var r=this.range*t;var o=this.showWin?r:this.range-r;var a=this.showWin?this.frontY+this.range-r:this.frontY+r;if(a>0){this.canvas.drawImage(this.canvasImage,0,this.h-a,n,a,0,0,n,a)}if(o>0){this.canvas.drawImage(this.canvasImage,e+this.w,i,n,o,e,a,n,o)}return true}}function AnimationHTranslate(){Animation.apply(this,arguments);this.leftToRight=true;this.beforeRun=function(){var t=this.sw-this.w;if(isMobile()){this.range=t*.8}else{this.range=t}this.start=t-this.range;this.canvas=this.canvasElement.getContext("2d")};this.toLeft=function(){this.leftToRight=true;return};this.toRight=function(){this.leftToRight=false;return};this.step=function(t){var e=0;if(this.leftToRight){e=this.start+this.range*t}else{e=this.w-this.range*t-this.start}if(this.lastOffset===e){return true}this.canvas.drawImage(this.canvasImage,e,0,this.w,this.h,0,0,this.w,this.h);this.lastOffset=e;return true}}function AnimationScale(){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;this.setRange=function(t,e){this.to=e;this.from=t;return};this.beforeRun=function(){this.canvas=this.canvasElement.getContext("2d")};this.step=function(t){var e=this.from+t*(this.to-this.from);var i=this.to>this.from?t:1-t;if(this.canvasImage){var n=this.canvas;var r=this.frontX+.5*this.frontW;var o=this.frontY+.5*this.frontH;this.drawBackground(n);n.save();n.translate(r,o);n.globalAlpha=i;n.scale(e,e);n.translate(-.5*this.frontW,-.5*this.frontH);n.drawImage(this.canvasImage,this.frontX+this.w,this.frontY,this.frontW,this.frontH,0,0,this.frontW,this.frontH);n.restore()}return true}}function AnimationAlpha(){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;this.setRange=function(t,e){this.to=e;this.from=t;return};this.beforeRun=function(){this.canvas=this.canvasElement.getContext("2d")};this.step=function(t){var e=this.from+t*(this.to-this.from);if(this.canvasImage){var i=this.canvas;i.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h);i.save();i.globalAlpha=e;i.drawImage(this.canvasImage,this.frontX+this.w,this.frontY,this.frontW,this.frontH,this.frontX,this.frontY,this.frontW,this.frontH);i.restore()}return true}}function AnimationMove(t){Animation.apply(this,arguments);this.beforeRun=function(){this.range=this.frontH;this.canvas=this.canvasElement.getContext("2d");return true};this.step=function(t){this.drawBackground(this.canvas);var e=this.frontX;var i=this.frontY;var n=this.frontW;var r=this.range*t;var o=this.showWin?r:this.range-r;var a=this.showWin?this.frontY+this.range-r:this.frontY+r;if(o>0){this.canvas.drawImage(this.canvasImage,e+this.w,i,n,o,e,a,n,o)}return true}}function AnimationBrowser(t){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;function e(t){try{document.body.removeChild(t)}catch(e){console.log(e.toString())}return}this.setRange=function(t,e){this.to=e;this.from=t;return};this.onShowCanvas=function(){setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.y);showElement(this.oldWinCanvas);showElement(this.newWinCanvas);return};this.showCanvas=function(t,e){var i=this.w;var n=this.h;var r=Animation.getOldWinCanvas();var o=Animation.getNewWinCanvas();this.moveResizeCanvas(r,this.x,this.y,i,n);this.moveResizeCanvas(o,this.x,this.y,i,n);r.style.zIndex=t;o.style.zIndex=e;var a=r.getContext("2d");var s=o.getContext("2d");if(this.showWin){a.drawImage(Animation.backendCanvas,0,0,i,n,0,0,i,n);s.drawImage(Animation.backendCanvas,this.w,0,i,n,0,0,i,n)}else{s.drawImage(Animation.backendCanvas,0,0,i,n,0,0,i,n);a.drawImage(Animation.backendCanvas,this.w,0,i,n,0,0,i,n)}this.oldWinCanvas=r;this.newWinCanvas=o;this.onShowCanvas();if(t>e){document.body.appendChild(o);document.body.appendChild(r)}else{document.body.appendChild(o);document.body.appendChild(r)}return true};this.show=function(){this.showCanvas(8,9);return true};this.hide=function(){if(this.oldWinCanvas&&this.newWinCanvas){if(this.showWin){e(this.oldWinCanvas);e(this.newWinCanvas)}else{e(this.oldWinCanvas);e(this.newWinCanvas)}this.newWinCanvas=null;this.oldWinCanvas=null}return true};this.afterRun=function(){};this.doStep=function(t){this.step(t);return};this.step=function(t){var e=this.from+t*(this.to-this.from);var i=t;scaleElement(this.newWinCanvas,e,i);return true}}function AnimationBrowserScaleWin(t){AnimationBrowser.apply(this,arguments);this.onShowCanvas=function(){setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.y);showElement(this.oldWinCanvas);hideElement(this.newWinCanvas);return};this.step=function(t){var e=t;var i=this.from+t*(this.to-this.from);scaleElement(this.newWinCanvas,i,e);return true}}function AnimationBrowserScaleDialog(t){AnimationBrowser.apply(this,arguments);this.show=function(){if(this.showWin){this.showCanvas(8,9)}else{this.showCanvas(9,8)}return true};this.step=function(t){var e=this.from+t*(this.to-this.from);var i=this.showWin?t:1-t;if(this.showWin){scaleElement(this.newWinCanvas,e,i)}else{scaleElement(this.oldWinCanvas,e,i)}return true}}function AnimationBrowserAlpha(t){AnimationBrowser.apply(this,arguments);this.show=function(){if(this.showWin){this.showCanvas(8,9)}else{this.showCanvas(9,8)}};this.step=function(t){var e=this.from+t*(this.to-this.from);if(this.showWin){alphaElement(this.newWinCanvas,e)}else{alphaElement(this.oldWinCanvas,e)}return true}}function AnimationBrowserMove(t){AnimationBrowser.apply(this,arguments);this.onShowCanvas=function(){if(this.showWin){setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.frontH)}else{setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.y)}showElement(this.oldWinCanvas);showElement(this.newWinCanvas);return};this.show=function(){if(this.showWin){this.showCanvas(8,9)}else{this.showCanvas(9,8)}return};this.step=function(t){var e=0;this.range=this.frontH;var i=this.range*t;if(this.showWin){e=this.range-i;moveElement(this.newWinCanvas,0,e)}else{e=i;moveElement(this.oldWinCanvas,0,e)}return true}}var C_DIR_UP=1;var C_DIR_DOWN=2;var C_DIR_LEFT=3;var C_DIR_RIGHT=4;var C_ACTION_EXPAND=1;var C_ACTION_COLLAPSE=2;function Animation1Expand(){Animation.apply(this,arguments);this.prepare=function(t,e,i,n,r,o){this.x=Math.round(t);this.y=Math.round(e);this.w=Math.round(i);this.h=Math.round(n);this.onFinish=o;this.canvasImage=r;this.xto=this.xfrom=0;this.yto=this.yfrom=0;this.wto=this.wfrom=i;this.hto=this.hfrom=n;this.show();return};this.expandV=function(t){this.direction=t?C_DIR_UP:C_DIR_DOWN;this.action=C_ACTION_EXPAND;this.yfrom=this.h;this.yto=0;this.hfrom=0;this.hto=this.h;return};this.expandH=function(t){this.direction=t?C_DIR_LEFT:C_DIR_RIGHT;this.action=C_ACTION_EXPAND;this.xfrom=this.w;this.xto=0;this.wfrom=0;this.wto=this.w;return};this.collapseV=function(t){this.direction=t?C_DIR_UP:C_DIR_DOWN;this.action=C_ACTION_COLLAPSE;this.yfrom=0;this.yto=this.h;this.hfrom=this.h;this.hto=0;return};this.collapseH=function(t){this.direction=t?C_DIR_LEFT:C_DIR_RIGHT;this.action=C_ACTION_COLLAPSE;this.xfrom=0;this.xto=this.w;this.wfrom=this.w;this.wto=0;return};this.expandUp=function(){return this.expandV(true)};this.expandDown=function(){return this.expandV(false)};this.expandLeft=function(){return this.expandH(true)};this.expandRight=function(){return this.expandH(false)};this.collapseUp=function(){return this.collapseV(true)};this.collapseDown=function(){return this.collapseV(false)};this.collapseLeft=function(){return this.collapseH(true)};this.collapseRight=function(){return this.collapseH(false)};this.show=function(){this.canvasElement=Animation.getCanvas();this.moveResizeCanvas(this.canvasElement,this.x,this.y,this.w,this.h);this.canvas=this.canvasElement.getContext("2d");document.body.appendChild(this.canvasElement);this.canvasElement.style.zIndex=9;setElementPosition(this.canvasElement,this.x,this.y);showElement(this.canvasElement);return true};this.hide=function(){this.visible=false;if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.step=function(t){var e=this.canvas;var i=this.xfrom+(this.xto-this.xfrom)*t;var n=this.yfrom+(this.yto-this.yfrom)*t;var r=this.wfrom+(this.wto-this.wfrom)*t;var o=this.hfrom+(this.hto-this.hfrom)*t;if(!r||!o){return}e.clearRect(0,0,this.w,this.h);var a=i;var s=n;var l=i;var h=n;if(this.action===C_ACTION_EXPAND){switch(this.direction){case C_DIR_UP:{h=0;break}case C_DIR_DOWN:{s=0;break}case C_DIR_LEFT:{l=0;break}case C_DIR_RIGHT:{a=0;break}}}else{switch(this.direction){case C_DIR_UP:{s=0;break}case C_DIR_DOWN:{h=0;break}case C_DIR_LEFT:{a=0;break}case C_DIR_RIGHT:{l=0;break}}}e.drawImage(this.canvasImage,l,h,r,o,a,s,r,o);return true}}function Animation1Alpha(){Animation.apply(this,arguments);this.prepare=function(t,e,i,n,r,o){this.x=Math.round(t);this.y=Math.round(e);this.w=Math.round(i);this.h=Math.round(n);this.onFinish=o;this.canvasImage=r;this.show();return};this.setRange=function(t,e){this.from=t;this.to=e;return};this.show=function(){this.canvasElement=Animation.getCanvas();this.moveResizeCanvas(this.canvasElement,this.x,this.y,this.w,this.h);this.canvas=this.canvasElement.getContext("2d");document.body.appendChild(this.canvasElement);this.canvasElement.style.zIndex=9;setElementPosition(this.canvasElement,this.x,this.y);showElement(this.canvasElement);this.canvas.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h);return true};this.hide=function(){this.visible=false;if(this.canvasElement){try{document.body.removeChild(this.canvasElement)}catch(t){console.log("document.body.removeChild: not found.")}this.canvasElement=null}return true};this.step=function(t){var e=this.canvas;var i=this.from+(this.to-this.from)*t;alphaElement(this.canvasElement,i);console.log("opacity:"+i);return true}}function Animation1Scale(){Animation.apply(this,arguments);this.prepare=function(t,e,i,n,r,o){this.x=Math.round(t);this.y=Math.round(e);this.w=Math.round(i);this.h=Math.round(n);this.xOrigin="50%";this.yOrigin="50%";this.onFinish=o;this.canvasImage=r;this.show();return};this.setOrigin=function(t,e){this.xOrigin=t;this.yOrigin=e;return};this.setRange=function(t,e){this.from=t;this.to=e;return};this.show=function(){this.canvasElement=Animation.getCanvas();this.moveResizeCanvas(this.canvasElement,this.x,this.y,this.w,this.h);this.canvas=this.canvasElement.getContext("2d");document.body.appendChild(this.canvasElement);this.canvasElement.style.zIndex=9;setElementPosition(this.canvasElement,this.x,this.y);showElement(this.canvasElement);this.canvas.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h);return true};this.hide=function(){this.visible=false;if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.step=function(t){var e=this.canvas;var i=this.from+(this.to-this.from)*t;var n=this.showWin?t:1-t;scaleElement(this.canvasElement,i,n,this.xOrigin,this.yOrigin);return true}}function animateUIElement(t,e,i){var n=false;var r=t.getRealScale();var o=t.getPositionInView();var a=t.view.getAbsPosition();var s=Math.round(o.x*r)+a.x;var l=Math.round(o.y*r)+a.y;var h=Math.round(t.w*r);var u=Math.round(t.h*r);var p=Animation.getBackendCanvas(h,u);var c=p.getContext("2d");c.save();n=t.visible;t.visible=true;c.scale(r,r);c.translate(-t.x,-t.y);t.paint(c);t.visible=n;c.restore();var f=AnimationFactory.create(e);f.prepare(s,l,h,u,p,function(){if(i){i()}t.setVisible(!n);t.postRedraw()});if(n){t.setVisible(!n);t.postRedraw()}switch(e){case"anim-expand-up":{f.expandUp();break}case"anim-expand-left":{f.expandLeft();break}case"anim-expand-right":{f.expandRight();break}case"anim-expand-down":{f.expandDown();break}case"anim-collapse-up":{f.collapseUp();break}case"anim-collapse-left":{f.collapseLeft();break}case"anim-collapse-right":{f.collapseRight();break}case"anim-collapse-down":{f.collapseDown();break}case"anim-scale1-show-origin-topleft":{f.setOrigin("0%","0%");f.setRange(.5,1);break}case"anim-scale1-show-origin-center":{f.setOrigin("50%","50%");f.setRange(.5,1);break}case"anim-scale1-show-origin-bottomleft":{f.setOrigin("0%","100%");f.setRange(.5,1);break}case"anim-scale1-show-origin-topright":{f.setOrigin("100%","0%");f.setRange(.5,1);break}case"anim-scale1-show-origin-bottomright":{f.setOrigin("100%","100%");f.setRange(.5,1);break}case"anim-scale1-show":{f.setRange(.5,1);break}case"anim-scale1-hide-origin-topleft":{f.setOrigin("0%","0%");f.setRange(1,.5);break}case"anim-scale1-hide-origin-center":{f.setOrigin("50%","50%");f.setRange(1,.5);break}case"anim-scale1-hide-origin-bottomleft":{f.setOrigin("0%","100%");f.setRange(1,.5);break}case"anim-scale1-hide-origin-topright":{f.setOrigin("100%","0%");f.setRange(1,.5);break}case"anim-scale1-hide-origin-bottomright":{f.setOrigin("100%","100%");f.setRange(1,.5);break}case"anim-scale1-hide":{f.setRange(1,.5);break}case"anim-alpha1-show":{f.setRange(.2,1);break}case"anim-alpha1-hide":{f.setRange(1,.2);break}}f.run();return}function testAnimation1Expand(t){var e=t.getWindow().findChildByName("ui-button-test",true);e.setVisible(false);e.postRedraw();setTimeout(function(){animateUIElement(e,"anim-alpha1-show")},100);setTimeout(function(){animateUIElement(e,"anim-alpha1-hide")},3e3);return}function UIElement(){return}UIElement.IMAGE_DISPLAY_CENTER=WImage.DISPLAY_CENTER;UIElement.IMAGE_DISPLAY_TILE=WImage.DISPLAY_TILE;UIElement.IMAGE_DISPLAY_9PATCH=WImage.DISPLAY_9PATCH;UIElement.IMAGE_DISPLAY_SCALE=WImage.DISPLAY_SCALE;UIElement.IMAGE_DISPLAY_AUTO=WImage.DISPLAY_AUTO;UIElement.IMAGE_DISPLAY_DEFAULT=WImage.DISPLAY_DEFAULT;UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO=WImage.DISPLAY_SCALE_KEEP_RATIO;UIElement.IMAGE_DISPLAY_TILE_V=WImage.DISPLAY_TILE_V;UIElement.IMAGE_DISPLAY_TILE_H=WImage.DISPLAY_TILE_H;UIElement.IMAGE_DISPLAY_AUTO_SIZE_DOWN=WImage.DISPLAY_AUTO_SIZE_DOWN;UIElement.IMAGE_DISPLAY_FIT_WIDTH=WImage.DISPLAY_FIT_WIDTH;UIElement.IMAGE_DISPLAY_FIT_HEIGHT=WImage.DISPLAY_FIT_HEIGHT;UIElement.IMAGE_DISPLAY_NAMES=["incenter","tile","9patch","scale","auto","default","scale(keep ratio)","vtile","htile","auto-size-down","fit-width","fit-height"];UIElement.X_FIX_LEFT=0;UIElement.X_FIX_RIGHT=1;UIElement.X_SCALE=2;UIElement.X_CENTER_IN_PARENT=3;UIElement.X_LEFT_IN_PARENT=4;UIElement.X_RIGHT_IN_PARENT=5;UIElement.X_AFTER_PREV=6;UIElement.X_LAYOUT_NAMES=["fix_left","fix_right","scale","center_in_parent","left_in_parent","right_in_parent"];UIElement.Y_FIX_TOP=0;UIElement.Y_FIX_BOTTOM=1;UIElement.Y_SCALE=2;UIElement.Y_MIDDLE_IN_PARENT=3;UIElement.Y_TOP_IN_PARENT=4;UIElement.Y_BOTTOM_IN_PARENT=5;UIElement.Y_AFTER_PREV=6;UIElement.Y_LAYOUT_NAMES=["fix_top","fix_bottom","scale","middle_in_parent","top_in_parent","bottom_in_parent"];UIElement.WIDTH_FIX=0;UIElement.WIDTH_SCALE=1;UIElement.WIDTH_FILL_PARENT=2;UIElement.WIDTH_FILL_AVAILABLE=3;UIElement.WIDTH_FILL_TO_PARENT_RIGHT=4;UIElement.HEIGHT_FIX=0;UIElement.HEIGHT_SCALE=1;UIElement.HEIGHT_FILL_PARENT=2;UIElement.HEIGHT_FILL_AVAILABLE=3;UIElement.HEIGHT_KEEP_RATIO_WITH_WIDTH=4;UIElement.HEIGHT_FILL_TO_PARENT_BOTTOM=5;UIElement.WIDTH_LAYOUT_NAMES=["fix","scale","fill_parent"];UIElement.HEIGHT_LAYOUT_NAMES=["fix","scale","fill_parent"];UIElement.IMAGE_DEFAULT="default_bg";UIElement.IMAGE_MASK="mask_fg";UIElement.IMAGE_NORMAL="normal_bg";UIElement.IMAGE_FOCUSED="focused_bg";UIElement.IMAGE_ACTIVE="active_bg";UIElement.IMAGE_POINTER_OVER="pointer_over_bg";UIElement.IMAGE_DISABLE="disable_bg";UIElement.IMAGE_DISABLE_FG="disable_fg";UIElement.IMAGE_NORMAL_FG="normal_fg";UIElement.IMAGE_ACTIVE_FG="active_fg";UIElement.IMAGE_ON_FG="on_fg";UIElement.IMAGE_OFF_FG="off_fg";UIElement.IMAGE_ON_BG="on_bg";UIElement.IMAGE_OFF_BG="off_bg";UIElement.IMAGE_CHECKED_FG="checked_fg";UIElement.IMAGE_UNCHECK_FG="unchecked_fg";UIElement.IMAGE_ON_FOCUSED="focused_on_bg";UIElement.IMAGE_ON_ACTIVE="active_on_bg";UIElement.IMAGE_OFF_FOCUSED="focused_off_bg";UIElement.IMAGE_OFF_ACTIVE="active_off_bg";UIElement.IMAGE_NORMAL_DRAG="normal_drag";UIElement.IMAGE_DELETE_ITEM="delete_item_icon";UIElement.IMAGE_CHECKED_ITEM="checked_item_icon";UIElement.IMAGE_POINT="point_img";UIElement.IMAGE_POINT1="point1_img";UIElement.IMAGE_POINT2="point2_img";UIElement.IMAGE_POINT3="point3_img";UIElement.IMAGE_POINT4="point4_img";UIElement.IMAGE_TIPS1="tips_img_1";UIElement.IMAGE_TIPS2="tips_img_2";UIElement.IMAGE_TIPS3="tips_img_3";UIElement.IMAGE_TIPS4="tips_img_4";UIElement.IMAGE_TIPS5="tips_img_5";UIElement.ITEM_BG_NORMAL="item_bg_normal";UIElement.ITEM_BG_ACTIVE="item_bg_active";UIElement.ITEM_BG_CURRENT_NORMAL="item_bg_current_normal";UIElement.ITEM_BG_CURRENT_ACTIVE="item_bg_current_active";UIElement.TEXT_ALIGN_CENTER=0;UIElement.TEXT_ALIGN_LEFT=0;UIElement.TEXT_ALIGN_RIGHT=0;UIElement.TEXT_ALIGN_NAMES=["center","left","right"];UIElement.ORIGIN_UP=1;UIElement.ORIGIN_DOWN=2;UIElement.ORIGIN_LEFT=3;UIElement.ORIGIN_RIGHT=4;UIElement.ORIGIN_UP_LEFT=5;UIElement.ORIGIN_UP_RIGHT=6;UIElement.ORIGIN_DOWN_LEFT=7;UIElement.ORIGIN_DOWN_RIGHT=8;UIElement.ORIGIN_MIDDLE_CENTER=9;UIElement.STATE_STOP=1;UIElement.STATE_RUNNING=2;UIElement.STATE_PAUSED=3;UIElement.prototype=new RShape;UIElement.Style=function(){this.lineWidth=2;this.lineColor="Orange";this.fillColor="White";this.textColor="Blue";this.fontSize=24;return};UIElement.Style.prototype=new ShapeStyle;UIElement.prototype.isUIElement=true;UIElement.prototype.hasChildren=true;UIElement.prototype.isContainer=true;UIElement.disableGetRelativePathOfURL=false;UIElement.prototype.addResource=function(t){if(!this.resources){this.resources=[]}if(this.resources.indexOf(t)<0){this.resources.push(t)}return};UIElement.prototype.setDefaultStyle=function(){this.style=new UIElement.Style;return};UIElement.prototype.clone=function(){var t=null;UIElement.disableGetRelativePathOfURL=true;t=this.dup();t.uid=UIElement.uidStart++;UIElement.disableGetRelativePathOfURL=false;return t};UIElement.prototype.getRelativePathOfURL=function(t){if(UIElement.disableGetRelativePathOfURL||!t){return t}var e="";if(window.location.protocol==="file:"){e=dirname(window.location.href)+"/"}else{e=window.location.protocol+"//"+window.location.host+"/"}if(t.indexOf("/web/backend/")>=0&&t.indexOf(e)>=0){return t}t=t.replace(e,"");return t};UIElement.prototype.setFreePosition=function(t){this.freePosition=t;return};UIElement.prototype.fixChildPosition=function(t){var e=t.left;var i=t.top;var n=t.h;var r=this.getHMargin();var o=this.getVMargin();if(t.freePosition){return}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){e=r}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){i=o}if(this.mode===Shape.MODE_EDITING){var a=this.getWindow();if(a&&!a.isUIScene&&!a.isUIDialog){e=e<r?r:e;i=i<o?o:i}}t.left=e;t.top=i;return};UIElement.prototype.setFreeSize=function(t){this.freeSize=t;return};UIElement.prototype.fixChildSize=function(t){if(t.freeSize){return}if(this.autoAdjustHeight){if(t.top+t.h>this.h){this.h=t.top+t.h+this.vMargin}}var e=t.left;var i=t.w;var n=t.top;var r=t.h;var o=this.getWidth(true);var a=this.getHeight(true);var s=o+this.hMargin;var l=a+this.vMargin;if(e+i>s&&t.widthAttr!=UIElement.WIDTH_FILL_PARENT&&t.xAttr!=UIElement.X_AFTER_PREV&&t.widthAttr!=UIElement.WIDTH_FILL_AVAILABLE&&this.mode===Shape.MODE_EDITING){e=s-i;if(e<0){e=0}i=s-e}if(n+r>l&&t.heightAttr!=UIElement.HEIGHT_FILL_PARENT&&t.yAttr!=UIElement.Y_AFTER_PREV&&t.heightAttr!=UIElement.HEIGHT_FILL_AVAILABLE&&this.mode===Shape.MODE_EDITING){n=l-r;if(n<0){n=0}r=l-n}if(e<0){e=0}if(n<0){n=0}t.left=e;t.top=n;t.w=i<=o?i:o;t.h=r<=a?r:a;return};UIElement.prototype.onInit=function(){this.callOnInitHandler();if(this.dataSourceUrl&&this.dataSourceUrl.length>5){this.bindDataUrl(this.dataSourceUrl)}return};UIElement.prototype.onDeinit=function(){if(this.animatingInfo){this.stopAnimation(true)}return};UIElement.prototype.onWindowOpen=function(){if(this.animations&&this.defaultAnimationName){var t=this.animations[this.defaultAnimationName];if(t){this.animate(t)}}return};UIElement.prototype.initChildren=function(){var t=this.children;var e=this.children.length;for(var i=0;i<e;i++){var n=t[i];n.init()}return};UIElement.prototype.init=function(){try{this.onInit()}catch(t){console.log("onInit Failed:"+t.message+"\n"+t.stack)}this.initChildren();return};UIElement.prototype.deinit=function(){var t=0;var e=null;var i=this.children;var n=this.children.length;for(t=0;t<n;t++){e=i[t];e.deinit()}this.onDeinit();return};UIElement.prototype.onModeChanged=function(){return};UIElement.prototype.userRemovable=function(){return this.mode===Shape.MODE_EDITING};UIElement.prototype.postRedraw=function(){if(this.view){this.view.postRedrawAll()}return this};UIElement.prototype.requestRedraw=UIElement.prototype.postRedraw;UIElement.prototype.setMode=function(t,e){this.mode=t;if(this.type!=="ui-menu-bar"){if(t===Shape.MODE_EDITING){this.setVisible(true)}}if(e){for(var i=0;i<this.children.length;i++){var n=this.children[i];if(n.isContainer){n.setMode(t,true)}}}this.onModeChanged();return this};UIElement.prototype.calcChildrenRange=function(){return this.calcShapesRange(this.children)};UIElement.prototype.calcShapesRange=function(t){var e=0;var i=0;var n=0;var r=0;var o=0;var a=0;var s=1e4;var l=1e4;var h={};if(t.length>0){for(var u=0;u<t.length;u++){var p=t[u];e=p.getX();i=p.getY();n=p.getWidth();r=p.getHeight();if(e<l)l=e;if(i<s)s=i;if(e+n>o)o=e+n;if(i+r>a)a=i+r}h.l=l;h.r=o;h.t=s;h.b=a}else{h.l=0;h.r=0;h.t=0;h.b=0}return h};UIElement.prototype.relayoutChildren=function(){};UIElement.prototype.onSized=function(){this.updateLayoutParams();return};UIElement.prototype.findSelectedShapes=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i.selected){t.push(i);continue}if(i.isContainer){i.findSelectedShapes(t)}}return};UIElement.onSelected=function(t){};UIElement.prototype.onSelectChanged=function(){if(this.selected){UIElement.onSelected(this)}return};UIElement.prototype.setSelected=function(t){if(!t){for(var e=0;e<this.children.length;e++){var i=this.children[e];i.setSelected(false)}}if(t){this.selectedTime=Date.now()}if(this.selected===t){return}this.targetShape=null;this.selected=t;this.onSelectChanged();return};UIElement.prototype.setPointerEventTarget=function(t){this.pointerEventTarget=t;return};UIElement.prototype.getPointerEventTarget=function(){return this.pointerEventTarget?this.pointerEventTarget:this.targetShape};UIElement.prototype.foreachImage=function(t){for(var e in this.images){if(e!=="display"){var i=this.getImageSrcByType(e);t(e,i)}}return};UIElement.prototype.forEach=function(t){if(t(this)){return true}for(var e=0;e<this.children.length;e++){var i=this.children[e];i.forEach(t)}return false};UIElement.prototype.getAllTabStopElements=function(){var t=[];var e=this.getWindow();if(e){e.forEach(function(e){if(e.isUIButton||e.isUIEdit){t.push(e)}})}return t};UIElement.prototype.findNextTabStop=function(){var t=this.getAllTabStopElements();if(!t.length){return}var e=t.indexOf(this);if(e>=0&&e+1<t.length){return t[e+1]}else{return t[0]}};UIElement.prototype.moveToNextStop=function(){var t=this.findNextTabStop();return};UIElement.prototype.isPointerOverShape=function(){return this.parentShape&&this.parentShape.pointerOverShape===this};UIElement.prototype.setPointerOverShape=function(t){if(this.pointerOverShape!==t){if(this.pointerOverShape){this.pointerOverShape.setPointerOverShape(null)}this.pointerOverShape=t;this.postRedraw()}return};UIElement.prototype.setTarget=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i!==t){i.setSelected(false)}}this.targetShape=t;this.selected=!t;this.onSelectChanged();return this};UIElement.prototype.getTarget=function(){return this.targetShape};UIElement.prototype.initContainerShape=function(t){this.children=new Array;this.toJsoners=new Array;this.fromJsoners=new Array;RShapeInit(this,t);this.mode=Shape.MODE_EDITING;this.rectSelectable=true;return this};UIElement.prototype.defaultDispatchPointerDownToChildren=function(t){var e=this.targetShape;if(e&&e.mode===Shape.MODE_EDITING){var i=this.hitTest(t);if(i!=Shape.HIT_TEST_MM&&i!=Shape.HIT_TEST_NONE){if(this.selected){this.setTarget(null);return true}if(this.targetShape.onPointerDown(t)){return true}}}for(var n=this.children.length;n>0;n--){var r=this.children[n-1];if(r.visible&&r.onPointerDown(t)){this.setTarget(r);return true}}return false};UIElement.prototype.dispatchPointerDownToChildren=function(t){return this.defaultDispatchPointerDownToChildren(t)};UIElement.prototype.onPointerDownEditing=function(t,e){return};UIElement.prototype.onPointerDownRunning=function(t,e){if(this.popupWindow||!this.pointerDown){return}return this.callOnPointerDownHandler(t,e)};UIElement.prototype.onPointerMoveEditing=function(t,e){return};UIElement.prototype.onPointerMoveRunning=function(t,e){if(this.popupWindow){return}return this.callOnPointerMoveHandler(t,e)};UIElement.prototype.onPointerUpEditing=function(t,e){return};UIElement.prototype.onPointerUpRunning=function(t,e){if(this.popupWindow||!this.pointerDown){return}return this.callOnPointerUpHandler(t,e)};UIElement.prototype.onDoubleClick=function(t){if(this.popupWindow||!this.pointerDown){return}if(this.targetShape){var e=this.translatePoint(t);return this.targetShape.onDoubleClick(e)}else{return this.callOnDoubleClickHandler(t)}};UIElement.prototype.onGesture=function(t){if(this.popupWindow){return}if(this.targetShape){return this.targetShape.onGesture(t)}return};UIElement.prototype.onLongPress=function(t){if(this.popupWindow||!this.pointerDown){return}this.longPressed=true;this.callOnLongPressHandler(t);if(this.targetShape){var e=this.translatePoint(t);return this.targetShape.onLongPress(e)}return};UIElement.prototype.onClick=function(t,e){if(e||this.popupWindow||!this.pointerDown){return}return this.callOnClickHandler(t)};UIElement.prototype.translatePoint=function(t){var e={x:t.x-this.left,y:t.y-this.top};return e};UIElement.prototype.setCanRectSelectable=function(t,e){this.rectSelectable=t;for(var i=0;i<this.children.length;i++){var n=this.children[i];n.setCanRectSelectable(t,e)}return};UIElement.prototype.canRectSelectable=function(){return this.rectSelectable&&this.parentShape};UIElement.prototype.setDraggable=function(t){if(this.draggable===t){return}this.draggable=t;if(t){this.addEventNames(["onDragStart","onDragging","onDragEnd"])}else{this.removeEventNames(["onDragStart","onDragging","onDragEnd"])}return};UIElement.prototype.callOnDragStartHandler=function(){if(!this.enable){return false}if(this.mode===Shape.MODE_EDITING){return false}if(!this.handleDragStart||this.mode===Shape.MODE_PREVIEW){var sourceCode=this.events["onDragStart"];if(sourceCode){sourceCode="this.handleDragStart = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDragStart){try{this.handleDragStart()}catch(e){console.log("this.handleDragStart:"+e.message)}}return};UIElement.prototype.callOnDragEndHandler=function(){if(!this.enable){return false}if(this.mode===Shape.MODE_EDITING){return false}if(!this.handleDragEnd||this.mode===Shape.MODE_PREVIEW){var sourceCode=this.events["onDragEnd"];if(sourceCode){sourceCode="this.handleDragEnd = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDragEnd){try{this.handleDragEnd()}catch(e){console.log("this.handleDragEnd:"+e.message)}}return};UIElement.prototype.callOnDragingHandler=function(){if(!this.enable){return false}if(this.mode===Shape.MODE_EDITING){return false}if(!this.handleDraging||this.mode===Shape.MODE_PREVIEW){var sourceCode=this.events["onDragging"];if(sourceCode){sourceCode="this.handleDraging = function() {\n"+sourceCode+"\n}\n";
try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDraging){try{this.handleDraging()}catch(e){console.log("this.handleDraging:"+e.message)}}return};UIElement.prototype.onDragStart=function(){console.log("Drag Start");this.callOnDragStartHandler();return};UIElement.prototype.onDragging=function(){console.log("Dragging");this.callOnDragingHandler();return};UIElement.prototype.onDragEnd=function(){console.log("Drag End");this.callOnDragEndHandler();return};UIElement.prototype.dragMove=function(t,e,i){this.left=this.left+t;this.top=this.top+e;this.onDragging(i);return};UIElement.prototype.handleDragMove=function(t){var e=this.getMoveDeltaX();var i=this.getMoveDeltaY();if(!this.dragging){var n=this.getMoveAbsDeltaX();var r=this.getMoveAbsDeltaY();if(Math.abs(n)>5||Math.abs(r)>5){this.dragging=true;this.onDragStart();e=n;i=r}}if(this.dragging){this.dragMove(e,i,t);if(this.parentShape){this.parentShape.onChildDragging(this,t)}}return};UIElement.prototype.onChildDragging=function(t,e){return};UIElement.prototype.onChildDragged=function(t,e){this.sortChildren();this.relayoutChildren("default");return};UIElement.prototype.handleDragUp=function(t){this.onDragEnd();delete this.dragging;if(this.parentShape){this.parentShape.onChildDragged(this,t)}return};UIElement.prototype.animMove=function(t,e){if(!this.dragging){this.animate({x:t,y:e})}return};UIElement.getIntFromConfig=function(t,e,i){var n=t[e];if(!n&&n!==0){return i}if(typeof n==="string"){if(n[1]==="+"||n[1]==="-"){n=i+parseInt(n.substr(1))}else{n=parseInt(n)}}return n};UIElement.prototype.stopAnimation=function(t){if(!this.animatingInfo){return this}if(t){this.stepAnimation({needRedraw:0},Date.now()+1e8)}this.animatingInfo=null;return this};UIElement.prototype.animate=function(t,e,i,n){var r=this;var o=Deferred();var i=i||t.onStep;var e=e||t.onDone;this.doAnimate(t,function(){if(typeof e==="function"){e.apply(r,arguments)}o.resolve()},function(){if(typeof i==="function"){return i.apply(r,arguments)}return true},n);return o.promise};UIElement.prototype.doAnimate=function(t,e,i,n){if(typeof t==="string"){t=this.animations[t]}if(!this.parentShape){UIElement.logWarning("animate error - parentShape is null.");return false}if(this.dragging){UIElement.logWarning("animate error - busy.");return false}var r=this.animatingInfo;if(r){var o=n||t.actionWhenBusy||"replace";if(o==="replace"){this.callOnAnimateDone(r);UIElement.logNotice("busy action - replace current animation.")}else if(o==="append"){var a=0;for(var s=r;s;s=s.next){if(s===t){UIElement.logWarning("animate error - already appended.");return false}if(!s.next||a>30){s.next=t;break}a++}UIElement.logNotice("busy action - append animation.");return true}else{UIElement.logWarning("animate error - busy.");return false}}if(!t){UIElement.logWarning("animate error - config is null.");return false}var l=this.getX();var h=this.getY();var u=this.w;var p=this.h;var c=t.duration||800;var f=UIElement.getIntFromConfig(t,"xStart",l);var m=UIElement.getIntFromConfig(t,"xEnd",l);var d=UIElement.getIntFromConfig(t,"yStart",h);var y=UIElement.getIntFromConfig(t,"yEnd",h);var g=UIElement.getIntFromConfig(t,"wStart",u);var v=UIElement.getIntFromConfig(t,"wEnd",u);var _=UIElement.getIntFromConfig(t,"hStart",p);var I=UIElement.getIntFromConfig(t,"hEnd",p);var w=t.valueStart||0;var x=t.valueEnd||0;var S=t.opacityStart||t.opacityStart===0?t.opacityStart:this.opacity;var T=t.opacityEnd||t.opacityEnd===0?t.opacityEnd:this.opacity;var C=t.rotationStart||t.rotationStart===0?t.rotationStart:this.rotation;var b=t.rotationEnd||t.rotationEnd===0?t.rotationEnd:this.rotation;var D=t.scaleXStart||t.scaleXStart===0?t.scaleXStart:this.getScaleX();var E=t.scaleXEnd||t.scaleXEnd===0?t.scaleXEnd:this.getScaleX();var A=t.scaleYStart||t.scaleYStart===0?t.scaleYStart:this.getScaleY();var U=t.scaleYEnd||t.scaleYEnd===0?t.scaleYEnd:this.getScaleY();if(t.scaleEnd!==undefined){E=t.scaleEnd;U=t.scaleEnd}if(t.scaleStart!==undefined){D=t.scaleStart;A=t.scaleStart}if(t.scale!==undefined){E=t.scale;U=t.scale}if(t.scaleX!==undefined){E=t.scaleX}if(t.scaleY!==undefined){U=t.scaleY}if(t.x!==undefined){m=t.x}if(t.y!==undefined){y=t.y}if(t.opacity!==undefined){T=t.opacity}if(t.rotation!==undefined){b=t.rotation}var M=e||t.onDone;var P=i||t.onStep;var B=m-f;var L=y-d;var R=v-g;var O=I-_;var V=E-D;var W=U-A;var k=T-S;var F=b-C;var N=x-w;var G=null;if(typeof t.interpolator==="string"){G=AnimationFactory.createInterpolator(t.interpolator)}else{G=t.interpolator?t.interpolator:new DecelerateInterpolator}if(!B){this.setX(f);m=f}if(!L){this.setY(d);y=d}if(!R){v=g=this.w}if(!O){I=_=this.h}var a={};a.wRange=R;a.hRange=O;a.xRange=B;a.yRange=L;a.scaleXRange=V;a.scaleYRange=W;a.opacityRange=k;a.rotationRange=F;a.valueRange=N;a.wStart=g;a.hStart=_;a.xStart=f;a.yStart=d;a.scaleXStart=D;a.scaleYStart=A;a.opacityStart=S;a.rotationStart=C;a.valueStart=w;a.startTime=Date.now();a.duration=c;a.onDone=M;a.onStep=P;a.interpolator=G;a.next=t.next;a.name=t.name;a.now=a.startTime;if(t.delay){a.startTime+=t.delay}this.animatingInfo=a;this.postRedraw();return true};UIElement.prototype.callOnAnimateDone=function(t){this.animating=false;this.animatingInfo=null;var e=t.onDone;if(e){e.call(this,t.name)}if(!this.parentShape)return false;this.callOnAnimateDoneHandler(t.name);if(!this.parentShape)return false;var i=t.next;if(i){if(typeof i==="string"){if(!this.animations[i]){return false}}this.animate(i);return true}return false};UIElement.prototype.isAnimating=function(){return this.animatingInfo&&this.parentShape};UIElement.prototype.stepAnimation=function(t,e){var i=this.animatingInfo;if(!i||!this.parentShape)return;i.now+=t.timeStep*UIElement.timeScale;if(!e){e=i.now}t.needRedraw++;if(i.startTime>e){return}if(!this.visible){this.visible=true}var n=i.wRange;var r=i.hRange;var o=i.xRange;var a=i.yRange;var s=i.valueRange;var l=i.scaleXRange;var h=i.scaleYRange;var u=i.opacityRange;var p=i.rotationRange;var c=i.wStart;var f=i.hStart;var m=i.xStart;var d=i.yStart;var y=i.scaleXStart;var g=i.scaleYStart;var v=i.opacityStart;var _=i.rotationStart;var I=i.valueStart;var w=i.onStep;var x=i.duration;var S=i.startTime;var T=i.interpolator;var C=(e-S)/x;var b=T.get(C);if(s){i.value=I+b*s}if(C>=1){b=1}if(o||a){var D=Math.floor(m+b*o);var E=Math.floor(d+b*a);this.setPosition(D,E)}if(n){this.clipW=Math.floor(c+b*n)}if(r){this.clipH=Math.floor(f+b*r)}if(n||r){if(!this.clipW&&this.clipW!==0){this.clipW=this.w}if(!this.clipH&&this.clipH!==0){this.clipH=this.h}}if(u){this.opacity=v+b*u}if(p){this.setRotation(_+b*p)}if(l){this.setScaleX(y+b*l)}if(h){this.setScaleY(g+b*h)}if(w&&!w(this,C,i)){this.callOnAnimateDone(i);return}if(b<1){this.animating=true}else{this.callOnAnimateDone(i)}return};UIElement.prototype.isHitWorkArea=function(){return this.hitTestResult===Shape.HIT_TEST_MM&&this.children.length>1&&this.canRectSelectable()};UIElement.prototype.onPointerDownNormal=function(t){if(!this.getParent()){this.setLastEventStatus(UIElement.EVENT_STATUS_NONE)}var e=this.translatePoint(t);this.hitTestResult=this.hitTest(t);if(!this.hitTestResult){if(this.dispatchPointerDownToChildren(e)){this.setPointerEventTarget(this.targetShape);return true}return false}this.pointerDown=true;this.pointerDownTime=Date.now();this.childrenRange=this.calcChildrenRange();if(this.mode===Shape.MODE_EDITING){this.onPointerDownEditing(t,true)}else if(this.enable){this.onPointerDownRunning(e,true)}this.setPointerEventTarget(null);if(this.hitTestResult===Shape.HIT_TEST_MM||!this.selected){if(this.dispatchPointerDownToChildren(e)){if(this.mode===Shape.MODE_EDITING){this.onPointerDownEditing(t,false)}else if(this.enable){this.onPointerDownRunning(e,false)}this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.setPointerEventTarget(this.targetShape);return true}}if(this.isHitWorkArea()){this.hitTestResult=Shape.HIT_TEST_WORKAREA}this.setTarget(null);this.setSelected(true);this.lastPosition.x=t.x;this.lastPosition.y=t.y;if(this.mode===Shape.MODE_EDITING){this.handlePointerEvent(t,1)}if(this.mode===Shape.MODE_EDITING){this.onPointerDownEditing(t,false)}else if(this.enable){this.onPointerDownRunning(e,false)}this.postRedraw();return true};UIElement.prototype.onPointerMoveNormal=function(t){var e=this.translatePoint(t);if(!this.getParent()){this.setLastEventStatus(UIElement.EVENT_STATUS_NONE)}if(this.draggable&&this.pointerDown){if(this.mode!==Shape.MODE_EDITING){this.handleDragMove(t);return}else{delete this.dragging}}if(this.hitTestResult){if(this.mode===Shape.MODE_EDITING){this.onPointerMoveEditing(t,true)}else if(this.enable){this.onPointerMoveRunning(e,true)}var i=this.getPointerEventTarget();if(i){i.onPointerMove(e);if(this.mode===Shape.MODE_EDITING){this.onPointerMoveEditing(t,false)}else if(this.enable){this.onPointerMoveRunning(e,false)}}else{if(this.mode===Shape.MODE_EDITING){this.onPointerMoveEditing(t,false);if(this.hitTestResult===Shape.HIT_TEST_WORKAREA&&this.isUIWindow){var e={x:0,y:0};var n=t.x-this.pointerDownPosition.x;var r=t.y-this.pointerDownPosition.y;var o=this.pointerDownPosition.x-this.left;var a=this.pointerDownPosition.y-this.top;var s={x:o,y:a,w:n,h:r};if(Math.abs(n)>5&&Math.abs(r)>5){s=fixRect(s);this.setSelected(false);for(var l=this.children.length-1;l>=0;l--){var h=this.children[l];e.x=h.left+h.w/2;e.y=h.top+h.h/2;h.setSelected(isPointInRect(e,s))}}}else{this.handlePointerEvent(t,0)}}else if(this.enable){this.onPointerMoveRunning(e,false)}}this.lastPosition.x=t.x;this.lastPosition.y=t.y;return true}else{var i=this.getPointerEventTarget();if(i){i.onPointerMove(e);if(this.mode===Shape.MODE_EDITING){this.onPointerMoveEditing(t,false)}else if(this.enable){this.onPointerMoveRunning(e,false)}}}this.lastPosition.x=t.x;this.lastPosition.y=t.y;return false};UIElement.prototype.onPointerUpNormal=function(t){if(!this.getParent()){this.setLastEventStatus(UIElement.EVENT_STATUS_NONE)}if(this.hitTestResult){var e=this.translatePoint(t);var i=this.isClicked();if(this.mode===Shape.MODE_EDITING){this.onPointerUpEditing(t,true)}else if(this.enable){this.onPointerUpRunning(e,true)}if(i&&this.enable){this.onClick(e,true)}var n=this.getPointerEventTarget();if(n){n.onPointerUp(e)}else{if(this.mode===Shape.MODE_EDITING){this.handlePointerEvent(t,-1)}}if(this.mode===Shape.MODE_EDITING){this.onPointerUpEditing(t,false)}else{if(this.dragging){this.handleDragUp(t)}else if(this.enable){this.onPointerUpRunning(e,false)}}if(i&&this.enable){this.onClick(e,false)}this.hitTestResult=Shape.HIT_TEST_NONE;if(this.longPressed){this.longPressed=false}return true}else{this.targetShape=null;if(this.mode!==Shape.MODE_EDITING&&this.enable){this.onPointerUpRunning(e,false);if(i){this.onClick(e,false)}}if(this.longPressed){this.longPressed=false}var n=this.getPointerEventTarget();if(n){var e=this.translatePoint(t);n.onPointerUp(e)}}return false};UIElement.prototype.needDrawTextTips=function(t){return this.mode===Shape.MODE_EDITING&&!this.children.length};UIElement.prototype.textEditable=function(t){return this.mode===Shape.MODE_EDITING};UIElement.prototype.isClicked=function(){if(!this.view){return false}if(this.longPressed&&this.events["onLongPress"]){console.log("Long Pressed, Ignore Click Event.");return false}return this.view.isClicked()};UIElement.prototype.onKeyDownRunning=function(code){if(!this.handleKeyDown||this.mode===Shape.MODE_PREVIEW){var sourceCode=this.events["onKeyDown"];if(sourceCode){sourceCode="this.handleKeyDown = function(code) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleKeyDown){try{this.handleKeyDown(code)}catch(e){console.log("this.handleKeyDown:"+e.message)}}return true};UIElement.prototype.onKeyDownEditing=function(t){};UIElement.prototype.onKeyDown=function(t){if(this.targetShape){this.targetShape.onKeyDown(t)}if(this.mode===Shape.MODE_EDITING){this.onKeyDownEditing(t)}else{this.onKeyDownRunning(t)}return};UIElement.prototype.onKeyUpRunning=function(code){if(!this.handleKeyUp||this.mode===Shape.MODE_PREVIEW){var sourceCode=this.events["onKeyUp"];if(sourceCode){sourceCode="this.handleKeyUp = function(code) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleKeyUp){try{this.handleKeyUp(code)}catch(e){console.log("this.handleKeyUp:"+e.message)}}else if(this.isUIWindow&&code==KeyEvent.DOM_VK_BACK_BUTTON&&!cantkIsEditorActive()){console.log("Back Key Pressed On: "+this.name);if(this.isMainWindow()){var app=this.getApp();var wm=this.getWindowManager();if(this.mode===Shape.MODE_RUNNING){wm.systemExit();app.exitApp();console.log("Back Key Pressed, Exit App.")}}else{this.closeWindow(0);console.log("Back Key Pressed, Close Current Window.")}}return true};UIElement.prototype.onKeyUpEditing=function(t){};UIElement.prototype.onKeyUp=function(t){if(t===KeyEvent.DOM_VK_BACK&&this.isUIWindow){this.closeWindow(0);return}if(this.targetShape){this.targetShape.onKeyUp(t)}if(this.mode===Shape.MODE_EDITING){this.onKeyUpEditing(t)}else{this.onKeyUpRunning(t)}return};UIElement.prototype.afterSetView=function(){return true};UIElement.prototype.setView=function(t){this.view=t;for(var e=0;e<this.children.length;e++){var i=this.children[e];i.setView(t)}this.afterSetView(t);return};UIElement.prototype.setApp=function(t){this.app=t;for(var e=0;e<this.children.length;e++){var i=this.children[e];i.setApp(t)}return};UIElement.prototype.shapeCanBeChild=function(t){return true};UIElement.prototype.onAppendedInParent=function(){};UIElement.prototype.afterChildAppended=function(t){return true};UIElement.prototype.beforeAddShapeIntoChildren=function(t){return true};UIElement.prototype.addShapeIntoChildren=function(t,e){var i={x:0,y:0,w:0,h:0};for(var n=this.children.length-1;n>=0;n--){var r=this.children[n];if(r===t)continue;if(r.isContainer&&r.visible){i.x=r.left;i.y=r.top;i.w=r.w;i.h=r.h;if(isPointInRect(e,i)){return r.addShape(t,true,e)}}}return false};UIElement.prototype.addChildWithJson=function(t,e){var i=t.type?t.type:t.id;var n=ShapeFactoryGet().createShape(i,C_CREATE_FOR_USER);if(n){n.fromJson(t);this.addShape(n,false,null,e);n.setVisible(true)}return n};UIElement.prototype.setAlwaysOnTop=function(t){this.alwaysOnTop=t;return};UIElement.onAddShape=function(t,e){};UIElement.prototype.fixShapeName=function(t){};UIElement.prototype.addShape=function(t,e,i,n){if(!t.isUIElement){return false}if(e){t.moveDelta(-this.left,-this.top)}if(this.beforeAddShapeIntoChildren(t)&&i){var r=this.translatePoint(i);if(this.addShapeIntoChildren(t,r)){return true}t.setLeftTop(r.x,r.y)}if(!this.shapeCanBeChild(t)){return false}if(e){var o={};if(t.deviceConfig){o=JSON.parse(t.deviceConfig);t.deviceConfig=null}else{o.version="5";o.platform="iphone";o.lcdDensity="xhdpi"}var a=1;var s=this.getWindow();var l=dupDeviceConfig(this.getDeviceConfig());var h=s&&s.lcddensity?s.lcddensity:l.lcdDensity;if(h!==o.lcdDensity||o.platform!==l.platform){if(h!="all"){l.lcdDensity=h}a=this.getSizeScale(o.lcdDensity,l.lcdDensity);t.notifyDeviceConfigChanged(o,l);if(h!==o.lcdDensity){var u=t.left;var p=t.top;t.scaleForDensity(a,l.lcdDensity,true);t.setLeftTop(u,p)}}}t.setParent(this);t.setView(this.view);t.setApp(this.app);this.fixShapeName(t);if(n===undefined){var c=this.children.length;if(c){n=this.children[c-1].z+1}else{n=0}}this.children.push(t);t.setZIndex(n);if(t.isUIElement){t.setMode(this.mode,true);if(this.mode!==Shape.MODE_EDITING){t.init()}}for(var f=0;f<this.children.length;f++){var m=this.children[f];if(m.alwaysOnTop){this.children.remove(m);this.children.push(m);break}}if(t.isCreatingElement()){t.callOnBirthedHandler(true)}this.afterChildAppended(t);t.onAppendedInParent();UIElement.onAddShape(t,e);return true};UIElement.prototype.appendChild=function(t){var e=this.children;var i=e.length;if(t.z===undefined){t.z=i}if(!i){e.push(t);return}for(var n=i-1;n>=0;n--){var r=e[n];if(r.z<=t.z){e.splice(n+1,0,t);return}}e.splice(0,0,t);return};UIElement.prototype.addShapeDirectly=function(t){if(!this.shapeCanBeChild(t)){return false}this.disableRelayout=true;t.disableRelayout=true;t.setParent(this);t.setView(this.view);t.setApp(this.app);this.appendChild(t);if(t.isUIElement){t.mode=this.mode}this.afterChildAppended(t);delete t.disableRelayout;delete this.disableRelayout;return true};UIElement.prototype.addChild=function(t,e){return this.addShape(t,false,null,e)};UIElement.prototype.shapeCanBeRemove=function(t){return true};UIElement.prototype.afterChildRemoved=function(t){return true};UIElement.prototype.remove=function(t,e){var i=this.getParent();if(i){i.removeChild(this,t,e)}return this};UIElement.prototype.removeAll=function(){var t=this.children.length;for(var e=0;e<t;e++){var i=this.children[0];this.removeShape(i)}return};UIElement.prototype.removeChild=function(t,e,i){var n=this;if(t.animatingInfo){UIElement.logWarning("removing animating element.")}if(i){this.removeShape(t,e)}else{t.removed=true;setTimeout(function(){n.removeShape(t,e);t=null;n=null},0)}return this};UIElement.onRemoveShape=function(t,e){};UIElement.prototype.removeShape=function(t,e){if(!this.shapeCanBeRemove(t)||!t.parentShape){return false}if(t.animatingInfo){UIElement.logWarning("removing animating element.")}if(this.targetShape===t){this.targetShape=null}if(this.pointerEventTarget===t){this.pointerEventTarget=null}this.children.remove(t);t.callOnRemovedHandler();this.afterChildRemoved(t);if(t.getParent()===this){t.setParent(null);t.setView(null);t.setApp(null)}if(this.mode===Shape.MODE_EDITING){this.relayout()}UIElement.onRemoveShape(this,t);t.onRemoved(this);if(e){t.destroy()}return};UIElement.prototype.reparent=function(t,e){var i=this.getParent();if(t===i){return}if(!t||!i){return}if(e){var n=i.getPositionInWindow();var r=t.getPositionInWindow();var o=n.x-r.x;var a=n.y-r.y;this.left+=o;this.top+=a}i.children.remove(this);t.addShapeDirectly(this);return};UIElement.prototype.afterPropertyChanged=function(){if(this.parentShape){this.parentShape.relayoutChildren()}else{this.relayout()}return};UIElement.prototype.getIndexOfChild=function(t){return this.children.indexOf(t)};UIElement.prototype.getIndex=function(){if(this.parentShape){return this.parentShape.getIndexOfChild(this)}else{return-1}};UIElement.prototype.getZIndex=function(){return this.z};UIElement.prototype.setZIndex=function(t){this.z=t;var e=this.parentShape;if(e){var i=e.children;var n=i.length;for(var r=0;r<n;r++){var o=i[r];if(o.z===undefined){o.z=r}}i.sort(function(t,e){return t.z-e.z})}if(UIElement.onRestackShape){UIElement.onRestackShape()}return this};UIElement.prototype.findChildByType=function(t,e){var i=0;var n=null;var r=null;var o=this.children.length;for(i=0;i<o;i++){r=this.children[i];if(r.type===t){return r}}if(e){for(i=0;i<o;i++){r=this.children[i];n=r.findChildByType(t,e);if(n){return n}}}return null};UIElement.prototype.findChildByPath=function(t){var e=t.shift();var i=this.findChildByName(e);if(t.length){return i.findChildByPath(t)}return i};UIElement.prototype.findChildByName=function(t,e){var i=0;var n=null;var r=null;var o=this.children.length;for(i=0;i<o;i++){r=this.children[i];if(r.name===t){return r}}if(e){for(i=0;i<o;i++){r=this.children[i];n=r.findChildByName(t,e);if(n){return n}}}return null};UIElement.prototype.find=function(t,e){if(!t){return this}if(t.indexOf("/")>=0){var i=t.split("/");i.remove("");return this.findChildByPath(i)}else{return this.findChildByName(t,e)}};UIElement.prototype.setValueOf=function(t,e){var i=this.findChildByName(t,true);return i?i.setValue(e):null};UIElement.prototype.getValueOf=function(t){var e=this.findChildByName(t,true);return e?e.getValue():null};UIElement.prototype.getSelectMark=function(t,e){if(this.mode!=Shape.MODE_EDITING||this.isLocked()){return false}var i=true;var n=4;switch(t){case Shape.HIT_TEST_TL:{e.x=n;e.y=n;break}case Shape.HIT_TEST_TM:{if(this.w<60){return false}e.x=this.w>>1;e.y=n;break}case Shape.HIT_TEST_TR:{e.x=this.w-n;e.y=n;break}case Shape.HIT_TEST_BL:{e.x=n;e.y=this.h-n;break}case Shape.HIT_TEST_BM:{if(this.w<60){return false}e.x=this.w>>1;e.y=this.h-n;break}case Shape.HIT_TEST_BR:{e.x=this.w-n;e.y=this.h-n;break}case Shape.HIT_TEST_ML:{if(this.h<60){return false}e.x=n;e.y=this.h>>1;break}case Shape.HIT_TEST_MR:{if(this.h<60){return false}e.x=this.w-n;e.y=this.h>>1;break}case Shape.HIT_TEST_MOVE:{var r=this.getWindow();if(this.children.length&&r!==this){e.x=this.w>>1;e.y=this.h+20;break}}default:{i=this.getMoreSelectMark(t,e)}}return i};UIElement.prototype.paintSelectingBox=function(t){if(this.hitTestResult===Shape.HIT_TEST_WORKAREA){var e=this.lastPosition.x-this.pointerDownPosition.x;var i=this.lastPosition.y-this.pointerDownPosition.y;if(Math.abs(e)>10&&Math.abs(i)>10){var n=this.pointerDownPosition.x-this.left;var r=this.pointerDownPosition.y-this.top;t.rect(n,r,e,i);t.strokeStyle="Gray";t.stroke()}}return true};UIElement.prototype.beforePaintChild=function(t,e){return};UIElement.prototype.afterPaintChild=function(t,e){return};UIElement.prototype.paintTargetShape=function(t){var e=this.targetShape;if(e&&(this.isUIList&&this.mode===Shape.MODE_EDITING||this.isUIGrid)){shape=e;this.beforePaintChild(shape,t);shape.paintSelf(t);this.afterPaintChild(shape,t)}return};UIElement.prototype.defaultPaintChildren=function(t){t.save();t.beginPath();var e=null;var i=this.children.length;for(var n=0;n<i;n++){e=this.children[n];if(!e){continue}if(e.visible){this.beforePaintChild(e,t);e.paintSelf(t);this.afterPaintChild(e,t)}else if(e.isAnimating()){e.stepAnimation(t)}}this.paintTargetShape(t);t.restore();return};UIElement.prototype.beforePaintChildren=function(t){if(!this.rotateChildren&&this.rotation){var e=this.w>>1;var i=this.h>>1;t.translate(e,i);t.rotate(-this.rotation);t.translate(-e,-i)}return};UIElement.prototype.afterPaintChildren=function(t){return};UIElement.prototype.paintChildren=function(t){this.defaultPaintChildren(t);return};UIElement.prototype.paintSelfOnly=function(t){return};UIElement.prototype.drawImageAtCenter=function(t,e,i,n,r,o,a){if(e&&e.width>0){var s=e.width;var l=e.height;if(a){var h=Math.min(1,Math.min(o/l,r/s));var u=s*h;var p=l*h;var c=(r-u>>1)+i;var f=(o-p>>1)+n;c=Math.max(c,i);f=Math.max(f,n)}else{c=i;f=n;u=r;p=o}t.drawImage(e,0,0,s,l,c,f,u,p)}return};UIElement.prototype.drawImage=function(t){this.drawFgImage(t);return};UIElement.prototype.drawFgImage=function(t){return};UIElement.prototype.getBgHtmlImage=function(){var t=this.getBgImage();return t?t.getImage():null};UIElement.prototype.getBgImage=function(){var t=null;if(this.enable){if(this.pointerDown&&!this.isClicked()){t=this.images.normal_bg}else{if(this.pointerDown){t=this.images.active_bg}else{if(this.isPointerOverShape()&&this.getHtmlImageByType(UIElement.IMAGE_POINTER_OVER)){t=this.images.pointer_over_bg}else if(this.isFocused()){t=this.images.focused_bg}else{t=this.images.normal_bg}}}}else{t=this.images.disable_bg}if(!t||!t.getImage()){t=this.images.default_bg}if(!t||!t.getImage()){t=this.images.normal_bg}if(!t||!t.getImage()){return}return t};UIElement.prototype.drawImageAt=function(t,e,i,n,r,o,a,s){UIElement.drawImageAt(t,e,i,n,r,o,a,s)};UIElement.drawImageAt=function(t,e,i,n,r,o,a,s){return WImage.draw(t,e,i,n,r,o,a,s)};UIElement.drawImageLine=function(t,e,i,n,r,o){var a=Math.lineAngle(n,r);var s=Math.round(Math.distanceBetween(n,r));t.save();t.translate(n.x,n.y);t.rotate(a);t.translate(0,-e.height>>1);UIElement.drawImageAt(t,e,i,0,0,s,e.height,o);t.restore();return};UIElement.prototype.drawBgImage=function(t){var e=this.getBgImage();if(e){var i=e.getImageRect();e=e.getImage();this.drawImageAt(t,e,this.images.display,0,0,this.w,this.h,i)}return};UIElement.prototype.beforeDrawIcon=function(t){return false};UIElement.prototype.afterDrawIcon=function(t){return false};UIElement.prototype.getLockImage=function(){if(!this.aLockImage){this.aLockImage=new WImage;this.aLockImage.setImageSrc("/drawapp8/images/lock.png")}if(this.aLockImage){return this.aLockImage.getImage()}return null};UIElement.prototype.prepareStyle=function(t){var e=this.style;t.beginPath();if(t.lineWidth!==e.lineWidth){t.lineWidth=e.lineWidth}if(t.strokeStyle!=e.lineColor){t.strokeStyle=e.lineColor}if(t.fillStyle!=e.fillColor){t.fillStyle=e.fillColor}return};UIElement.prototype.updateTransform=function(t){this.callOnUpdateTransformHandler(t);return};UIElement.prototype.saveTransform=function(){this.savedTransform={};this.savedTransform.opacity=this.opacity;this.savedTransform.scale=this.scale;this.savedTransform.scaleX=this.scaleX;this.savedTransform.scaleY=this.scaleY;this.savedTransform.rotation=this.rotation;this.savedTransform.offsetX=this.offsetX;this.savedTransform.offsetY=this.offsetY;return};UIElement.prototype.restoreTransform=function(){if(this.savedTransform){this.opacity=this.savedTransform.opacity;this.scale=this.savedTransform.scale;this.scaleX=this.savedTransform.scaleX;this.scaleY=this.savedTransform.scaleY;this.rotation=this.savedTransform.rotation;this.offsetX=this.savedTransform.offsetX;this.offsetY=this.savedTransform.offsetY}return};UIElement.prototype.setHighlightConfig=function(t){if(t){var e=JSON.parse(JSON.stringify(t));e.startTime=0;this.saveTransform();this.removeHighlightConfig=false;this.highlightConfig=e;if(e.rotationFrom!==undefined&&e.rotationTo!==undefined){e.rotationRange=e.rotationTo-e.rotationFrom;e.rotationMiddle=(e.rotationTo+e.rotationFrom)/2}else{e.rotationRange=0}if(e.opacityFrom!==undefined&&e.opacityTo!==undefined){e.opacityRange=e.opacityTo-e.opacityFrom;e.opacityMiddle=(e.opacityTo+e.opacityFrom)/2}else{e.opacityRange=0}if(e.scaleFrom!==undefined&&e.scaleTo!==undefined){e.scaleRange=e.scaleTo-e.scaleFrom;e.scaleMiddle=(e.scaleTo+e.scaleFrom)/2}else{e.scaleRange=0}if(e.scaleXFrom!==undefined&&e.scaleXTo!==undefined){e.scaleXRange=e.scaleXTo-e.scaleXFrom;e.scaleXMiddle=(e.scaleXTo+e.scaleXFrom)/2}else{e.scaleXRange=0}if(e.scaleYFrom!==undefined&&e.scaleYTo!==undefined){e.scaleYRange=e.scaleYTo-e.scaleYFrom;e.scaleYMiddle=(e.scaleYTo+e.scaleYFrom)/2}else{e.scaleYRange=0}if(e.offsetXFrom!==undefined&&e.offsetXTo!==undefined){e.offsetXRange=e.offsetXTo-e.offsetXFrom;e.offsetXMiddle=(e.offsetXTo+e.offsetXFrom)/2}else{e.offsetXRange=0}if(e.offsetYFrom!==undefined&&e.offsetYTo!==undefined){e.offsetYRange=e.offsetYTo-e.offsetYFrom;e.offsetYMiddle=(e.offsetYTo+e.offsetYFrom)/2}else{e.offsetYRange=0}}else{this.removeHighlightConfig=true}return};UIElement.prototype.updateHighlightTransform=function(t){if(this.highlightConfig){var e=this.highlightConfig;if(e.paused)return;var i=this;var n=0;var r=e.random?e.random/1e3:0;var o=e.frequency?e.frequency:4;if(e.startTime){n=(t.now-e.startTime)/1e3}else{e.startTime=Date.now()}n+=1/(o*4)+r;var a=o*Math.PI*2;var s=UIElement.timeScale*Math.cos(a*n)*.5;if(this.removeHighlightConfig&&Math.abs(s)<.1){this.removeHighlightConfig=false;this.highlightConfig=null;this.restoreTransform();return}if(e.rotationRange){this.rotation=e.rotationMiddle+e.rotationRange*s}if(e.opacityRange){this.opacity=e.opacityMiddle+e.opacityRange*s}if(e.scaleRange){var l=e.scaleMiddle+e.scaleRange*s;this.scaleX=l;this.scaleY=l}if(e.scaleXRange){this.scaleX=e.scaleXMiddle+e.scaleXRange*s}if(e.scaleYRange){this.scaleY=e.scaleYMiddle+e.scaleYRange*s}if(e.offsetXRange){this.offsetX=e.offsetXMiddle+e.offsetXRange*s}if(e.offsetYRange){this.offsetY=e.offsetYMiddle+e.offsetYRange*s}t.needRedraw++}return};UIElement.prototype.paintSelf=function(t){this.stepAnimation(t);if(!this.visible)return;var e=this.animating;t.save();this.translate(t);if(e){var i=Math.min(this.w,this.clipW);var n=Math.min(this.h,this.clipH);if(i&&n){t.beginPath();t.rect(0,0,i,n);t.clip()}}if(this.events["onUpdateTransform"]&&!e){this.updateTransform(t)}if(this.highlightConfig){this.updateHighlightTransform(t)}this.applyTransform(t);t.save();var r=this.flipX?-1:1;var o=this.flipY?-1:1;if(r<0||o<0){t.save();var a=this.w>>1;var s=this.h>>1;t.translate(a,s);t.scale(r,o);t.translate(-a,-s)}this.drawBgImage(t);this.paintSelfOnly(t);this.drawImage(t);if(r<0||o<0){t.restore()}t.restore();if(this.children.length||this.mode===Shape.MODE_EDITING){t.save();if(e){t.animating++}this.beforePaintChildren(t);this.paintChildren(t);this.afterPaintChildren(t);if(e){t.animating--}t.restore()}if(this.drawText&&this.textType!==Shape.TEXT_NONE){this.drawText(t);this.drawTextTips(t)}t.restore();return};UIElement.prototype.regSerializer=function(t,e){this.toJsoners.push(t);this.fromJsoners.push(e);return};UIElement.prototype.toJsonMore=function(t){if(this.isUIDevice){this.exitPreview()}for(var e=0;e<this.toJsoners.length;e++){var i=this.toJsoners[e];if(i){i.call(this,t)}}var n=this.children.length;var r=this.children;if(n){t.children=[];for(var e=0;e<n;e++){var o=r[e];t.children.push(o.toJson())}}return t};UIElement.prototype.childrenFromJson=function(t){if(t.children){var e=t.children.length;this.children.clear(true);for(var i=0;i<e;i++){var n=t.children[i];var r=n.type?n.type:n.id;var o=ShapeFactoryGet().createShape(r,C_CREATE_FOR_USER);if(o){if(n.z===undefined){n.z=i}o.z=n.z;if(this.addShapeDirectly(o)){o.fromJson(n)}}}}this.targetShape=null;this.pointerEventTarget=null;return};UIElement.prototype.fromJsonMore=function(t){for(var e=0;e<this.fromJsoners.length;e++){var i=this.fromJsoners[e];if(i){i.call(this,t)}}this.childrenFromJson(t);this.targetShape=null;this.selected=false;return this};UIElement.prototype.afterApplyFormat=function(){if(this.parentShape){this.parentShape.relayoutChildren()}else{this.relayout()}return};UIElement.prototype.findChildByPoint=function(t,e,i){var n=this.children.length;var r=this.translatePoint(t);for(var o=n;o>0;o--){var a=this.children[o-1];if(a.visible&&a.hitTest(r)){if(i&&!i(a)){continue}if(e){return a.findChildByPoint(r,e,i)}else{return a}}}return this};UIElement.prototype.findShapeByPoint=UIElement.prototype.findChildByPoint;UIElement.prototype.getChildren=function(){return this.children};UIElement.prototype.getChild=function(t){return t<this.children.length&&t>=0?this.children[t]:null};UIElement.prototype.canBindingData=function(){return!this.isUIDevice&&!this.isUIScreen&&!this.isUIWindowManager&&this.children.length>0};UIElement.prototype.onDataBindingTemplate=function(t){if(this.isUIImage){var e=this.getImageByType(UIElement.IMAGE_DEFAULT);var i=e?e.getImageSrc():"";i=this.getRelativePathOfURL(i);t.image=i}else{if(this.value!==undefined){t.value=this.value}}if(this.text||this.isUILabel){t.text=this.text}return t};UIElement.prototype.getDataBindingTemplate=function(){var t=0;var e=null;var i={};var n=this.children;var r=this.children.length;this.onDataBindingTemplate(i);if(r>0){i.children=[];for(t=0;t<r;t++){e=n[t];if(!this.childIsBuiltin(e)){i.children.push(e.getDataBindingTemplate())}}}return i};UIElement.prototype.setUserData=function(t){this.userData=t;return};UIElement.prototype.getUserData=function(){return this.userData};UIElement.prototype.onBindData=function(t){var e=t.text;var i=t.image;var n=t.value;if(e!==undefined){this.setText(e)}if(i!==undefined){this.setImage(UIElement.IMAGE_DEFAULT,i)}if(n!==undefined){this.setValue(n)}if(t.enable!==undefined){this.setEnable(t.enable)}if(t.visible!==undefined){this.setVisible(t.visible)}if(t.textColor){this.style.setTextColor(t.textColor)}if(t.fillColor){this.style.setFillColor(t.fillColor)}if(t.lineColor){this.style.setLineColor(t.lineColor)}if(t.fontSize){this.style.setFontSize(t.fontSize)}this.setUserData(t.userData);if(t.height){this.h=t.height}if(t.width){this.w=t.width}if(this.offset){this.offset=0}var r=["children","text","value","image","visible","enable","textColor","fillColor","lineColor","fontSize","userData"];for(var o in t){if(r.indexOf(o)>=0)continue;var n=t[o];var a=this.find(o,true);if(!a)continue;if(typeof n==="object"){a.doBindData(n)}else{a.setValue(n)}}return};UIElement.prototype.moveMustBeLastItemToLast=function(){var t=null;var e=this.children;var i=this.children.length;for(var n=0;n<i;n++){var r=e[n];if(r.name==="ui-last"){t=r;e[n]=e[i-1];e[i-1]=t;break}}return};UIElement.prototype.childIsBuiltin=function(t){
return false};UIElement.makeImageURLToAbsOfJson=function(t){if(!t){return}var e=t.images;var i=window.location.protocol+"//"+window.location.host+"/";for(var n in e){var r=e[n];if(n!=="display"){if(r.indexOf("http://")<0&&r.indexOf("https://")<0){r=i+r;e[n]=r}}}if(!t.children){return}for(var o=0;o<t.children.length;o++){var a=t.children[o];UIElement.makeImageURLToAbsOfJson(a)}return};UIElement.prototype.getTemplateChildJson=function(){if(!this.templateChildJson){var t=this.getTemplateChild();this.templateChildJson=t?t.toJson():null;UIElement.makeImageURLToAbsOfJson(this.templateChildJson);if(this.templateChildJson){delete this.templateChildJson.isTemplate}else{console.log("No Template Child.")}}return this.templateChildJson};UIElement.prototype.getTemplateChild=function(){if(!this.templateChild){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isTemplate){this.children.remove(e);this.templateChild=e;break}}if(!this.templateChild){this.templateChild=this.getLastUserChild()}}return this.templateChild};UIElement.prototype.dupTemplateChild=function(){var t=this.getTemplateChild().clone();delete t.isTemplate;return t};UIElement.prototype.dupChild=function(t,e){var i=this.findChildByName(t);if(i){var n=i.clone();n.xAttr=0;n.yAttr=0;if(i.anchor){n.setAnchor(i.anchor.x,i.anchor.y)}this.addShape(n,false,null,e);n.setVisible(true);return n}else{return null}};UIElement.prototype.getLastUserChild=function(){var t=this.children;var e=this.children.length;if(e>0){for(var i=e-1;i>=0;i--){var n=t[i];if(!this.childIsBuiltin(n)){return n}}}return null};UIElement.prototype.countUserChildren=function(){var t=0;var e=this.children;var i=this.children.length;for(var n=0;n<i;n++){var r=this.children[n];if(!this.childIsBuiltin(r)){t=t+1}}return t};UIElement.prototype.bindData=function(t,e,i){var n=this;n.disableRelayout=true;n.doBindData(t,i);delete n.disableRelayout;n.relayoutChildren(e);console.log("bindData: done");n.postRedraw();return};UIElement.prototype.doBindData=function(t,e){var i=0;var n=0;var r=null;var o=this.isUIList||this.isUIGrid?this.getTemplateChildJson():null;this.onBindData(t);var a=this.children;var s=this.countUserChildren();if(s<1&&!o||!t.children){return}var l=t.children.length;if(this.isUIList||this.isUIGrid){if(l>s){o.y=0;o.visible=true;for(i=s;i<l;i++){this.addChildWithJson(o)}}else if(l<s&&e){var h=[];n=s-l;for(i=this.children.length-1;i>=0;i--){var r=this.children[i];if(!this.childIsBuiltin(r)&&!r.isTemplate){h.push(r)}}for(var i=0;i<h.length;i++){var r=h[i];if(i===n){break}this.children.remove(r);r.setParent(null);r.setApp(null);r.setView(null)}}s=this.children.length}else{s=this.children.length}for(i=0,n=0;n<s&i<l;n++){r=a[n];if(!this.childIsBuiltin(r)){r.doBindData(t.children[i]);i=i+1}}return};UIElement.prototype.bindDataUrl=function(t,e,i){var n={};var r=this;httpGetJSON(t,function(t){if(e){t=e(t)}if(t){r.bindData(t,"default",true)}if(i){i(t)}});return};function UIElementCreator(t){t=t?t:"ui-element";var e=[t,"UI-Element",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIElement;return e.initUIElement(this.type)};return}UIElement.prototype.sortChildren=function(){return};UIElement.prototype.shouldShowContextMenu=function(){return this.mode===Shape.MODE_EDITING};UIElement.prototype.setText=function(t,e){if(this.text!=t){this.text=this.toText(t);if(e){this.callOnChangedHandler(t)}this.textNeedRelayout=true}return this};UIElement.prototype.getValue=function(){return this.getText()};UIElement.prototype.setValue=function(t,e,i){var n=this;var r=this.getText()||0;t=String(t);if(t==String(r))return this;if(!!i&&!isNaN(+t)&&!isNaN(+r)){var o=t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0;this.animate({duration:300,valueEnd:+t,valueStart:+r,onStep:function(t,e,i){n.setText(i.value.toFixed(o));return true},onDone:function(e,i){n.setText(t);console.debug("element setValue onDone")}})}else{this.setText(t)}return this};UIElement.prototype.addValue=function(t,e,i){var n=this.getValue();var r=String(n).indexOf(":");if(r==-1){n=+n;var o=(isNaN(n)?0:n)+(isNaN(+t)?0:+t);var a=u(String(n));var s=u(String(t));var l=u(String(o));var h=a>s?a:s;h=h>l?l:h;function u(t){return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}return this.setValue(o.toFixed(h),e,i)}else{var p=+n.substr(0,r);var c=+n.substr(r+1,2);var f=(isNaN(p)?0:p*60)+(isNaN(c)?0:c);var m=f+t>>0;if(isNaN(+t)||m<0){return this}else{var p=Math.floor(m/60);var c=m%60;p=p<10?"0"+p:p;c=c<10?"0"+c:c;return this.setValue(p+":"+c)}}};UIElement.prototype.getPositionInView=function(){var t=this.getX();var e=this.getY();var i={x:0,y:0};var n=this.parentShape;while(n!=null){t+=n.getX();e+=n.getY();if(n.isUIVScrollView){e=e-n.offset}else if(n.isUIHScrollView){t=t-n.offset}else if(n.isUIScene){t=t-n.xOffset;e=e-n.yOffset}n=n.parentShape}i.x=t;i.y=e;return i};UIElement.prototype.getLocaleText=function(t){var e=webappGetText(t);if(!e){return t}if(!this.locale){this.locale={text:e};this.needRelayout=true}return e};UIElement.prototype.getLocaleInputTips=function(t){var e=webappGetText(t);return e?e:t};UIElement.prototype.setBgImage=function(t){return this.setImage(UIElement.IMAGE_DEFAULT,t)};UIElement.prototype.setImage=function(t,e){var i=this;var n=arguments.length;if(n<2){e=t;t=UIElement.IMAGE_DEFAULT}else{t=t?t:UIElement.IMAGE_DEFAULT}var r=null;function o(t){i.postRedraw();return}if(typeof e==="string"){r=WImage.create(e,o)}else if(typeof e==="object"){if(e&&e.image){r=e}else{r=WImage.createWithImage(e)}}else if(typeof e==="number"){r=this.images["option_image_"+e]}else{r=WImage.create(e,o)}this.images[t]=r;if(!r){console.log("%c %s. image is null %s:%s","background: red; color: white",this.name,t,e)}return this};UIElement.prototype.getHtmlImageByType=function(t){var e=this.images[t];return e?e.getImage():null};UIElement.prototype.getImageByType=function(t){return this.images[t]};UIElement.prototype.getImageSrcByType=function(t){var e=this.images[t];return e?e.getImageSrc():""};UIElement.prototype.getImageTypes=function(){var t=[];for(var e in this.images){var i=this.images[e];if(e!="display"){t.push(e)}}return t};UIElement.prototype.addEventNames=function(t){if(t){for(var e=0;e<t.length;e++){var i=t[e];if(!this.events[i]){this.events[i]=null}}}return this};UIElement.prototype.removeEventNames=function(t){if(t){for(var e=0;e<t.length;e++){var i=t[e];delete this.events[i]}}return this};UIElement.prototype.getEventNames=function(){var t=[];for(var e in this.events){t.push(e)}return t};UIElement.uidStart=1e4+Math.floor(Math.random()*1e4);UIElement.prototype.initUIElement=function(t){this.initContainerShape(t);this.enable=true;this.visible=true;this.opacity=1;this.vMargin=0;this.hMargin=0;this.xAttr=UIElement.X_FIX_LEFT;this.yAttr=UIElement.Y_FIX_TOP;this.widthAttr=UIElement.WIDTH_FIX;this.heightAttr=UIElement.HEIGHT_FIX;this.name=t;this.events={};this.uid=UIElement.uidStart++;this.runtimeVisible=true;this.images={};this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;this.addEventNames(["onClick"]);this.regSerializer(this.elementToJson,this.elementFromJson);return this};UIElement.prototype.updateLayoutParams=function(){var t=this.parentShape;if(!t){return}this.xParam=1;this.yParam=1;this.widthParam=1;this.heightParam=1;var e=t.getRelayoutWidth();var i=t.getRelayoutHeight();if(this.xAttr===UIElement.X_SCALE){this.xParam=this.left/e}else if(this.xAttr===UIElement.X_FIX_RIGHT){this.xParam=e-(this.left+this.w)}if(this.yAttr===UIElement.Y_SCALE){this.yParam=this.top/i}else if(this.yAttr===UIElement.Y_FIX_BOTTOM){this.yParam=i-(this.top+this.h)}if(this.widthAttr===UIElement.WIDTH_SCALE){this.widthParam=this.w/e;this.widthScaleMin=this.w>>1;this.widthScaleMax=this.w<<1}if(this.heightAttr===UIElement.HEIGHT_SCALE){this.heightParam=this.h/i;this.heightScaleMin=this.h>>1;this.heightScaleMax=this.h<<1}if(this.heightAttr===UIElement.HEIGHT_KEEP_RATIO_WITH_WIDTH){this.heightParam=this.h/this.w}return this};UIElement.prototype.imagesToJson=function(t){for(var e in this.images){var i=this.images[e];if(e==="display"){t.images[e]=i}else{var n=i.getImageSrc();n=this.getRelativePathOfURL(n);if(n){t.images[e]=n;var r=n.indexOf("#");if(r>0){var o=i.getRealImageSrc();o=this.getRelativePathOfURL(o);var a=n.substr(0,r);if(o&&o.indexOf(n)<0){t.images["real-image-"+a]=decodeURI(o)}}}}}return t};UIElement.prototype.elementToJson=function(t){this.updateLayoutParams();t.events=this.events;t.images={};this.imagesToJson(t);if(this.value!=undefined){t.value=this.value}if(this.animations){t.animations=JSON.parse(JSON.stringify(this.animations))}return t};UIElement.prototype.imagesFromJson=function(t){if(t.images){for(var e in t.images){var i=t.images[e];if(e==="display"){this.images[e]=i}else if(e.indexOf("real-image")!==0){this.setImage(e,i)}}}return};UIElement.prototype.elementFromJson=function(t){if(t.events){delete t.events.onOnUpdateTransform;for(var e in t.events){var i=t.events[e];this.events[e]=i}}for(var e in this.images){var i=this.images[e];if(e!=="display"&&e.indexOf("real-image")!==0){this.setImage(e,null)}}this.imagesFromJson(t);if(t.animations){this.animations=t.animations}if(t.enable!=undefined){this.setEnable(t.enable)}if(t.opacity!=undefined){this.setOpacity(t.opacity)}return this};UIElement.prototype.getEnable=function(){return this.enable};UIElement.prototype.setEnable=function(t){this.enable=t;return this};UIElement.prototype.isEnable=function(){var t=this;if(!this.isValid()){return false}while(t!=null){if(!t.enable){return false}t=t.parentShape}return true};UIElement.prototype.getVisible=function(t){return this.visible};UIElement.prototype.setVisible=function(t){this.visible=t;if(!t){if(this.animatingInfo){UIElement.logWarning("hide animating element invisble.")}}return this};UIElement.prototype.isVisible=function(){var t=this;if(!this.isValid()){return false}while(t!=null){if(!t.visible){return false}t=t.parentShape}return true};UIElement.prototype.isFocused=function(){return this.parentShape&&this.parentShape.targetShape==this};UIElement.prototype.onShowHTML=function(){return};UIElement.prototype.onHideHTML=function(){return};UIElement.prototype.showHTML=function(){var t=0;var e=this.children.length;for(t=0;t<e;t++){var i=this.children[t];i.showHTML()}this.onShowHTML();return};UIElement.prototype.hideHTML=function(){var t=0;var e=this.children.length;for(t=0;t<e;t++){var i=this.children[t];i.hideHTML()}this.onHideHTML();return};UIElement.prototype.show=function(){return this.setVisible(true)};UIElement.prototype.hide=function(){return this.setVisible(false)};UIElement.prototype.beforeRelayout=function(){};UIElement.prototype.afterRelayout=function(){};UIElement.prototype.getPrevSibling=function(){if(!this.parentShape||this.parentShape.children.length<2){return null}var t=0;for(t=0;t<this.parentShape.children.length;t++){if(this.parentShape.children[t]===this){break}}return t>0?this.parentShape.children[t-1]:null};UIElement.prototype.setAutoScaleFontSize=function(t){this.enableAutoScaleFontSize=t;return this};UIElement.prototype.autoScaleFontSize=function(t){if(this.enableAutoScaleFontSize){var e=Math.round(this.style.fontSize*t);e=Math.min(e,36);e=Math.max(e,12);this.style.setFontSize(e)}return};UIElement.prototype.getRelayoutWidth=function(){return this.getWidth()};UIElement.prototype.getRelayoutHeight=function(){return this.getHeight()};UIElement.prototype.relayout=function(){if(this.disableRelayout){return}var t=getParentShapeOfShape(this);if(!t||!t.isUIElement){if(this.mode===Shape.MODE_EDITING){this.setUserMovable(true);this.setUserResizable(true)}}if(this.isUIDevice){this.setUserResizable(false)}if(!t){this.relayoutChildren();return}var e=0;var i=0;var n=0;var r=0;var o=this.xAttr;var a=this.yAttr;var s=t.getRelayoutWidth();var l=t.getRelayoutHeight();var h=t.getHMargin();var u=t.getVMargin();var p=s-h-h;var c=l-u-u;var f=this.top+this.h;var m=this.left+this.w;this.beforeRelayout();switch(this.widthAttr){case UIElement.WIDTH_SCALE:{e=s*this.widthParam;if(this.widthScaleMin&&e<this.widthScaleMin){if(this.pointerDown){this.widthScaleMin=e}else{e=this.widthScaleMin}}if(this.widthScaleMax&&e>this.widthScaleMax){if(this.pointerDown){this.widthScaleMax=e}else{e=this.widthScaleMax}}break}case UIElement.WIDTH_FILL_PARENT:{e=p;this.left=h;o=UIElement.X_FIX_LEFT;break}default:{e=this.w;break}}switch(this.heightAttr){case UIElement.HEIGHT_SCALE:{i=l*this.heightParam;if(this.heightScaleMin&&i<this.heightScaleMin){if(this.pointerDown){this.heightScaleMin=i}else{i=this.heightScaleMin}}if(this.heightScaleMax&&i>this.heightScaleMax){if(this.pointerDown){this.heightScaleMax=i}else{i=this.heightScaleMax}}break}case UIElement.HEIGHT_FILL_PARENT:{i=c;this.top=u;a=UIElement.Y_FIX_TOP;break}default:{i=this.h;break}}switch(o){case UIElement.X_SCALE:{n=s*this.xParam;break}case UIElement.X_FIX_RIGHT:{n=s-this.xParam-this.w;break}case UIElement.X_CENTER_IN_PARENT:{n=s-e>>1;break}case UIElement.X_LEFT_IN_PARENT:{n=h;break}case UIElement.X_RIGHT_IN_PARENT:{n=s-e-h;break}default:{n=this.left;break}}switch(a){case UIElement.Y_SCALE:{r=l*this.yParam;break}case UIElement.Y_FIX_BOTTOM:{r=l-this.yParam-this.h;break}case UIElement.Y_MIDDLE_IN_PARENT:{r=l-i>>1;break}case UIElement.Y_TOP_IN_PARENT:{r=u;break}case UIElement.Y_BOTTOM_IN_PARENT:{r=l-i-u;break}default:{r=this.top;break}}if(this.widthAttr===UIElement.WIDTH_FILL_TO_PARENT_RIGHT){e=s-n-h}if(this.heightAttr===UIElement.HEIGHT_FILL_TO_PARENT_BOTTOM){i=l-r-u}if(this.heightAttr===UIElement.HEIGHT_KEEP_RATIO_WITH_WIDTH){i=e*this.heightParam}var d=this.w;this.w=Math.round(e);this.h=Math.round(i);this.setLeftTop(n,r);if(t.isUIElement){if(this.mode===Shape.MODE_EDITING){var y=this.getWindow();if(y&&!y.isUIScene&&!y.isUIDialog){t.fixChildSize(this)}}t.fixChildPosition(this)}this.setSize(this.w,this.h);this.autoScaleFontSize(e/d);this.relayoutChildren();this.afterRelayout();this.setTextNeedRelayout(true);return};UIElement.prototype.beforeRelayoutChild=function(t){return true};UIElement.prototype.afterRelayoutChild=function(t){return true};UIElement.prototype.relayoutChildren=function(){if(this.disableRelayout||!this.children){return}for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.widthAttr===UIElement.WIDTH_FILL_AVAILABLE||e.heightAttr===UIElement.HEIGHT_FILL_AVAILABLE){continue}if(this.beforeRelayoutChild(e)){e.relayout()}this.afterRelayoutChild(e)}for(var t=0;t<this.children.length;t++){var e=this.children[t];if(!(e.widthAttr===UIElement.WIDTH_FILL_AVAILABLE||e.heightAttr===UIElement.HEIGHT_FILL_AVAILABLE)){continue}if(this.beforeRelayoutChild(e)){e.relayout()}this.afterRelayoutChild(e)}return};UIElement.prototype.getWindowManager=function(){var t=this;while(t!=null&&!t.isUIWindowManager){t=t.parentShape}return t};UIElement.EVENT_STATUS_NONE=0;UIElement.EVENT_VSCROLL_HANDLED=1;UIElement.EVENT_HSCROLL_HANDLED=2;UIElement.lastEvent={};UIElement.lastEvent.element=null;UIElement.lastEvent.status=UIElement.EVENT_STATUS_NONE;UIElement.prototype.setLastEventStatus=function(t){if(t){UIElement.lastEvent.status|=t;UIElement.lastEvent.element=this}else{UIElement.lastEvent.status=0;UIElement.lastEvent.element=null}return};UIElement.prototype.getLastEventStatus=function(){return UIElement.lastEvent.status};UIElement.prototype.getDevice=function(){var t=this;while(t!=null&&!t.isUIDevice){t=t.parentShape}return t};UIElement.prototype.getDeviceConfig=function(){var t=this.getWindowManager();if(t){return t.getDeviceConfig()}return null};UIElement.prototype.isTopWindow=function(){var t=this.getWindow();var e=this.getWindowManager();var i=e.getCurrentFrame();if(t===i||t===i.popupWindow){return true}return false};UIElement.prototype.getWindow=function(){var t=this;while(t!=null&&!t.isUIWindow){t=t.parentShape}return t};UIElement.prototype.getPositionInWindow=function(){var t=this;var e=t.left;var i=t.top;while(t!=null&&!t.isUIWindow){t=t.parentShape;if(t.isUIWindow){break}e=e+t.left;i=i+t.top}return{x:e,y:i}};UIElement.prototype.getWindowNames=function(){var t=this.getWindowManager();if(t){return t.getWindowNames()}return[]};UIElement.prototype.openScene=function(t,e){var i=this;setTimeout(function(){i.openWindow(t,null,true,e)},0)};UIElement.prototype.openWindow=function(t,e,i,n,r){var o=this.getWindowManager();if(o){return o.openWindow(t,e,i,n,r)}return false};UIElement.prototype.backToHomeWin=function(){var t=this.getWindowManager();if(t){t.backToHomeWin()}return};UIElement.prototype.closeWindow=function(t){var e=this.getWindow();var i=this.getWindowManager();if(i&&e){if(i.isWindowOpen(e)){return i.closeCurrentWindow(t)}else{console.log("Current Window Is Not Open.")}}return false};UIElement.prototype.canBeComponent=function(){return true};UIElement.prototype.isCreatingElement=function(){if(this.view&&this.view.creatingShape===this){return true}return false};UIElement.prototype.onScaleForDensityDone=function(t,e){};UIElement.prototype.setNotScaleForDensity=function(t){this.notScaleForDensity=t;return};UIElement.prototype.scaleForDensity=function(t,e,i){if(!t||t===1||this.notScaleForDensity){return}if(this.widthAttr===UIElement.WIDTH_FIX){this.w=Math.floor(this.w*t)}if(this.heightAttr===UIElement.HEIGHT_FIX){this.h=this.h*t;if(this.h<36&&(this.isUIButton||this.isUIProgressBar||this.isUIColorTile||this.isUIColorButton||this.isUIEdit||this.isUIRadioBox||this.isUICheckBox||this.isUIWaitBar||this.isUISwitch)){this.h=40}if(this.h<50&&(this.isUIToolBar||this.isUIButtonGroup)){this.h=50}if(this.hMin>this.h){this.hMin=this.h}}var n=this.isCreatingElement();if(!n&&this.yAttr===UIElement.Y_FIX_TOP){this.top=Math.floor(this.top*t)}if(!n&&this.xAttr===UIElement.X_FIX_LEFT){this.left=Math.floor(this.left*t)}this.style.setFontSize(Math.floor(this.style.fontSize*t));if(this.itemHeight>20){this.itemHeight=Math.floor(this.itemHeight*t)}if(this.roundRadius){this.roundRadius=Math.floor(this.roundRadius*t)}this.vMargin=Math.floor(this.vMargin*t);this.hMargin=Math.floor(this.hMargin*t);if(this.buttonHeight>40){this.buttonHeight=Math.floor(this.buttonHeight*t)}this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.w=Math.round(this.w);this.h=Math.round(this.h);if(i){for(var r=0;r<this.children.length;r++){var o=this.children[r];o.scaleForDensity(t,e,true)}}if(this.isUIProgressBar){var a=this.getValue();this.setValue(0);this.setValue(a)}this.onScaleForDensityDone(t,e);return};UIElement.prototype.onDeviceConfigChanged=function(t,e){return};UIElement.prototype.fixImagePath=function(t,e){var i=t.version;var n=t.platform;var r=t.lcdDensity;var o=e.version;var a=e.platform;var s=e.lcdDensity;for(var l in this.images){var h=this.images[l];if(l==="display"){continue}var u=h.getImageSrc();if(u){u=u.replaceAll("/"+r+"/","/"+s+"/");h.setImageSrc(u)}}return};UIElement.prototype.scaleForCurrentDensity=function(t){var e=this.getDeviceConfig();var i=this.getDensitySizeByName(e?e.lcdDensity:"hdpi");return t*(i/160)};UIElement.prototype.getDensitySizeByName=function(t){switch(t){case"ldpi":{return 80}case"mdpi":{return 160}case"hdpi":{return 240}case"xhdpi":{return 350}case"xxhdpi":{return 450}default:{console.log("not supported density: "+t)}}return 160};UIElement.prototype.getSizeScale=function(t,e){var i=this.getDensitySizeByName(t);var n=this.getDensitySizeByName(e);var r=n/i;return r};UIElement.prototype.notifyDeviceConfigChanged=function(t,e){for(var i=0;i<this.children.length;i++){var n=this.children[i];n.notifyDeviceConfigChanged(t,e)}this.fixImagePath(t,e);this.onDeviceConfigChanged(t,e);return};UIElement.prototype.addMovementForVelocityTracker=function(){if(this.velocityTracker){var t={};t.x=this.getMoveAbsDeltaX();t.y=this.getMoveAbsDeltaY();var e=Date.now()*1e6;this.velocityTracker.addMovement(e,t);delete date}return};UIElement.prototype.getSavedState=function(){return this.savedState?this.savedState.json:null};UIElement.prototype.saveState=function(t){this.savedState={};UIElement.disableGetRelativePathOfURL=true;this.savedState.json=t?t:this.toJson();UIElement.disableGetRelativePathOfURL=false;return this};UIElement.prototype.restoreState=function(){if(this.savedState&&this.savedState.json){this.fromJson(this.savedState.json)}return this};UIElement.prototype.clearState=function(t){if(this.savedState){this.savedState.json=null}return this};UIElement.prototype.isUserMovable=function(){if(this.widthAttr==UIElement.WIDTH_FILL_PARENT&&(this.yAttr===UIElement.Y_TOP_IN_PARENT||this.yAttr===UIElement.Y_MIDDLE_IN_PARENT||this.yAttr===UIElement.Y_BOTTOM_IN_PARENT)){return false}if(this.heightAttr===UIElement.HEIGHT_FILL_PARENT&&(this.xAttr===UIElement.X_LEFT_IN_PARENT||this.xAttr===UIElement.X_CENTER_IN_PARENT||this.xAttr===UIElement.X_RIGHT_IN_PARENT)){return false}if(this.widthAttr===UIElement.WIDTH_FILL_PARENT&&this.heightAttr===UIElement.HEIGHT_FILL_PARENT){return false}return this.userMovable&&!this.isLocked()};UIElement.prototype.isUserResizable=function(){if(this.widthAttr===UIElement.WIDTH_FILL_PARENT&&this.heightAttr===UIElement.HEIGHT_FILL_PARENT){return false}return this.userResizable};UIElement.prototype.getEditorRect=function(){var t={};t.x=this.left;t.y=this.top;t.w=this.w;t.h=this.h;return t};UIElement.funcs=[];UIElement.setAnimTimer=function(t,e){return UIElement.setTimeout(t,e)};UIElement.setTimeout=function(t,e){e=e?Math.max(e,16):16;t.deltaTime=e;t.time=Date.now()+e;UIElement.funcs.push(t);function i(){var t=UIElement.funcs;var e=Date.now();var n=t.length;UIElement.funcs=[];for(var r=0;r<n;r++){var o=t[r];if(o.time<=e){if(o()){o.time=e+o.deltaTime;UIElement.funcs.push(o)}}else{UIElement.funcs.push(o)}}t=null;if(UIElement.funcs.length){UIElement.animTimerID=requestAnimFrame(i)}else{UIElement.animTimerID=0}}if(!UIElement.animTimerID){UIElement.animTimerID=requestAnimFrame(i,16)}return};UIElement.getMainCanvas=function(){return CantkRT.getMainCanvas()};UIElement.getMainCanvasScale=function(t){if(!UIElement.canvasScale||t){var e=1;var i=1;UIElement.canvasScale={};var n=UIElement.getMainCanvas();if(n.style.width&&n.style.height){e=n.width/parseFloat(n.style.width);i=n.height/parseFloat(n.style.height)}UIElement.canvasScale.x=e;UIElement.canvasScale.y=i}return UIElement.canvasScale};UIElement.prototype.isFullscreenMode=function(){return cantkIsFullscreen()};UIElement.prototype.setFlipX=function(t){this.flipX=t;return this};UIElement.prototype.setFlipY=function(t){this.flipY=t;return this};UIElement.prototype.getFlipX=function(){return this.flipX};UIElement.prototype.getFlipY=function(){return this.flipY};UIElement.prototype.requestFullscreen=function(t){if(!isMobile()){if(t){t(false)}console.log("UIElement.requestFullScreen Rejected(not mobile)")}else{if(!cantkRequestFullscreen(t)){t(false)}console.log("UIElement.requestFullScreen")}return};UIElement.prototype.pickFiles=function(t,e){return showFileDialog(t,true,false,e)};UIElement.prototype.pickFile=function(t,e){if(!window.FileReader){return false}showFileDialog(t,false,true,function(t){var i=t[0];if(i){var n=new FileReader;n.readAsDataURL(i);n.onloadend=function(){if(e){e(i,n.result)}n=null}}});return true};UIElement.prototype.pickAudio=function(t){return this.pickFile("audio/*",t)};UIElement.prototype.pickImage=function(t){return this.pickFile("image/*",t)};UIElement.fixArtTextStyle=function(t){t.fontSize=t.fontSize?t.fontSize:16;t.imageBorder=t.imageBorder?t.imageBorder:10;t.textAlignH=t.textAlignH?t.textAlignH:"left";t.startColor=t.startColor?t.startColor:"Green";t.endColor=t.endColor?t.endColor:"Green";t.lineWidth=t.lineWidth?t.lineWidth:0;t.lineColor=t.lineColor?t.lineColor:"Black";t.shadowColor=t.shadowColor?t.shadowColor:"Black";t.shadowBlur=t.shadowBlur?t.shadowBlur:0;t.shadowOffsetX=t.shadowOffsetX?t.shadowOffsetX:0;t.shadowOffsetY=t.shadowOffsetY?t.shadowOffsetY:0;return t};UIElement.createArtTextImage=function(t,e,i){UIElement.fixArtTextStyle(e);if(!t){return null}var n=300;var r=80;var o=e.imageBorder;var a=e.fontSize;var s=e.fontFamily;var l=e.textAlignH;var h=e.monospace;var u=cantkGetTempCanvas(n,r);var p=u.getContext("2d");p.clearRect(0,0,n,r);var c=n>>1;var f=r>>1;var m="";var d=t.length;if(e.textB){m+="Bold "}if(e.textI){m+="Italic "}m+=a+"pt '"+s+"'";p.font=m;p.textBaseline="middle";p.textAlign="center";switch(l){case"left":{c=o;p.textAlign="left";break}case"right":{c=n-o;p.textAlign="right";break}default:break}if(h){var y=0;for(var g=0;g<d;g++){var v=t[g];var _=p.measureText(v).width;if(_>y){y=_}}y=y+4;n=d*y}else{var I=p.measureText(t).width;n=I+o*2}r=e.fontSize+2*(Math.abs(e.shadowOffsetY)+e.shadowOffsetY+o);u.width=n;u.height=r;if(i){p.fillStyle=i;p.fillRect(0,0,n,r)}p.font=m;p.textBaseline="middle";p.textAlign="center";if(e.useTexture&&e.texture){var w=WImage.create(e.texture);var x=w.getImage();if(x){var S=p.createPattern(x,"repeat");p.fillStyle=S}}else{if(e.startColor!=e.endColor){var T=p.createLinearGradient(0,0,0,r);if(e.horizonalGradient){T=p.createLinearGradient(0,0,n,0)}T.addColorStop(0,e.startColor);T.addColorStop(1,e.endColor);p.fillStyle=T}else{p.fillStyle=e.startColor}}if(e.shadowBlur){p.shadowOffsetX=e.shadowOffsetX;p.shadowOffsetY=e.shadowOffsetY;p.shadowBlur=e.shadowBlur;p.shadowColor=e.shadowColor}c=n>>1;f=r>>1;p.lineWidth=e.lineWidth;p.strokeStyle=e.lineColor;if(h){c=0;var C=y>>1;var d=t.length;p.textAlign="center";for(var g=0;g<d;g++){c=g*y+C;var v=t[g];p.fillText(v,c,f);p.strokeText(v,c,f)}}else{p.fillText(t,c,f);if(p.lineWidth){p.strokeText(t,c,f)}}var b=u.toDataURL();return b};ShapeFactoryGet().addShapeCreator(new UIGroupCreator(200,200,null));UIElement.timeScale=1;UIElement.timeScaleIsZero=function(){return UIElement.timeScale<1e-5};UIElement.prototype.getTimeScale=function(){return UIElement.timeScale};UIElement.prototype.setTimeScale=function(t,e){UIElement.timeScaleAnimating=false;if(e&&e>100){var i=this;var n=UIElement.timeScale;var r=t-n;var o=Date.now();UIElement.timeScaleAnimating=true;function a(){if(!UIElement.timeScaleAnimating)return;var i=Date.now()-o;if(i<e){setTimeout(a,100);UIElement.timeScale=n+r*(i/e)}else{UIElement.timeScale=t;UIElement.timeScaleAnimating=false}}a()}else{UIElement.timeScale=t}return this};UIElement.prototype.getAppInfo=function(){var t=this.view.getMetaInfo();return t.general};UIElement.logNotice=function(t){console.log("%cNotice: "+t,"color: green; font-weight: bold")};UIElement.logWarning=function(t){console.log("%cWarning: "+t,"color: red; font-weight: bold")};UIElement.logError=function(t,e){console.log("%cWarning: "+t+"("+e.message+")\n"+e.stack,"color: red; font-weight: bold")};UIElement.prototype.isPointIn=function(t,e){var i=false;if(t){t.beginPath();t.rect(0,0,this.w,this.h);t.closePath();i=t.isPointInPath(e.x,e.y)}else{i=isPointInRect(e,this)}return i};UIElement.prototype.pInPolygon=function(t,e,i){var n=false;for(var r=0,o=t.length-1;r<t.length;o=r++){if(t[r].y>i!=t[o].y>i&&e<(t[o].x-t[r].x)*(i-t[r].y)/(t[o].y-t[r].y)+t[r].x)n=!n}return n};UIElement.prototype.isPointInMatrix=function(t,e,i){var n=t.x,r=t.y,o=t.w,a=t.h,s={x:n,y:r},l={x:n+o,y:r},h={x:n+o,y:r+a},u={x:n,y:r+a},p=Matrix2D.identity;p.beginPath=function(){};p.clip=function(){};p.rect=function(){};p.arc=function(){};try{i.call(this,p)}catch(c){console.debug("applyTransform catch err",err)}var f=p.transformPoint(s.x,s.y),m=p.transformPoint(l.x,l.y),d=p.transformPoint(h.x,h.y),y=p.transformPoint(u.x,u.y),g=[f,m,d,y];p.identity();return this.pInPolygon(g,e.x,e.y)};function UIElementCreator(t){var e=[t,"ui-element",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIElement;return e.initUIElement(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIElementCreator("ui-element"));function UIGroup(){return}UIGroup.prototype=new UIElement;UIGroup.prototype.isUIGroup=true;UIGroup.prototype.initUIGroup=function(t,e,i,n){this.initUIElement(t);this.roundRadius=5;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.setCanRectSelectable(false,false);this.addEventNames(["onInit"]);this.style.lineColor="rgba(0,0,0,0)";this.style.fillColor="rgba(0,0,0,0)";this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;return this};UIGroup.prototype.shapeCanBeChild=function(t){if(t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow||t.isUIListItem){return false}return true};UIGroup.prototype.onPointerUpEditing=function(t,e){return};UIGroup.prototype.fixChildPosition=function(t){};UIGroup.prototype.fixChildSize=function(t){};UIGroup.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){t.beginPath();drawRoundRect(t,this.w,this.h,this.roundRadius);if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fill()}if(!this.isStrokeColorTransparent()){t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;t.stroke()}}return};function UIGroupCreator(t,e,i){var n=["ui-group","ui-group",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIGroup;return r.initUIGroup(this.type,t,e,i)};return}UIGroup.create=function(){var t=new UIGroup;t.initUIGroup("ui-group",200,200,null);t.state=Shape.STAT_NORMAL;return t};function UIWindow(){return}UIWindow.serialNo=0;UIWindow.prototype=new UIElement;UIWindow.prototype.isUIWindow=true;UIWindow.prototype.onGesture=function(t){if(this.mode!=Shape.MODE_EDITING){this.callOnGestureHandler(t)}return};UIWindow.prototype.isMainWindow=function(){var t=this.getWindowManager();var e=t.history[0];var i=t.children[e];return i===this};UIWindow.prototype.initUIWindow=function(t,e,i,n,r,o){this.initUIElement(t);this.setLeftTop(e,i);this.settings={};this.setDefSize(n,r);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,o);this.setName("window-"+UIWindow.serialNo++);if(!o){this.style.setFillColor("White")}this.addEventNames(["onSystemInit","onLoad","onUnload","onOpen","onBeforeOpen","onClose","onSwitchToBack","onSwitchToFront","onGesture","onKeyDown","onKeyUp"]);this.setAnimHint("htranslate");this.oldHitTest=this.hitTest;this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);this.intervals=[];this.timeouts=[];return this};UIWindow.prototype.setAnimHint=function(t){this.animHint=t;return true};UIWindow.prototype.shapeCanBeChild=function(t){if(t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow){return false}return true};UIWindow.prototype.onModeChanged=function(){if(this.mode===Shape.MODE_EDITING){this.popupWindow=null}return};UIWindow.prototype.removePopupWindow=function(t){if(this.popupWindow){if(this.popupWindow===t){this.popupWindow=null;this.targetShape=null;return true}return this.popupWindow.removePopupWindow(t)}return false};UIWindow.prototype.setPopupWindow=function(t){if(this.popupWindow){return this.popupWindow.setPopupWindow(t)}else{this.popupWindow=t}return true};UIWindow.prototype.getPopupWindow=function(){if(this.popupWindow){return this.popupWindow.getPopupWindow()}return this.isUIPopupWindow?this:null};UIWindow.prototype.isGrabElement=function(t){return this.grabElement===t};UIWindow.prototype.grab=function(t){this.grabElement=t;return};UIWindow.prototype.ungrab=function(t){this.grabElement=null;return};UIWindow.prototype.dispatchPointerDownToChildren=function(t){if(this.grabElement){this.grabElement.onPointerDown(t);this.setTarget(this.grabElement);return true}return this.defaultDispatchPointerDownToChildren(t)};UIWindow.prototype.onPointerDownNormal=function(t){if(this.popupWindow){this.popupWindow.onPointerDownNormal(t);this.setTarget(this.popupWindow);this.pointerDown=false;return true}return UIElement.prototype.onPointerDownNormal.call(this,t)};UIWindow.prototype.onPointerMoveNormal=function(t){if(this.popupWindow){
return this.popupWindow.onPointerMoveNormal(t)}return UIElement.prototype.onPointerMoveNormal.call(this,t)};UIWindow.prototype.onPointerUpNormal=function(t){if(this.popupWindow){return this.popupWindow.onPointerUpNormal(t)}else if(this.mode!==Shape.MODE_EDITING&&this.enable){var e=this.lastPosition.x-this.pointerDownPosition.x;var i=this.lastPosition.y-this.pointerDownPosition.y;var n=Math.abs(e);var r=Math.abs(i);if(n>20||r>20){if(n>>1>r){if(e<0){this.callOnSwipeLeftHandler()}else{this.callOnSwipeRightHandler()}}if(r>>1>n){if(i<0){this.callOnSwipeUpHandler()}else{this.callOnSwipeDownHandler()}}}}return UIElement.prototype.onPointerUpNormal.call(this,t)};UIWindow.prototype.paintSelfOnly=function(t){t.globalAlpha=this.opacity;this.clearBackground(t);this.drawBgImage(t);t.globalAlpha=1;return};UIWindow.prototype.paintSelf=function(t){if(this.mode===Shape.MODE_EDITING){UIElement.prototype.paintSelf.call(this,t)}else{t.save();this.translate(t);this.paintSelfOnly(t);this.beforePaintChildren(t);this.paintChildren(t);this.afterPaintChildren(t);t.restore()}if(this.popupWindow){this.popupWindow.paintSelf(t)}return};UIWindow.prototype.show=function(){this.setVisible(true);this.showHTML();return};UIWindow.prototype.hide=function(){this.setVisible(false);this.hideHTML();cantkHideAllInput();return};UIWindow.prototype.setCloseWhenPointerUpOutside=function(t){if(t){this.hitTest=function(t){var e=this.oldHitTest(t);if(!e){if(this.mode!=Shape.MODE_EDITING){e=Shape.HIT_TEST_MM}}return e}}else{this.hitTest=this.oldHitTest}this.closeWhenPointerUpOutside=t;return};UIWindow.prototype.isAnimationEnabled=function(){if(CantkRT.isNative()||window.cantkRTV8)return false;return this.animHint!=="none"};UIWindow.prototype.getAnimationDuration=function(t){return t?this.openAnimationDuration:this.closeAnimationDuration};UIWindow.prototype.getAnimationName=function(t){var e="";switch(this.animHint){case"fade":{e=t?"anim-fade-in":"anim-fade-out";break}case"scale":{if(this.isUIDialog){e=t?"anim-scale-show-dialog":"anim-scale-hide-dialog"}else{e=t?"anim-scale-show-win":"anim-scale-hide-win"}break}case"popup":{e=t?"anim-move-up":"anim-move-down";break}case"htranslate":{e=t?"anim-forward":"anim-backward";break}case"vtranslate":{e=t?"anim-upward":"anim-downward";break}default:{if(this.isUIDialog){e=t?"anim-scale-show-dialog":"anim-scale-hide-dialog"}else{if(isAndroid()||isFirefoxMobile()){e=t?"anim-scale-show-win":"anim-scale-hide-win"}else{e=t?"anim-forward":"anim-backward"}}break}}return e};UIWindow.prototype.isSplashWindow=function(){return this.isUINormalWindow&&this.windowType==="splash"};UIWindow.prototype.getSupportedAnimations=function(){var t=["none","default","scale","fade","popup","htranslate","vtranslate"];return t};UIWindow.prototype.clearBackground=function(t){var e=this.images.display;var i=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(i){switch(e){case UIElement.IMAGE_DISPLAY_TILE:case UIElement.IMAGE_DISPLAY_TILE_V:case UIElement.IMAGE_DISPLAY_TILE_H:case UIElement.IMAGE_DISPLAY_SCALE:case UIElement.IMAGE_DISPLAY_9PATCH:case UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO:return;default:break}if(i.width>=this.w&&i.height>=this.h){return}}if(!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};UIWindow.prototype.defaultChildrenFromJson=UIElement.prototype.childrenFromJson;UIWindow.prototype.loadChildren=function(){if(this.childrenJson){this.defaultChildrenFromJson(this.childrenJson);delete this.childrenJson;delete this.pendingLoadChildren;console.log("Now To Load Children Of "+this.name);if(this.scaleInfo){this.scaleForDensity(this.scaleInfo.sizeScale,this.scaleInfo.lcdDensity,true)}var t=this.getWindowManager();var e=t.oldConfig;var i=t.deviceConfig;if(e&&i){this.notifyDeviceConfigChanged(e,i)}}return};UIWindow.prototype.childrenFromJson=function(t){if(t.lazyLoad&&!dappIsEditorApp()){this.childrenJson=t;this.pendingLoadChildren=true;console.log("Delay To Load Children Of "+this.name)}else{delete this.pendingLoadChildren;this.defaultChildrenFromJson(t)}return};function UINormalWindow(){return}UINormalWindow.prototype=new UIWindow;UINormalWindow.prototype.isUINormalWindow=true;function UINormalWindowCreator(t){var e=["ui-window","ui-window",null,1];ShapeCreator.apply(this,e);this.createShape=function(e){var i=new UINormalWindow;i.initUIWindow(this.type,0,0,100,100,t);i.widthAttr=UIElement.WIDTH_FILL_PARENT;i.heightAttr=UIElement.HEIGHT_FILL_PARENT;i.addEventNames(["onSwipeLeft","onSwipeRight","onSwipeUp","onSwipeDown"]);return i};return}UIWindow.prototype.initStageOne=function(){this.clearAllTimeouts();this.clearAllIntervals();this.forEach(function(t){if(t.offset){t.offset=0}t.visible=t.runtimeVisible;if(t.animatingInfo){t.animatingInfo=null;t.animating=false}if(t.animations&&t.animations[t.defaultAnimationName]){console.log(t.name+" has default animation, set it invisible initially.");t.visible=false}});return};UIWindow.prototype.onInit=function(){this.initStageOne();return};UIWindow.prototype.prepareForOpen=function(){if(!this.getSavedState()){this.relayout();this.saveState()}else{this.restoreState()}this.relayout();return this};UIWindow.prototype.callOnBeforeOpen=function(t){this.show();this.init();return this.callOnBeforeOpenHandler(t)};UIWindow.prototype.callOnOpen=function(t){delete this.openPending;if(this.onOpen){try{this.onOpen(t)}catch(e){console.log("onOpen"+e.message)}}this.callOnOpenHandler(t);if(this.isSplashWindow()){var i=this;var n=i.duration?i.duration:3e3;if(window.splashWinTimeID){clearTimeout(window.splashWinTimeID);delete window.splashWinTimeID}window.splashWinTimeID=setTimeout(function(){if(i.visible){i.openWindow(null,null,true)}},n)}this.forEach(function(t){t.onWindowOpen()});return true};UIWindow.prototype.callOnClose=function(t){if(this.onClose){try{this.onClose(t)}catch(e){console.log("onClose: "+e.message)}}this.callOnCloseHandler(t);this.deinit();this.hide();if(this.destroyWhenClose){this.getWindowManager().removeChild(this,true)}this.clearAllTimeouts();this.clearAllIntervals();return true};UIWindow.prototype.callOnSwitchToBack=function(t){this.callOnSwitchToBackHandler();if(!t){this.hide()}return true};UIWindow.prototype.callOnSwitchToFront=function(t){if(this.isUINormalWindow&&(this.w!=this.parentShape.w||this.h!=this.parentShape.h)){this.relayout();console.log("WindowManager Size Changed, Relayout Current Window.")}this.show();this.callOnSwitchToFrontHandler();return true};UIWindow.prototype.setTimeout=function(t,e){if(this.mode===Shape.MODE_EDITING){console.log("Can not UIWindow.prototype.setTimeout in edit mode.");return}if(typeof t!=="function"){console.log("invalid func for UIWindow.prototype.setTimeout");return}function i(){this.timeouts.remove(n);t()}var n=window.setTimeout(i.bind(this),e);this.timeouts.push(n);return n};UIWindow.prototype.clearTimeout=function(t){window.clearTimeout(t);this.timeouts.remove(t)};UIWindow.prototype.setInterval=function(t,e){if(this.mode===Shape.MODE_EDITING){console.log("Can not UIWindow.prototype.setInterval in edit mode.");return}if(typeof t!=="function"){console.log("invalid func for UIWindow.prototype.setInterval");return}function i(){t()}var n=window.setInterval(i.bind(this),e);this.intervals.push(n);return n};UIWindow.prototype.clearInterval=function(t){window.clearInterval(t);this.intervals.remove(t)};UIWindow.prototype.clearAllIntervals=function(){var t=this.intervals;for(var e=0;e<t.length;e++){var i=t[e];window.clearInterval(i)}this.intervals.length=0};UIWindow.prototype.clearAllTimeouts=function(){var t=this.timeouts;for(var e=0;e<t.length;e++){var i=t[e];window.clearTimeout(i)}this.timeouts.length=0};UIWindow.prototype.relayout=function(){if(!this.getWindowManager().isDeviceDirectionOK()){console.log("UIWindow.prototype.relayout Reject Relayout");return}return UIElement.prototype.relayout.call(this)};ShapeFactoryGet().addShapeCreator(new UINormalWindowCreator(null));function UIDialog(){return}UIDialog.prototype=new UIWindow;UIDialog.prototype.isUIDialog=true;UIDialog.prototype.isUIPopupWindow=true;function UIDialogCreator(t,e,i){var n=["ui-dialog","ui-dialog",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIDialog;r.initUIWindow(this.type,0,0,t,e,i);r.setMargin(8,8);r.xAttr=UIElement.X_CENTER_IN_PARENT;r.yAttr=UIElement.Y_MIDDLE_IN_PARENT;r.images.display=UIElement.IMAGE_DISPLAY_SCALE;r.setAnimHint("scale");return r};return}ShapeFactoryGet().addShapeCreator(new UIDialogCreator(600,400,null));function UIEdit(){return}UIEdit.prototype=new UIElement;UIEdit.prototype.isUIEdit=true;UIEdit.prototype.initUIEdit=function(t,e,i,n,r,o,a,s){this.initUIElement(t);this.setDefSize(e,i);this.setText(o);this.leftMargin=n;this.rightMargin=r;this.setSizeLimit(60,30,1e3,80);this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,a);this.setImage(UIElement.IMAGE_FOCUSED,s);this.setMargin(5,5);this.setInputType("text");this.addEventNames(["onChanged","onChanging","onFocusIn","onFocusOut"]);this.setTextAlignV("middle");this.setTextAlignH("left");return this};UIEdit.prototype.shapeCanBeChild=function(t){if(t.isUIButton){return true}return false};UIEdit.prototype.textEditable=function(t){return true};UIEdit.prototype.getLocaleText=function(t){if(t===" "){return t}if(this.inputType==="password"&&t&&t===this.text){var e="";var i=t.length;for(var n=0;n<i;n++){e=e+"*"}return e}else{return t}};UIEdit.prototype.drawText=function(t){var e=this.h>>1;var i=this.leftMargin;var n=this.getLocaleText(this.text);var r=this.w-i-this.rightMargin;var o=this.inputTips;if(!n&&!o||this.editing){return}t.save();t.font=this.style.getFont();if(n){t.fillStyle=this.style.textColor}else{n=o;t.fillStyle="#E0E0E0"}t.beginPath();t.rect(0,0,this.w-this.rightMargin,this.h);t.clip();t.textAlign="left";t.textBaseline="middle";t.fillText(n,i,e);t.restore();return};UIEdit.prototype.paintSelfOnly=function(t){var e=this.getBgImage();if(e){return}t.beginPath();drawRoundRect(t,this.w,this.h,8);t.fillStyle=this.style.fillColor;t.fill();t.strokeStyle=this.style.lineColor;t.lineWidth=this.isFocused()?4:2;t.stroke();return};UIEdit.prototype.onClick=function(t,e){if(e){return}if(this.mode!==Shape.MODE_EDITING){this.editText()}return};UIEdit.prototype.getWidth=function(t){var e=this.w;if(t){e=e-this.leftMargin-this.rightMargin}return e};UIEdit.prototype.getEditorRect=function(){var t=this.getPositionInView();var e=this.view.getAbsPosition();var i=this.view.getViewScale();var n=e.x;var r=e.y;var o=t.y*i+r;if(isMobile()){var a=t.x*i+n;var s=this.getWidth()*i}else{var a=(t.x+this.leftMargin)*i+n;var s=this.getWidth(true)*i}var l=this.getHeight()*i;var h={};i=UIElement.getMainCanvasScale();h.x=a/i.x;h.y=o/i.y;h.w=Math.max(60,s)/i.x;h.h=l/i.y;return h};UIEdit.prototype.editText=function(t){var e=this;if(this.textType&&this.textEditable(t)){var i=this;var n=this.getText();var r=this.getEditorRect();var o=this.getRealScale()/UIElement.getMainCanvasScale().y;var a=this.inputType?this.inputType:"text";var s=this.style.fontSize*o;var l=cantkShowInput(a,s,n,r.x,r.y,r.w,r.h);i.editing=true;function h(t){if(t!==i.text){i.setText(t,true);i.postRedraw()}else{i.text=t}l.setOnChangedHandler(null);l.setOnChangeHandler(null);l.hide();delete i.editing;i.callOnFocusOutHandler();return}function u(t){i.callOnChangingHandler(t)}l.setOnChangedHandler(h);l.setOnChangeHandler(u);this.callOnFocusInHandler()}return};UIEdit.prototype.drawTextTips=function(t){};function UIEditCreator(t,e,i,n,r,o){var a=["ui-edit","ui-edit",null,1];ShapeCreator.apply(this,a);this.createShape=function(a){var s=new UIEdit;return s.initUIEdit(this.type,t,e,i,n,dappGetText("Edit"),r,o)};return}ShapeFactoryGet().addShapeCreator(new UIEditCreator(120,50,12,12,null,null));function UIGauge(){return}UIGauge.prototype=new UIElement;UIGauge.prototype.isUIGauge=true;UIGauge.IMAGE_POINTER="pointer-image";UIGauge.prototype.initUIGauge=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onInit"]);return this};UIGauge.prototype.shapeCanBeChild=function(t){return t.isUILedDigits||t.isUILabel||t.isUIGaugePointer};UIGauge.prototype.afterChildAppended=function(t){var e=20;var i=0;if(t.isUIGaugePointer){t.xAttr=UIElement.X_CENTER_IN_PARENT;t.yAttr=UIElement.Y_MIDDLE_IN_PARENT}for(var n=0;n<this.children.length;n++){var r=this.children[n];if(!r.isUIGaugePointer){continue}switch(i){case 0:{e=100;break}case 1:{e=70;break}case 2:{e=40;break}}i=i+1;r.setSizeLimit(e,e,e,e,1);r.setSize(e,e)}this.setSizeLimit(100,100,1e3,1e3,1);return};UIGauge.prototype.paintSelfOnly=function(t){return};function UIGaugeCreator(){var t=["ui-gauge","ui-gauge",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGauge;return e.initUIGauge(this.type,200,200)};return}function UIGaugePointer(){return}UIGaugePointer.prototype=new UIElement;UIGaugePointer.prototype.isUIGaugePointer=true;UIGaugePointer.prototype.initUIGaugePointer=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIGauge.IMAGE_POINTER,null);this.value=0;this.minAngle=0;this.maxAngle=360;this.minValue=0;this.maxValue=60;return this};UIGaugePointer.prototype.shapeCanBeChild=function(t){return false};UIGaugePointer.prototype.setText=function(t){t=this.toText(t?t:0);try{this.setValue(parseInt(t))}catch(e){console.log("UIGaugePointer.prototype.setText:"+e.message)}return this};UIGaugePointer.prototype.getText=function(){return this.getValue()+""};UIGaugePointer.prototype.setValue=function(t){if(t>=this.minValue&&t<=this.maxValue){this.value=t}else{console.log("UIGaugePointer.prototype.setValue: Out Of Range.")}return this};UIGaugePointer.prototype.getValue=function(){return this.value};UIGaugePointer.prototype.animSetValue=function(t,e){return this.animSetValue(t,e)};UIGaugePointer.prototype.animateSetValue=function(t,e){if(t<this.minValue){t=this.minValue}if(t>this.maxValue){t=this.maxValue}var i=this;var n=t;var r=this.getValue();var o=t-r;var a=Math.abs(o*(this.maxAngle-this.minAngle)/(this.maxValue-this.minValue));if(a<5){this.setValue(t);return}var s=(new Date).getTime();var l=e&&e=="slow"?1e3:500;function h(){var t=new Date;var e=(t.getTime()-s)/l;if(e<1){var a=r+o*e;i.setValue(a);setTimeout(h,10)}else{delete s;i.setValue(n)}delete t;i.postRedraw()}h();return};UIGaugePointer.prototype.getAngle=function(t){var e=this.maxAngle-this.minAngle;var i=this.maxValue-this.minValue;var n=this.value/i*e+this.minAngle;n=Math.PI*(n/180);return n};UIGaugePointer.prototype.paintSelfOnly=function(t){var e=0;var i=0;var n=this.w;var r=this.h;var o=this.getAngle();var a=this.getHtmlImageByType(UIGauge.IMAGE_POINTER);if(a&&a.width){var s=a.width;var l=a.height;t.translate(n/2,r/2);t.rotate(o);t.translate(-n/2,-r/2);e=(n-s)/2;i=(r-l)/2;t.drawImage(a,e,i)}else{t.fillRect(0,0,this.w,this.h)}return};function UIGaugePointerCreator(){var t=["ui-gauge-pointer","ui-gauge-pointer",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGaugePointer;return e.initUIGaugePointer(this.type,20,200)};return}ShapeFactoryGet().addShapeCreator(new UIGaugePointerCreator);ShapeFactoryGet().addShapeCreator(new UIGaugeCreator);function UIHtml(){return}UIHtml.prototype=new UIElement;UIHtml.prototype.isUIHtml=true;UIHtml.prototype.initUIHtml=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);return this};UIHtml.prototype.shapeCanBeChild=function(t){return false};UIHtml.prototype.drawBgImage=function(t){if(this.mode===Shape.MODE_EDITING||this.isIcon){var e=this.getBgImage();if(e){var i=e.getImage();var n=e.getImageRect();this.drawImageAt(t,i,this.images.display,0,0,this.w,this.h,n)}else{t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}}return};UIHtml.prototype.setVisible=function(t){if(this.visible!=t){if(t){this.onShowHTML()}else{this.onHideHTML()}this.visible=t}return this};UIHtml.prototype.showHTMLElement=function(){var t=this.element;if(t){var e=this.getRealScale();var i=this.getPositionInView();var n=i.x*e+this.view.getX();var r=i.y*e+this.view.getY();var o=this.w*e;var a=this.h*e;UIElement.getMainCanvasScale(true);var s=UIElement.canvasScale.x;var l=UIElement.canvasScale.y;n/=s;r/=l;t.style.position="absolute";t.style.left=n+"px";t.style.top=r+"px";t.style.width=o/s+"px";t.style.height=a/l+"px";t.style.visibility="visible";this.htmlVisible=true}return};UIHtml.prototype.createHTMLElement=function(t){var e=null;if(!this.element){e=document.createElement(t);e.id=this.type+this.name;document.body.appendChild(e);this.element=e}return this.element};UIHtml.prototype.beforeShowHTML=function(){};UIHtml.prototype.setScrollable=function(t){this.scrollable=t;return};UIHtml.prototype.onSetElementStyle=function(){var t=Math.floor(this.scaleForCurrentDensity(14));this.element.style.fontSize=t+"px";this.element.style.marginLeft="0px";this.element.style.marginTop="0px";this.element.style.marginBottom="0px";this.element.style.marginRight="0px";return};UIHtml.prototype.onShowHTML=function(){this.reload()};UIHtml.prototype.reload=function(){this.createHTMLElement("div");this.element.innerHTML=this.getHtmlContent();this.element.style.overflow=this.scrollable?"scroll":"hidden";this.element.style.zIndex=5;this.element.style["-ms-touch-action"]="auto";this.onSetElementStyle();if(this.mode!=Shape.MODE_EDITING){this.beforeShowHTML();this.showHTMLElement()}return};UIHtml.prototype.beforeHideHTML=function(){};UIHtml.prototype.onHideHTML=function(){this.htmlVisible=false;if(this.element){this.beforeHideHTML();this.element.style.visibility="hidden"}return};UIHtml.prototype.getValue=function(){return this.value};UIHtml.prototype.setValue=function(t){this.value=t;return this};UIHtml.prototype.setHtmlContent=function(t){this.htmlContent=t;if(this.element){this.element.innerHTML=t}return this};UIHtml.prototype.getHtmlContent=function(){return this.htmlContent};function UIHtmlCreator(t,e){var i=["ui-html","ui-html",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIHtml;return n.initUIHtml(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIHtmlCreator);function UIVideo(){return}UIVideo.prototype=new UIHtml;UIVideo.prototype.isUIVideo=true;UIVideo.prototype.getHtmlContent=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=this.value?this.value:"";var n=this.loop?'loop="loop" ':"";var r=this.autoPlay?'autoplay="true" ':"";var o=this.showControls?'controls="controls" ':"";var a='<video width="'+t+'" height="'+e+'" preload="true" '+o+n+r+'src="'+i+'"></video>';return a};UIVideo.prototype.beforeHideHTML=function(){video=this.getVideoElement();if(video.src&&!video.puased){video.pause()}return};UIVideo.prototype.getVideoElement=function(){if(this.element){var t=this.element.getElementsByTagName("video");return t.length?t[0]:null}return null};UIVideo.prototype.setShowControls=function(t){this.showControls=t;return};UIVideo.prototype.isShowControls=function(){return this.showControls};UIVideo.prototype.setLoop=function(t){this.loop=t;return};UIVideo.prototype.isLoop=function(){return this.loop};UIVideo.prototype.setAutoPlay=function(t){this.autoPlay=t;return};UIVideo.prototype.isAutoPlay=function(){return this.autoPlay};UIVideo.prototype.initUIVideo=function(t){this.initUIHtml(t,400,300);this.setValue("http://www.w3school.com.cn/i/movie.ogg");this.setImage(UIElement.IMAGE_DEFAULT,null);return this};function UIVideoCreator(){var t=["ui-video","ui-video",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIVideo;return e.initUIVideo(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIVideoCreator);function UIFlash(){return}UIFlash.prototype=new UIHtml;UIFlash.prototype.isUIFlash=true;UIFlash.prototype.getHtmlContent=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=this.value?this.value:"";var n='<object type="application/x-shockwave-flash" width="'+t+'" height="'+e+'"> <param name="movie" value="'+i+'" /> <param name="quality" value="high" /></object>';return n};UIFlash.prototype.initUIFlash=function(t){this.initUIHtml(t,400,300);this.setValue("test/5.swf");this.setImage(UIElement.IMAGE_DEFAULT,null);return this};function UIFlashCreator(){var t=["ui-flash","ui-flash",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFlash;return e.initUIFlash(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIFlashCreator);function UIHtmlImage(){return}UIHtmlImage.prototype=new UIHtml;UIHtmlImage.prototype.isUIHtmlImage=true;UIHtmlImage.prototype.getHtmlContent=function(){var t=this.getRealScale();var e=Math.round(t*this.w);var i=Math.round(t*this.h);var n=this.getImageSrcByType(UIElement.IMAGE_DEFAULT);var r='<img src="'+n+'" width='+e+" height="+i+">";return r};UIHtmlImage.prototype.initUIHtmlImage=function(t){this.initUIHtml(t,400,300);this.setImage(UIElement.IMAGE_DEFAULT,null);return this};function UIHtmlImageCreator(){var t=["ui-html-image","ui-html-image",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIHtmlImage;return e.initUIHtmlImage(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIHtmlImageCreator);function UITips(){return}UITips.prototype=new UIElement;UITips.prototype.isUITips=true;UITips.prototype.initUITips=function(t,e){this.initUIElement(t);this.roundRadius=8;this.setDefSize(200,200);this.setClickable(true);this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,e);this.pointerDirection=UITips.BOTTOM;this.pointerOffset=1;this.pointer={x:0,y:0};this.setMargin(20,20);this.setSizeLimit(80,80);this.autoAdjustHeight=true;return this};UITips.TOP=0;UITips.LEFT=1;UITips.RIGHT=2;UITips.BOTTOM=3;UITips.prototype.getPointer=function(){var t=0;var e=0;var i=this.roundRadius+this.hMargin*2;var n=this.roundRadius+this.vMargin*2;switch(this.pointerDirection){case UITips.TOP:case UITips.BOTTOM:{t=this.pointerOffset*this.w;t=Math.max(t,i);t=Math.min(t,this.w-i);e=this.pointerDirection===UITips.TOP?0:this.h;break}case UITips.LEFT:case UITips.RIGHT:{e=this.pointerOffset*this.h;e=Math.max(e,n);e=Math.min(e,this.h-n);t=this.pointerDirection===UITips.LEFT?0:this.w;break}}return{x:t,y:e}};UITips.prototype.getMoreSelectMark=function(t,e){if(t===Shape.HIT_TEST_HANDLE){e.x=this.pointer.x;e.y=this.pointer.y;return true}return false};UITips.prototype.moveHandle=function(t,e){var i=.5*this.w;var n=.5*this.h;var r=this.roundRadius+this.hMargin;var o=this.pointer;o.x+=t;o.y+=e;var a=o.x>=0?o.x:0;a=a<this.w?a:this.w;var s=o.y>=0?o.y:0;s=s<this.h?s:this.h;if(o.y<r){this.pointerOffset=a/this.w;this.pointerDirection=UITips.TOP}else if(o.y<this.h-r){this.pointerOffset=s/this.h;this.pointerDirection=o.x<i?UITips.LEFT:UITips.RIGHT}else{this.pointerOffset=a/this.w;this.pointerDirection=UITips.BOTTOM}this.pointer=o;return};UITips.prototype.setAutoAdjustHeight=function(t){this.autoAdjustHeight=t;return true};UITips.prototype.setClickable=function(t){this.clickable=t;return};UITips.prototype.drawPath=function(t){var e=this.hMargin/2;var i=this.vMargin/2;var n=this.getWidth(true)+this.hMargin;var r=this.getHeight(true)+this.vMargin;var o=this.getPointer();var a=o.x;var s=o.y;var l=this.hMargin*.75;var h=this.roundRadius;var u=e+n-h;var p=i+r-h;var c=e+n;var f=i+r;if(s<=i&&(a>e&&a<c)){s=0;if(a<e+h+l){a=e+h+l}t.moveTo(a-l,i);t.lineTo(a,s);t.lineTo(a+l,i);t.lineTo(u,i);t.arc(u,i+h,h,1.5*Math.PI,2*Math.PI,false);t.lineTo(c,p);t.arc(u,p,h,0,.5*Math.PI,false);t.lineTo(e+h,f);t.arc(e+h,p,h,.5*Math.PI,Math.PI,false);t.lineTo(e,h+i);t.arc(e+h,i+h,h,Math.PI,1.5*Math.PI,false);t.lineTo(a-l,i)}else if(s>i&&(a>e&&a<c)){s=this.h;if(a<e+h+l){a=e+h+l}t.moveTo(e+h,i);t.arc(u,i+h,h,1.5*Math.PI,2*Math.PI,false);t.lineTo(c,p);t.arc(u,p,h,0,.5*Math.PI,false);t.lineTo(a+l,f);t.lineTo(a,s);t.lineTo(a-l,f);t.arc(e+h,p,h,.5*Math.PI,Math.PI,false);t.lineTo(e,h+i);t.arc(e+h,i+h,h,Math.PI,1.5*Math.PI,false)}else if(a<=e&&(s>i&&s<f)){a=0;if(s<i+h+l){s=i+h+l}t.moveTo(e+h,i);t.arc(u,i+h,h,1.5*Math.PI,2*Math.PI,false);t.lineTo(c,p);t.arc(u,p,h,0,.5*Math.PI,false);t.lineTo(e+h,f);t.arc(e+h,p,h,.5*Math.PI,Math.PI,false);t.lineTo(e,s+l);t.lineTo(a,s);t.lineTo(e,s-l);t.lineTo(e,h+i);t.arc(e+h,i+h,h,Math.PI,1.5*Math.PI,false)}else if(a>e&&(s>i&&s<f)){a=this.w;if(s<i+h+l){s=i+h+l}t.moveTo(e+h,i);t.arc(u,i+h,h,1.5*Math.PI,2*Math.PI,false);t.lineTo(c,s-l);t.lineTo(a,s);t.lineTo(c,s+l);t.lineTo(c,p);t.arc(u,p,h,0,.5*Math.PI,false);t.lineTo(e+h,f);t.arc(e+h,p,h,.5*Math.PI,Math.PI,false);t.lineTo(e,h+i);t.arc(e+h,i+h,h,Math.PI,1.5*Math.PI,false)}return};UITips.prototype.paintSelfOnlyByColor=function(t){t.beginPath();this.drawPath(t);if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fill()}if(!this.isStrokeColorTransparent()){t.strokeStyle=this.style.lineColor;t.lineWidth=this.pointerDown&&this.clickable?4:2;t.stroke()}return};UITips.prototype.paintSelfOnly=function(t){if(this.autoAdjustHeight&&(!this.children||!this.children.length)){var e=this.getTextHeight();this.h=e+this.vMargin*2+this.style.fontSize}var i=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!i){this.paintSelfOnlyByColor(t)}return};UITips.prototype.shapeCanBeChild=function(t){return t.isUIButton||t.isUIGroup||t.isUILabel||t.isUIImage};function UITipsCreator(){var t=["ui-tips","ui-tips",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITips;return e.initUITips(this.type,null)};return}ShapeFactoryGet().addShapeCreator(new UITipsCreator);function UIImageView(){return}UIImageView.prototype=new UIElement;UIImageView.prototype.isUIImageView=true;UIImageView.cachedImages={};UIImageView.IMAGE_STATE_PENDING=0;UIImageView.IMAGE_STATE_ERROR=1;UIImageView.IMAGE_STATE_DONE=2;imageViewInitCustomProp=function(t){};imageThumbViewInitCustomProp=function(t){};imageAnimationInitCustomProp=function(t){};imageSlideViewInitCustomProp=function(t){};UIImageView.prototype.imageViewToJson=function(t){t.userImages=this.getImages();return t};UIImageView.prototype.imageViewFromJson=function(t){this.cacheInvalid=true;if(t.userImages){this.userImages=[];var e=t.userImages.split("\n");var i=e.length;for(var n=0;n<i;n++){var r="image_"+(n+1);var o=this.getImageSrcByType(r);if(o&&o.length>4){this.userImages.push(o)}}}return};UIImageView.prototype.initUIImageView=function(t,e){this.setDefSize(t,e);this.userImages=[];this.onSized=UIImageView.prototype.onSized;this.afterRelayout=UIImageView.prototype.afterRelayout;this.setImages=UIImageView.prototype.setImages;this.getImages=UIImageView.prototype.getImages;this.setValue=UIImageView.prototype.setValue;this.getValue=UIImageView.prototype.getValue;this.ensureImages=UIImageView.prototype.ensureImages;this.addUserImage=UIImageView.prototype.addUserImage;this.imageViewToJson=UIImageView.prototype.imageViewToJson;this.imageViewFromJson=UIImageView.prototype.imageViewFromJson;this.onScaleForDensityDone=UIImageView.prototype.onScaleForDensityDone;imageViewInitCustomProp(this);this.regSerializer(this.imageViewToJson,this.imageViewFromJson);return this};UIImageView.createImage=function(t,e){var i=UIImageView.cachedImages[t];if(!i){i=new Image;i.src=t;i.onLoadDoneListeners=[];function n(t,e){if(!t||!t.onLoadDoneListeners){return}for(var i=0;i<t.onLoadDoneListeners.length;i++){var n=t.onLoadDoneListeners[i];n(t,e)}t.onLoadDoneListeners.clear();return}i.onload=function(t){n(this,true);this.loaded=true};i.onabort=function(t){n(this,false);this.failed=true;console.log("load "+this.src+" failed.")};i.onerror=function(t){n(this,false);this.failed=true;console.log("load "+this.src+" failed.")}}else{console.log("Create Image From Cache: "+t)}if(e){if(i.loaded){e(i,true)}else if(i.failed){e(i,false)}else{i.onLoadDoneListeners.push(e)}}return i};UIImageView.drawImageAtCenter=function(t,e,i,n,r,o,a,s){if(s){t.fillStyle=s;t.fillRect(i,n,r,o)}else{t.clearRect(i,n,r,o)}if(e&&e.width>0){var l=r;var h=o;var u=e.width;var p=e.height;var c=e.width;var f=e.height;if(a){var m=l/c;var d=h/f;if(m<d){u=Math.min(c,l/d)}else{p=Math.min(f,h/m)}}t.drawImage(e,0,0,u,p,i,n,l,h)}return};UIImageView.prototype.ensureImages=function(){if(!this.cacheInvalid){return}var t=this;function e(e,i){t.postRedraw();return}this.cachedImages=[];for(var i=0;i<this.userImages.length;i++){var n=this.userImages[i];var r=UIImageView.createImage(n,e);this.cachedImages.push(r)}delete this.cacheInvalid;return};UIImageView.prototype.afterRelayout=function(){this.cacheInvalid=true;return};UIImageView.prototype.onSized=function(){this.cacheInvalid=true;return};UIImageView.prototype.onScaleForDensityDone=function(){this.cacheInvalid=true;return};UIImageView.prototype.addUserImage=function(t){this.cacheInvalid=true;this.userImages.push(t);var e="image_"+this.userImages.length;this.setImage(e,t);return};UIImageView.prototype.getCurrentImage=function(){return this.curentImage};UIImageView.prototype.getValue=function(){var t=this.getCurrentImage();return t?t.src:null};UIImageView.prototype.setValue=function(t){return this};UIImageView.prototype.setImages=function(t){var e=this.images.display;var i=t.split("\n");this.userImages=[];this.images={};this.images.display=e;for(var n=0;n<i.length;n++){var r=i[n];if(r){this.addUserImage(r)}}return};UIImageView.prototype.getImages=function(){var t="";var e=location.protocol+"//"+location.host+"/";for(var i=0;i<this.userImages.length;i++){var n=this.userImages[i];n=n.replace(e,"");t=t+n+"\n"}return t};function UIScrollView(){return this}UIScrollView.prototype=new UIElement;UIScrollView.prototype.isUIScrollView=true;UIScrollView.prototype.afterChildAppended=function(t){t.setCanRectSelectable(false,true);return true};UIScrollView.prototype.initUIScrollView=function(t,e,i){this.initUIElement(t);this.offset=0;this.scrollBarOpacity=0;this.setMargin(e,e);this.setSizeLimit(100,100,2e3,2e3);this.setDefSize(300+2*e,300+2*e);this.velocityTracker=new VelocityTracker;this.interpolator=new DecelerateInterpolator(2);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.heightAttr=UIElement.HEIGHT_FILL_PARENT;this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,i);this.setScrollable("always");if(!i){this.style.setFillColor("#f0f0f0")}this.setCanRectSelectable(false,true);return this};UIScrollView.prototype.setScrollable=function(t){this.scrollable=t;return};UIScrollView.prototype.fixChildSize=function(t){if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.w=this.getWidth(true)}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.h=this.getHeight(true)}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT&&t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.setUserMovable(false);t.setUserResizable(false)}return};UIScrollView.prototype.shapeCanBeChild=function(t){if(t.isUIButton||t.isUIGroup||t.isUILabel||t.isUIImage||t.isUIList||t.isUIGrid||t.isUIProgressBar||t.isUICheckBox||t.isUIRadioBox||t.isUIWaitBar||t.isUIButtonGroup||t.isUITips||t.isUIGroup){return true}return false};UIScrollView.prototype.onModeChanged=function(){this.offset=0;return};UIScrollView.prototype.scrollTo=function(t){this.offset=Math.round(t);return};UIScrollView.prototype.scrollDelta=function(t){var e=this.offset+t;this.scrollTo(e);return};UIScrollView.prototype.scrollToPageDelta=function(t){var e=Math.floor(this.offset/this.w)+t;this.scrollToPage(e);return};UIScrollView.prototype.scrollToPage=function(t){if(t<0){t=0}var e=this.w*t;var i=this.offset-e;this.animScrollTo(i,300);return};UIScrollView.prototype.isEventHandledByChild=function(){var t=UIElement.lastEvent.status;if(this.isUIVScrollView){return t&UIElement.EVENT_VSCROLL_HANDLED}else{return t&UIElement.EVENT_HSCROLL_HANDLED}};UIScrollView.prototype.setEventHandled=function(){var t=this.isUIVScrollView?UIElement.EVENT_VSCROLL_HANDLED:UIElement.EVENT_HSCROLL_HANDLED;this.setLastEventStatus(t);return this};UIScrollView.prototype.onPointerDownRunning=function(t,e){if(e){return}if(this.isEventHandledByChild()){return}this.setEventHandled();this.velocityTracker.clear();return};UIScrollView.prototype.onDrag=function(t){return};UIScrollView.prototype.isScrollable=function(){
if(this.scrollable==="always"){return true}else if(this.scrollable==="never"){return false}else{var t=this.getScrollRange();var e=this.getPageSize();return t>e}};UIScrollView.prototype.onPointerMoveRunning=function(t,e){if(e||!this.isScrollable()){return}if(this.isEventHandledByChild()){return}this.setEventHandled();this.scrollBarOpacity=0;var i=this.getScrollDelta(t);if(this.pointerDown&&this.needScroll(t)){this.scrollBarOpacity=1;this.scrollDelta(-i)}this.addMovementForVelocityTracker();this.onDrag(this.offset);return};UIScrollView.prototype.animScrollTo=function(t,e){var i=this;var n=new Date;var r=n.getTime();var o=this.offset;var a=o-t;var s=this.getScrollRange();var l=this.getPageSize();e=e<400?400:e;if(a<0){e=600;t=o}if(this.mode!=Shape.MODE_EDITING){if(a>s-l){t=o-(s-l)}}if(s<=l){a=0;t=o}function h(){var n=new Date;var a=n.getTime();var s=(a-r)/e;var l=i.interpolator.get(s);var u=o-t*Math.min(l,1);if(s<1&&!i.pointerDown){setTimeout(h,5);i.scrollTo(u);i.scrollBarOpacity=1-l}else{var u=o-t;i.scrollBarOpacity=0;i.scrollTo(u)}i.postRedraw();return}setTimeout(h,5);return};UIScrollView.prototype.whenScrollOutOfRange=function(t){return};UIScrollView.prototype.onPointerUpRunning=function(t,e){if(e||!this.isScrollable()){return}if(this.isEventHandledByChild()){return}this.setEventHandled();var i=this.getScrolledSize();if(!this.needScroll(t)){this.scrollBarOpacity=0;return}var n=0;var r=0;var o=this.getVelocity();var a=this.getPageSize();var s=o/a;var l=.5*a*s*s;r=Math.abs(l);n=2*r/o;r=i<0?-r:r;n=Math.abs(n);if(n>3){n=3}var h=this.offset;var u=h-r;var p=this.offset;var c=p+this.h;var f=this.getScrollRange();if(p<0){this.whenScrollOutOfRange(p)}else if(c>f){this.whenScrollOutOfRange(c-f)}this.animScrollTo(r,n*1e3);return true};UIScrollView.prototype.paintSelfOnly=function(t){return};function UIHScrollView(){return}UIHScrollView.prototype=new UIScrollView;UIHScrollView.prototype.isUIHScrollView=true;UIHScrollView.prototype.initUIHScrollView=function(t,e,i){this.initUIScrollView(t,e,i);this.setSizeLimit(100,40,2e3,2e3);return this};UIHScrollView.prototype.needScroll=function(t){var e=Math.abs(this.getMoveAbsDeltaX());var i=Math.abs(this.getMoveAbsDeltaY());return e>20&&e>i||e>20&&this.mode!=Shape.MODE_EDITING};UIHScrollView.prototype.getScrolledSize=function(){return Math.floor(this.getMoveAbsDeltaX())};UIHScrollView.prototype.getScrollDelta=function(t){return Math.floor(this.getMoveDeltaX())};UIHScrollView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().x};UIHScrollView.prototype.getPageSize=function(){return this.w};UIHScrollView.prototype.onPointerUpRunning=function(t,e){if(e){return}if(this.isEventHandledByChild()){return}this.setEventHandled();var i=0;var n=this.getVelocity();var r=this.getScrolledSize();var o=Math.abs(r);if(o>this.w/4||n>this.w){if(r<0){i=1}else{i=-1}}this.scrollToPageDelta(i);return true};UIHScrollView.prototype.translatePoint=function(t){var e={x:t.x-this.left+this.offset,y:t.y-this.top};return e};UIHScrollView.prototype.getScrollRange=function(){var t=0;var e=this.calcChildrenRange();t=e.r-e.l;if(t<this.w){t=this.w}t=Math.ceil(t/this.w)*this.w;return t};UIHScrollView.prototype.fixChildPosition=function(t){if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.left=this.offset+this.hMargin;t.widthAttr=UIElement.WIDTH_SCALE}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.top=this.vMargin}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT&&t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.setUserMovable(false)}return};UIHScrollView.prototype.paintChildren=function(t){var e=null;var i=this.offset;var n=this.offset+this.w;t.save();t.beginPath();t.rect(0,0,this.w,this.h);t.closePath();t.clip();t.beginPath();t.translate(-this.offset,0);for(var r=0;r<this.children.length;r++){e=this.children[r];if(!e.visible){continue}if(e.left+e.w<i||e.left>n){continue}this.beforePaintChild(e,t);e.paintSelf(t);this.afterPaintChild(e,t)}this.paintTargetShape(t);t.restore();return};function UIHScrollViewCreator(t,e){var i=["ui-h-scroll-view","ui-h-scroll-view",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIHScrollView;return n.initUIHScrollView(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIHScrollViewCreator(0,null));function UIVScrollView(){return}UIVScrollView.prototype=new UIScrollView;UIVScrollView.prototype.isUIVScrollView=true;UIVScrollView.prototype.initUIVScrollView=function(t,e,i,n){this.initUIScrollView(t,e,i);this.setSizeLimit(40,100,2e3,2e3);this.setImage("scrollBarImg",n);this.rectSelectable=false;return this};UIVScrollView.prototype.needScroll=function(t){var e=Math.abs(this.getMoveAbsDeltaX());var i=Math.abs(this.getMoveAbsDeltaY());return i>50&&i>e||i>50&&this.mode!=Shape.MODE_EDITING};UIVScrollView.prototype.getScrolledSize=function(){return Math.floor(this.getMoveAbsDeltaY())};UIVScrollView.prototype.getScrollDelta=function(t){return Math.floor(this.getMoveDeltaY())};UIVScrollView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().y};UIVScrollView.prototype.getPageSize=function(){return this.h};UIVScrollView.prototype.translatePoint=function(t){var e={x:t.x-this.left,y:t.y-this.top+this.offset};return e};UIVScrollView.prototype.getScrollRange=function(){var t=0;var e=this.calcChildrenRange();t=e.b;if(t<this.h){t=this.h}var i=this.mode===Shape.MODE_EDITING?this.h:10;t=Math.ceil(t/i)*i;return t};UIVScrollView.prototype.fixChildPosition=function(t){if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.left=this.hMargin}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.top=this.offset+this.vMargin;t.heightAttr=UIElement.HEIGHT_SCALE}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT&&t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.setUserMovable(false)}return};UIVScrollView.prototype.paintChildren=function(t){var e=null;var i=this.offset;var n=this.offset+this.h;t.save();t.beginPath();t.rect(this.getHMargin(),this.getVMargin(),this.getWidth(true),this.getHeight(true));t.closePath();t.clip();t.beginPath();t.translate(0,-this.offset);for(var r=0;r<this.children.length;r++){e=this.children[r];if(!e.visible){continue}if(e.top+e.h<i||e.top>n){continue}this.beforePaintChild(e,t);e.paintSelf(t);this.afterPaintChild(e,t)}this.paintTargetShape(t);t.restore();return};UIVScrollView.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);return};UIVScrollView.prototype.drawScrollBar=function(t){var e=this.getHtmlImageByType("scrollBarImg");if(!this.scrollBarOpacity||!e){return}var i=this.getScrollRange();var n=this.w-e.width-2;var r=e.width;var o=this.h*this.h/i;var a=this.offset/i*this.h;if(a+o>this.h){o=this.h-a;a=this.h-o}if(a<0){o=o+a;a=0}t.save();t.globalAlpha=this.scrollBarOpacity;drawNinePatchEx(t,e,0,0,e.width,e.height,n,a,r,o);t.restore();return};function UIVScrollViewCreator(t,e,i){var n=["ui-v-scroll-view","ui-v-scroll-view",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIVScrollView;return r.initUIVScrollView(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIVScrollViewCreator(0,null,null));function UIVScrollViewGeneral(){return}UIVScrollViewGeneral.prototype=new UIVScrollView;UIVScrollViewGeneral.prototype.isUIList=true;UIVScrollViewGeneral.prototype.isUILayout=true;UIVScrollViewGeneral.prototype.isUIVScrollViewGeneral=true;UIVScrollViewGeneral.prototype.sortChildren=UIList.prototype.sortChildren;UIVScrollViewGeneral.prototype.initUIVScrollViewGeneral=function(t){this.initUIVScrollView(t,0,null,null);this.setTextType(Shape.TEXT_NONE);return this};UIVScrollViewGeneral.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.getVMargin();var i=this.children.length;var n=e;for(var r=0;r<i;r++){var o=this.children[r];if(!o.visible){continue}o.yAttr=UIElement.Y_FIX_TOP;o.heightAttr=UIElement.HEIGHT_FIX;o.relayout();o.top=n;n+=o.h}return};UIVScrollViewGeneral.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);if(this.mode===Shape.MODE_EDITING){this.drawPageDownUp(t)}return};function UIVScrollViewGeneralCreator(){var t=["ui-g-scroll-view","ui-g-scroll-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIVScrollViewGeneral;return e.initUIVScrollViewGeneral(this.type)};return}function UIShortcut(){return}UIShortcut.prototype=new UIElement;UIShortcut.prototype.isUIShortcut=true;UIShortcut.prototype.initUIShortcut=function(t){this.initUIElement(t);this.setText("#ABCDEFGHIJKLMNOPQRSTUVYWXYZ");this.setDefSize(200,200);this.setMargin(5,5);this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onChanged"]);return this};UIShortcut.prototype.shapeCanBeChild=function(t){return false};UIShortcut.prototype.drawText=function(t){var e=this.text;var i=e.length;if(!i){return}t.textBaseline="middle";t.textAlign="center";t.font=this.style.getFont();var n=this.w>>1;var r=this.vMargin;var o=this.getWidth(true);var a=this.getHeight(true)/i;var s=a>>1;t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;for(var l=0;l<e.length;l++){var h=e[l];if(this.currentItem===l){t.rect(0,r,this.w,a);if(this.pointerDown){t.fillStyle=this.style.fillColor;t.fill()}t.stroke()}t.fillStyle=this.style.textColor;t.fillText(h,n,r+s);r+=a}return};UIShortcut.prototype.findItemByPoint=function(t){var e=this.text;var i=this.vMargin;var n=this.getHeight(true);var r=Math.floor(e.length*(t.y-i)/n);return r};UIShortcut.prototype.changeItemByPoint=function(t){var e=this.text;var i=this.findItemByPoint(t);if(i>=0&&i<e.length){var n=e[i];if(this.currentItem!=i){this.callOnChangedHandler(n);this.currentItem=i}}return};UIShortcut.prototype.setValue=function(t){var e=this.text.indexOf(t);if(e>=0){if(this.currentItem!=e){this.currentItem=e;this.callOnChangedHandler(t)}}return};UIShortcut.prototype.getValue=function(){if(this.text&&this.currentItem>=0&&this.currentItem<this.text.length){return this.text[this.currentItem]}else{return""}};UIShortcut.prototype.onPointerDownRunning=function(t,e){if(e||!this.text){return}this.changeItemByPoint(t);return};UIShortcut.prototype.onPointerMoveRunning=function(t,e){if(e||!this.text){return}if(this.pointerDown){this.changeItemByPoint(t)}return};function UIShortcutCreator(){var t=["ui-shortcut","ui-shortcut",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIShortcut;return e.initUIShortcut(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIShortcutCreator);function UIScrollText(){return}UIScrollText.prototype=new UIElement;UIScrollText.prototype.isUIScrollText=true;UIScrollText.prototype.initUIScrollText=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onScrollDone"]);return this};UIScrollText.prototype.onModeChanged=function(){this.offsetX=0;this.offsetY=0;return};UIScrollText.prototype.shapeCanBeChild=function(t){return false};UIScrollText.prototype.getAnimationDuration=function(){return this.animationDuration?this.animationDuration:1e3};UIScrollText.prototype.setAnimationDuration=function(t){this.animationDuration=t;return};UIScrollText.prototype.getPauseDuration=function(){return this.pauseDuration?this.pauseDuration:0};UIScrollText.prototype.setPauseDuration=function(t){this.pauseDuration=t;return};UIScrollText.prototype.startVScroll=function(){var t=this;var e=this.getTextHeight();var i=this.getLineHeight(true);if(e<=this.h){return}this.offsetX=0;this.offsetY=0;var n=0;var r=0;var o=this.getAnimationDuration();var a=this.getPauseDuration();this.h=Math.floor(this.h/i)*i;var s=-this.h;var l=true;var h=new DecelerateInterpolator;function u(){if(l){l=false;n=(new Date).getTime()}if(!t.isVisible()){return}var i=new Date;var p=(i.getTime()-n)/o;var c=a>0?h.get(p):p;delete i;if(p<1){t.offsetY=r+s*c;setTimeout(u,10)}else{t.offsetY=r+s;if(Math.abs(t.offsetY)<e-t.h){l=true;r=t.offsetY;setTimeout(u,a)}else{delete h;t.callOnScrollDoneHandler()}delete n}delete i;t.postRedraw()}setTimeout(u,a);return};UIScrollText.prototype.startHScroll=function(){var t=this;var e=this.textWidth;if(e<=this.w){return}this.offsetX=0;this.offsetY=0;var i=0;var n=0;var r=this.getAnimationDuration();var o=this.getPauseDuration();var a=-this.w;var s=true;var l=new DecelerateInterpolator;function h(){if(s){s=false;i=(new Date).getTime()}if(!t.isVisible()){return}var u=new Date;var p=(u.getTime()-i)/r;var c=o>0?l.get(p):p;if(p<1){t.offsetX=n+a*c;setTimeout(h,10)}else{t.offsetX=n+a;if(Math.abs(t.offsetX)<e-t.w){s=true;n=t.offsetX;setTimeout(h,o)}else{delete i;t.callOnScrollDoneHandler()}}delete u;t.postRedraw()}setTimeout(h,o);return};UIScrollText.prototype.startScroll=function(){if(!this.isVisible()){return}if(this.type==="ui-vscroll-text"){this.startVScroll()}else{this.startHScroll()}return};UIScrollText.prototype.onInit=function(){this.offsetX=0;this.offsetY=0;var t=this;setTimeout(function(){t.startScroll()},1e3);return};UIScrollText.prototype.drawText=function(t){var e=this.offsetX?this.offsetX:0;var i=this.offsetY?this.offsetY:0;t.save();t.rect(0,0,this.w,this.h);t.clip();t.translate(e,i);t.beginPath();t.font=this.style.getFont();t.fillStyle=this.style.textColor;t.strokeStyle=this.style.lineColor;t.lineWidth=1;if(this.type==="ui-vscroll-text"){this.drawMLText(t,false,true)}else{this.textWidth=this.draw1LText(t,true)}t.restore();return};function UIScrollTextCreator(t,e,i){var n=[t,t,null,1];ShapeCreator.apply(this,n);this.createShape=function(t){var n=new UIScrollText;return n.initUIScrollText(this.type,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIScrollTextCreator("ui-vscroll-text",200,200));ShapeFactoryGet().addShapeCreator(new UIScrollTextCreator("ui-hscroll-text",200,50));function UIList(){return}UIList.prototype=new UIElement;UIList.prototype.isUIList=true;UIList.prototype.isUILayout=true;UIList.prototype.initUIList=function(t,e,i,n){this.initUIElement(t);this.setMargin(e,e);this.setSizeLimit(100,100,1e3,1e3);this.setDefSize(400,i*3+2*e);this.itemHeight=i;this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,n);this.rectSelectable=false;this.itemHeightVariable=false;this.addEventNames(["onInit"]);if(!n){this.style.setFillColor("White")}return this};UIList.prototype.getItemHeight=function(){return this.itemHeight};UIList.prototype.setItemHeight=function(t){this.itemHeight=t;return};UIList.prototype.shapeCanBeChild=function(t){if(!t.isUIListItem){return false}return true};UIList.prototype.childIsBuiltin=function(t){return t.name==="ui-list-item-update-status"||t.name==="ui-list-item-update-tips"||t.name==="ui-last"||t.name.indexOf("prebuild")>=0||t.name.indexOf("builtin")>=0};UIList.FIRST_ITEM=-1;UIList.LAST_ITEM=1;UIList.MIDDLE_ITEM=0;UIList.SINGLE_ITEM=2;UIList.prototype.fixListItemImage=function(t,e){var i=t.images;for(var n in i){var r=i[n];if(n!="display"){var o=r.getImageSrc();if(!o){continue}switch(e){case UIList.FIRST_ITEM:{o=o.replace(/\.single\./,".first.");o=o.replace(/\.middle\./,".first.");o=o.replace(/\.last\./,".first.");break}case UIList.MIDDLE_ITEM:{o=o.replace(/\.single\./,".middle.");o=o.replace(/\.first\./,".middle.");o=o.replace(/\.last\./,".middle.");break}case UIList.LAST_ITEM:{o=o.replace(/\.single\./,".last.");o=o.replace(/\.first\./,".last.");o=o.replace(/\.middle\./,".last.");break}case UIList.SINGLE_ITEM:{o=o.replace(/\.first\./,".single.");o=o.replace(/\.middle\./,".single.");o=o.replace(/\.last\./,".single.");break}}r.setImageSrc(o)}}return};UIList.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var o=this.getWidth(true);var a=this.getItemHeight();var s=a;var l=this.itemHeightVariable;var h=0;var u=this.children.length;var p=this.children;for(var c=0;c<u;c++){var f=p[c];var m={};var d=false;if(f.removed||!f.visible)continue;if(l||f.isHeightVariable()){s=f.measureHeight(a)}else{s=a}if(u===1){this.fixListItemImage(f,UIList.SINGLE_ITEM)}else if(h===0){this.fixListItemImage(f,UIList.FIRST_ITEM)}else if(h===u-1){this.fixListItemImage(f,UIList.LAST_ITEM)}else{this.fixListItemImage(f,UIList.MIDDLE_ITEM)}if(this.h<=r+i+s){this.h=r+i+s}d=r<this.h&&(t||this.mode===Shape.MODE_EDITING);if(d){f.setSize(o,s);m.xStart=f.left;m.yStart=f.top;m.wStart=f.w;m.hStart=f.h;m.xEnd=n;m.yEnd=r;m.wEnd=o;m.hEnd=s;m.delay=10;m.duration=500;m.element=f;m.onDone=function(t){this.relayoutChildren()};f.animate(m)}else{f.move(n,r);f.setSize(o,s);f.relayoutChildren()}f.setUserMovable(true);f.widthAttr=UIElement.WIDTH_FILL_PARENT;if(f.heightAttr===UIElement.HEIGHT_FILL_PARENT){f.heightAttr=UIElement.HEIGHT_FIX}f.setUserResizable(l||f.isHeightVariable());if(!this.isUIScrollView){f.setDraggable(this.itemDraggable)}r+=s;h++}return};UIList.prototype.beforePaintChildren=function(t){t.beginPath();t.rect(0,0,this.w,this.h);t.clip();t.beginPath();return};UIList.prototype.afterPaintChildren=function(t){return};UIList.prototype.afterChildAppended=function(t){if(t.view&&this.mode===Shape.MODE_EDITING&&t.isCreatingElement()){this.sortChildren()}this.moveMustBeLastItemToLast();t.setUserMovable(true);t.setUserResizable(false);t.setCanRectSelectable(false,true);t.autoAdjustHeight=this.itemHeightVariable;t.setDraggable(this.itemDraggable);return true};UIList.prototype.sortChildren=function(){this.children.sort(function(t,e){var i=e.top;var n=e.pointerDown&&e.hitTestResult===Shape.HIT_TEST_MM?t.top+t.h*.8:t.top;return n-i});var t=this.children;for(var e=0;e<t.length;e++){var i=t[e];i.z=e}return};UIList.prototype.onKeyUpRunning=function(t){var e=0;if(!this.children.length){return}switch(t){case KeyEvent.DOM_VK_UP:{e=this.children.indexOf(this.targetShape)-1;break}case KeyEvent.DOM_VK_DOWN:{e=this.children.indexOf(this.targetShape)+1;break}default:{return}}var i=this.children.length;e=(e+this.children.length)%i;var n=this.children[e];this.setTarget(n);this.postRedraw();if(this.isUIListView){if(this.offset>n.top){this.offset=n.top}if(this.offset+this.h<n.top+n.h){this.offset=n.top-(this.h-n.h)}}return};UIList.prototype.onKeyDownRunning=function(t){};UIList.prototype.getValue=function(){var t=null;var e=this.children.length;if(e<1)return t;for(var i=0;i<e;i++){var n=this.children[i];if(!n.isUIListCheckableItem||!n.value)continue;if(n.isRadio){return i}else{if(!t)t=[];t.push(i)}}return t};UIList.prototype.setValue=function(t){var e=null;if(typeof t==="array"){e=t}else if(typeof t==="number"){e=[t]}else{e=[]}var i=this.children.length;for(var n=0;n<i;n++){var r=this.children[n];if(r.isUIListCheckableItem){r.setValue(false)}}for(var n=0;n<e.length;n++){var o=e[n];if(o>=0&&o<i){var r=this.children[o];if(r.isUIListCheckableItem){r.setChecked(true)}}}return this};function UIListCreator(t,e,i){var n=["ui-list","ui-list",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIList;return r.initUIList(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIListCreator(5,114,null));function UIListView(){return}UIListView.prototype=new UIVScrollView;UIListView.prototype.isUIList=true;UIListView.prototype.isUILayout=true;UIListView.prototype.isUIListView=true;UIListView.prototype.setItemHeight=UIList.prototype.setItemHeight;UIListView.prototype.sortChildren=UIList.prototype.sortChildren;UIListView.prototype.initUIList=UIList.prototype.initUIList;UIListView.prototype.shapeCanBeChild=UIList.prototype.shapeCanBeChild;UIListView.prototype.paintSelfOnly=UIList.prototype.paintSelfOnly;UIListView.prototype.fixListItemImage=function(t,e){};UIListView.prototype.afterChildAppended=UIList.prototype.afterChildAppended;UIListView.prototype.childIsBuiltin=UIList.prototype.childIsBuiltin;UIListView.prototype.onKeyUpRunning=UIList.prototype.onKeyUpRunning;UIListView.prototype.onKeyDownRunning=UIList.prototype.onKeyDownRunning;UIListView.prototype.getValue=UIList.prototype.getValue;UIListView.prototype.setValue=UIList.prototype.setValue;UIListView.UPDATE_STATUS_NONE=0;UIListView.UPDATE_STATUS_TIPS=1;UIListView.UPDATE_STATUS_SYNC=2;UIListView.prototype.beginUpdate=function(){this.updateStatus=UIListView.UPDATE_STATUS_SYNC;var t=this.findChildByName("ui-list-item-update-status");if(t){var e=t.findChildByName("ui-wait-box");if(e){e.show()}var i=t.findChildByName("ui-label-loading");if(i){i.setText(dappGetText("Loading..."))}}return};UIListView.prototype.endUpdate=function(){this.updateStatus=UIListView.UPDATE_STATUS_NONE;var t=this.findChildByName("ui-list-item-update-status");if(t){this.setLastUpdateTime(new Date)}this.relayoutChildren(true);return};UIListView.prototype.initUIListView=function(t,e,i,n){this.initUIList(t,e,i,n);this.initUIVScrollView(t,0,n,null);this.updateStatus=UIListView.UPDATE_STATUS_NONE;this.addEventNames(["onUpdateData","onScrollOutOfRange"]);this.setTextType(Shape.TEXT_INPUT);return this};UIListView.prototype.onModeChanged=function(){this.offset=0;this.updateStatus=UIListView.UPDATE_STATUS_NONE;return};UIListView.prototype.updateDone=function(){var t=this;t.endUpdate();setTimeout(function(){if(t.parentShape){t.relayoutChildren();t.postRedraw()}},1e3);return};UIListView.prototype.callOnUpdateData=function(){this.callOnUpdateDataHandler();this.beginUpdate();var t=this;setTimeout(function(){if(t.parentShape){t.updateDone()}},1e4);return true};UIListView.prototype.setLastUpdateTime=function(t){var e=this.findChildByName("ui-list-item-update-tips");if(e&&t){var i="";var n=new Date;if(n.getFullYear()===t.getFullYear()&&n.getDate()===t.getDate()&&n.getMonth()===t.getMonth()){i=dappGetText("Today")}else{i=t.getMonth()+"-"+t.getDate()}i=i+" "+t.getHours()+":"+t.getMinutes();var r=e.findChildByName("ui-label-update-time");if(r){r.setText(i)}var r=e.findChildByName("ui-label-update-time");if(r){r.setText(i)}var o=e.findChildByName("ui-label-update-time-tips");if(o){o.setText(dappGetText("Last Update:"))}}return};UIListView.prototype.onDrag=function(t){var e=this.findChildByName("ui-list-item-update-tips");if(e){var i=e.findChildByName("ui-image");var n=e.findChildByName("ui-label-tips");if(i){if(t<-115){if(i.rotation===0){function r(){var t=i.rotation+.2*Math.PI;if(t>Math.PI){t=Math.PI}i.setRotation(t);if(t<Math.PI){setTimeout(r,50)}i.postRedraw();return}r();if(n){n.setText(dappGetText("Release To Update."))}}}else{i.setRotation(0);if(n){n.setText(dappGetText("Pull To Update."))}}}}return};UIListView.prototype.whenScrollOutOfRange=function(t){if(t<-115){this.callOnUpdateData();this.relayoutChildren()}this.callOnScrollOutOfRangeHandler(t);return};UIListView.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var o=this.getWidth(true);var a=this.itemHeight;var s=this.itemHeightVariable;var l=this.getScrollRange();var h=this.getPageSize();var u=true;var p=0;var c=this.children.length;var f=this.children;for(var m=0;m<c;m++){var d=f[m];var y={};var g=false;if(d.removed||!d.visible)continue;if(s||d.isHeightVariable()){a=d.measureHeight(this.itemHeight)}else{a=this.itemHeight}if(d.name==="ui-list-item-update-tips"){if(this.mode!==Shape.MODE_EDITING){d.move(n,-a);d.left=n;d.top=-a;d.w=o;d.h=a;d.setUserMovable(false);d.setUserResizable(false);d.setVisible(this.updateStatus!==UIListView.UPDATE_STATUS_TIPS);continue}else{d.setVisible(true)}g=true}else if(d.name==="ui-list-item-update-status"){if(this.mode!==Shape.MODE_EDITING){if(this.updateStatus!==UIListView.UPDATE_STATUS_SYNC){d.setVisible(false)}else{d.setVisible(true)}}else{d.setVisible(true)}g=true}if(!d.visible){continue}animatable=d.isVisible()&&!g&&r<this.h&&(t||this.mode===Shape.MODE_EDITING);if(animatable&&(n!=d.left||r!=d.top||o!=d.w||a!=d.h)){d.setSize(o,a);y.xStart=d.left;y.yStart=d.top;y.wStart=d.w;y.hStart=d.h;y.xEnd=n;y.yEnd=r;y.wEnd=o;y.hEnd=a;y.delay=10;y.duration=1e3;y.element=d;y.onDone=function(t){this.relayoutChildren()};d.animate(y)}else{d.move(n,r);d.setSize(o,a);d.relayoutChildren()}d.widthAttr=UIElement.WIDTH_FILL_PARENT;if(d.heightAttr===UIElement.HEIGHT_FILL_PARENT){d.heightAttr=UIElement.HEIGHT_FIX}d.setUserMovable(u);d.setUserResizable(s||d.isHeightVariable());r+=a;p++}return};UIListView.prototype.drawText=UIList.prototype.drawText;UIListView.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);if(this.mode===Shape.MODE_EDITING){this.drawPageDownUp(t)}return};function UIListViewCreator(t,e,i){var n=["ui-list-view","ui-list-view",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIListView;return r.initUIListView(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIListViewCreator(5,114,null));function UIListItem(){return}UIListItem.prototype=new UIElement;UIListItem.prototype.isUIListItem=true;UIListItem.prototype.initUIListItem=function(t){this.initUIElement(t);this.roundRadius=5;this.setDefSize(200,120);this.setTextType(Shape.TEXT_NONE);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;this.setImage(UIElement.IMAGE_FOCUSED,null);this.setImage(UIElement.IMAGE_ACTIVE,null);this.setImage(UIElement.IMAGE_NORMAL,null);this.setImage(UIElement.IMAGE_DISABLE,null);this.setImage(UIElement.IMAGE_POINTER_OVER,null);this.setImage(UIElement.IMAGE_DELETE_ITEM,null);this.addEventNames(["onLongPress","onRemoved"]);return this};UIListItem.prototype.dragMove=function(t,e){this.top=this.top+e;this.onDragging();return};UIListItem.prototype.getDeleteItemIcon=function(){var t=this.getHtmlImageByType(UIElement.IMAGE_DELETE_ITEM);return t};UIListItem.prototype.shapeCanBeChild=function(t){if(t.isUIMenu||t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow||t.isUIPageManager||t.isUIPage||t.isUIListItem){return false}return true};UIListItem.prototype.onUserResized=function(){var t=this.parentShape;if(t){t.relayoutChildren()}return};UIListItem.prototype.setSlideToRemove=function(t){this.slideToRemove=t;return this};UIListItem.prototype.setHeightVariable=function(t){this.heightVariable=t;return this};UIListItem.prototype.isHeightVariable=function(){return this.heightVariable};UIListItem.prototype.measureHeight=function(t){return this.h};UIListItem.prototype.ANIM_DRAW_LINE=1;UIListItem.prototype.onPointerUpRunning=function(t,e){if(e||!this.slideToRemove){return}var i=this.getMoveAbsDeltaX();var n=this.getMoveAbsDeltaY();if(Math.abs(i)<this.w/2||Math.abs(n)>this.h){return}var r=this;var o=300;var a=(new Date).getTime();r.animateState=this.ANIM_DRAW_LINE;for(var s=0;s<this.children.length;s++){var l=this.children[s];l.style.setTextColor("#C0C0C0")}function h(){var t=new Date;var e=(t.getTime()-a)/o;if(e<1){r.animatePercent=e;setTimeout(h,10)}else{r.animatePercent=1;setTimeout(function(){delete a;delete r.animatePercent;delete r.animateState;var t=r.parentShape;t.removeChild(r);t.relayoutChildren("default");t.postRedraw()},300)}delete t;r.postRedraw()}h();return};UIListItem.prototype.getFillColor=function(t){var e;if(this.pointerDown){var i=Math.abs(this.getMoveAbsDeltaY());if(i<5){var n=Date.now()-this.pointerDownTime;if(n<50&&this.getParent().isUIListView){e=this.style.fillColor;this.postRedraw()}else{e=this.style.textColor}}else{e=this.style.fillColor}}else if(this.isPointerOverShape()){e=this.style.overFillColor?this.style.overFillColor:this.style.fillColor}else if(this.isFocused()){e=this.style.focusedFillColor?this.style.focusedFillColor:this.style.fillColor}else{e=this.style.fillColor}return e};UIListItem.prototype.paintSelfOnly=function(t){if(this.getBgHtmlImage()){return}var e=this.parentShape;var i=this.getFillColor();var n=this.style.lineColor;var r=this.style.lineWidth;t.beginPath();if(!e||e.isUIListView||e.isUIMenu){if(!Shape.isTransparentColor(i)){t.fillStyle=i;t.fillRect(0,0,this.w,this.h)}if(!Shape.isTransparentColor(n)){t.moveTo(0,this.h);t.lineTo(this.w,this.h);t.lineWidth=r;t.strokeStyle=n;t.stroke()}return}var o=this.roundRadius;var a=this===e.children[0];var s=this===e.children[e.children.length-1];if(a&&s){drawRoundRect(t,this.w,this.h,o)}else if(a){drawRoundRect(t,this.w,this.h,o,RoundRect.TL|RoundRect.TR)}else if(s){drawRoundRect(t,this.w,this.h,o,RoundRect.BL|RoundRect.BR)}else{t.rect(0,0,this.w,this.h)}if(!Shape.isTransparentColor(i)){t.fillStyle=i;t.fill()}if(!Shape.isTransparentColor(n)){t.lineWidth=r;t.strokeStyle=n;t.stroke()}return};UIListItem.prototype.afterPaintChildren=function(t){if(!this.animateState){return}var e=this.getDeleteItemIcon();if(this.animateState===this.ANIM_DRAW_LINE&&e&&e.width>0){var i=20;var n=this.animatePercent;var r=(this.w-i)*n-e.width;if(r>i){t.lineWidth=1;t.strokeStyle="#D0D0D0";t.moveTo(i,this.h/2);t.lineTo(r,this.h/2);t.stroke();if(n>.9){var o=(this.h-e.height)/2;var a=this.w-e.width-i;t.drawImage(e,a,o)}}}return};UIListItem.prototype.afterChildAppended=function(t){if(t.isUIButton||t.isUICheckBox){this.setImage(UIElement.IMAGE_ACTIVE,this.getImageByType(UIElement.IMAGE_NORMAL).getImageSrc());this.setImage(UIElement.IMAGE_FOCUSED,this.getImageByType(UIElement.IMAGE_NORMAL).getImageSrc())}return true};function UIListItemCreator(){var t=["ui-list-item","ui-list-item",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIListItem;e.initUIListItem(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIListItemCreator(null,null,null,null));function UIListCheckableItem(){return}UIListCheckableItem.prototype=new UIListItem;UIListCheckableItem.prototype.isUIListCheckableItem=true;UIListCheckableItem.prototype.initUIListCheckableItem=function(t){this.initUIListItem(t);this.isUIListRadioBoxItem=t==="ui-list-radiobox-item";this.isUIListCheckBoxItem=t==="ui-list-checkbox-item";this.setImage(UIElement.IMAGE_CHECKED_FG,null);this.setImage(UIElement.IMAGE_UNCHECK_FG,null);this.addEventNames(["onChanged"]);return this};UIListCheckableItem.prototype.getValue=function(){return this.value};UIListCheckableItem.prototype.setValue=function(t){if(this.value!=t){this.value=t;this.callOnChangedHandler(this.value)}return};UIListCheckableItem.prototype.setChecked=function(){var t=this.parentShape;if(t){for(var e=0;e<t.children.length;e++){var i=t.children[e];if(i.isUIListCheckableItem){i.setValue(false)}}}this.setValue(true);return};UIListCheckableItem.prototype.setParent=function(t){this.parentShape=t;if(this.value){this.setChecked()}return};UIListCheckableItem.prototype.onClick=function(t,e){if(e){return}if(this.isUIListRadioBoxItem){this.setChecked()}else{this.setValue(!this.value)}return};UIListCheckableItem.prototype.drawFgImage=function(t){var e=this.getHtmlImageByType(this.value?UIElement.IMAGE_CHECKED_FG:UIElement.IMAGE_UNCHECK_FG);if(e){var i=this.w-e.width-20;var n=(this.h-e.height)/2;t.drawImage(e,0,0,e.width,e.height,i,n,e.width,e.height)}return};function UIListCheckBoxItemCreator(){var t=["ui-list-checkbox-item","ui-list-checkbox-item",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIListCheckableItem;e.initUIListCheckableItem(this.type);return e};return}function UIListRadioBoxItemCreator(){var t=["ui-list-radiobox-item","ui-list-radiobox-item",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIListCheckableItem;e.initUIListCheckableItem(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIListCheckBoxItemCreator);ShapeFactoryGet().addShapeCreator(new UIListRadioBoxItemCreator);function UISelect(){return}UISelect.prototype=new UIElement;UISelect.prototype.isUISelect=true;UISelect.prototype.initUISelect=function(t,e,i){this.initUIElement(t);this.offset=0;this.options=[];this.visibleItems=5;this.setDefSize(e,i);this.addEventNames(["onInit","onChanged"]);this.setTextType(Shape.TEXT_TEXTAREA);this.setCanRectSelectable(false,true);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;return this};UISelect.prototype.getItemHeight=function(){return Math.round(this.h/this.visibleItems)};UISelect.prototype.getVisibleItems=function(){return this.visibleItems};UISelect.prototype.setVisibleItems=function(t){if(t<=3){this.visibleItems=3}else{this.visibleItems=5}};UISelect.prototype.scrollTo=function(t){var e=this.getItemHeight();
t=Math.round(t/e)*e;var i=this;var n=500;var r=this.offset;var o=t-r;var a=(new Date).getTime();var s=new DecelerateInterpolator;this.animating=true;function l(){var t=new Date;var e=(t.getTime()-a)/n;var h=s.get(e);if(e<1){i.setOffset(Math.floor(r+h*o));setTimeout(l,10)}else{i.setOffset(r+o,true);delete a;delete s;delete i.animating}delete t}setTimeout(function(){l()},10);return};UISelect.prototype.setOffset=function(t,e){this.offset=t;this.postRedraw();if(e){var i=this.getValue();this.callOnChangedHandler(i)}return};UISelect.prototype.onPointerDownRunning=function(t,e){if(e||this.animating){return}if(!this.velocityTracker){this.velocityTracker=new VelocityTracker}this.velocityTracker.clear();this.saveOffset=this.offset;return true};UISelect.prototype.onPointerMoveRunning=function(t,e){if(e||this.animating){return}this.addMovementForVelocityTracker();var i=this.getMoveAbsDeltaY();this.setOffset(this.saveOffset+i);return};UISelect.prototype.getMaxOffset=function(){var t=Math.floor(.5*this.visibleItems);return t*this.getItemHeight()};UISelect.prototype.getMinOffset=function(){var t=this.getItemHeight();var e=Math.round(.5*this.visibleItems);if(this.options.length<=e){return 0}else{return-(this.options.length-e)*t}};UISelect.prototype.handleClicked=function(t){var e=this.getItemHeight();var i=Math.floor((this.h/2-this.offset)/e);var n=Math.floor((t.y-this.offset)/e);var r=(n-i)*e;var o=this.offset-r;var a=this.getMinOffset();var s=this.getMaxOffset();if(o<a){o=a}if(o>s){o=s}this.scrollTo(o);return};UISelect.prototype.onPointerUpRunning=function(t,e){if(e||this.animating){return}var i=this.getMoveAbsDeltaY();var n=this.velocityTracker.getVelocity().y;var r=i+n/2;if(Math.abs(r)<10){this.setOffset(this.saveOffset);this.handleClicked(t);return}var o=this.getMinOffset();var a=this.getMaxOffset();var s=this.saveOffset+i+n;if(s<o){s=o}if(s>a){s=a}this.scrollTo(s);return};UISelect.prototype.shapeCanBeChild=function(t){return false};UISelect.prototype.setText=function(t){t=this.toText(t);if(t){this.options=t.split("\n");this.options.remove("")}else{this.options=[]}this.text=t;return this};UISelect.prototype.drawText=function(t){return};UISelect.prototype.drawImage=function(t){var e=0;var i=0;var n=this.w;var r=this.h;var o=n>>1;var a=0;var s=this.offset;var l=this.getItemHeight();t.beginPath();t.rect(0,0,n,r);t.clip();var h=this.options.length;var u=this.getBgImage()!=null;this.drawBgImage(t);if(!u){t.lineWidth=3;t.strokeStyle=this.style.lineColor;t.beginPath();e=(this.visibleItems>>1)*l;t.moveTo(5,e);t.lineTo(n-10,e);t.moveTo(5,e+l);t.lineTo(n-10,e+l);t.stroke()}this.style.setTextB(false);this.style.setFontSize(Math.floor(l*.5));var p=this.style.getFont();var c=this.style.textColor;this.style.setTextB(true);this.style.setFontSize(Math.floor(l*.6));var f=this.style.getFont();var m=this.style.textColorHighlight;t.textAlign="center";t.textBaseline="middle";t.font=this.style.getFont();t.fillStyle=this.style.textColor;t.translate(0,s);var d=Math.floor((.5*r-s)/l);for(var y=0;y<h;y++){var g=this.options[y];e=y*l;i=e+l;a=-s;if(i<a&&e<a){continue}a=-(s-r);if(i>a&&e>a){continue}if(d==y){t.font=f;t.fillStyle=m}else{t.font=p;t.fillStyle=c}e=e+(l>>1);t.fillText(g,o,e,n)}return};UISelect.prototype.getValue=function(){var t=this.h;var e=this.offset;var i=this.getItemHeight();var n=Math.floor((.5*t-e)/i);var r=n<this.options.length?this.options[n]:"";return r};UISelect.prototype.setValueByIndex=function(t,e){var i=t;var n=this.getItemHeight();if(i>=0){var r=-(i-(this.getVisibleItems()>>1))*n;if(e){this.scrollTo(r)}else{this.setOffset(r,true)}}return this};UISelect.prototype.setValue=function(t,e){var i=this.options.indexOf(t.toString());this.setValueByIndex(i,e);return this};function UISelectCreator(t,e){var i=["ui-select","ui-select",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UISelect;return n.initUISelect(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UISelectCreator("ui-select",300,50));function UIMenu(){return}UIMenu.FREE_LAYOUT=0;UIMenu.ARC_LAYOUT=1;UIMenu.VLINEAR_LAYOUT=2;UIMenu.HLINEAR_LAYOUT=3;UIMenu.prototype=new UITips;UIMenu.prototype.isUIMenu=true;UIMenu.prototype.initUIMenu=function(t){this.initUITips(t,null);this.spacer=2;this.menuItemNr=2;this.roundRadius=5;this.animDuration=600;this.setTextType(Shape.TEXT_NONE);this.layoutType=UIMenu.FREE_LAYOUT;this.originPoint=UIElement.ORIGIN_RIGHT;this.setCanRectSelectable(false,false);this.enableHideAnimation=true;this.enableShowAnimation=true;return this};UIMenu.prototype.relayoutChildrenHLL=function(){var t=this.children.length;var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var o=this.spacer;var a=this.getWidth(true);var s=this.getHeight(true);var l=this.originPoint;var h=Math.max(t,this.menuItemNr);var u=Math.round((a-o*(h-1))/h);for(var p=0;p<t;p++){var c=this.children[p];c.h=s;c.w=u;c.left=n;c.top=r;n+=u+o;c.relayoutChildren()}return this};UIMenu.prototype.relayoutChildrenVLL=function(){var t=this.children.length;var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var o=this.spacer;var a=this.getWidth(true);var s=this.getHeight(true);var l=this.originPoint;var h=Math.max(t,this.menuItemNr);var u=Math.round((s-o*(h-1))/h);for(var p=0;p<t;p++){var c=this.children[p];c.w=a;c.h=u;c.left=n;c.top=r;r+=u+o;c.relayoutChildren()}return this};UIMenu.prototype.getChildPositionOfArc=function(t,e,i,n){var r={};var o=t.angleRange>Math.PI*1.9?n:n-1;var a=t.angleStart+t.angleRange*i/o;r.x=t.x+e*Math.cos(a);r.y=t.y+e*Math.sin(a);return r};UIMenu.prototype.relayoutChildrenARC=function(){var t=this.children.length;var e=this.getOrigin();var i=e.r;var n=this.w;var r=this.h;for(var o=0;o<t;o++){var a=this.children[o];var s=this.getChildPositionOfArc(e,i,o,t);a.left=s.x-(a.w>>1);a.top=s.y-(a.h>>1);a.relayoutChildren()}return};UIMenu.prototype.relayoutChildren=function(){var t=this.children.length;if(this.disableRelayout||!t){return}switch(this.layoutType){case UIMenu.HLINEAR_LAYOUT:{this.relayoutChildrenHLL();break}case UIMenu.VLINEAR_LAYOUT:{this.relayoutChildrenVLL();break}case UIMenu.ARC_LAYOUT:{this.relayoutChildrenARC();break}default:{for(var e=0;e<t;e++){this.children[e].relayout()}break}}return};UIMenu.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){this.paintSelfOnlyByColor(t)}return};UIMenu.prototype.prepareShowChildAnimation=function(t,e){var i={};i.duration=this.animDuration;i.interpolator="d";i.xStart=e.x-(t.w>>1);i.xEnd=t.left;i.yStart=e.y-(t.h>>1);i.yEnd=t.top;i.scaleXStart=0;i.scaleXEnd=1;i.scaleYStart=0;i.scaleYEnd=1;i.opacityStart=0;i.opacityEnd=1;i.rotationStart=0;i.rotationEnd=2*Math.PI;return i};UIMenu.prototype.prepareHideChildAnimation=function(t,e){var i={};i.duration=this.animDuration;i.interpolator="d";i.xStart=t.left;i.xEnd=e.x-(t.w>>1);i.yStart=t.top;i.yEnd=e.y-(t.h>>1);i.opacityStart=1;i.opacityEnd=0;i.scaleXStart=1;i.scaleXEnd=0;i.scaleYStart=1;i.scaleYEnd=0;i.rotationStart=Math.PI*2;i.rotationEnd=0;return i};UIMenu.prototype.animateShowChildren=function(){var t=this;var e=this.children.length;var i=this.getOrigin();this.busy=e;this.visible=true;for(var n=0;n<e;n++){var r=null;var o=this.children[n];if(o.animations){r=o.animations["show"]}if(!r){r=this.prepareShowChildAnimation(o,i)}else{console.log("Use child show animation.")}o.animate(r,function(){t.busy--})}return this};UIMenu.prototype.animateHideChild=function(t,e){var i=this;var n=t.left;var r=t.top;var o=t.w;var a=t.h;t.animate(e,function(){t.left=n;t.top=r;t.w=o;t.h=a;t.opacity=1;t.visible=false;i.busy--;if(!i.busy){i.visible=false}});return};UIMenu.prototype.animateHideChildren=function(){var t=this;var e=this.children.length;var i=this.getOrigin();this.busy=e;this.visible=true;for(var n=0;n<e;n++){var r=null;var o=this.children[n];if(o.animations){r=o.animations["hide"]}if(!r){r=this.prepareHideChildAnimation(o,i)}else{console.log("Use child hide animation.")}this.animateHideChild(o,r)}return this};UIMenu.prototype.prepareShowAnimation=function(){var t={};t.duration=this.animDuration;t.interpolator="d";t.scaleXStart=.5;t.scaleXEnd=1;t.scaleYStart=.5;t.scaleYEnd=1;t.opacityStart=0;t.opacityEnd=1;return t};UIMenu.prototype.prepareHideAnimation=function(){var t={};t.duration=this.animDuration;t.interpolator="a";t.scaleXStart=1;t.scaleXEnd=.5;t.scaleYStart=1;t.scaleYEnd=.5;t.opacityStart=1;t.opacityEnd=0;return t};UIMenu.prototype.animateShowSelf=function(){var t=this;t.busy=true;var e=null;if(this.animations){e=this.animations["show"]}if(!e){e=this.prepareShowAnimation()}this.animate(e,function(){t.visible=true;t.busy=false})};UIMenu.prototype.animateHideSelf=function(){var t=this;t.busy=true;this.visible=true;var e=null;if(this.animations){e=this.animations["hide"]}if(!e){e=this.prepareHideAnimation()}this.animate(e,function(){t.visible=false;t.busy=false});return this};UIMenu.prototype.show=function(){if(this.busy)return;if(this.autoHideWhenClicked){this.getWindow().grab(this)}if(!this.enableShowAnimation){this.visible=true;return}if(this.childrenAnimation){this.animateShowChildren()}else{this.animateShowSelf()}};UIMenu.prototype.hide=function(){if(this.busy)return;if(this.autoHideWhenClicked){this.getWindow().ungrab(this)}if(!this.enableHideAnimation){this.visible=false;return}if(this.childrenAnimation){return this.animateHideChildren()}else{return this.animateHideSelf()}};UIMenu.prototype.onPointerUpRunning=function(t,e){if(e){return}if(this.autoHideWhenClicked){this.hide()}return};UIMenu.prototype.setVisible=function(t){if(this.visible===t||this.busy){return this}return t?this.show():this.hide()};UIMenu.prototype.getOrigin=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=this.hMargin;var n=this.vMargin;var r={x:i,y:n};switch(this.originPoint){case UIElement.ORIGIN_UP:{r.x=this.w>>1;r.angleRange=Math.PI;r.angleStart=0;r.r=t>>1;break}case UIElement.ORIGIN_DOWN:{r.x=this.w>>1;r.y=this.h-n;r.angleRange=Math.PI;r.angleStart=Math.PI;r.r=t>>1;break}case UIElement.ORIGIN_LEFT:{r.x=i;r.y=this.h>>1;r.angleRange=Math.PI;r.angleStart=-Math.PI*.5;r.r=e>>1;break}case UIElement.ORIGIN_RIGHT:{r.x=this.w-i;r.y=this.h>>1;r.angleRange=Math.PI;r.angleStart=Math.PI*.5;r.r=e>>1;break}case UIElement.ORIGIN_UP_LEFT:{r.angleRange=Math.PI*.5;r.angleStart=0;r.r=Math.min(t,e);break}case UIElement.ORIGIN_UP_RIGHT:{r.x=this.w-i;r.angleStart=.5*Math.PI;r.angleRange=Math.PI*.5;r.r=Math.min(t,e);break}case UIElement.ORIGIN_DOWN_LEFT:{r.x=i;r.y=this.h-n;r.angleStart=-.5*Math.PI;r.angleRange=Math.PI*.5;r.r=Math.min(t,e);break}case UIElement.ORIGIN_DOWN_RIGHT:{r.x=this.w-i;r.y=this.h-n;r.angleStart=Math.PI;r.angleRange=Math.PI*.5;r.r=Math.min(t,e);break}case UIElement.ORIGIN_MIDDLE_CENTER:{r.x=this.w>>1;r.y=this.h>>1;r.angleStart=-.5*Math.PI;r.angleRange=Math.PI*2;r.r=Math.min(t,e)>>1;break}default:break}return r};UIMenu.prototype.applyTransform=function(t){if(this.mode===Shape.MODE_EDITING)return;var e=this.getOrigin();if(t.globalAlpha!=this.opacity){t.globalAlpha=this.opacity}if(this.offsetX){t.translate(this.offsetX,0)}if(this.offsetY){t.translate(0,this.offsetY)}var i=this.getScaleX();var n=this.getScaleY();if(this.rotation||i&&i!==1||n&&n!==1){var r=e.x;var o=e.y;t.translate(r,o);if(i&&n){t.scale(i,n)}if(this.rotation){t.rotate(this.rotation)}t.translate(-r,-o)}return};UIMenu.prototype.shapeCanBeChild=function(t){return t.isUIListItem||t.isUIButton||t.isUIImage};function UIMenuCreator(){var t=["ui-menu","ui-menu",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIMenu;return e.initUIMenu(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIMenuCreator);function UIImage(){return}UIImage.prototype=new UIElement;UIImage.prototype.isUIImage=true;UIImage.prototype.initUIImage=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_INPUT);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,n);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);this.setCanRectSelectable(false,true);this.addEventNames(["onDoubleClick","onUpdateTransform"]);return this};UIImage.prototype.setValue=function(t){var e=null;var i=UIElement.IMAGE_DEFAULT;this.setImageSrc(t);e=this.images[i];if(e===WImage.nullWImage){console.log("%c %s. setValue is nullWImage %s:%s","background: red; color: white",this.name,i,t)}};UIImage.prototype.getValue=function(){return this.getImageSrc()};UIImage.prototype.setImageSrc=function(t){this.setImage(UIElement.IMAGE_DEFAULT,t);return this};UIImage.prototype.getImageSrc=function(t){return this.getImageSrcByType(t?t:UIElement.IMAGE_DEFAULT)};UIImage.prototype.getHtmlImage=function(t){return this.getHtmlImageByType(t?t:UIElement.IMAGE_DEFAULT)};UIImage.prototype.getImageSrcRect=function(){var t=this.getImageByType(UIElement.IMAGE_DEFAULT);if(this.srcRect){return this.srcRect}else if(t){return t.getImageRect()}else{return null}};UIImage.prototype.setImageSrcRect=function(t,e,i,n){this.srcRect={};this.srcRect.x=t;this.srcRect.y=e;this.srcRect.w=i;this.srcRect.h=n;return};UIImage.prototype.fitToImage=function(){var t=this.getImageSrcRect();if(t&&t.w&&t.h){this.w=t.rw||t.w;this.h=t.rh||t.h}return};UIImage.prototype.drawBgImage=function(t){var e=this.getBgHtmlImage();if(e){var i=this.getImageSrcRect();this.drawImageAt(t,e,this.images.display,0,0,this.w,this.h,i);if(this.keepSizeWithImage){this.w=i.rw||i.w;this.h=i.rh||i.h}}return};UIImage.prototype.fixChildSize=function(){return};UIImage.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;function UIImageCreator(t){var e=[t,"ui-image",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIImage;return e.initUIImage(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIImageCreator("ui-image"));ShapeFactoryGet().addShapeCreator(new UIImageCreator("ui-icon"));UIImage.prototype.setBorderStyle=function(t,e){return};UIImage.prototype.setClickedStyle=function(t,e){return};function UILabel(){return}UILabel.prototype=new UIElement;UILabel.prototype.isUILabel=true;UILabel.prototype.initUILabel=function(t,e,i){this.initUIElement(t);this.setText(e);this.setDefSize(200,200);this.setMargin(5,5);this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,i);this.addEventNames(["onChanged","onUpdateTransform"]);return this};UILabel.prototype.shapeCanBeChild=function(t){return t.isUILabel||t.isUIImage};UILabel.prototype.setText=function(t){this.text=this.toText(t);this.textNeedRelayout=true;this.callOnChangedHandler(t);return this};UILabel.prototype.drawText=function(t){this.layoutText(t);this.defaultDrawText(t);return};function UILabelCreator(){var t=["ui-label","ui-label",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UILabel;return e.initUILabel(this.type,dappGetText("Text"),null)};return}ShapeFactoryGet().addShapeCreator(new UILabelCreator);function UIScreen(){return}UIScreen.prototype=new UIElement;UIScreen.prototype.isUIScreen=true;UIScreen.prototype.initUIScreen=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);return this};UIScreen.prototype.getWindowManager=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isUIWindowManager){return e}}return};UIScreen.prototype.shapeCanBeChild=function(t){if(!t.isUIStatusBar&&!t.isUIWindowManager){return false}for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i.type===t.type){return false}}return true};UIScreen.prototype.beforeRelayoutChild=function(t){this.relayoutChildren();return false};UIScreen.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var t=0;var e=0;var i=0;var n=this.w;var r=null;var o=null;var a=null;for(var s=0;s<this.children.length;s++){var l=this.children[s];l.left=0;l.w=n;l.setUserMovable(false);l.setUserResizable(false);l.widthAttr=UIElement.WIDTH_FILL_PARENT;if(l.type==="ui-status-bar"){o=l;if(l.h>this.h/4){l.h=this.h/4}l.move(0,0);l.relayout();continue}if(l.type==="ui-menu-bar"){var h=this.getDeviceConfig();var u=h&&h.hasMenuBar&&this.h>this.w;if(u){r=l;if(l.h>this.h/4){l.h=this.h/4}l.move(0,this.h-l.h);l.relayout()}else{l.top=0;l.left=0}l.setVisible(u);l.setEnable(u);continue}if(l.isUIWindowManager){a=l;continue}}i=this.h;if(a){if(o){e=o.h;i=i-o.h}if(r){i=i-r.h}a.h=i;a.relayout()}return};UIScreen.drawRuler=function(t,e,i,n){var r=0;var o=0;t.beginPath();for(var a=10;a<e;a+=10){if(a%100===0){o=12}else if(a%50===0){o=8}else{o=5}t.moveTo(a,0);t.lineTo(a,o);t.moveTo(a,i);t.lineTo(a,i-o);if(o>5){t.textBaseline="center";t.textAlign="center";r=-6;t.fillText(a.toString(),a,r);r=i+8;if(n){t.save();t.translate(a,r);t.rotate(Math.PI);t.translate(-a,-r);t.fillText(a.toString(),a,r);t.restore()}else{r=-6;r=i+14;t.fillText(a.toString(),a,r)}}}t.stroke();return};UIScreen.prototype.drawRulers=function(t){if(this.mode!==Shape.MODE_EDITING){return}t.translate(this.left,this.top);t.lineWidth=1;t.fillStyle="#101010";t.strokeStyle="#101010";t.font="10px sans";var e=this.w>>1;var i=this.h>>1;UIScreen.drawRuler(t,this.w,this.h);t.translate(e,i);t.rotate(.5*Math.PI);t.translate(-i,-e);UIScreen.drawRuler(t,this.h,this.w,true);return};UIScreen.prototype.paintSelf=function(t){t.save();t.beginPath();t.rect(this.left,this.top,this.w,this.h);t.clip();t.beginPath();UIElement.prototype.paintSelf.call(this,t);t.restore();t.save();this.drawRulers(t);t.restore();return};function UIScreenCreator(t,e){var i=["ui-screen","ui-screen",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIScreen;return n.initUIScreen(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIScreenCreator(640,960));function UIPage(){return}UIPage.prototype=new UIElement;UIPage.prototype.isUIPage=true;UIPage.prototype.initUIPage=function(t,e){this.initUIElement(t);this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,e);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.heightAttr=UIElement.HEIGHT_FILL_PARENT;if(!e){this.style.setFillColor("Gold")}return this};UIPage.prototype.show=function(){this.setVisible(true);this.showHTML();return};UIPage.prototype.hide=function(){this.setVisible(false);this.hideHTML();cantkHideAllInput();return};UIPage.prototype.shapeCanBeChild=function(t){if(t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow||t.isUIPage){return false}if(t.isUIPageIndicator&&!this.isUIPageExt){return false}return true};UIPage.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e&&!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};function UIPageCreator(t){var e=["ui-page","ui-page",null,1];ShapeCreator.apply(this,e);this.createShape=function(e){var i=new UIPage;return i.initUIPage(this.type,t)};return}ShapeFactoryGet().addShapeCreator(new UIPageCreator(null));function UICircleLayout(){return}UICircleLayout.prototype=new UIElement;UICircleLayout.prototype.isUILayout=true;UICircleLayout.prototype.isUICircleLayout=true;UICircleLayout.O_CENTER="c";UICircleLayout.O_TOP_LEFT="tl";UICircleLayout.O_TOP_MIDDLE="tm";UICircleLayout.O_TOP_RIGHT="tr";UICircleLayout.O_LEFT_MIDDLE="lm";UICircleLayout.O_RIGHT_MIDDLE="rm";UICircleLayout.O_BOTTOM_LEFT="bl";UICircleLayout.O_BOTTOM_MIDDLE="bm";UICircleLayout.O_BOTTOM_RIGHT="br";UICircleLayout.prototype.initUICircleLayout=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.setCanRectSelectable(false,false);this.addEventNames(["onInit"]);this.origin=UICircleLayout.O_CENTER;this.setSizeLimit(120,120,1e3,1e3,1);return this};UICircleLayout.prototype.shapeCanBeChild=function(t){if(t.isUIImage||t.isUIButton){return true}return false};UICircleLayout.prototype.paintSelfOnly=function(t){if(this.mode===Shape.MODE_EDITING){t.lineWidth=this.style.lineWidth;switch(this.origin){case UICircleLayout.O_CENTER:{var e=this.w>>1;var i=this.h>>1;var n=(this.w>>1)-30;var r=this.children.length?this.children.length:6;var o=r>1?2*Math.PI/(r-1):0;t.beginPath();t.fillStyle=this.style.fillColor;t.strokeStyle=this.style.lineColor;t.arc(e,i,n,0,Math.PI*2);t.stroke();var a=-.5*Math.PI;for(var s=0;s<r;s++){t.beginPath();if(s==0){t.arc(e,i,10,0,Math.PI*2);t.stroke()}else{var l=o*(s-1)+a;var h=e+n*Math.cos(l);var u=i+n*Math.sin(l);t.arc(h,u,10,0,Math.PI*2);t.stroke()}}t.stroke();break}default:break}}return};UICircleLayout.prototype.moveShapeToCenter=function(t,e,i){e=e-(t.w>>1);i=i-(t.h>>1);t.move(e,i);return};UICircleLayout.prototype.relayoutChildren=function(){if(this.disableRelayout){return}switch(this.origin){case UICircleLayout.O_CENTER:{var t=this.w>>1;var e=this.h>>1;var i=(this.w>>1)-30;var n=this.children.length-1;var r=n>0?2*Math.PI/n:0;var o=-.5*Math.PI;for(var a=0;a<this.children.length;a++){var s=this.children[a];if(a==0){this.moveShapeToCenter(s,t,e)}else{var l=r*(a-1)+o;var h=t+i*Math.cos(l);var u=e+i*Math.sin(l);this.moveShapeToCenter(s,h,u)}}break}default:break}return};UICircleLayout.prototype.afterChildAppended=function(t){t.yAttr=UIElement.Y_FIX_TOP;t.xAttr=UIElement.X_FIX_LEFT;t.widthAttr=UIElement.WIDTH_SCALE;t.heightAttr=UIElement.HEIGHT_SCALE;t.setUserMovable(true);t.setUserResizable(true);t.setCanRectSelectable(false,true);this.relayoutChildren();return true};function UICircleLayoutCreator(t,e,i){var n=["ui-circle-layout","ui-circle-layout",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UICircleLayout;return r.initUICircleLayout(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UICircleLayoutCreator(400,400));function UIGrid(){return}UIGrid.prototype=new UIElement;UIGrid.prototype.isUIGrid=true;UIGrid.prototype.isUILayout=true;UIGrid.prototype.gridToJson=function(t){t.cols=this.cols;t.rows=this.rows;t.spacer=this.spacer;t.scrollDirection=this.scrollDirection;return};UIGrid.prototype.gridFromJson=function(t){this.cols=t.cols||t.itemWidth;this.rows=t.rows||t.itemHeight;if(t.spacer!==undefined){this.spacer=t.spacer}if(t.scrollDirection!==undefined){this.scrollDirection=t.scrollDirection}return};UIGrid.prototype.initUIGrid=function(t){this.initUIElement(t);this.spacer=0;this.offset=0;this.setMargin(5,5);this.setDefSize(200,200);this.rows=3;this.cols=3;this.checkable=false;this.rectSelectable=false;this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_DELETE_ITEM,null);this.setImage(UIElement.IMAGE_CHECKED_ITEM,null);this.regSerializer(this.gridToJson,this.gridFromJson);this.addEventNames(["onChildDragged","onChildDragging","onInit"]);return this};UIGrid.prototype.setRows=function(t){this.rows=t;return this};UIGrid.prototype.getRows=function(){return this.rows};UIGrid.prototype.setCols=function(t){this.cols=t;return this};UIGrid.prototype.getCols=function(){return this.cols};UIGrid.prototype.isCheckable=function(t){return this.checkable};UIGrid.prototype.setCheckable=function(t){this.checkable=t;return this};UIGrid.prototype.setChildChecked=function(t,e){if(t>=0&&t<this.children.length){this.children[t].checked=e}return this};UIGrid.prototype.isChildChecked=function(t){if(t<this.children.length){return this.children[t].checked}return false};UIGrid.prototype.getChildByRowCol=function(t,e){var i=this.getCols();var n=t*i+e;if(n<this.children.length){return this.children[n]}else{return null}};UIGrid.prototype.getChildRow=function(t){var e=this.getCols();var i=this.children.indexOf(t);return Math.floor(i/e)};UIGrid.prototype.getChildCol=function(t){var e=this.getCols();var i=this.children.indexOf(t);return i%e};UIGrid.prototype.exchangeTwoChildren=function(t,e,i){var n=this.children.length;if(t<0||t>=n||e<0||e>=n){return}var r=this.children[t];this.children[t]=this.children[e];this.children[e]=r;this.relayoutChildren(i);return this};UIGrid.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIGrid.prototype.childIsBuiltin=function(t){return t.name==="ui-last"};UIGrid.prototype.calcItemSize=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=Math.floor(t/this.cols);var n=Math.floor(e/this.rows);return{w:i,h:n,cols:this.cols,rows:this.rows}};UIGrid.prototype.sortChildren=function(){var t=this.calcItemSize();var e=t.h;var i=t.w;var n=this.children;n.sort(function(t,i){var n=0;var r=0;var o=Math.floor((t.top+5)/e);var a=Math.floor((i.top+5)/e);if(o===a){r=i.left;n=i.pointerDown&&i.hitTestResult===Shape.HIT_TEST_MM?t.left+t.w:t.left}else{n=o;r=a}return n-r});for(var r=0;r<n.length;r++){var o=n[r];o.z=r}return};UIGrid.prototype.getChildIndexByPoint=function(t){var e=this.getHMargin();var i=this.calcItemSize();var n=this.spacer;var r=this.getWidth(true);var o=this.getHeight(true);var a=i.w+n;var s=i.h+n;var l=Math.floor(r/a);var h=Math.floor(o/s);var u=Math.floor((t.y-e)/i.h);var p=Math.floor((t.x-e)/i.w);var c=u*l+p;return c};UIGrid.prototype.onChildDragging=function(t,e){var i=this.getChildIndexByPoint(e);var n=this.getIndexOfChild(t);this.callOnChildDraggingHandler(n,i);return};UIGrid.prototype.onChildDragged=function(t,e){var i=this.getChildIndexByPoint(e);var n=this.getIndexOfChild(t);this.callOnChildDraggedHandler(n,i);this.relayoutChildren("default");return};UIGrid.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=0;var i=0;var n=0;var r=0;var o=this.cols;var a=this.rows;var s=this.spacer;var l=this.getWidth(true);var h=this.getHeight(true);var u=Math.floor((l-(o-1)*s)/o);var p=Math.floor((h-(a-1)*s)/a);var c=u+s;var f=p+s;var m=this.h-a*f>>1;var d=this.w-o*c>>1;var y=0;var g=this.children.length;var v=this.children;for(var _=0;_<g;_++){var I=v[_];I.z=_;if(I.removed||!I.visible)continue;e=Math.floor(y/o);i=Math.floor(y%o);n=d+i*c;r=m+e*f;I.setSize(u,p);if(t||this.mode===Shape.MODE_EDITING){I.animMove(n,r,t)}else{I.move(n,r)}I.xAttr=UIElement.X_FIX_LEFT;I.yAttr=UIElement.Y_FIX_TOP;I.widthAttr=UIElement.WIDTH_FIX;I.heightAttr=UIElement.HEIGHT_FIX;I.setUserMovable(true);I.setUserResizable(false);I.relayoutChildren();if(!this.isUIScrollView){I.setDraggable(this.itemDraggable)}y++}return};UIGrid.prototype.afterChildAppended=function(t){if(this.mode===Shape.MODE_EDITING&&!this.disableRelayout){this.sortChildren()}this.moveMustBeLastItemToLast();t.setUserMovable(true);t.setUserResizable(false);t.setCanRectSelectable(false,true);t.setDraggable(this.itemDraggable);t.xAttr=UIElement.X_FIX_LEFT;t.yAttr=UIElement.Y_FIX_TOP;t.widthAttr=UIElement.WIDTH_FIX;t.heightAttr=UIElement.HEIGHT_FIX;if(this.mode===Shape.MODE_EDITING&&!this.disableRelayout){this.relayoutChildren()}return true};UIGrid.prototype.triggerDeleteMode=function(){if(this.mode===Shape.MODE_EDITING){return}this.deleteMode=!this.deleteMode;var t=this;function e(){t.postRedraw();if(t.deleteMode){setTimeout(e,20)}}e();return};UIGrid.prototype.isInDeleteMode=function(){return this.deleteMode&&this.mode!=Shape.MODE_EDITING};UIGrid.prototype.beforePaintChild=function(t,e){if(this.isInDeleteMode()){e.save();var i=t.left+t.w/2;var n=t.top+t.h/2;var r=e.now/1e3;var o=.03*Math.cos(20*r);e.translate(i,n);e.rotate(o);e.translate(-i,-n)}return};UIGrid.prototype.afterPaintChild=function(t,e){if(this.isInDeleteMode()){var i=this.getImageByType(UIElement.IMAGE_DELETE_ITEM);if(WImage.isValid(i)){var n=i.getImage();var r=i.getImageRect();var o=t.top+t.vMargin;var a=t.left+t.w-r.w-t.hMargin;e.drawImage(n,a,o);WImage.draw(e,n,WImage.DISPLAY_CENTER,a,o,r.w,r.h,r)}e.restore();return}if(this.checkable){if(t.checked){var i=this.getImageByType(UIElement.IMAGE_CHECKED_ITEM);if(WImage.isValid(i)){var n=i.getImage();var r=i.getImageRect();WImage.draw(e,n,WImage.DISPLAY_AUTO_SIZE_DOWN,t.left,t.top,t.w,t.h,r)}}}return};function UIGridCreator(t){var e=["ui-grid","ui-grid",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIGrid;return e.initUIGrid(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIGridCreator);function UIGridView(){return}UIGridView.prototype=new UIVScrollView;UIGridView.prototype.isUIGrid=true;UIGridView.prototype.isUILayout=true;UIGridView.prototype.isUIGridView=true;UIGridView.prototype.gridToJson=UIGrid.prototype.gridToJson;UIGridView.prototype.gridFromJson=UIGrid.prototype.gridFromJson;UIGridView.prototype.sortChildren=UIGrid.prototype.sortChildren;UIGridView.prototype.initUIGrid=UIGrid.prototype.initUIGrid;UIGridView.prototype.shapeCanBeChild=UIGrid.prototype.shapeCanBeChild;UIGridView.prototype.childIsBuiltin=UIGrid.prototype.childIsBuiltin;UIGridView.prototype.paintSelfOnly=UIGrid.prototype.paintSelfOnly;UIGridView.prototype.calcItemSize=UIGrid.prototype.calcItemSize;UIGridView.prototype.relayoutChildren=UIGrid.prototype.relayoutChildren;UIGridView.prototype.afterChildAppended=UIGrid.prototype.afterChildAppended;UIGridView.prototype.isInDeleteMode=UIGrid.prototype.isInDeleteMode;UIGridView.prototype.beforePaintChild=UIGrid.prototype.beforePaintChild;UIGridView.prototype.afterPaintChild=UIGrid.prototype.afterPaintChild;UIGridView.prototype.triggerDeleteMode=UIGrid.prototype.triggerDeleteMode;UIGridView.prototype.setCheckable=UIGrid.prototype.setCheckable;UIGridView.prototype.setChildChecked=UIGrid.prototype.setChildChecked;UIGridView.prototype.isChildChecked=UIGrid.prototype.isChildChecked;UIGridView.prototype.initUIGridView=function(t){this.initUIGrid(t);this.initUIVScrollView(t,0,null,null);this.setImage(UIElement.IMAGE_DELETE_ITEM,null);this.setImage(UIElement.IMAGE_CHECKED_ITEM,null);return this};UIGridView.prototype.onModeChanged=function(){this.offset=0;return};function UIGridViewCreator(){var t=["ui-grid-view","ui-grid-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGridView;return e.initUIGridView(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIGridViewCreator);function UIImageValue(){return}UIImageValue.prototype=new UIImage;UIImageValue.prototype.isUIImageValue=true;UIImageValue.prototype.initUIImageValue=function(t,e,i){this.initUIImage(t,e,i,null);this.value=0;return this};UIImageValue.prototype.getImageSrcByValue=function(t){var e="option_image_"+t;return this.getImageSrcByType(e)};UIImageValue.prototype.getValue=function(){return this.value};UIImageValue.prototype.setValue=function(t){var e=this.getImageSrcByValue(t);if(e){this.value=t;this.setImage(UIElement.IMAGE_DEFAULT,e)}return this.value};UIImageValue.prototype.inc=function(){var t=this.value+1;return this.setValue(t)};UIImageValue.prototype.dec=function(){var t=this.value-1;return this.setValue(t)};UIImageValue.prototype.getImages=function(){var t="";for(var e in this.images){var i=this.images[e];if(e.indexOf("option_image_")>=0&&i&&i.src){t+=i.src+"\n"}}return t};UIImageValue.prototype.setImages=function(t){var e=this.images.display;this.images={};this.images.display=e;if(t){var i=0;var n=0;var r=t.split("\n");for(var i=0;i<r.length;i++){var o=r[i];if(!o)continue;if(o.indexOf("/")===0){o=o.substr(1)}var a="option_image_"+n++;this.setImage(a,o)}this.setValue(this.value)}return this};UIImageValue.prototype.shapeCanBeChild=function(t){return false};function UIImageValueCreator(t,e,i){var n=["ui-image-value","ui-image-value",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIImageValue;return r.initUIImageValue(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIImageValueCreator(200,200,null));function UIImageThumbView(){return}UIImageThumbView.prototype=new UIImageView;UIImageThumbView.prototype.isUIImageThumbView=true;UIImageThumbView.prototype.initUIImageThumbView=function(t,e){
this.userImages=[];this.imageProxies=[];this.itemSize=0;this.setDefSize(t,e);this.initUIImageView(t,e);this.setItemSize=UIImageThumbView.prototype.setItemSize;this.getCacheCanvas=UIImageThumbView.prototype.getCacheCanvas;this.getCacheCanvasContext=UIImageThumbView.prototype.getCacheCanvasContext;this.setValue=UIImageThumbView.prototype.setValue;this.getCurrentImage=UIImageThumbView.prototype.getCurrentImage;this.getCurrentImageSrc=UIImageThumbView.prototype.getCurrentImageSrc;imageThumbViewInitCustomProp(this);this.errorImage=UIImageView.createImage("drawapp8/images/common/failed.png",null);this.loadingImage=UIImageView.createImage("drawapp8/images/common/loading.png",null);this.addEventNames(["onChanged"]);return this};UIImageThumbView.prototype.setItemSize=function(t){this.itemSize=t?t:100;if(t){this.setSizeLimit(100,t+10,2e3,2e3)}return};UIImageThumbView.prototype.setKeepRatio=function(t){if(this.keepRatio!=t){this.cacheInvalid=true}this.keepRatio=t;return};UIImageThumbView.prototype.getCacheCanvasContext=function(t,e){if(!this.cacheImagesCanvas){canvas=document.createElement("canvas");canvas.width=t;canvas.height=e;this.cacheImagesCanvas=canvas}if(canvas.width!=t){canvas.width=t}if(canvas.height!=e){canvas.height=e}var i=canvas.getContext("2d");i.clearRect(0,0,t,e);return i};UIImageThumbView.prototype.getCurrentImageSrc=function(){return this.currentImageProxy?this.currentImageProxy.src:null};UIImageThumbView.prototype.getCurrentImage=function(){return this.currentImageProxy?this.currentImageProxy.image:null};UIImageThumbView.prototype.setValue=function(t){for(var e=0;e<this.imageProxies.length;e++){var i=this.imageProxies[e];if(i.src.indexOf(t)>=0||t.indexOf(i.src)>=0){this.currentImageProxy=i;return this}}return this};UIImageThumbView.createImageProxy=function(t,e,i,n,r,o,a,s,l){var h={};h.x=o;h.y=a;h.w=s;h.h=l;h.src=e;h.imageState=UIImageView.IMAGE_STATE_PENDING;function u(e,i){var o=t.keepRatio;if(i){h.imageState=UIImageView.IMAGE_STATE_DONE;UIImageView.drawImageAtCenter(r,e,h.x,h.y,h.w,h.h,o)}else{h.imageState=UIImageView.IMAGE_STATE_ERROR;UIImageView.drawImageAtCenter(r,n,h.x,h.y,h.w,h.h,o)}console.log("onLoadDone: "+e.src);t.postRedraw()}h.image=UIImageView.createImage(e,u);if(h.imageState===UIImageView.IMAGE_STATE_PENDING){var p=t.keepRatio;UIImageView.drawImageAtCenter(r,i,h.x,h.y,h.w,h.h,p)}return h};UIImageThumbView.prototype.createCacheCanvas=function(){};UIImageThumbView.prototype.getCacheCanvas=function(){if(this.cacheInvalid||!this.cacheImagesCanvas){this.createCacheCanvas()}return this.cacheImagesCanvas};function UIImageThumbViewTape(){return}UIImageThumbViewTape.prototype=new UIHScrollView;UIImageThumbViewTape.prototype.isUIImageView=true;UIImageThumbViewTape.prototype.isUIImageThumbView=true;UIImageThumbViewTape.prototype.isUIImageThumbViewTape=true;UIImageThumbViewTape.prototype.initUIImageView=UIImageView.prototype.initUIImageView;UIImageThumbViewTape.prototype.initUIImageThumbView=UIImageThumbView.prototype.initUIImageThumbView;UIImageThumbViewTape.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIImageThumbViewTape.prototype.initUIImageThumbViewTape=function(t,e,i){this.initUIHScrollView(t,10,null);this.initUIImageThumbView(e,i);this.heightAttr=UIElement.HEIGHT_FIX;return this};UIImageThumbViewTape.prototype.getSpaceBetweenImages=function(){return this.spaceBetweenImages?this.spaceBetweenImages:2};UIImageThumbViewTape.prototype.createCacheCanvas=function(){var t=this.getSpaceBetweenImages();var e=this.w;var i=this.h;var n=this.itemSize>0&&this.itemSize<i?this.itemSize:i;var r=this.cacheImagesCanvas;var o=this.userImages.length;delete this.cacheInvalid;this.imageProxies.clear();this.currentImageProxy=null;if(!o){return}e=o*(n+t);var a=0;var s=Math.floor((i-n)/2);var l=this.errorImage;var h=this.loadingImage;var u=this.getCacheCanvasContext(e,i);for(var p=0;p<this.userImages.length;p++){var c=this.userImages[p];var f=UIImageThumbView.createImageProxy(this,c,h,l,u,a,s,n,n);this.imageProxies.push(f);a=a+n+t}return};UIImageThumbViewTape.prototype.getScrollRange=function(){var t=this.h;var e=this.getSpaceBetweenImages();var i=this.userImages.length*(t+e)+e;return i};UIImageThumbViewTape.prototype.paintChildren=function(t){return};UIImageThumbViewTape.prototype.getCacheCanvasOffset=function(){var t=Math.max(0,(this.w-this.cacheImagesCanvas.width)/2);return t};UIImageThumbViewTape.prototype.onClick=function(t,e){if(!this.imageProxies||!this.imageProxies.length||e){return}this.currentImageProxy=null;var i=t.x-this.getCacheCanvasOffset();for(var n=0;n<this.imageProxies.length;n++){var r=this.imageProxies[n];if(i>=r.x&&i<r.x+r.w){this.currentImageProxy=r}}this.callOnClickHandler(t);this.callOnChangedHandler(this.getCurrentImageSrc());return};UIImageThumbViewTape.prototype.paintSelfOnly=function(t){if(!this.userImages||!this.userImages.length||!this.getCacheCanvas()){t.rect(0,0,this.w,this.h);t.stroke();return}var e=0;var i=0;var n=this.h;var r=this.w;var o=this.getCacheCanvas();var a=this.getCacheCanvasOffset();var s=a;t.rect(0,0,this.w,this.h);t.clip();t.beginPath();if(this.offset>=0){if(s>this.offset){s=s-this.offset;var e=o.width;t.drawImage(this.cacheImagesCanvas,0,0,e,n,s,i,e,n);a=s}else{var l=this.offset-s;var e=Math.min(r,o.width-l);t.drawImage(this.cacheImagesCanvas,l,0,e,n,0,i,e,n);a=-l}}else{s=s-this.offset;var e=Math.min(r+this.offset,o.width);t.drawImage(this.cacheImagesCanvas,0,0,e,n,s,i,e,n);a=s}if(this.currentImageProxy){s=a+this.currentImageProxy.x;i=this.currentImageProxy.y;t.lineWidth=3;t.rect(s,i,this.currentImageProxy.w,this.currentImageProxy.h);t.stroke()}return};function UIUIImageThumbViewTapeCreator(){var t=["ui-image-thumb-view-tape","ui-image-thumb-view-tape",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageThumbViewTape;return e.initUIImageThumbViewTape(this.type,300,100)};return}function UIImageThumbViewGrid(){return}UIImageThumbViewGrid.prototype=new UIHScrollView;UIImageThumbViewGrid.prototype.isUIImageView=true;UIImageThumbViewGrid.prototype.isUIImageThumbView=true;UIImageThumbViewGrid.prototype.isUIImageThumbViewGrid=true;UIImageThumbViewGrid.prototype.initUIImageView=UIImageView.prototype.initUIImageView;UIImageThumbViewGrid.prototype.initUIImageThumbView=UIImageThumbView.prototype.initUIImageThumbView;UIImageThumbViewGrid.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIImageThumbViewGrid.prototype.initUIImageThumbViewGrid=function(t,e,i){this.initUIHScrollView(t,10,null);this.initUIImageThumbView(e,i);this.setSizeLimit(100,40,2e3,2e3);this.rows=4;this.cols=3;this.pageNr=1;this.itemSize=100;return this};UIImageThumbViewGrid.prototype.calcSize=function(){if(!this.userImages){return}if(this.isIcon){this.cols=3;this.rows=4;this.pageNr=1;return}var t=this.userImages.length;var e=this.getDeviceConfig();var i=e?e.lcdDensity:"hdpi";var n=this.getDensitySizeByName(i)/160;var r=this.w/n;var o=this.h/n;var a=Math.round(r/this.itemSize);var s=Math.round(o/this.itemSize);this.cols=a;this.rows=s;this.pageNr=Math.ceil(t/(s*a));return};UIImageThumbViewGrid.prototype.getSpaceBetweenImages=function(){return this.spaceBetweenImages?this.spaceBetweenImages:2};UIImageThumbViewGrid.prototype.createCacheCanvas=function(){var t=this.userImages.length;var e=this.getSpaceBetweenImages();delete this.cacheInvalid;this.imageProxies.clear();this.currentImageProxy=null;this.calcSize();if(!t){return}var i=0;var n=0;var r=0;var o=this.h;var a=this.pageNr*this.w;var s=this.getCacheCanvasContext(a,o);var l=Math.floor((this.w-e)/this.cols)-e;var h=Math.floor((this.h-e)/this.rows)-e;var u=this.errorImage;var p=this.loadingImage;for(var c=0;c<this.pageNr;c++){n=e;for(var f=0;f<this.rows;f++){i=c*this.w+e;for(var m=0;m<this.cols;m++,r++){if(r>=t){break}var d=this.userImages[r];var y=UIImageThumbView.createImageProxy(this,d,p,u,s,i,n,l,h);this.imageProxies.push(y);i=i+l+e}n=n+h+e}}return};UIImageThumbViewGrid.prototype.getScrollRange=function(){var t=this.pageNr*this.w;return t};UIImageThumbViewGrid.prototype.paintChildren=function(t){return};UIImageThumbViewGrid.prototype.getCacheCanvasOffset=function(){return this.getSpaceBetweenImages()};UIImageThumbViewGrid.prototype.onClick=function(t,e){if(!this.imageProxies||!this.imageProxies.length||e){return}var i=t.x;var n=t.y;var r=this.imageProxies.length;var o=Math.floor(i/this.w);var a=Math.floor(n*this.rows/this.h);var s=Math.floor(i%this.w*this.cols/this.w);var l=o*this.rows*this.cols+a*this.cols+s;if(l<r){this.currentImageProxy=this.imageProxies[l]}this.callOnClickHandler(t);this.callOnChangedHandler(this.getCurrentImageSrc());return this.callOnClickHandler(t)};UIImageThumbViewGrid.prototype.paintSelfOnly=function(t){var e=this.getSpaceBetweenImages();if(!this.userImages||!this.userImages.length||!this.getCacheCanvas()){t.rect(0,0,this.w,this.h);t.stroke();return}var i=0;var n=this.w;var r=this.offset;var o=this.getCacheCanvas();var a=o.height;var s=o.width;if(r>=0){var i=Math.min(n,s-r);t.drawImage(this.cacheImagesCanvas,r,0,i,a,0,0,i,a)}else{var i=Math.min(s+r,n);t.drawImage(this.cacheImagesCanvas,0,0,i,a,-r,0,i,a)}if(this.currentImageProxy){y=this.currentImageProxy.y;x=this.currentImageProxy.x-r;t.rect(x,y,this.currentImageProxy.w,this.currentImageProxy.h);t.lineWidth=3;t.strokeStyle=this.style.lineColor;t.stroke()}return};function UIUIImageThumbViewGridCreator(){var t=["ui-image-thumb-view-grid","ui-image-thumb-view-grid",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageThumbViewGrid;return e.initUIImageThumbViewGrid(this.type,300,100)};return}ShapeFactoryGet().addShapeCreator(new UIUIImageThumbViewTapeCreator);ShapeFactoryGet().addShapeCreator(new UIUIImageThumbViewGridCreator);function UILayout(){return}UILayout.prototype=new UIElement;UILayout.prototype.isUILayout=true;UILayout.prototype.initUILayout=function(t,e,i){this.initUIElement(t);this.spacer=10;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,false);this.vLayout=this.type==="ui-v-layout";this.addEventNames(["onInit"]);return this};UILayout.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var t=this.w;var e=this.h;var i=this.hMargin;var n=this.vMargin;var r=this.vLayout;var o=this.spacer?this.spacer:0;var a=this.children.length;var s=this.children;for(var l=0;l<a;l++){var h=s[l];if(!h.isVisible()){continue}if(r){h.top=n;h.left=t-h.w>>1;if(h.heightAttr===UIElement.HEIGHT_SCALE){h.h=h.heightParam*e}n+=h.h+o}else{h.left=i;h.top=e-h.h>>1;if(h.widthAttr===UIElement.WIDTH_SCALE){h.w=h.widthParam*t}i+=h.w+o}h.relayoutChildren()}return};function UILayoutCreator(t){var e=[t,t,null,true];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UILayout;return e.initUILayout(this.type,100,100)};return}UILayout.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;ShapeFactoryGet().addShapeCreator(new UILayoutCreator("ui-v-layout"));ShapeFactoryGet().addShapeCreator(new UILayoutCreator("ui-h-layout"));function UIFrames(){return}UIFrames.prototype=new UIElement;UIFrames.prototype.isUIFrames=true;UIFrames.prototype.initUIFrames=function(t){this.initUIElement(t);this.current=0;this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.addEventNames(["onChanged"]);return this};UIFrames.preparseBackendCanvas=function(t,e){var i=t.w;var n=t.h;var r=Animation.getBackendCanvas(2*i,n);var o=r.getContext("2d");o.timeStep=0;o.now=Date.now();o.clearRect(0,0,2*i,n);o.save();t.paint(o);o.translate(i,0);e.paint(o);o.restore();return r};UIFrames.prototype.getStatusString=function(){var t="";var e=this.current+1;var i=this.children.length;var n=this.getCurrentFrame();e=e<=i?e:i;if(n&&n.name){t=n.name+"("+e+"/"+i+")"}else{t=e+"/"+i}return t};UIFrames.prototype.getCurrent=function(){return this.current};UIFrames.prototype.setCurrent=function(t){if(this.current!==t){this.current=t;if(this.mode!=Shape.MODE_EDITING){this.callOnChangedHandler(t)}}return this};UIFrames.prototype.getCurrentFrame=function(){if(this.children.length<1){return null}if(this.current<0||!this.current){this.current=0}if(this.current>=this.children.length){this.current=this.children.length-1}return this.children[this.current]};UIFrames.prototype.fixChildSize=function(t){return};UIFrames.prototype.fixChildPosition=function(t){var e=t.left;var i=t.top;var n=t.h;var r=t.w;if(t.freePosition){return}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){e=this.getHMargin();r=this.getWidth(true)}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){i=this.getVMargin();n=this.getHeight(true)}t.left=e;t.top=i;t.h=n;t.w=r;return};UIFrames.prototype.setTarget=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(!t){i.setSelected(false);continue}if(i!=t&&i!=t.popupWindow){i.setSelected(false)}}this.targetShape=t;this.selected=!t;return};UIFrames.prototype.dispatchPointerDownToChildren=function(t){var e=null;if(this.children.length<1){return false}e=this.getCurrentFrame();if(e.onPointerDown(t)){this.setTarget(e);return true}return false};UIFrames.prototype.addShapeIntoChildren=function(t,e){var i=null;if(this.children.length<1){return false}i=this.getCurrentFrame();return i.addShape(t,true,e)};UIFrames.prototype.paintChildren=function(t){var e=this.getCurrentFrame();if(e){t.save();t.beginPath();e.paintSelf(t);t.restore()}return};UIFrames.prototype.showNextFrame=function(){this.showFrame(this.current+1);this.relayoutChildren();return};UIFrames.prototype.getFrame=function(t){if(t<0||t>=this.children.length){return null}return this.children[t]};UIFrames.prototype.getFrameIndex=function(t){return this.getIndexOfChild(t)};UIFrames.prototype.getFrames=function(){return this.children.length};UIFrames.prototype.showPrevFrame=function(){this.showFrame(this.current-1);this.relayoutChildren();return};UIFrames.prototype.showFrame=function(t){this.current=(t+this.children.length)%this.children.length;var e=this.children[this.current];if(e){e.show(true)}return};UIFrames.prototype.shapeCanBeChild=function(t){return true};UIFrames.prototype.initDefaultNameForChild=function(t){};UIFrames.prototype.relayoutChildren=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.left=0;e.top=0;e.w=this.w;e.h=this.h;e.widthAttr=UIElement.WIDTH_FILL_PARENT;e.heightAttr=UIElement.HEIGHT_FILL_PARENT;e.relayoutChildren()}return};UIFrames.prototype.afterChildAppended=function(t){this.current=this.children.length-1;if(!t.name){this.initDefaultNameForChild(t)}return};UIFrames.prototype.onChildRemoved=function(t){return};UIFrames.prototype.afterChildRemoved=function(t){if(this.children.length===0){this.current=0}else if(this.current>=this.children.length){this.current--}this.onChildRemoved(t);return};UIFrames.prototype.findChildByPoint=function(t,e){var i=this.translatePoint(t);var n=this.getCurrentFrame();if(n){return n.findChildByPoint(i,e)}return this};function UIFramesCreator(){var t=["ui-frames","ui-frames",null,0];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFrames;return e.initUIFrames(this.type)};return}function UICheckBox(){return}UICheckBox.prototype=new UIElement;UICheckBox.prototype.isUICheckBox=true;UICheckBox.prototype.initUICheckBox=function(t){this.initUIElement(t);this.setDefSize(100,100);this.setTextType(Shape.TEXT_INPUT);this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.setImage(UIElement.IMAGE_CHECKED_FG,null);this.setImage(UIElement.IMAGE_UNCHECK_FG,null);this.addEventNames(["onChanged","onUpdateTransform"]);this.value=false;return this};UICheckBox.prototype.shapeCanBeChild=function(t){return t.isUIImage||t.isUILabel};UICheckBox.prototype.getValue=function(){return this.value};UICheckBox.prototype.setValue=function(t){if(this.value!=t){this.value=t;this.callOnChangedHandler(this.value)}return this};UICheckBox.prototype.getBgImage=function(){return this.getImageByType(this.getValue()?UIElement.IMAGE_CHECKED_FG:UIElement.IMAGE_UNCHECK_FG)};UICheckBox.prototype.getTextColor=function(t){return this.getValue()?this.style.textColorOn:this.style.textColor};UICheckBox.prototype.onClick=function(t,e){if(e){return}this.setValue(!this.getValue());this.callOnClickHandler(t);return};function UICheckBoxCreator(){var t=["ui-checkbox","ui-checkbox",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UICheckBox;return e.initUICheckBox(this.type)};return}ShapeFactoryGet().addShapeCreator(new UICheckBoxCreator);function UISwitch(){return}UISwitch.prototype=new UICheckBox;UISwitch.prototype.isUISwitch=true;UISwitch.prototype.initUISwitch=function(t,e,i,n,r){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,r);this.value=true;this.imageWidth=412;this.maskWidth=n;this.offsetImage=n;this.addEventNames(["onChanged"]);this.interpolator=new DecelerateInterpolator(2);return this};UISwitch.prototype.updateImageSize=function(t){this.imageWidth=t;this.maskWidth=Math.floor(t*.373786);if(!this.animating){this.offsetImage=this.value?this.maskWidth:this.imageWidth-this.maskWidth}return};UISwitch.prototype.animateChange=function(){var t=this;var e=new Date;var i=e.getTime();var n=this.offsetImage;var r=this.value?this.maskWidth:this.imageWidth-this.maskWidth;var o=r-n;this.animating=true;var a=500;function s(){var e=new Date;var l=e.getTime();var h=(l-i)/a;var u=t.interpolator.get(h);var p=n+o*u;if(h<1){t.offsetImage=p;setTimeout(s,10)}else{t.offsetImage=r;delete this.animating}t.postRedraw();delete e;return}setTimeout(s,30);return};UISwitch.prototype.onClick=function(t,e){if(e||this.mode!==Shape.MODE_EDITING){return}this.setValue(!this.value);return};UISwitch.prototype.onPointerDownRunning=function(t,e){if(e){return}this.pointerDownPosition=t;return};UISwitch.prototype.onPointerUpRunning=function(t,e){if(e){return}var i=t.x-this.pointerDownPosition.x;if(Math.abs(i)<5){this.setValue(!this.value)}else{this.setValue(i>0)}return};UISwitch.prototype.setValue=function(t){if(this.value!=t){this.value=t;this.callOnChangedHandler(this.value);this.animateChange()}return this};UISwitch.prototype.drawBgImage=function(t){return};UISwitch.prototype.drawFgImage=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(e){this.updateImageSize(e.width);var i=e.height;var n=this.maskWidth;var r=(this.w-n)/2;var o=(this.h-i)/2;this.imageWidth=e.width;t.drawImage(e,this.offsetImage,0,n,i,r,o,n,i);t.drawImage(e,0,0,n,i,r,o,n,i)}return};function UISwitchCreator(t,e,i,n){var r=["ui-switch","ui-switch",null,1];ShapeCreator.apply(this,r);this.createShape=function(r){var o=new UISwitch;return o.initUISwitch(this.type,t,e,i,n)};return}ShapeFactoryGet().addShapeCreator(new UISwitchCreator(154,54,154,null));function UISimpleHTML(){return}UISimpleHTML.prototype=new UIVScrollView;UISimpleHTML.prototype.isUISimpleHTML=true;UISimpleHTML.prototype.initUISimpleHTML=function(t,e,i){this.initUIVScrollView(t,10,i,null);this.setText(e);this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,i);return this};UISimpleHTML.prototype.extractHtmlElements=function(t,e){var i=0;var n=null;var r=this;var o=t.localName;var a=t.childNodes.length;var s=t.childNodes;function l(t){var e={x:0,y:0};e.type=t;return e}if(o==="b"){this.bold=this.bold+1}else if(o==="i"){this.italic=this.italic+1}else if(o==="u"){this.underline=this.underline+1}else if(o==="a"){this.anchor=this.anchor+1}else if(o==="ol"||o==="ul"){if(e>0){n=l("newline")}}else if(o==="li"){n=l("text");if(t.parentNode.localName==="ol"){n.value="    "+(e+1)+". "}else{n.value="    o. "}n.bold=true;n.color="gray";n.fontStyle="bold "}var h=null;if(t.style&&t.style.color){h=t.style.color}if(!h&&t.getAttribute){h=t.getAttribute("color")}if(!h&&this.colors.length){h=this.colors[this.colors.length-1]}this.colors.push(h||"black");if(n){n.tag=o;this.elements.push(n);n=null}for(var i=0;i<a;i++){var u=s[i];this.extractHtmlElements(u,i)}if(o==="img"&&t.src){var p=t.src;var c=new Image;c.onload=function(t){n.imageLoaded=true;r.textNeedRelayout=true;return};c.onerror=function(t){n.imageLoaded=false;if(p){console.log("load "+p+" failed.")}};c.onabort=function(t){n.imageLoaded=false;if(p){console.log("load "+p+" failed(abort).")}};c.src=p;n=l("img");n.value=c;n.displayWidth=t.width;n.displayHeight=t.height}else if(!a&&t.textContent){var f=t.textContent.replace(/(\t|\n|\r)+/g,"");var m=f.replace(/ +/g," ");if(m){n=l("text");n.value=m;n.bold=this.bold;n.italic=this.italic;n.underline=this.underline;n.anchor=this.anchor;n.fontStyle="";if(this.colors.length){n.color=this.colors[this.colors.length-1]}if(n.bold){n.fontStyle=n.fontStyle+"bold "}if(n.italic){n.fontStyle=n.fontStyle+"italic "}}}if(o==="b"){this.bold=this.bold-1}if(o==="i"){this.italic=this.italic-1}if(o==="u"){this.underline=this.underline-1}if(o==="a"){n=l("a");n.href=t.href;this.anchor=this.anchor-1}if(o==="p"||t.style!=null&&t.style.display==="block"){n=l("newblock")}else if(o==="li"||o==="br"||o==="hr"||o==="dd"){n=l("newline")}this.colors.pop();if(n){n.tag=o;this.elements.push(n)}return};UISimpleHTML.prototype.getNodeByPoint=function(t){var e=0;var i=t.x;var n=t.y;var r=null;var o=null;var a={};var s=this.elements.length;var l=this.elements;for(e=0;e<s;e++){r=l[e];o=e+1<s?l[e+1]:null;if(n<r.y){continue}if(o&&(n>o.y&&r.y<o.y)){continue}if(r.type==="text"){var h=0;var u=r.lines.length;a.h=r.lineHeight;for(h=0;h<u;h++){a.x=0;a.y=r.y+h*r.lineHeight;if(h===0){a.x=r.x;a.w=r.firstLineWidth}else if(h+1===u){a.w=r.lastLineWidth}else{a.w=this.w}if(isPointInRect(t,a)){return r}}}else if(r.type==="img"){a.x=r.x;a.y=r.y;a.w=r.w;a.h=r.h;if(isPointInRect(t,a)){return r}}}return r};UISimpleHTML.prototype.layoutHtmlElements=function(t){var e=0;var i=0;var n=0;var r=null;var o=0;var a=null;var s=this.elements.length;var l=this.elements;var h=this.getWidth(true);var u=this.style.fontSize;var p=new TextLayout(t);var c=u+"pt "+this.style.fontFamily;var f=u*2;t.font=c;for(e=0;e<s;e++){r=l[e];if(r.type==="text"){r.lines=[];r.x=i;r.y=n;r.firstLineWidth=0;t.font=r.fontStyle+c;r.lineHeight=f;p.setText(r.value);while(true){o=h-i;if(p.hasNext()){a=p.nextLine(o,u);r.lines.push(a.text);if(r.lines.length===1){r.firstLineWidth=a.width}if(p.hasNext()){i=0;n=n+f}else{i=i+a.width;r.lastLineWidth=a.width;break}}else{break}}}else if(r.type==="newline"){r.x=i;r.y=n;i=0;n=n+f}else if(r.type==="newblock"){r.x=i;r.y=n;i=0;n=n+f*1.5}else if(r.type==="img"){if(r.imageLoaded){var m=r.value;var d=m.height/m.width;var y=r.displayWidth?r.displayWidth:m.width;var g=r.displayHeight?r.displayHeight:m.height;r.y=n+f*.5;if(y<h){r.w=y;r.x=Math.floor((h-y)/2);r.h=Math.floor(r.w*d)}else{r.x=0;r.w=h;r.h=Math.floor(r.w*d)}n=r.y+r.h;n=n+.5*f}else{n=n+f}i=0}this.scrollRange=n}return};UISimpleHTML.prototype.getScrollRange=function(){return this.scrollRange?this.scrollRange:this.h};UISimpleHTML.prototype.loadUrl=function(t,e){var i={};var n=this;i.method="GET";i.url=t;i.headers={"Cache-Control":"no-cache",Pragma:"no-cache"};i.onDone=function(t,i,r){var o=i.status===200;if(i.status===200){var a=r;try{n.setText(a);console.log("loadUrl: done")}catch(s){o=false;console.log("loadUrl: failed"+s.message)}}if(e){e(o)}return};httpDoRequest(i);return};UISimpleHTML.prototype.setText=function(t){this.text=this.toText(t);this.elements=[];var e=document.createElement("div");e.innerHTML=this.text;this.bold=0;this.anchor=0;this.italic=0;this.underline=0;this.strong=0;this.colors=[];this.extractHtmlElements(e,0);delete this.colors;delete this.anchor;delete this.bold;delete this.italic;delete this.underline;delete this.strong;this.textNeedRelayout=true;return};UISimpleHTML.prototype.layoutHtml=function(t){if(!this.textNeedRelayout){return}if(!this.text){return}this.layoutHtmlElements(t);this.textNeedRelayout=false;return};UISimpleHTML.prototype.shapeCanBeChild=function(t){return false};UISimpleHTML.prototype.paintSelfOnly=function(t){var e=0;var i=0;var n=0;var r=0;var o=this.h;var a=this.w;var s=null;var l=this.hMargin;var h=this.getWidth(true);var u=this.style.fontSize;var p=2*u;var c=this.hMargin;var f=-this.offset+this.vMargin;var m=u+"pt "+this.style.fontFamily;this.layoutHtml(t);t.save();t.rect(0,0,a,o);t.clip();if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fill()}t.beginPath();t.font=m;t.textAlign="left";t.textBaseline="top";t.fillStyle=this.style.textColor;var d=this.elements.length;var y=this.elements;for(e=0;e<d;e++){s=y[e];if(s.type==="text"&&s.lines&&s.lines.length){var g=s.lines.length;t.font=s.fontStyle+m;if(s.color){t.fillStyle=s.color}else if(s.anchor){t.fillStyle="Blue"}else{t.fillStyle=this.style.textColor}for(k=0;k<g;k++){if(k===0){i=s.x;n=s.y}else{i=0;n=s.y+k*p}i=i+c;n=n+f;r=n+u;if(n<o&&r>=0){h=a-i-l;t.fillText(s.lines[k],i,n,h)}}}else if(s.type==="img"&&s.imageLoaded){var v=s.value;var _=v.width;var I=v.height;i=s.x+c;n=s.y+f;r=n+s.h;if(n<o&&r>=0){t.drawImage(v,0,0,_,I,i,n,s.w,s.h)}}}t.restore();return};function UISimpleHTMLCreator(){var t=["ui-simple-html","ui-simple-html",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISimpleHTML;var i="Simpe HTML";return e.initUISimpleHTML(this.type,i,null)};return}ShapeFactoryGet().addShapeCreator(new UISimpleHTMLCreator);function UIHtmlView(){return}UIHtmlView.prototype=new UIHtml;UIHtmlView.prototype.isUIHtmlView=true;UIHtmlView.prototype.getHtmlContent=function(){var t="<p>hello html view";var e=this.getWidth(true);var i=this.getHeight(true);var n=this.getUrl();var r=this.getValue();if(n){t='<iframe seamless="seamless" scrolling="yes" width="'+e+'" height="'+i+'" src="'+n+'"></iframe>'}else if(r){t=r}return t};UIHtmlView.prototype.setText=function(t){this.text=t;return};UIHtmlView.prototype.getValue=function(){return this.text?this.text:""};UIHtmlView.prototype.setValue=function(t){this.text=t;return};UIHtmlView.prototype.getUrl=function(){return this.url?this.url:""};UIHtmlView.prototype.setUrl=function(t){this.url=t;return};UIHtmlView.prototype.paintSelfOnly=function(t){if(!this.htmlVisible){var e=this.w>>1;var i=this.h>>1;var n=dappGetText("HtmlView");t.textBaseline="middle";t.textAlign="center";t.font=this.style.getFont();t.fillStyle=this.style.textColor;t.fillText(n,e,i)}return};UIHtmlView.prototype.initUIHtmlView=function(t){this.initUIHtml(t,400,300);this.setValue("<p>hello html view");this.setImage(UIElement.IMAGE_DEFAULT,null);this.setScrollable(true);return this};function UIHtmlViewCreator(){var t=["ui-html-view","ui-html-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIHtmlView;return e.initUIHtmlView(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIHtmlViewCreator);function UIButtonGroup(){return}UIButtonGroup.prototype=new UIElement;UIButtonGroup.prototype.isUIButtonGroup=true;UIButtonGroup.prototype.initUIButtonGroup=function(t,e,i,n){this.initUIElement(t);this.setMargin(e,e);this.setDefSize(300,60);this.setSizeLimit(100,40,1e3,120);this.buttonMaxWidth=i;this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.rectSelectable=false;this.addEventNames(["onInit"]);if(!n){this.style.setFillColor("White")}return this};UIButtonGroup.prototype.shapeCanBeChild=function(t){if(t.isUILabel||t.isUIImage||t.isUIButton||t.isUIGroup||t.isUIRadioBox||t.isUICheckBox){return true}return false};UIButtonGroup.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e&&!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};UIButtonGroup.prototype.relayoutChildren=function(){var t=this.getHMargin();var e=this.getVMargin();var i=this.children.length;if(i===0||this.disableRelayout){return}var n=t;var r=e;var o=this.h-2*e;var a=this.buttonMaxWidth;var s=Math.floor((this.w-2*t)/i);var l=Math.min(s,a);for(var h=0;h<i;h++){var u=this.children[h];n=h*s+(s-l)/2+t;u.setLeftTop(n,r);u.setSize(l,o);u.setUserMovable(false);u.setUserResizable(false);u.relayoutChildren()}this.w=s*i+2*t;return};UIButtonGroup.prototype.afterChildAppended=function(t){t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;return true};function UIButtonGroupCreator(t,e,i){var n=["ui-button-group","ui-button-group",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIButtonGroup;return r.initUIButtonGroup(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIButtonGroupCreator(5,200,null));function UIPageIndicator(){return}UIPageIndicator.prototype=new UIHScrollView;UIPageIndicator.prototype.isUIPageIndicator=true;UIPageIndicator.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIPageIndicator.prototype.isScrollable=function(){return this.getPages()>this.getVisibleTabs()};UIPageIndicator.prototype.setVisibleTabs=function(t){this.visibleTabs=t;return};UIPageIndicator.prototype.getVisibleTabs=function(){return this.visibleTabs?this.visibleTabs:6};UIPageIndicator.prototype.getTabWidth=function(){var t=this.getPages();var e=this.getVisibleTabs();if(t<e){return this.w/t}else{return this.w/e}};UIPageIndicator.prototype.getScrollRange=function(){var t=this.getVisibleTabs();if(t<6){return this.w}else{var e=this.getPages();return this.getTabWidth()*e}};UIPageIndicator.prototype.initUIPageIndicator=function(t,e,i){this.initUIHScrollView(t,10,null);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setCanRectSelectable(false,false);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;return this};UIPageIndicator.prototype.getViewPager=function(){if(!this.getParent()){return}if(this.viewPager&&!this.viewPager.parentShape){this.viewPager=null}if(!this.viewPager){this.viewPager=this.getParent().findChildByType("ui-view-pager",true);if(!this.viewPager&&this.isUIPageIndicatorSimple){this.viewPager=this.getWindow().findChildByType("ui-view-pager",true)}}if(this.viewPager){this.viewPager.setShowIndicator(false)}return this.viewPager};UIPageIndicator.prototype.getViewPagerOffset=function(){var t=this.getViewPager();return t?t.offset/t.w:0};UIPageIndicator.prototype.getPages=function(){var t=this.getViewPager();if(t){t.pageIndicator=this}return t?t.getFrames():3};UIPageIndicator.prototype.getCurrent=function(){var t=this.getViewPager();return t?t.getCurrent():0};UIPageIndicator.prototype.paintOneIndicator=function(t,e,i,n,r,o,a){t.beginPath();t.arc(n+o/2,r+a/2,10,0,2*Math.PI);t.fill();if(e){t.stroke()}return};UIPageIndicator.prototype.shapeCanBeChild=function(t){return false};UIPageIndicator.prototype.paintOneIndicatorCircle=function(t,e,i,n,r,o,a){var s=Math.floor(Math.max(5,a/4));t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.lineColorOfCurrent:this.style.lineColor;t.beginPath();t.arc(n+o/2,r+a/2,s,0,2*Math.PI);t.fill();t.stroke();return};UIPageIndicator.prototype.paintOneIndicatorNumber=function(t,e,i,n,r,o,a){var s=Math.floor(Math.max(5,a/4));var l=Math.floor(n+o/2);var h=Math.floor(r+a/2);t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.lineColorOfCurrent:this.style.lineColor;t.beginPath();t.arc(l,h,s,0,2*Math.PI);t.fill();t.stroke();t.font=s<20?"16px sans":"22px sans";t.textAlign="center";t.textBaseline="middle";t.fillStyle=this.style.textColor;t.fillText(i+1,l,h);return};UIPageIndicator.prototype.paintOneIndicatorRect=function(t,e,i,n,r,o,a){var s=10;if(o>a){s=Math.max(20,a/4)}else{s=Math.max(20,o/4)}s=Math.floor(s);t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.lineColorOfCurrent:this.style.lineColor;var l=(o-s)/2;var h=(a-s)/2;t.beginPath();t.rect(n+l,r+h,s,s);t.fill();t.stroke();return};UIPageIndicator.prototype.paintOneIndicatorLine=function(t,e,i,n,r,o,a){var s=4;if(o>a){s=Math.max(4,a/4)}else{s=Math.max(4,o/4)}s=Math.floor(s);t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.fillColorOfCurrent:this.style.fillColor;
t.strokeStyle=e?this.lineColorOfCurrent:this.style.lineColor;var l=(o-s)/2;var h=(a-s)/2;t.beginPath();if(o>a){t.rect(n,r+h,o,s)}else{t.rect(n+l,r,s,a)}t.fill();t.stroke();return};UIPageIndicator.prototype.onClickItem=function(t){var e=this.getViewPager();if(e){e.setCurrent(t)}return};UIPageIndicator.prototype.findItemByPoint=function(t){var e=this.getPages();if(this.w>this.h){var i=this.getTabWidth();for(var n=0;n<e;n++){if(t.x>n*i&&t.x<(n+1)*i){return n}}}else{var r=this.h/e;for(var n=0;n<e;n++){if(t.y>n*r&&t.y<(n+1)*r){return n}}}return-1};UIPageIndicator.prototype.onClick=function(t,e){if(e){return}var i=this.findItemByPoint(t);if(i>=0){this.onClickItem(i)}this.callOnClickHandler(t);return};UIPageIndicator.prototype.paintBackground=function(t){var e=this.getPages();if(!e){t.lineWidth=1;t.strokeStyle="Red";t.rect(0,0,this.w,this.h);t.stroke()}};UIPageIndicator.prototype.paintSelfOnly=function(t){var e=this.getPages();var i=this.getCurrent();var n={};n.x=this.lastPosition.x-this.left;n.y=this.lastPosition.y-this.top;this.pointerOnItem=this.findItemByPoint(n);this.paintBackground(t);t.translate(-this.offset,0);if(this.w>this.h){var r=this.h;var o=this.getTabWidth();var a=Math.floor(this.getViewPagerOffset()*o);for(var s=0;s<e;s++){var l=s*o;this.paintOneIndicator(t,s===i,s,l,0,o,r)}}else{var o=this.w;var r=this.h/e;for(var s=0;s<e;s++){var h=s*r;this.paintOneIndicator(t,s===i,s,0,h,o,r)}}t.translate(this.offset,0);delete this.pointerOnItem;return};function UIPageIndicatorCreator(){var t=["ui-page-indicator","ui-page-indicator",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicator;return e.initUIPageIndicator(this.type,200,60)};return}function UIPageIndicatorSimple(){return}UIPageIndicatorSimple.prototype.isScrollable=function(){return this.getPages()>this.getVisibleTabs()};UIPageIndicatorSimple.prototype=new UIPageIndicator;UIPageIndicatorSimple.prototype.isUIPageIndicatorSimple=true;UIPageIndicatorSimple.prototype.initUIPageIndicatorSimple=function(t,e,i){this.initUIPageIndicator(t,e,i);this.fillColorOfCurrent="Gray";this.lineColorOfCurrent="Black";this.setAlwaysOnTop(true);this.setVisibleTabs(12);return this};UIPageIndicatorSimple.prototype.setLineColorOfCurrent=function(t){this.lineColorOfCurrent=t;return};UIPageIndicatorSimple.prototype.setFillStyleOfCurrent=function(t){this.fillColorOfCurrent=t;return};function UIPageIndicatorCircleCreator(){var t=["ui-page-indicator-circle","ui-page-indicator-circle",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;e.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorCircle;return e.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorNumberCreator(){var t=["ui-page-indicator-number","ui-page-indicator-number",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;e.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorNumber;return e.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorRectCreator(){var t=["ui-page-indicator-rect","ui-page-indicator-rect",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;e.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorRect;return e.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorLineCreator(){var t=["ui-page-indicator-line","ui-page-indicator-line",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;e.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorLine;return e.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorNormal(){return}UIPageIndicatorNormal.prototype=new UIPageIndicator;UIPageIndicatorNormal.prototype.isUIPageIndicatorNormal=true;UIPageIndicatorNormal.prototype.initUIPageIndicatorNormal=function(t,e,i){this.initUIPageIndicator(t,e,i);this.itemTexts=[];this.itemImages=[];this.imagePosition="left";this.itemImagesOfCurrent=[];this.setMargin(5,5);this.setAlwaysOnTop(false);this.setImage(UIElement.ITEM_BG_NORMAL,null);this.setImage(UIElement.ITEM_BG_ACTIVE,null);this.setImage(UIElement.ITEM_BG_CURRENT_NORMAL,null);this.setImage(UIElement.ITEM_BG_CURRENT_ACTIVE,null);return this};UIPageIndicatorNormal.prototype.onInit=function(){this.syncImages()};UIPageIndicatorNormal.prototype.syncImages=function(){this.itemImages=[];this.itemImagesOfCurrent=[];for(var t in this.images){if(t==="display")continue;var e=this.images[t];if(t.indexOf("current-item-images-")===0){this.itemImagesOfCurrent.push(e)}else if(t.indexOf("item-images-")===0){this.itemImages.push(e)}}return};UIPageIndicatorNormal.prototype.setEnableAnimatePage=function(t){this.enableAnimatePage=t;return};UIPageIndicatorNormal.prototype.setItemImagesByStr=function(t){var e=t.split("\n");var i="item-images-";var n=this.itemImages.length;for(var r=0;r<n;r++){this.setImage(i+r,null)}for(var r=0;r<e.length;r++){var o=e[r];if(o){this.setImage(i+r,o)}}this.syncImages();this.strItemImages=t;return};UIPageIndicatorNormal.prototype.setItemImagesOfCurrentByStr=function(t){var e=t.split("\n");var i="current-item-images-";var n=this.itemImagesOfCurrent.length;for(var r=0;r<n;r++){this.setImage(i+r,null)}for(var r=0;r<e.length;r++){var o=e[r];if(o){this.setImage(i+r,o)}}this.syncImages();this.strItemImagesOfCurrent=t;return};UIPageIndicatorNormal.prototype.setItemTextsByStr=function(t){this.strItemTexts=t;this.itemTexts=t.split("\n");return};UIPageIndicatorNormal.prototype.setImagePosition=function(t){this.imagePosition=t;return};UIPageIndicatorNormal.prototype.getItemImagesStr=function(){return this.strItemImages?this.strItemImages:""};UIPageIndicatorNormal.prototype.getItemImagesStrOfCurrent=function(){return this.strItemImagesOfCurrent?this.strItemImagesOfCurrent:""};UIPageIndicatorNormal.prototype.getItemImages=function(){if(!this.itemImages.length){this.syncImages()}return this.itemImages};UIPageIndicatorNormal.prototype.getItemImagesOfCurrent=function(){if(!this.itemImagesOfCurrent.length){this.syncImages()}return this.itemImagesOfCurrent};UIPageIndicatorNormal.prototype.getItemTextsStr=function(){return this.strItemTexts?this.strItemTexts:""};UIPageIndicatorNormal.prototype.getItemTexts=function(){if(!this.itemTexts.length&&this.strItemTexts){this.setItemTextsByStr(this.strItemTexts)}return this.itemTexts};UIPageIndicatorNormal.prototype.getItemImage=function(t,e){var i=e?this.getItemImagesOfCurrent():this.getItemImages();if(i&&t<i.length){return i[t]}return null};UIPageIndicatorNormal.prototype.getBackgroundImage=function(t,e){var i="";var n=this.pointerDown&&this.pointerOnItem===t;if(e){i=n?UIElement.ITEM_BG_CURRENT_ACTIVE:UIElement.ITEM_BG_CURRENT_NORMAL}else{i=n?UIElement.ITEM_BG_ACTIVE:UIElement.ITEM_BG_NORMAL}return this.getImageByType(i)};UIPageIndicatorNormal.prototype.paintOneIndicatorBackground=function(t,e,i,n,r,o,a){var s=this.getBackgroundImage(i,e);if(!s||!s.getImage()){return}var l=s.getImage();var h=s.getImageRect();this.drawImageAt(t,l,this.images.display,n,r,o,a,h);return};UIPageIndicatorNormal.prototype.setItemTextColorOfCurrent=function(t){this.itemTextColorOfCurrent=t;return};UIPageIndicatorNormal.prototype.getItemTextColorOfCurrent=function(){return this.itemTextColorOfCurrent?this.itemTextColorOfCurrent:"green"};UIPageIndicatorNormal.prototype.paintBackground=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_NORMAL);if(!e){t.fillStyle=this.style.fillColor;t.rect(0,0,this.w,this.h);t.fill()}return};UIPageIndicatorNormal.prototype.getItemLocaleText=function(t){var e=null;var i=this.getItemTexts();if(i&&t<i.length){e=webappGetText(i[t]);if(!e){e=i[t]}}return e};UIPageIndicatorNormal.prototype.paintOneIndicator=function(t,e,i,n,r,o,a){var s=this.getItemImage(i,e);this.paintOneIndicatorBackground(t,e,i,n,r,o,a);var l=8;var h=this.style.fontSize;var u=this.getItemLocaleText(i);t.font=this.style.getFont();t.fillStyle=e?this.getItemTextColorOfCurrent():this.style.textColor;if(s&&s.getImage()){var p=s.getImage();var c=s.getImageRect();var f=this.hMargin;var m=this.vMargin;if(u){var h=this.style.fontSize;var d=n+f;var y=r+m;var g=o-2*f;var v=a-h-2*m-l;this.drawImageAt(t,p,UIElement.IMAGE_DISPLAY_AUTO,d,y,g,v,c);d=n+(o>>1);y=r+a-m;t.textAlign="center";t.textBaseline="bottom";t.fillText(u,d,y)}else{var d=n+f;var y=r+m;var g=o-2*f;var v=a-2*m;this.drawImageAt(t,p,UIElement.IMAGE_DISPLAY_AUTO,d,y,g,v,c)}}else{if(u){t.textAlign="center";t.textBaseline="middle";t.fillText(u,Math.floor(n+o/2),Math.floor(r+a/2))}}return};UIPageIndicator.prototype.onClickItem=function(t){var e=this.getViewPager();if(e){if(this.enableAnimatePage){e.switchTo(t)}else{e.setCurrent(t)}}return};function UIPageIndicatorNormalCreator(){var t=["ui-page-indicator-normal","ui-page-indicator-normal",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorNormal;return e.initUIPageIndicatorNormal(this.type,200,60)};return}ShapeFactoryGet().addShapeCreator(new UIPageIndicatorNormalCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorCircleCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorNumberCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorRectCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorLineCreator);function UIColorBar(){return}UIColorBar.prototype=new UIElement;UIColorBar.prototype.isUIButton=false;UIColorBar.prototype.isUIColorBar=true;UIColorBar.prototype.initUIColorBar=function(t,e,i){this.initUIElement(t);this.setBarPosition(0);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,false);this.barDierction=0;return this};UIColorBar.prototype.setBarDirection=function(t){this.barDirection=t;return this};UIColorBar.prototype.getBarDirection=function(){return this.barDirection};UIColorBar.prototype.setBarPosition=function(t){this.barPosition=t;return this};UIColorBar.prototype.getBarPosition=function(){return this.barPosition};UIColorBar.prototype.shapeCanBeChild=function(t){return t.isUIImage||t.isUIColorTile||t.isUILabel};UIColorBar.prototype.paintSelfOnly=function(t){var e=0;var i=0;var n=this.barDirection;var r=this.style.lineWidth;switch(this.barPosition){case-1:{break}case 1:{if(n){e=this.w-r}else{i=this.h-r}break}default:{if(n){e=Math.floor(this.w-r>>1)}else{i=Math.floor(this.h-r>>1)}}}if(n){t.moveTo(e,0);t.lineTo(e,this.h)}else{t.moveTo(0,i);t.lineTo(this.w,i)}t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;t.stroke();return};function UIColorBarCreator(t,e){var i=["ui-color-bar","ui-color-bar",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIColorBar;return n.initUIColorBar(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIColorBarCreator(100,10));function UIImageAnimation(){return}UIImageAnimation.prototype=new UIImageView;UIImageAnimation.prototype.isUIImageAnimation=true;UIImageAnimation.prototype.initUIImageAnimation=function(t,e,i){this.initUIElement(t);this.initUIImageView(e,i);this.addEventNames(["onChanged"]);this.setTextType(Shape.TEXT_NONE);imageAnimationInitCustomProp(this);return this};UIImageAnimation.prototype.setCurrent=function(t){if(this.userImages.length){t=t%this.userImages.length}if(this.currFrame!=t){this.callOnChangedHandler(t)}this.currFrame=t;return this};UIImageAnimation.prototype.setValue=function(t){for(var e=0;e<this.cachedImages.length;e++){var i=this.cachedImages[e];if(i.src.indexOf(t)>=0||t.indexOf(i.src)>=0){return this.setCurrent(e)}}return this};UIImageAnimation.prototype.getCurrentImage=function(){var t=this.cachedImages[this.currFrame];return t};UIImageAnimation.prototype.onInit=function(){var t=this;this.currFrame=0;function e(){if(t.isVisible()){var i=1e3/t.getFrameRate();t.postRedraw();setTimeout(e,i);t.setCurrent(t.currFrame+1)}}var i=1e3/this.getFrameRate();setTimeout(e,i);return};UIImageAnimation.prototype.getFrameRate=function(){return this.frameRate?this.frameRate:5};UIImageAnimation.prototype.setFrameRate=function(t){this.frameRate=Math.max(1,Math.min(t,30));return};UIImageAnimation.prototype.drawImage=function(t){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var e=(this.currFrame?this.currFrame:0)%this.userImages.length;var i=this.cachedImages[e];if(i&&i.width>0){this.drawImageAt(t,i,this.images.display,0,0,this.w,this.h)}return};UIImageAnimation.prototype.shapeCanBeChild=function(t){return false};function UIImageAnimationCreator(){var t=["ui-image-animation","ui-image-animation",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageAnimation;return e.initUIImageAnimation(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIImageAnimationCreator);UIElement.prototype.callOnUpdateTransformHandler=function(canvas){if(this.mode===Shape.MODE_EDITING||!this.events)return true;if(!this.handleOnUpdateTransform){var sourceCode=this.events["onUpdateTransform"];if(sourceCode){sourceCode="this.handleOnUpdateTransform = function(canvas) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnUpdateTransform eval",e)}}}if(this.handleOnUpdateTransform){try{this.handleOnUpdateTransform(canvas)}catch(e){UIElement.logError("this.handleOnUpdateTransform",e)}}return};UIElement.prototype.callOnPointerDownHandler=function(point,beforeChild){if(!this.enable||!this.events){return false}if(!this.handlePointerDown){var sourceCode=this.events["onPointerDown"];if(sourceCode){sourceCode="this.handlePointerDown = function(point, beforeChild) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handlePointerDown eval",e)}}}if(this.handlePointerDown){try{this.handlePointerDown(point,beforeChild)}catch(e){UIElement.logError("this.handlePointerDown",e)}}return true};UIElement.prototype.callOnPointerMoveHandler=function(point,beforeChild){if(!this.enable||!this.events){return false}if(!this.handlePointerMove){var sourceCode=this.events["onPointerMove"];if(sourceCode){sourceCode="this.handlePointerMove = function(point, beforeChild) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handlePointerMove eval",e)}}}if(this.handlePointerMove){try{this.handlePointerMove(point,beforeChild)}catch(e){UIElement.logError("this.handlePointerMove",e)}}return true};UIElement.prototype.callOnPointerUpHandler=function(point,beforeChild){if(!this.enable||!this.events){return false}if(!this.handlePointerUp){var sourceCode=this.events["onPointerUp"];if(sourceCode){sourceCode="this.handlePointerUp = function(point, beforeChild) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handlePointerUp eval",e)}}}if(this.handlePointerUp){try{this.handlePointerUp(point,beforeChild)}catch(e){UIElement.logError("this.handlePointerUp",e)}}return true};UIElement.prototype.callOnLongPressHandler=function(point){if(!this.enable||!this.events){return false}if(!this.handleLongPress){var sourceCode=this.events["onLongPress"];if(sourceCode){sourceCode="this.handleLongPress = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleLongPress eval",e)}}}if(this.handleLongPress){try{this.handleLongPress(point)}catch(e){UIElement.logError("this.handleLongPress",e)}}return true};UIElement.prototype.callOnDoubleClickHandler=function(point){if(this.mode===Shape.MODE_EDITING){if(this.textType!=Shape.TEXT_NONE){this.editText(point)}else{this.showProperty()}return true}if(!this.enable||!this.events){return false}if(!this.handleDoubleClick){var sourceCode=this.events["onDoubleClick"];if(sourceCode){sourceCode="this.handleDoubleClick = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleDoubleClick eval",e)}}}if(this.handleDoubleClick){try{this.handleDoubleClick(point)}catch(e){UIElement.logError("this.handleDoubleClick",e)}}this.hitTestResult=0;return true};UIElement.prototype.callOnPaintHandler=function(canvas2dCtx){if(this.mode===Shape.MODE_EDITING){return true}if(!this.enable||!this.events){return false}if(!this.handlePaint){var sourceCode=this.events["onPaint"];if(sourceCode){sourceCode="this.handlePaint = function(canvas2dCtx) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handlePaint eval",e)}}}if(this.handlePaint){try{this.handlePaint(canvas2dCtx)}catch(e){UIElement.logError("this.handlePaint",e)}}return true};UIElement.prototype.callOnClickHandler=function(point){if(!this.enable||!this.events){return false}if(this.mode===Shape.MODE_EDITING){return false}if(this.onClicked){this.onClicked(point)}if(!this.handleClick){var sourceCode=this.events["onClick"];if(sourceCode){sourceCode="this.handleClick = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleClick eval",e)}}}if(!this.children.length){console.log("clicked: "+this.type+"("+this.name+")")}if(this.handleClick){try{this.handleClick(point)}catch(e){UIElement.logError("this.handleClick",e)}}return};UIElement.prototype.callOnScrollDoneHandler=function(){if(!this.enable||!this.events){return false}if(!this.handleOnScrollDone){var sourceCode=this.events["onScrollDone"];if(sourceCode){sourceCode="this.handleOnScrollDone = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnScrollDone eval",e)}}}if(this.handleOnScrollDone){try{this.handleOnScrollDone()}catch(e){UIElement.logError("this.handleOnScrollDone",e)}}return true};UIElement.prototype.callOnRemovedHandler=function(){if(!this.enable||!this.events){return false}if(!this.handleOnRemoved){var sourceCode=this.events["onRemoved"];if(sourceCode){sourceCode="this.handleOnRemoved = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode);UIElement.logError("this.handleOnRemoved eval",e)}}}if(this.handleOnRemoved){try{this.handleOnRemoved()}catch(e){UIElement.logError("this.handleOnRemoved",e)}}return true};UIElement.prototype.callOnChildDraggingHandler=function(sourceChildIndex,targetChildIndex){if(!this.enable||!this.events){return false}if(!this.handleOnChildDragging){var sourceCode=this.events["onChildDragging"];if(sourceCode){sourceCode="this.handleOnChildDragging = function(sourceChildIndex, targetChildIndex) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnChildDragging eval",e)}}}if(this.handleOnChildDragging){try{this.handleOnChildDragging(sourceChildIndex,targetChildIndex)}catch(e){UIElement.logError("this.handleOnChildDragging",e)}}return true};UIElement.prototype.callOnChildDraggedHandler=function(sourceChildIndex,targetChildIndex){if(!this.enable||!this.events){return false}if(!this.handleOnChildDragged){var sourceCode=this.events["onChildDragged"];if(sourceCode){sourceCode="this.handleOnChildDragged = function(sourceChildIndex, targetChildIndex) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnChildDragged eval",e)}}}if(this.handleOnChildDragged){try{this.handleOnChildDragged(sourceChildIndex,targetChildIndex)}catch(e){UIElement.logError("this.handleOnChildDragged",e)}}return true};UIElement.prototype.callOnChangingHandler=function(value){if(!this.enable||this.mode===Shape.MODE_EDITING||!this.events){return false}if(!this.handleOnChanging){var sourceCode=this.events["onChanging"];if(sourceCode){sourceCode="this.handleOnChanging = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnChanging eval",e)}}}if(this.handleOnChanging){try{this.handleOnChanging(value)}catch(e){UIElement.logError("this.handleOnChanging",e)}}return true};UIElement.prototype.callOnChangedHandler=function(value){if(!this.enable||this.mode===Shape.MODE_EDITING||!this.events){return false}if(this.onChanged){this.onChanged(value);return}if(!this.handleOnChanged){var sourceCode=this.events["onChanged"];if(sourceCode){sourceCode="this.handleOnChanged = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnChanged eval",e)}}}if(this.handleOnChanged){try{this.handleOnChanged(value)}catch(e){UIElement.logError("this.handleOnChanged",e)}}return true};UIElement.prototype.callOnInitHandler=function(){if(!this.events)return;if(!this.handleOnInit){var sourceCode=this.events["onInit"];if(sourceCode){sourceCode="this.handleOnInit = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnInit eval",e)}}}if(this.handleOnInit){try{this.handleOnInit()}catch(e){UIElement.logError("this.handleOnInit",e)}}return true};UIElement.prototype.callOnFocusInHandler=function(){if(this.onFocusIn){try{this.onFocusIn()}catch(e){console.log("onFocusIn:"+e.message)}}if(!this.events)return;if(!this.handleOnFocusIn){var sourceCode=this.events["onFocusIn"];if(sourceCode){sourceCode="this.handleOnFocusIn = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnFocusIn eval",e)}}}if(this.handleOnFocusIn){try{this.handleOnFocusIn()}catch(e){UIElement.logError("this.handleOnFocusIn",e)}}return true};UIElement.prototype.callOnFocusOutHandler=function(){if(this.onFocusOut){try{this.onFocusOut()}catch(e){UIElement.logError("this.onFocusOut ",e)}}if(!this.events)return;if(!this.handleOnFocusOut){var sourceCode=this.events["onFocusOut"];if(sourceCode){sourceCode="this.handleOnFocusOut = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.onFocusOut eval",e)}}}if(this.handleOnFocusOut){try{this.handleOnFocusOut()}catch(e){UIElement.logError("this.onFocusOut",e)}}return true};UIElement.prototype.callOnUpdateDataHandler=function(){if(!this.events)return;if(!this.handleOnUpdateData){var sourceCode=this.events["onUpdateData"];if(sourceCode){sourceCode="this.handleOnUpdateData = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnUpdateData eval",e)}}}if(this.handleOnUpdateData){try{this.handleOnUpdateData()}catch(e){UIElement.logError("this.handleOnUpdateData",e)}}return true};UIElement.prototype.callOnGestureHandler=function(gesture){if(!this.enable||!this.events){return false}if(!this.handleOnGesture){var sourceCode=this.events["onGesture"];if(sourceCode){sourceCode="this.handleOnGesture = function(gesture) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnGesture eval",e)}}}if(this.handleOnGesture){try{this.handleOnGesture(gesture)}catch(e){UIElement.logError("this.handleOnGesture",e)}}console.log("callOnGestureHandler: scale="+gesture.scale+" rotation="+gesture.rotation);return true};UIElement.prototype.callOnBeforeOpenHandler=function(initData){if(!this.events)return;if(!this.handleOnBeforeOpen){var sourceCode=this.events["onBeforeOpen"];if(sourceCode){sourceCode="this.handleOnBeforeOpen = function(initData) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBeforeOpen eval",e)}}}if(this.handleOnBeforeOpen){try{this.handleOnBeforeOpen(initData)}catch(e){UIElement.logError("this.handleOnBeforeOpen",e)}}return true};UIElement.prototype.callOnOpenHandler=function(initData){if(!this.events)return;if(!this.handleOnOpen){var sourceCode=this.events["onOpen"];if(sourceCode){sourceCode="this.handleOnOpen = function(initData) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnOpen eval",e)}}}if(this.handleOnOpen){try{this.handleOnOpen(initData)}catch(e){UIElement.logError("this.handleOnOpen",e)}}return true};UIElement.prototype.callOnCloseHandler=function(retInfo){if(!this.events)return;if(!this.handleOnClose){var sourceCode=this.events["onClose"];if(sourceCode){sourceCode="this.handleOnClose = function(retInfo) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnClose eval",e)}}}if(this.handleOnClose){try{this.handleOnClose(retInfo)}catch(e){UIElement.logError("this.handleOnClose",e)}}return true};UIElement.prototype.callOnSwitchToBackHandler=function(){if(!this.events)return;if(!this.handleOnSwitchToBack){var sourceCode=this.events["onSwitchToBack"];if(sourceCode){sourceCode="this.handleOnSwitchToBack = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwitchToBack eval",e)}}}if(this.handleOnSwitchToBack){try{this.handleOnSwitchToBack()}catch(e){UIElement.logError("this.handleOnSwitchToBack",e)}}return true};UIElement.prototype.callOnSwitchToFrontHandler=function(){if(!this.events)return;if(!this.handleOnSwitchToFront){var sourceCode=this.events["onSwitchToFront"];if(sourceCode){sourceCode="this.handleOnSwitchToFront = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwitchToFront eval",e)}}}if(this.handleOnSwitchToFront){try{this.handleOnSwitchToFront()}catch(e){UIElement.logError("this.handleOnSwitchToFront",e)}}return true};UIElement.prototype.callOnLoadHandler=function(){if(!this.events)return;if(!this.handleOnLoad){var sourceCode=this.events["onLoad"];if(sourceCode){sourceCode="this.handleOnLoad = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnLoad eval",e)}}}if(this.handleOnLoad){try{this.handleOnLoad()}catch(e){UIElement.logError("this.handleOnLoad",e)}}return true};UIElement.prototype.callOnUnloadHandler=function(){if(!this.events)return;if(!this.handleOnUnload){var sourceCode=this.events["onUnload"];if(sourceCode){sourceCode="this.handleOnUnload = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnUnload eval",e)}}}if(this.handleOnUnload){try{this.handleOnUnload()}catch(e){UIElement.logError("this.handleOnUnload",e)}}return true};UIElement.prototype.callOnMovedHandler=function(){if(!this.events)return;if(!this.handleOnMoved){var sourceCode=this.events["onMoved"];if(sourceCode){sourceCode="this.handleOnMoved = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnMoved eval",e)}}}if(this.handleOnMoved){try{this.handleOnMoved()}catch(e){UIElement.logError("this.handleOnMoved",e)}}if(this.cameraFollowMe){this.getWindow().cameraFollow(this)}return true};UIElement.prototype.callOnBeginContactHandler=function(body,contact){if(this.onBeginContact){this.onBeginContact(body,contact);return}if(!this.events)return;if(!this.handleOnBeginContact){var sourceCode=this.events["onBeginContact"];if(sourceCode){sourceCode="this.handleOnBeginContact = function(body, contact) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBeginContact eval",e)}}}if(this.handleOnBeginContact){try{this.handleOnBeginContact(body,contact)}catch(e){UIElement.logError("this.handleOnBeginContact",e)}}return true};UIElement.prototype.callOnEndContactHandler=function(body,contact){if(this.onEndContact){this.onEndContact(body,contact);return}if(!this.events)return;if(!this.handleOnEndContact){var sourceCode=this.events["onEndContact"];if(sourceCode){sourceCode="this.handleOnEndContact = function(body, contact) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnEndContact eval",e)}}}if(this.handleOnEndContact){try{this.handleOnEndContact(body,contact)}catch(e){UIElement.logError("this.handleOnEndContact",e)}}return true};UIElement.prototype.callOnAnimateDoneHandler=function(name){if(!this.events)return;if(!this.handleOnAnimateDone){var sourceCode=this.events["onAnimateDone"];if(sourceCode){sourceCode="this.handleOnAnimateDone = function(name) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnAnimateDone eval",e)}}}if(this.handleOnAnimateDone){try{this.handleOnAnimateDone(name)}catch(e){UIElement.logError("this.handleOnAnimateDone",e)}}return true};UIElement.prototype.callOnSwipeLeftHandler=function(){if(!this.events)return;if(!this.handleOnSwipeLeft){var sourceCode=this.events["onSwipeLeft"];if(sourceCode){sourceCode="this.handleOnSwipeLeft = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwipeLeft eval",e)}}}if(this.handleOnSwipeLeft){try{this.handleOnSwipeLeft()}catch(e){UIElement.logError("this.handleOnSwipeLeft",e)}}return true};UIElement.prototype.callOnSwipeRightHandler=function(){if(!this.events)return;if(!this.handleOnSwipeRight){var sourceCode=this.events["onSwipeRight"];if(sourceCode){sourceCode="this.handleOnSwipeRight = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwipeRight eval",e)}}}if(this.handleOnSwipeRight){try{this.handleOnSwipeRight()}catch(e){UIElement.logError("this.handleOnSwipeRight",e)}}return true};UIElement.prototype.callOnSwipeUpHandler=function(){if(!this.events)return;if(!this.handleOnSwipeUp){var sourceCode=this.events["onSwipeUp"];if(sourceCode){sourceCode="this.handleOnSwipeUp = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwipeUp eval",e)}}}if(this.handleOnSwipeUp){try{this.handleOnSwipeUp()}catch(e){UIElement.logError("this.handleOnSwipeUp",e)}}return true};UIElement.prototype.callOnSwipeDownHandler=function(){if(!this.events)return;if(!this.handleOnSwipeDown){var sourceCode=this.events["onSwipeDown"];if(sourceCode){sourceCode="this.handleOnSwipeDown = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwipeDown eval",e)}}}if(this.handleOnSwipeDown){try{this.handleOnSwipeDown()}catch(e){UIElement.logError("this.handleOnSwipeDown",e)}}return true};UIElement.prototype.callOnBecomeZeroHandler=function(){if(!this.events)return;if(!this.handleOnBecomeZero){var sourceCode=this.events["onBecomeZero"];if(sourceCode){sourceCode="this.handleOnBecomeZero = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBecomeZero eval",e)}}}if(this.handleOnBecomeZero){try{this.handleOnBecomeZero()}catch(e){UIElement.logError("this.handleOnBecomeZero",e)}}return true};UIElement.prototype.callOnBecomeFullHandler=function(){if(!this.events)return;if(!this.handleOnBecomeFull){var sourceCode=this.events["onBecomeFull"];if(sourceCode){sourceCode="this.handleOnBecomeFull = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBecomeFull eval",e)}}}if(this.handleOnBecomeFull){try{this.handleOnBecomeFull()}catch(e){UIElement.logError("this.handleOnBecomeFull",e)}}return true};UIElement.prototype.callOnTimeoutHandler=function(){if(!this.events)return;if(!this.handleOnTimeout){var sourceCode=this.events["onTimeout"];if(sourceCode){sourceCode="this.handleOnTimeout = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnTimeout eval",e)}}}if(this.handleOnTimeout){try{this.handleOnTimeout()}catch(e){UIElement.logError("this.handleOnTimeout",e)}}return true};UIElement.prototype.callOnSystemInitHandler=function(){if(!this.events)return;if(!this.handleOnSystemInit){var sourceCode=this.events["onSystemInit"];if(sourceCode){sourceCode="this.handleOnSystemInit = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSystemInit eval",e)}}}if(this.handleOnSystemInit){try{this.handleOnSystemInit()}catch(e){UIElement.logError("this.handleOnSystemInit",e)}}return true};UIElement.prototype.callOnScrollOutOfRangeHandler=function(offset){if(!this.enable||!this.events){return false}if(this.onScrollOutOfRange){this.onScrollOutOfRange(offset);return}if(!this.handleOnScrollOutOfRange){var sourceCode=this.events["onScrollOutOfRange"];if(sourceCode){sourceCode="this.handleOnScrollOutOfRange = function(offset) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnScrollOutOfRange eval",e)}}}if(this.handleOnScrollOutOfRange){try{this.handleOnScrollOutOfRange(offset)}catch(e){UIElement.logError("this.handleOnScrollOutOfRange",e);
}}return true};UIElement.prototype.callOnBirthedHandler=function(){if(this.onBirthed){this.onBirthed()}if(!this.events)return;if(!this.handleOnBirthed){var sourceCode=this.events["onBirthed"];if(sourceCode){sourceCode="this.handleOnBirthed = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBirthed eval",e)}}}if(this.handleOnBirthed){try{this.handleOnBirthed()}catch(e){UIElement.logError("this.handleOnBirthed",e)}}return true};UIElement.prototype.callOnDeviceOrientation=function(x,y,z,evt){if(!this.events)return;if(!this.handleOnDeviceOrientation){var sourceCode=this.events["onDeviceOrientation"];if(sourceCode){sourceCode="this.handleOnDeviceOrientation = function(x, y, z, event) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnDeviceOrientation eval",e)}}}if(this.handleOnDeviceOrientation){try{this.handleOnDeviceOrientation(x,y,z,evt)}catch(e){UIElement.logError("this.handleOnDeviceOrientation",e)}}return true};UIElement.prototype.dispatchCustomEvent=function(eventName,args){if(!this.events)return;if(!this.customEventHandler){this.customEventHandler={}}var handleCustomEvent=this.customEventHandler[eventName];if(!handleCustomEvent){var sourceCode=this.events[eventName];if(sourceCode){sourceCode="this.handleCustomEvent = function(args) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleCustomEvent eval",e)}}if(this.handleCustomEvent){handleCustomEvent=this.handleCustomEvent;this.customEventHandler[eventName]=handleCustomEvent;this.handleCustomEvent=null}}if(handleCustomEvent){try{handleCustomEvent.call(this,args)}catch(e){UIElement.logError("this.handleCustomEvent",e)}}return true};function UIVScrollImage(){return}UIVScrollImage.prototype=new UIVScrollView;UIVScrollImage.prototype.initUIVScrollImage=function(t){this.initUIVScrollView(t,0,null,null);this.setImage(UIElement.IMAGE_DEFAULT,null);this.widthAttr=UIElement.WIDTH_SCALE;this.heightAttr=UIElement.HEIGHT_SCALE;this.setSize(200,200);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);return this};UIVScrollImage.prototype.drawBgImage=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e||!e.height){t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h);return}var i=this.w/e.width;var n=e.height*i;var r=0;var o=this.offset/i;var a=e.width;var s=Math.min(this.h/i,e.height-o);var l=0;var h=0;var u=this.w;var p=s*i;t.drawImage(e,r,o,a,s,l,h,u,p);return};UIVScrollImage.prototype.getScrollRange=function(){var t=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(t&&t.height&&t.width){var e=this.w/t.width;return e*t.height+60}else{return this.h}};UIVScrollImage.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);if(this.mode===Shape.MODE_EDITING){this.drawPageDownUp(t)}return};function UIVScrollImageCreator(){var t=["ui-v-scroll-image","ui-v-scroll-image",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIVScrollImage;return e.initUIVScrollImage(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIVScrollImageCreator);function UIPageManager(){}UIPageManager.prototype=new UIFrames;UIPageManager.prototype.isUIPageManager=true;UIPageManager.prototype.initUIPageManager=function(t){return this.initUIFrames(t)};UIPageManager.prototype.beforeAddShapeIntoChildren=function(t){return!t.isUIPage};UIPageManager.prototype.shapeCanBeChild=function(t){return t.isUIPage};UIPageManager.prototype.relayoutChildren=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.left=0;e.top=0;e.w=this.w;e.h=this.h;e.relayoutChildren();e.setUserMovable(false);e.setUserResizable(false)}return};UIPageManager.prototype.showHTML=function(){var t=this.getCurrentFrame();if(t){t.showHTML()}return};UIPageManager.prototype.hideHTML=function(){var t=this.getCurrentFrame();if(t){t.hideHTML()}return};UIPageManager.prototype.switchTo=function(t){var e=this;var i=this.getCurrentFrame();var n=this.getFrame(t);var r=this.current;if(i){i.hideHTML()}if(r<0||r===t||!i||!n){this.showFrame(t);if(n){n.showHTML()}return}function o(){e.showFrame(t);e.postRedraw();return}if(!this.isTopWindow()){o();return}var a=null;var s=null;var l=this.getPositionInScreen();if(t<r){a=AnimationFactory.create("anim-backward");s=UIFrames.preparseBackendCanvas(n,i)}else{a=AnimationFactory.create("anim-forward");s=UIFrames.preparseBackendCanvas(i,n)}a.setScale(this.getRealScale());a.prepare(l.x,l.y,this.w,this.h,s,o);a.run();return};function UIPageManagerCreator(){var t=["ui-page-manager","ui-page-manager",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageManager;e.initUIPageManager(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIPageManagerCreator);function UIWaitBar(){return}UIWaitBar.TILES=8;UIWaitBar.prototype=new UIElement;UIWaitBar.prototype.initUIWaitBar=function(t,e,i){this.initUIElement(t);this.offset=0;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);return this};UIWaitBar.prototype.shapeCanBeChild=function(t){return false};UIWaitBar.prototype.step=function(){if(this.isVisible()&&this.getParent()){this.offset++;if(this.isUIWaitBar){this.offset=this.offset%UIWaitBar.TILES}this.postRedraw()}return this};UIWaitBar.prototype.drawBgImage=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){return}if(this.isUIWaitBar){this.drawBgImageBar(t,e)}else{this.drawBgImageBox(t,e)}return};UIWaitBar.prototype.drawBgImageBox=function(t,e){var i=.05*Math.PI*this.offset;this.setRotation(i);UIElement.prototype.drawBgImage.call(this,t);return};UIWaitBar.prototype.onInit=function(){UIElement.prototype.onInit.call(this);var t=this;function e(){t.step();if(t.getParent()){setTimeout(e,50)}}e();return};UIWaitBar.prototype.drawBgImageBar=function(t,e){var i=e.width;var n=e.height;var r=Math.round(n/UIWaitBar.TILES);var o=this.offset*r;var a={x:0,y:o,w:i,h:r};UIElement.drawImageAt(t,e,this.images.display,0,0,this.w,this.h,a);return};function UIWaitBarCreator(t,e,i){var n=[t,t,null,1];ShapeCreator.apply(this,n);this.createShape=function(t){var n=new UIWaitBar;n.isUIWaitBar=true;return n.initUIWaitBar(this.type,e,i)};return}function UIWaitBoxCreator(t,e,i){var n=[t,t,null,1];ShapeCreator.apply(this,n);this.createShape=function(t){var n=new UIWaitBar;n.isUIWaitBox=true;return n.initUIWaitBar(this.type,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIWaitBarCreator("ui-wait-bar",200,24));ShapeFactoryGet().addShapeCreator(new UIWaitBoxCreator("ui-wait-box",60,60));function UIStaticMap(){return}UIStaticMap.prototype=new UIImage;UIStaticMap.prototype.isUIStaticMap=true;UIStaticMap.prototype.initUIStaticMap=function(t){this.initUIImage(t,200,200,null);return this};UIStaticMap.prototype.setMapProvider=function(t){this.mapProvider=t;return};UIStaticMap.prototype.setMapType=function(t){this.mapType=t;return};UIStaticMap.prototype.setMapZoom=function(t){this.mapZoom=t;return};UIStaticMap.prototype.setMapCenter=function(t){this.mapCenter=t;return};UIStaticMap.prototype.setMapWidth=function(t){this.mapWidth=t;return};UIStaticMap.prototype.setMapHeight=function(t){this.mapHeight=t;return};UIStaticMap.prototype.setMapExtraParams=function(t){this.mapEtraParams=t;return};UIStaticMap.prototype.getMapType=function(){return this.mapType?this.mapType:""};UIStaticMap.prototype.getMapProvider=function(){return this.mapProvider?this.mapProvider:"google"};UIStaticMap.prototype.getMapZoom=function(){return this.mapZoom?this.mapZoom:10};UIStaticMap.prototype.getMapWidth=function(){return this.mapWidth?this.mapWidth:600};UIStaticMap.prototype.getMapHeight=function(){return this.mapHeight?this.mapHeight:600};UIStaticMap.prototype.getMapCenter=function(){if(!this.mapCenter&&this.currentLocation){return this.currentLocation}else{return this.mapCenter?this.mapCenter:"China"}};UIStaticMap.prototype.getMapExtraParams=function(){return this.mapEtraParams?this.mapEtraParams:""};UIStaticMap.prototype.getMapURL=function(){var t="";if(this.mapProvider==="baidu"){t="http://api.map.baidu.com/staticimage?center="+this.getMapCenter()+"&width="+this.getMapWidth()+"&height="+this.getMapHeight()+"&zoom="+this.getMapZoom()+this.getMapExtraParams()}else if(this.mapProvider==="google"){t="http://maps.googleapis.com/maps/api/staticmap?center="+this.getMapCenter()+"&size="+this.getMapWidth()+"x"+this.getMapHeight()+"&zoom="+this.getMapZoom()+"&maptype="+this.getMapType()+"&sensor=true"+this.getMapExtraParams()}console.log("Map URL:"+t);return t};UIStaticMap.prototype.updateMap=function(){var t=this.getMapURL();this.setImageSrc(t);return};UIStaticMap.prototype.onInit=function(){var t=this;function e(e){t.currentLocation=e.coords.latitude+","+e.coords.longitude;t.updateMap();return}if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e)}this.updateMap();return};UIStaticMap.prototype.drawImage=function(t){this.drawBgImage(t);return};function UIStaticMapCreator(){var t=["ui-static-map","ui-static-map",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIStaticMap;return e.initUIStaticMap(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIStaticMapCreator);function UIStatusBar(){return}UIStatusBar.prototype=new UIElement;UIStatusBar.prototype.isUIStatusBar=true;UIStatusBar.prototype.initUIStatusBar=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.widthAttr=UIElement.WIDTH_FILL_PARENT;return this};UIStatusBar.prototype.shapeCanBeChild=function(t){if(t.isUILabel||t.isUIImage||t.isUIButton){return true}return false};UIStatusBar.prototype.afterChildAppended=function(t){t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;if(this.type==="ui-menu-bar"){t.hideSelectMark=true;t.textType=Shape.TEXT_NONE;this.hideSelectMark=true}return true};UIStatusBar.prototype.beforeRelayoutChild=function(t){t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;return true};function UIStatusBarCreator(t,e,i,n){var r=[t,"ui-status-bar",null,true];ShapeCreator.apply(this,r);this.createShape=function(t){var r=new UIStatusBar;return r.initUIStatusBar(this.type,e,i,n)};return}ShapeFactoryGet().addShapeCreator(new UIStatusBarCreator("ui-status-bar",640,40,null));ShapeFactoryGet().addShapeCreator(new UIStatusBarCreator("ui-menu-bar",640,96,null));function UIUnkown(){return}UIUnkown.prototype=new UIElement;UIUnkown.prototype.isUIUnkown=true;UIUnkown.prototype.initUIUnkown=function(t){this.initUIElement(t);this.setDefSize(100,100);this.maxTryTimes=10;return this};UIUnkown.prototype.shapeCanBeChild=function(t){return true};UIUnkown.prototype.tryCreateRealElement=function(){if(this.maxTryTimes<1)return;var t=this.realObjJs;var e=this.parentShape;var i=ShapeFactoryGet().createShape(t.type,C_CREATE_FOR_PROGRAM,true);if(i){this.realObjJs=null;var n=e.getIndexOfChild(this);i.fromJson(t);e.addChild(i,n);e.removeChild(this);console.log("Create real obj done:"+t.type)}else{this.maxTryTimes--;if(this.maxTryTimes<1){this.realObjJs=null;console.log("Create real obj failed:"+t.type)}}};UIUnkown.prototype.paintSelfOnly=function(t){this.tryCreateRealElement();return};UIUnkown.prototype.toJson=function(){return this.realObjJs};UIUnkown.prototype.fromJson=function(t){this.realObjJs=t;this.setDefSize(t.w,t.h);return this};function UIUnkownCreator(){var t=["ui-unkown","ui-unkown",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIUnkown;return e.initUIUnkown(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIUnkownCreator);function SuggestionProvider(){this.query=function(t,e){};this.init=function(t){};return}function StaticSuggestionProvider(){this.init=function(t){if(typeof t=="string"){t=t.split("\n")}this.options=t;if(this.options){this.options.sort()}return};this.query=function(t,e){if(!t||!this.options){e([]);return}function i(t,e){if(t.indexOf(e)==0){return 0}if(t<e){return-1}else{return 1}}var n=[];var r=this.options.binarySearch(t,i);if(r>=0){var o=this.options.length;for(;r>=0;r--){var a=this.options[r];if(a.indexOf(t)!==0){r=r+1;break}}for(var s=r;s<o;s++){var a=this.options[s];if(a.indexOf(t)===0){n.push(a)}else{break}}}e(n);return};return}function createSuggestionProvider(t,e){var i=null;if(t==="static"){i=new StaticSuggestionProvider}if(i){i.init(e)}return i}function UISuggestion(){return}UISuggestion.prototype=new UIListView;UISuggestion.prototype.isUISuggestion=true;UISuggestion.prototype.initUISuggestion=function(t){this.initUIListView(t,5,100,null);this.maxSuggestionItems=10;this.suggestionProviderParams="";this.suggestionProviderName="static";return this};UISuggestion.prototype.onInit=function(){this.suggestionProvider=createSuggestionProvider(this.suggestionProviderName,this.suggestionProviderParams);return};UISuggestion.prototype.setSuggestionProvider=function(t){this.suggestionProvider=t;return};UISuggestion.prototype.getSuggestionProvider=function(){return this.suggestionProvider};UISuggestion.prototype.onSuggestionSelected=function(t){};UISuggestion.prototype.showSuggestion=function(t){var e={children:[]};if(t.length>this.maxSuggestionItems){t.length=this.maxSuggestionItems}for(var i=0;i<t.length;i++){var n={children:[]};var r=t[i];n.children.push({text:r});e.children.push(n)}this.bindData(e,null,true);return};UISuggestion.prototype.onSuggestionShow=function(){};UISuggestion.prototype.query=function(t){var e=this;this.suggestionProvider.query(t,function(t){e.showSuggestion(t);e.onSuggestionShow()})};function UISuggestionCreator(){var t=["ui-suggestion","ui-suggestion",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISuggestion;return e.initUISuggestion(this.type)};return}ShapeFactoryGet().addShapeCreator(new UISuggestionCreator);function UIButton(){return}UIButton.prototype=new UIElement;UIButton.prototype.isUIButton=true;UIButton.prototype.initUIButton=function(t,e,i){this.initUIElement(t);this.setMargin(5,5);this.setDefSize(e,i);this.setSizeLimit(50,50);this.setAutoScaleFontSize(true);this.setTextType(Shape.TEXT_INPUT);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;this.setImage(UIElement.IMAGE_ACTIVE,null);this.setImage(UIElement.IMAGE_NORMAL,null);this.setImage(UIElement.IMAGE_DISABLE,null);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);this.addEventNames(["onUpdateTransform"]);return this};UIButton.prototype.shapeCanBeChild=function(t){if(t.isUILabel||t.isUIImage||t.isUIBitmapFontText){return true}return false};UIButton.prototype.paintSelfOnly=function(t){if(this.pointerDown){var e=this.getHtmlImageByType(UIElement.IMAGE_ACTIVE);if(!e){t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}}return};function UIButtonCreator(t,e){var i=["ui-button","ui-button",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIButton;return n.initUIButton(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIButtonCreator(120,60));function UIMLEdit(){return}UIMLEdit.prototype=new UIElement;UIMLEdit.prototype.isUIMLEdit=true;UIMLEdit.prototype.initUIMLEdit=function(t,e,i,n,r,o,a){this.initUIElement(t);this.setDefSize(e,i);this.setText(r);this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,o);this.setImage(UIElement.IMAGE_FOCUSED,a);this.setMargin(n,n);this.addEventNames(["onChanged","onFocusIn","onFocusOut"]);this.setTextAlignV("top");this.setTextAlignH("left");return this};UIMLEdit.prototype.drawText=function(t){if(!this.text||this.editing){return}return this.defaultDrawText(t)};UIMLEdit.prototype.shapeCanBeChild=function(t){return false};UIMLEdit.prototype.textEditable=function(t){return true};UIMLEdit.prototype.onClick=function(t,e){if(e){return}if(this.mode!==Shape.MODE_EDITING){this.editText()}return};UIMLEdit.prototype.getEditorRect=function(){var t=this.getPositionInView();var e=this.view.getAbsPosition();var i=this.view.getViewScale();var n=e.x;var r=e.y;var o=t.x*i+n;var a=t.y*i+r;var s=this.getWidth()*i;var l=this.getHeight()*i;var h={};i=UIElement.getMainCanvasScale();h.x=Math.round(o/i.x);h.y=Math.round(a/i.y);h.w=Math.round(s/i.x);h.h=Math.round(l/i.y);return h};UIMLEdit.prototype.editText=function(t){if(this.textType&&this.textEditable(t)){var e=this;var i=this.getEditorRect();var n=this.getRealScale()/UIElement.getMainCanvasScale().y;var r=this.inputType?this.inputType:"text";var o=this.style.fontSize*n;var a=cantkShowTextArea(this.getText(),o,i.x,i.y,i.w,i.h);e.editing=true;function s(t){if(t!==e.text){e.setText(t,true);e.postRedraw()}else{e.text=t}a.setOnChangedHandler(null);a.setOnChangeHandler(null);a.hide();delete e.editing;e.callOnFocusOutHandler();return}function l(t){e.callOnChangingHandler(t)}a.setOnChangedHandler(s);a.setOnChangeHandler(l);this.callOnFocusInHandler()}return};UIMLEdit.prototype.getTextTipsPosition=function(){var t={};t.x=this.hMargin;t.y=this.vMargin;t.textAlign="left";t.textBaseline="top";return t};function UIMLEditCreator(t,e,i,n,r){var o=["ui-mledit","ui-mledit",null,1];ShapeCreator.apply(this,o);this.createShape=function(o){var a=new UIMLEdit;return a.initUIMLEdit(this.type,t,e,i,dappGetText("Edit"),n,r)};return}ShapeFactoryGet().addShapeCreator(new UIMLEditCreator(300,300,12,null,null));function UIToolBar(){return}UIToolBar.prototype=new UIElement;UIToolBar.prototype.isUIToolBar=true;UIToolBar.prototype.initUIToolBar=function(t,e,i,n){this.initUIElement(t);this.xAttr=UIElement.X_LEFT_IN_PARENT;this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.yAttr=e?UIElement.Y_TOP_IN_PARENT:UIElement.Y_BOTTOM_IN_PARENT;this.setDefSize(200,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.setSizeLimit(100,50,2e3,200);return this};UIToolBar.prototype.shapeCanBeChild=function(t){if(t.isUILabel||t.isUIImage||t.isUIButton||t.isUIGroup||t.isUIButtonGroup||t.isUIEdit||t.isUIImageButton||t.isUICheckBox||t.isUIRadioBox||t.isUIProgressBar||t.isUISwitch||t.isUILedDigits||t.isUIGroup||t.isUILayout||t.isUIWaitBar||t.isUIColorBar){return true}return false};UIToolBar.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};function UIToolBarCreator(t,e,i,n){var r=[t,"ui-toolbar",null,1];ShapeCreator.apply(this,r);this.createShape=function(r){var o=new UIToolBar;return o.initUIToolBar(t,e,i,n)};return}ShapeFactoryGet().addShapeCreator(new UIToolBarCreator("ui-toolbar",true,85,null));function UIPlaceholder(){return}UIPlaceholder.prototype=new UIElement;UIPlaceholder.prototype.isUIPlaceholder=true;UIPlaceholder.prototype.initUIPlaceholder=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,false);return this};UIPlaceholder.prototype.shapeCanBeChild=function(t){return false};UIPlaceholder.prototype.paintSelfOnly=function(t){if(this.mode===Shape.MODE_EDITING){var e=this.vMargin;var i=this.hMargin;var n=this.getWidth(true);var r=this.getHeight(true);t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;drawDashedRect(t,e,i,n,r);t.stroke()}return};function UIVPlaceholderCreator(t,e){var i=["ui-v-placeholder","ui-placeholder",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIPlaceholder;n.initUIPlaceholder(this.type,t,e);n.widthAttr=UIElement.WIDTH_FILL_PARENT;n.MIN_SIZE=4;n.setSizeLimit(20,4);return n};return}function UIHPlaceholderCreator(t,e){var i=["ui-h-placeholder","ui-placeholder",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIPlaceholder;n.initUIPlaceholder(this.type,t,e);n.heightAttr=UIElement.HEIGHT_FILL_PARENT;n.MIN_SIZE=4;n.setSizeLimit(4,20);return n};return}ShapeFactoryGet().addShapeCreator(new UIVPlaceholderCreator(100,20));ShapeFactoryGet().addShapeCreator(new UIHPlaceholderCreator(20,100));function UIRadioBox(){return}UIRadioBox.prototype=new UICheckBox;UIRadioBox.prototype.isUIRadioBox=true;UIRadioBox.prototype.initUIRadioBox=function(t){return this.initUICheckBox(t)};UIRadioBox.prototype.setParent=function(t){this.parentShape=t;if(this.value){this.setChecked()}return this};UIRadioBox.prototype.onFromJsonDone=function(){if(this.value){this.setChecked()}return this};UIRadioBox.prototype.setChecked=function(){var t=this.getParent();if(t){for(var e=0;e<t.children.length;e++){var i=t.children[e];if(i.isUIRadioBox){i.setValue(false)}}}this.setValue(true);return this};UIRadioBox.prototype.onClick=function(t,e){if(e){return}this.setChecked();return this.callOnClickHandler(t)};function UIRadioBoxCreator(t,e){var i=["ui-radiobox","ui-radiobox",null,1];ShapeCreator.apply(this,i);this.createShape=function(t){var e=new UIRadioBox;e.initUIRadioBox(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIRadioBoxCreator(50,50,null,null,null,null,null,null));function UILedDigits(){return}UILedDigits.prototype=new UIElement;UILedDigits.prototype.isUILedDigits=true;UILedDigits.prototype.initUILedDigits=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);return this};UILedDigits.prototype.shapeCanBeChild=function(t){return false};UILedDigits.prototype.setText=function(t){this.text="";t=this.toText(t);for(var e=0;e<t.length;e++){var i=t[e];switch(i){case".":case":":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"E":case"F":case"F":{this.text=this.text+i}default:break}}return};UILedDigits.prototype.drawBarVL=function(t,e,i){t.beginPath();t.moveTo(0,0);t.lineTo(0,i);t.lineTo(e,i-e);t.lineTo(e,e);t.lineTo(0,0);return};UILedDigits.prototype.drawBarVR=function(t,e,i){t.beginPath();t.moveTo(e,0);t.lineTo(e,i);t.lineTo(0,i-e);t.lineTo(0,e);t.lineTo(e,0);return};UILedDigits.prototype.drawBarHT=function(t,e,i){t.beginPath();t.moveTo(0,0);t.lineTo(e,0);t.lineTo(e-i,i);t.lineTo(i,i);t.lineTo(0,0);return};UILedDigits.prototype.drawBarHM=function(t,e,i){t.beginPath();var n=Math.round(i/3);e=e-2*n;t.translate(n,0);t.moveTo(0,i/2);t.lineTo(i/2,0);t.lineTo(e-i/2,0);t.lineTo(e,i/2);t.lineTo(e-i/2,i);t.lineTo(i/2,i);t.lineTo(0,i/2);t.translate(-n,0);return};UILedDigits.prototype.drawBarHB=function(t,e,i){t.beginPath();t.moveTo(0,i);t.lineTo(e,i);t.lineTo(e-i,0);t.lineTo(i,0);t.lineTo(0,i);return};UILedDigits.prototype.drawBar=function(t,e,i){if(e<i){this.drawBarV(t,e,i)}else{this.drawBarH(t,e,i)}return};UILedDigits.prototype.drawDot=function(t,e,i,n){var r=(e/4+i/8)/2;if(n==="."){t.fillRect((e-r)/2,.75*i-r/2,r,r)}else if(n=":"){t.fillRect((e-r)/2,.25*i-r/2,r,r);t.fillRect((e-r)/2,.75*i-r/2,r,r)}return};UILedDigits.prototype.map={0:125,1:96,2:55,3:103,4:106,5:79,6:95,7:97,8:127,9:111,E:31,F:27,H:122};UILedDigits.prototype.fillBar=function(t,e){if(e){t.fillStyle=this.style.textColor;t.fill()}else{t.lineWidth=1;t.strokeStyle=this.style.lineColor;t.stroke()}return};UILedDigits.prototype.drawDigit=function(t,e,i,n){var r=Math.max(3,Math.round(i/10));var o=Math.max(3,Math.round(e/10));var a=Math.round((o+r)/2);var s=1;var l=e-2*s;var h=Math.floor(i/2-2*s);var u=this.map[n];t.translate(s,0);this.drawBarHT(t,l,a);t.translate(-s,0);this.fillBar(t,u&1);var p=Math.floor((i-r)/2);t.translate(s,p);this.drawBarHM(t,l,a);t.translate(-s,-p);this.fillBar(t,u>>1&1);var p=i-r;t.translate(s,p);this.drawBarHB(t,l,a);t.translate(-s,-p);this.fillBar(t,u>>2&1);t.translate(0,s);this.drawBarVL(t,a,h);t.translate(0,-s);this.fillBar(t,u>>3&1);var p=Math.round(2*s+(i-r)/2)+s;t.translate(0,p);this.drawBarVL(t,a,h);t.translate(0,-p);this.fillBar(t,u>>4&1);t.translate(e-a,s);this.drawBarVR(t,a,h);t.translate(-(e-a),-s);this.fillBar(t,u>>5&1);t.translate(e-a,p);this.drawBarVR(t,a,h);t.translate(-(e-a),-p);this.fillBar(t,u>>6&1);return};UILedDigits.prototype.drawDigits=function(t){var e=0;var i=this.text;var n=i.length;if(!n){return}for(var r=0;r<n;r++){var o=i[r];if(o==="."||o===":"){e=e+1}}var a=this.w/n*.2;var s=this.w/n-a;var l=this.h;t.save();t.translate(s/4*e,0);for(var r=0;r<n;r++){var o=i[r];if(o==="."||o===":"){this.drawDot(t,s/2,l,i[r]);t.translate(s/2+a,0)}else{this.drawDigit(t,s,l,i[r]);t.translate(s+a,0)}}t.restore();return};UILedDigits.prototype.paintSelfOnly=function(t){if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}t.fillStyle=this.style.lineColor;this.drawDigits(t);return};function UILedDigitsCreator(t,e){var i=["ui-led-digits","ui-led-digits",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UILedDigits;return n.initUILedDigits(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UILedDigitsCreator(100,100));function UIDevice(){return}UIDevice.PORTRAIT=0;UIDevice.LANDSCAPE=1;UIDevice.prototype=new UIElement;UIDevice.prototype.isUIDevice=true;UIDevice.prototype.deviceToJson=function(t){t.config=this.config;return};UIDevice.prototype.drawSelectMarks=function(t){};UIDevice.prototype.deviceFromJson=function(t){if(t.config){this.config=dupDeviceConfig(t.config)}return};UIDevice.prototype.getDirection=function(){return this.h>this.w?UIDevice.PORTRAIT:UIDevice.LANDSCAPE};UIDevice.prototype.setDirection=function(t){var e=this.getDirection();if(t===e){return}var i=JSON.stringify(this.toJson());var n=this.w;var r=this.h;var o=(r-n)/2;this.left=this.left-o;this.top=this.top+o;var a=0;var s=0;var l=this.config.screenW;var h=this.config.screenH;if(e===UIDevice.PORTRAIT){this.top=100;a=this.config.screenY;s=n-(this.config.screenX+this.config.screenW)}else{this.top=0;s=this.config.screenX;a=r-(this.config.screenY+this.config.screenH)}this.w=r;this.h=n;this.config.screenX=a;this.config.screenY=s;this.config.screenW=h;this.config.screenH=l;var u=JSON.stringify(this.toJson());this.exec(new PropertyCommand(this,i,u));return};UIDevice.prototype.setName=function(t){this.name=t;this.loadConfig();return};UIDevice.prototype.beforePropertyChanged=function(){this.oldConfig=dupDeviceConfig(this.config);return};UIDevice.prototype.afterPropertyChanged=function(){if(!isDeviceConfigEqual(this.oldConfig,this.config)){this.notifyDeviceConfigChanged(this.oldConfig,this.config)}this.relayout();return};UIDevice.prototype.onDeviceConfigChanged=function(t,e){this.relayoutChildren();return};UIDevice.prototype.loadConfig=function(){var t=cantkGetDeviceConfig(this.name);if(!t){t=cantkGetDeviceConfig("iphone5")}if(t){this.config=t}return};UIDevice.prototype.initUIDevice=function(t,e,i,n,r){this.initUIElement(t);this.setDefSize(e,i);this.setName(n);this.loadConfig();this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,r);this.setUserResizable(false);this.rectSelectable=false;this.regSerializer(this.deviceToJson,this.deviceFromJson);this.events={};return this};UIDevice.prototype.drawBgImage=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(e){var i=this.h/this.w;var n=e.height/e.width;if(i<=1&&n<=1||i>=1&&n>=1){this.drawImageAt(t,e,this.images.display,0,0,this.w,this.h)}else{t.save();t.translate(this.h/2,this.h/2);t.rotate(-Math.PI/2);t.translate(-this.h/2,-this.h/2);this.drawImageAt(t,e,this.images.display,0,0,this.h,this.w);t.restore()}}return};UIDevice.prototype.getScreen=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isUIScreen){return e}}return null};UIDevice.prototype.enterPreview=function(t){var e=this.getApp();var i=this.getScreen();var n=this.getWindowManager();if(!n||!i||!e){return}if(n.mode!=Shape.MODE_EDITING){return}var r=n.getCurrent();e.saveTemp();e.clearCommandHistory();var o=this.findChildByName("button-preview",false);if(o){o.setText(dappGetText("Edit"))}n.saveState();this.setMode(Shape.MODE_PREVIEW);i.setMode(Shape.MODE_PREVIEW,true);ResLoader.reset();e.loadUserScripts();n.systemInit();n.setInitWindow(null);if(t){n.setInitWindow(r)}return};UIDevice.prototype.exitPreview=function(){var t=this.getScreen();var e=this.getWindowManager();if(!e||!t||!this.app){return}if(e.mode!=Shape.MODE_PREVIEW){return}var i=this.findChildByName("button-preview",false);if(i){i.setText(dappGetText("Preview"))}if(this.app){this.app.clearCommandHistory()}e.systemExit();this.setMode(Shape.MODE_EDITING);t.setMode(Shape.MODE_EDITING,true);e.restoreState();e.clearState();this.setSelected(true);UIElement.timeScale=1;if(window.HolaSDK){window.HolaSDK.closeAd()}return};UIDevice.prototype.shapeCanBeChild=function(t){if(t.isUIDevice){var e=t.toJson();e.x=this.left;e.y=this.top;this.fromJson(e);this.relayoutChildren();if(this.app){this.app.clearCommandHistory()}return false}return t.isUIScreen&&this.getScreen()===null};UIDevice.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var t=0;var e=0;var i=0;var n=0;var r=this;for(var o=0;o<this.children.length;o++){var a=this.children[o];if(a.isUIScreen){t=this.config.screenX;e=this.config.screenY;i=this.config.screenW;n=this.config.screenH;a.widthAttr=UIElement.WIDTH_FIX;a.heightAttr=UIElement.HEIGHT_FIX;a.setLeftTop(t,e);a.setSize(i,n);a.relayout()}else{a.setVisible(false)}}return true};UIDevice.prototype.afterSetView=function(){this.relayoutChildren();return};UIDevice.prototype.getWindowManager=function(){var t=this.getScreen();return t?t.getWindowManager():null};UIDevice.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){t.beginPath();drawRoundRect(t,this.w,this.h,40);t.fill();t.stroke()}return};UIDevice.prototype.onKeyDownRunning=function(t){var e=this.getWindowManager();return e.onKeyDownRunning(t)};UIDevice.prototype.onKeyUpRunning=function(t){var e=this.getWindowManager();if(t==KeyEvent.DOM_VK_P){this.snapIt()}return e.onKeyUpRunning(t)};UIDevice.prototype.snapIt=function(){var t=null;var e=cantkGetQueryParam("snap-device");var i=cantkGetQueryParam("snap-screen");if(e){t=this}if(i){t=this.getWindowManager()}if(!t){return}var n=null;n=cantkGetQueryParam("width");var r=n?parseInt(n):t.w;n=cantkGetQueryParam("height");var o=n?parseInt(n):t.h;var a=cantkGetTempCanvas(r,o);var s=a.getContext("2d");var l=r/t.w;var h=o/t.h;s.save();s.scale(l,h);s.translate(-t.x,-t.y);t.paint(s);s.restore();window.open(a.toDataURL(),"_blank");return};function UIDeviceCreator(t,e,i,n){var r=["ui-device","ui-device",null,1];ShapeCreator.apply(this,r);this.createShape=function(r){var o=new UIDevice;o.initUIDevice(this.type,i,n,t+e,null);return o};return}ShapeFactoryGet().addShapeCreator(new UIDeviceCreator("android","",420,700));function UICanvas(){return}UICanvas.prototype=new UIElement;UICanvas.prototype.isUICanvas=true;UICanvas.prototype.initUICanvas=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.addEventNames(["onPaint","onPointerDown","onPointerMove","onPointerUp","onKeyDown","onKeyUp","onLongPress","onDoubleClick"]);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);
this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);return this};UICanvas.prototype.shapeCanBeChild=function(t){return t.isUIImage||t.isUIButton||t.isUIGroup||t.isUILabel};UICanvas.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e&&!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}t.beginPath();this.callOnPaintHandler(t);return};function UICanvasCreator(t,e){var i=["ui-canvas","ui-canvas",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UICanvas;return n.initUICanvas(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UICanvasCreator(200,200));function UIColorButton(){return}UIColorButton.prototype=new UIElement;UIColorButton.prototype.isUIButton=true;UIColorButton.prototype.isUIColorButton=true;UIColorButton.prototype.initUIColorTile=function(t,e,i){this.initUIColorButton(t,e,i);this.isUIButton=false;this.isUIColorButton=false;this.isUIColorTile=true;this.setAutoScaleFontSize(true);this.addEventNames(["onUpdateTransform"]);this.roundStyle="a";return this};UIColorButton.prototype.initUIColorButton=function(t,e,i){this.initUIElement(t);this.roundRadius=5;this.setDefSize(e,i);this.setTextType(Shape.TEXT_INPUT);this.setCanRectSelectable(false,false);this.setMargin(8,8);this.addEventNames(["onUpdateTransform"]);return this};UIColorButton.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIColorButton.prototype.getRoundStyle=function(){var t=this.roundStyle;if(t==="t"){return RoundRect.TL|RoundRect.TR}else if(t==="l"){return RoundRect.TL|RoundRect.BL}else if(t==="r"){return RoundRect.TR|RoundRect.BR}else if(t==="b"){return RoundRect.BL|RoundRect.BR}else{return RoundRect.TL|RoundRect.TR|RoundRect.BL|RoundRect.BR}};UIColorButton.prototype.paintSelfOnly=function(t){var e=this.getRoundStyle();var i=this.style.fillColor;var n=this.style.lineColor;if(this.pointerDown&&this.style.activeFillColor){i=this.style.activeFillColor}var r=!Shape.isTransparentColor(i);var o=!Shape.isTransparentColor(n);if(!r&&!o){return}t.save();t.beginPath();t.translate(this.hMargin,this.vMargin);drawRoundRect(t,this.w-2*this.hMargin,this.h-2*this.vMargin,this.roundRadius,e);if(r){t.fillStyle=i;t.fill()}if(o){if(this.isUIColorButton&&this.pointerDown){t.lineWidth=this.style.lineWidth+1}else{t.lineWidth=this.style.lineWidth}t.strokeStyle=n;t.stroke()}t.restore();return};function UIColorTileCreator(t,e){var i=["ui-color-tile","ui-color-tile",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIColorButton;return n.initUIColorTile(this.type,t,e)};return}function UIColorButtonCreator(t,e){var i=["ui-color-button","ui-color-button",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIColorButton;return n.initUIColorButton(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIColorTileCreator(80,80));ShapeFactoryGet().addShapeCreator(new UIColorButtonCreator(80,80));function UIViewPager(){return}UIViewPager.prototype=new UIPageManager;UIViewPager.prototype.isUIViewPager=true;UIViewPager.prototype.initUIViewPager=function(t){this.initUIPageManager(t);this.current=0;this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.heightAttr=UIElement.HEIGHT_FILL_PARENT;this.velocityTracker=new VelocityTracker;return this};UIViewPager.prototype.getFrameIndicatorParams=function(){var t=this.children.length;var e=Math.min(.5*this.w/t,40);var i=e*t;var n=(this.w-i)/2;var r=.8*this.h;return{offsetX:n,offsetY:r,itemSize:e,n:t}};UIViewPager.prototype.onClick=function(t,e){if(e||this.animating){return}if(!this.needShowIndicator()){return}var i=this.getFrameIndicatorParams();var n=t.x;var r=t.y;var o=i.n;var a=i.offsetX;var s=i.offsetY;var l=i.itemSize;if(r<s||r>s+l||n<a||n>a+o*l){return}for(var h=0;h<o;h++){if(n>a&&n<a+l){this.setCurrent(h);break}a+=l}return};UIViewPager.prototype.drawFrameIndicator=function(t,e){var i=this.getFrameIndicatorParams();var n=i.n;var r=i.offsetX;var o=i.offsetY;var a=i.itemSize;r+=a/2;o+=a/2;var s=15;t.fillStyle=this.style.fillColor;for(var l=0;l<n;l++){t.beginPath();t.arc(r,o,s,0,Math.PI*2);r+=a;if(l===e){t.save();t.shadowColor=this.style.lineColor;t.shadowBlur=5;t.shadowOffsetX=0;t.shadowOffsetY=0;t.fill();t.stroke();t.restore()}else{t.fill()}}return};UIViewPager.prototype.needShowIndicator=function(){if(this.pageIndicator){return false}if(this.mode===Shape.MODE_EDITING||this.showIndicator){return true}return false};UIViewPager.prototype.afterPaintChildren=function(t){if(this.needShowIndicator()){this.drawFrameIndicator(t,this.current)}return};UIViewPager.prototype.getPrevFrame=function(){var t=this.children.length;var e=(this.current-1+t)%t;return this.children[e]};UIViewPager.prototype.getNextFrame=function(){var t=this.children.length;var e=(this.current+1)%t;return this.children[e]};UIViewPager.prototype.animScrollTo=function(t,e){var i=1e3;var n=this;var r=this.offset;var o=(new Date).getTime();var a=new DecelerateInterpolator(2);if(n.animating){return}n.animating=true;function s(){var l=new Date;var h=(l.getTime()-o)/i;var u=a.get(h);if(h<1){n.offset=r+t*u;setTimeout(s,10)}else{n.offset=0;n.setCurrent(e);delete o;delete a;delete n.animating}delete l;n.postRedraw()}s();return};UIViewPager.prototype.onPointerDownRunning=function(t,e){if(e||this.animating||!this.slideToChange){return}if(this.isEventHandledByChild()){return}this.setEventHandled();this.velocityTracker.clear();return true};UIViewPager.prototype.isEventHandledByChild=function(){var t=UIElement.lastEvent.status;return t&UIElement.EVENT_HSCROLL_HANDLED};UIViewPager.prototype.setEventHandled=function(){this.setLastEventStatus(UIElement.EVENT_HSCROLL_HANDLED);return this};UIViewPager.prototype.onPointerMoveRunning=function(t,e){if(!this.slideToChange||e||!this.pointerDown){return}if(this.animating){this.setEventHandled();return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.current;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}var r=Math.abs(this.getMoveAbsDeltaX());var o=Math.abs(this.getMoveAbsDeltaY());if(r>o&&r>10){this.offset=this.getMoveAbsDeltaX()}else{this.offset=0}this.addMovementForVelocityTracker();return};UIViewPager.prototype.onPointerUpRunning=function(t,e){if(!this.slideToChange||e||!this.pointerDown){return}if(this.animating){this.setEventHandled();return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.current;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}var o=0;var a=this.offset;var s=this.current;var l=Math.abs(this.getMoveAbsDeltaY());var h=this.velocityTracker.getVelocity().x;if(Math.abs(a)<5||l>60){this.offset=0;return}var u=this.children.length;var p=a+h;if(Math.abs(p)>this.w/3){if(a>0){o=this.w-a;s=(this.current-1+u)%u}else{o=-this.w-a;s=(this.current+1)%u}}else{o=-a}this.animScrollTo(o,s);return};UIViewPager.prototype.paintChildrenAnimating=function(t){var e=this.getCurrentFrame();var i=this.getPrevFrame();var n=this.getNextFrame();t.save();t.rect(0,0,this.w,this.h);t.clip();if(this.offset>0){var r=this.w-this.offset;i.x=-r;i.paintSelf(t);r=this.offset;e.x=r;e.paintSelf(t)}else{e.x=this.offset;e.paintSelf(t);n.x=this.w+this.offset;n.paintSelf(t)}e.x=0;n.x=0;i.x=0;t.restore();return};UIViewPager.prototype.paintChildrenNormal=function(t){var e=this.getCurrentFrame();if(e){t.save();t.beginPath();e.paintSelf(t);t.restore()}return};UIViewPager.prototype.paintChildren=function(t){if(this.offset&&this.children.length>1){this.paintChildrenAnimating(t)}else{this.paintChildrenNormal(t)}return};UIViewPager.prototype.setSlideToChange=function(t){this.slideToChange=t;return};UIViewPager.prototype.setShowIndicator=function(t){this.showIndicator=t;return};UIViewPager.prototype.onModeChanged=function(){this.setCurrent(0);return};function UIViewPagerCreator(){var t=["ui-view-pager","ui-view-pager",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIViewPager;return e.initUIViewPager(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIViewPagerCreator);function UISlidingMenu(){return}UISlidingMenu.prototype=new UIElement;UISlidingMenu.prototype.isUISlidingMenu=true;UISlidingMenu.prototype.initUISlidingMenu=function(t,e,i){this.initUIElement(t);this.offset=0;this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setCanRectSelectable(false,false);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;return this};UISlidingMenu.prototype.onAppendedInParent=function(){var t=this.getMenu();if(!t){return}if(this.offset){this.setOffset(t.w)}else{this.setOffset(0)}return};UISlidingMenu.prototype.shapeCanBeChild=function(t){return t.isUIPage&&this.children.length<2};UISlidingMenu.prototype.afterChildAppended=function(t){t.setUserMovable(false);if(this.children.length>1&&this.mode==Shape.MODE_EDITING){var e=this.getMenu();this.setOffset(e.w)}return};UISlidingMenu.prototype.onDoubleClick=function(t,e){if(e||this.mode!=Shape.MODE_EDITING){return}if(this.offset){this.hideMenu()}else{this.showMenu()}return};UISlidingMenu.prototype.getMenu=function(){if(this.children.length>0){return this.children[0]}return null};UISlidingMenu.prototype.getContent=function(){if(this.children.length>1){return this.children[1]}return null};UISlidingMenu.prototype.showMenu=function(){var t=this.getMenu();if(t){this.scrollTo(t.w)}return};UISlidingMenu.prototype.hideMenu=function(){var t=this.getMenu();if(t){this.scrollTo(0)}return};UISlidingMenu.prototype.relayoutChildren=function(){var t=null;var e=null;var i=this.children.length;if(!i){return}if(i===1){t=this.children[0];t.y=0;t.x=0;t.h=this.h;t.xAttr=UIElement.X_FIX_LEFT;t.yAttr=UIElement.Y_FIX_TOP;t.widthAttr=UIElement.WIDTH_SCALE;t.heightAttr=UIElement.HEIGHT_FILL_PARENT;t.relayout();return}else{t=this.children[0];e=this.children[1];var n=t.w;t.y=0;t.h=this.h;t.xAttr=UIElement.X_FIX_LEFT;t.yAttr=UIElement.Y_FIX_TOP;t.widthAttr=UIElement.WIDTH_SCALE;t.heightAttr=UIElement.HEIGHT_FILL_PARENT;t.relayout();if(n===this.offset){this.offset=t.w}var r=this.offset/t.w;t.x=-Math.round(.5*((1-r)*t.w));e.y=0;e.x=this.offset;e.h=this.h;e.w=this.w;e.xAttr=UIElement.X_FIX_LEFT;e.widthAttr=UIElement.WIDTH_FIX;e.heightAttr=UIElement.HEIGHT_FILL_PARENT;t.relayoutChildren();e.relayoutChildren()}return};UISlidingMenu.prototype.getMinOffset=function(){return 0};UISlidingMenu.prototype.getMaxOffset=function(){var t=this.getMenu();return t?t.w:0};UISlidingMenu.prototype.scrollTo=function(t){var e=this;var i=500;var n=this.offset;var r=t-n;var o=(new Date).getTime();var a=new DecelerateInterpolator;this.animating=true;function s(){var t=new Date;var l=(t.getTime()-o)/i;var h=a.get(l);if(l<1){e.setOffset(Math.floor(n+h*r));setTimeout(s,10)}else{e.setOffset(n+r);delete o;delete a;delete e.animating}delete t}setTimeout(function(){s()},10);return};UISlidingMenu.prototype.setOffset=function(t){var e=this.getMenu();this.offset=t;if(e){if(this.offset<0){this.offset=0}if(this.offset>e.w){this.offset=e.w}}this.relayoutChildren();this.postRedraw();return};UISlidingMenu.prototype.isEventHandledByChild=function(){var t=UIElement.lastEvent.status;return t&UIElement.EVENT_HSCROLL_HANDLED};UISlidingMenu.prototype.setEventHandled=function(){this.setLastEventStatus(UIElement.EVENT_HSCROLL_HANDLED);return this};UISlidingMenu.prototype.onPointerDownRunning=function(t,e){if(e||this.animating){return}if(this.isEventHandledByChild()){return}this.setEventHandled();if(!this.velocityTracker){this.velocityTracker=new VelocityTracker}this.velocityTracker.clear();this.saveOffset=this.offset;return true};UISlidingMenu.prototype.onPointerMoveRunning=function(t,e){if(this.animating){this.setEventHandled();return}if(e){return}if(this.isEventHandledByChild()){return}this.setEventHandled();this.addMovementForVelocityTracker();var i=this.getMoveAbsDeltaX();var n=this.getMoveAbsDeltaY();if(Math.abs(i)>Math.abs(n)){this.setOffset(this.saveOffset+i)}return};UISlidingMenu.prototype.onPointerUpRunning=function(t,e){if(this.animating){this.setEventHandled();return}if(e){return}if(this.isEventHandledByChild()){return}this.setEventHandled();var i=this.getMoveAbsDeltaX();var n=this.getMoveAbsDeltaY();if(Math.abs(i)<Math.abs(n)){return}var r=this.velocityTracker.getVelocity().x;var o=i+r/2;if(Math.abs(o)<10){var a=this.getMenu();if(this.offset>10&&a&&t.x>a.x+a.w){this.hideMenu()}else{this.setOffset(this.saveOffset)}return}var s=this.getMinOffset();var l=this.getMaxOffset();var h=this.saveOffset+i+r;if(h<s){h=s}if(h>l){h=l}if(this.saveOffset>(s+l)/2){if(h<=s){h=s}else{h=l}}else{if(h>=l){h=l}else{h=s}}this.scrollTo(h);return};UISlidingMenu.prototype.onInit=function(){if(this.offset){var t=this.getMenu();if(t){this.setOffset(t.w)}}else{this.setOffset(0)}return};UISlidingMenu.prototype.dispatchPointerDownToChildren=function(t){var e=this.getMenu();var i=this.getContent();var n=this.offset?e:i;if(e&&i&&e.x==i.x&&e.x==0){this.setOffset(0)}if(n&&n.visible&&n.onPointerDown(t)){this.setTarget(n);return true}return false};UISlidingMenu.prototype.paintChildren=function(t){t.save();t.beginPath();t.rect(0,0,this.w,this.h);t.clip();t.beginPath();this.defaultPaintChildren(t);t.restore();return};function UISlidingMenuCreator(){var t=["ui-sliding-menu","ui-sliding-menu",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISlidingMenu;return e.initUISlidingMenu(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UISlidingMenuCreator);function UIProgressBar(){return}UIProgressBar.prototype=new UIElement;UIProgressBar.prototype.isUIProgressBar=true;UIProgressBar.prototype.initUIProgressBar=function(t,e,i,n){this.initUIElement(t);this.setPercent(50);this.setDefSize(e,i);this.roundRadius=0;this.setInteractive(n);this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_NORMAL_FG,null);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;if(n){this.addEventNames(["onChanged"]);this.addEventNames(["onChanging"])}return this};UIProgressBar.prototype.shapeCanBeChild=function(t){if(this.dragger){return false}return t.isUIImage||t.isUILabel||t.isUIColorTile};UIProgressBar.prototype.updateDraggerParams=function(){var t=this.dragger;if(!t)return;if(this.w<this.h){t.yAttr=UIElement.Y_FIX_TOP;t.xAttr=UIElement.X_CENTER_IN_PARENT;t.widthAttr=UIElement.WIDTH_FILL_PARENT;t.heightAttr=UIElement.HEIGHT_FIX}else{t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;t.xAttr=UIElement.X_FIX_LEFT;t.widthAttr=UIElement.WIDTH_FIX;t.heightAttr=UIElement.HEIGHT_FILL_PARENT}};UIProgressBar.prototype.relayoutChildren=function(){if(!this.dragger){return}if(this.w>this.h){var t=this.value*this.w-(this.dragger.w>>1);var e=this.w-this.dragger.w;this.dragger.setLeft(Math.max(0,Math.min(e,t)))}else{var i=(1-this.value)*this.h-(this.dragger.h>>1);var n=this.h-this.dragger.h;this.dragger.setTop(Math.max(0,Math.min(n,i)))}UIElement.prototype.relayoutChildren.call(this);return};UIProgressBar.prototype.resizeDragger=function(){if(this.dragger){var t=this.dragger.w;var e=this.dragger.h;if(this.w>this.h){e=this.h;t=Math.min(this.h,t)}else{t=this.w;e=Math.min(this.w,e)}this.dragger.setSize(t,e)}return this};UIProgressBar.prototype.afterChildAppended=function(t){var e=this;this.dragger=t;this.updateDraggerParams();this.setTextType(Shape.TEXT_NONE);t.setTextType(Shape.TEXT_NONE);e.onPointerMoveRunning=function(t,e){if(e){return}if(this.pointerDown&&this.dragger){var i=Math.min(Math.max(0,t.x),this.w-this.dragger.w);var n=Math.min(Math.max(0,t.y),this.h-this.dragger.h);this.dragger.move(i,n)}return};e.onPointerUpRunning=function(t,e){if(e){return}if(this.changed){this.changed=false;this.callOnChangedHandler(this.getValue())}return};e.onSized=function(){var t=Math.min(this.w,this.h);this.updateLayoutParams();this.setPercent(this.getPercent());this.resizeDragger();this.updateDraggerParams();return};t.onSized=function(){e.resizeDragger()};t.onMoved=function(){var t=0;if(e.w>e.h){var i=(this.left+(this.w>>1))/e.w;t=i*100;if(this.left<=0){t=0}if(this.left+this.w>=e.w){t=100}}else{var i=(e.h-(this.top+(this.h>>1)))/e.h;t=i*100;if(this.top<=0){t=100}if(this.top+this.h>=e.h){t=0}}e.changed=true;e.setPercentOnly(t);e.callOnChangingHandler(e.getValue());return};return};UIProgressBar.prototype.setInteractive=function(t){this.interactive=t;return this};UIProgressBar.prototype.setPercentOnly=function(t,e,i){var n=t%101/100;if(!i){this.value=n;this.relayoutChildren()}if(this.mode===Shape.MODE_EDITING||!this.isVisible()){return this}if(!i){if(e){this.callOnChangedHandler(this.getValue())}}else{if(this.value==n)return this;this.setupAnimation({notify:e,valueStart:this.value,valueEnd:n})}return this};UIProgressBar.prototype.setupAnimation=function(t){var e=this;var i={duration:300,actionWhenBusy:"replace",onStep:function(t,i,n){e.value=n.value;e.relayoutChildren();return true},onDone:function(i,n){e.value=t.valueEnd;if(t.notify){e.callOnChangedHandler(e.getValue())}}};if(!t){t=i}else{var n=Object.keys(i);for(var r=0,o=n.length;r<o;r++){var a=n[r];if(!t[a]){t[a]=i[a]}}}this.animate(t);return this};UIProgressBar.prototype.setPercent=function(t,e,i){t=Math.max(0,Math.min(t,100));this.setPercentOnly(t,e,i);this.relayoutChildren();return this};UIProgressBar.prototype.getPercent=function(){return this.value*100};UIProgressBar.prototype.getValue=function(){return this.getPercent()};UIProgressBar.prototype.setValue=function(t,e,i){this.setPercent(t,e,i);return this};UIProgressBar.prototype.drawText=function(t){var e=Math.round(this.getPercent())+"%";if(!this.isTextColorTransparent()){t.font=this.style.getFont();t.fillStyle=this.getTextColor();t.textBaseline="middle";t.textAlign="center";t.fillText(e,this.w>>1,this.h>>1)}return};UIProgressBar.prototype.paintSelfOnly=function(t){};UIProgressBar.prototype.drawBgImageV=function(t){var e=null;var i=this.w>>1;var n=this.w-i>>1;var r=this.roundRadius?this.roundRadius:0;var o=this.getImageByType(UIElement.IMAGE_DEFAULT);if(o&&o.getImage()){var a=o.getImageRect();e=o.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,0,this.w,this.h,a)}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,n,0,i,this.h,a)}}else{t.beginPath();t.translate(n,0);drawRoundRect(t,i,this.h,r);t.translate(-n,0);t.fillStyle=this.style.fillColor;t.fill()}o=this.getImageByType(UIElement.IMAGE_NORMAL_FG);var s=Math.round(this.h*this.value);var l=this.h-s;if(o&&o.getImage()){var a=o.getImageRect();e=o.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){var h=a.h;var u=a.y;var p=a.rh;var c=Math.round(h*this.value);a.h=c;a.y=a.y+h-c;a.h=c;a.rh=Math.round(p*this.value);WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,l,this.w,s,a);a.y=u;a.h=h;a.rh=p}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,n,l,i,s,a)}}else{if(s>2*r){t.beginPath();t.translate(n,l);drawRoundRect(t,i,s,r);t.fillStyle=this.style.lineColor;t.fill()}}return};UIProgressBar.prototype.drawBgImageH=function(t){var e=null;var i=this.h>>1;var n=this.h-i>>1;var r=this.roundRadius?this.roundRadius:0;var o=this.getImageByType(UIElement.IMAGE_DEFAULT);if(o&&o.getImage()){var a=o.getImageRect();e=o.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,0,this.w,this.h,a)}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,0,n,this.w,i,a)}}else{t.beginPath();t.translate(0,n);drawRoundRect(t,this.w,i,r);t.translate(0,-n);t.fillStyle=this.style.fillColor;t.fill()}var s=Math.round(this.w*this.value);var o=this.getImageByType(UIElement.IMAGE_NORMAL_FG);if(o&&o.getImage()){var a=o.getImageRect();e=o.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){var l=a.w;var h=a.rw;a.w=Math.round(a.w*this.value);a.rw=Math.round(a.rw*this.value);WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,0,s,this.h,a);a.w=l;a.rw=h}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,0,n,s,i,a)}}else{if(s>2*r){t.beginPath();t.translate(0,n);drawRoundRect(t,s,i,r);t.fillStyle=this.style.lineColor;t.fill()}}return};UIProgressBar.prototype.drawCircle=function(t){var e=this.w>>1;var i=this.h>>1;var n=Math.min(e,i);var r=Math.PI*2*this.value-.5*Math.PI;var o=Math.min(n,Math.max(this.style.lineWidth,5));if(!this.isFillColorTransparent()){t.beginPath();t.arc(e,i,n,0,Math.PI*2);t.fillStyle=this.style.fillColor;t.fill()}if(!this.isStrokeColorTransparent()){n=n-(o>>1);t.beginPath();t.lineCap="round";t.lineWidth=o;t.arc(e,i,n,-Math.PI*.5,r);t.strokeStyle=this.style.lineColor;t.stroke()}return};UIProgressBar.prototype.drawBgImage=function(t){t.save();if(Math.abs(this.w-this.h)<10){this.drawCircle(t)}else if(this.w>this.h){this.drawBgImageH(t)}else{this.drawBgImageV(t)}t.restore()};UIProgressBar.prototype.onFromJsonDone=function(){this.setPercent(this.getPercent());return};function UIProgressBarCreator(t,e,i){var n=i?"ui-slider":"ui-progressbar";var r=[n,"ui-progressbar",null,1];ShapeCreator.apply(this,r);this.createShape=function(n){var r=new UIProgressBar;return r.initUIProgressBar(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIProgressBarCreator(200,45,false));ShapeFactoryGet().addShapeCreator(new UIProgressBarCreator(200,45,true));function UIWindowManager(){}UIWindowManager.prototype=new UIFrames;UIWindowManager.prototype.isUIWindowManager=true;UIWindowManager.prototype.initUIWindowManager=function(t){this.settings={};this.initUIFrames(t);this.history=new Array;this.showLoadingProgress=true;this.setImage("force-landscape-tips",null);this.setImage("force-portrait-tips",null);this.soundMusicAutoPlay=true;this.setSoundEffectsEnable(true);this.setImage("loading-ui-logo",null);this.setImage("loading-ui-progress-bg",null);this.setImage("loading-ui-progress-fg",null);this.logoImage=ResLoader.loadImage(CanTK.config.logoImageSrc);this.progressBarBgImage=ResLoader.loadImage(CanTK.config.progressBarBgSrc);this.progressBarFgImage=ResLoader.loadImage(CanTK.config.progressBarFgSrc);return this};UIWindowManager.prototype.getEventNames=function(){return["onSystemInit"]};UIWindowManager.prototype.onFromJsonDone=function(){this.designWidth=this.w;this.designHeight=this.h;this.forcePortrait=false;this.forceLandscape=false;return};UIWindowManager.prototype.beforeAddShapeIntoChildren=function(t){return!t.isUIWindow};UIWindowManager.prototype.initDefaultNameForChild=function(t){t.name="newwin";return};UIWindowManager.prototype.getSplashWindow=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isUILoadingWindow)continue;if(e.isUINormalWindow&&e.windowType==="splash"){return e}}return null};UIWindowManager.prototype.getMainWindow=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isUILoadingWindow)continue;if(e.isUINormalWindow&&e.windowType==="main"){return e}}for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isUILoadingWindow)continue;if(e.isUINormalWindow){return e}}return null};UIWindowManager.prototype.getWindowNames=function(){var t=[];for(var e=0;e<this.children.length;e++){var i=this.children[e];t.push(i.name)}return t};UIWindowManager.prototype.setInitWindow=function(t){if(t===null||t===undefined){this.initWindowIndex=null}else{this.initWindowIndex=Math.max(0,Math.min(t,this.children.length-1))}return this};UIWindowManager.prototype.showInitWindow=function(){var t=null;if(this.children.length===0){return false}this.history.clear();if(this.initWindowIndex||this.initWindowIndex===0){t=this.children[this.initWindowIndex]}var e=cantkGetQueryParam("initwin");if(e){t=this.findBestFitWindowByName(e)}if(!t){t=this.getSplashWindow();if(!t){t=this.getMainWindow()}}if(t){this.targetShape=t;console.log("showInitWindow: set targetShape:"+this.targetShape.name);t.prepareForOpen();index=this.getFrameIndex(t);this.showFrame(index);t.callOnBeforeOpen();t.callOnOpen();this.history.push(index);this.postRedraw()}return true};UIWindowManager.prototype.callOnLoad=function(){this.resLoadDone=true;for(var t=0;t<this.children.length;t++){var e=this.children[t];e.callOnLoadHandler()}function i(){var t=this.getAppInfo();HolaSDK.init(t.appid,false)}setTimeout(i.bind(this),3e3);return true};UIWindowManager.prototype.callOnUnload=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.callOnUnloadHandler()}return true};UIWindowManager.prototype.onResLoadDone=function(){this.callOnLoad();this.showInitWindow();return};UIWindowManager.prototype.showResLoadingWindow=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isUINormalWindow&&(e.isUILoadingWindow||e.name==="win-loading")){e.isUILoadingWindow=true;this.openWindow(e.name);console.log("found resource loading window.");return}}this.showInitWindow();return};UIWindowManager.prototype.systemInit=function(){this.loadSoundEffects();this.loadSoundMusic();this.resLoadDone=false;UIElement.animTimerID=null;this.callOnSystemInitHandler();for(var t=0;t<this.children.length;t++){var e=this.children[t];e.callOnSystemInitHandler()}if(this.showLoadingProgress){var i=this.getHtmlImageByType("loading-ui-logo");if(i&&i.src){this.logoImage=i}i=this.getHtmlImageByType("loading-ui-progress-bg");if(i&&i.src){this.progressBarBgImage=i}i=this.getHtmlImageByType("loading-ui-progress-fg");if(i&&i.src){this.progressBarFgImage=i}}else{var n=this;var r=cantkGetQueryParam("show-loading-win");if(r==="false"){ResLoader.setOnLoadFinishListener(function(){n.onResLoadDone()});console.log("show-loading-win=false")}else{this.showResLoadingWindow();ResLoader.setOnLoadFinishListener(function(){n.callOnLoad()})}}return};UIWindowManager.prototype.systemExit=function(){console.log("systemExit: ");var t=this.history.length;for(var e=0;e<t;e++){this.closeCurrentWindow(0,true)}this.history.length=0;this.stopSoundMusic();this.callOnUnload();return};UIWindowManager.prototype.findBestFitWindowByName=function(t){var e=null;var i=null;var n=null;var r=null;var o=null;var a=this.getDeviceConfig();var s=t;var l=t+"-"+a.platform;var h=l+"-"+a.lcdDensity;var u=h+"-"+a.screenW+"x"+a.screenH;for(var p=0;p<this.children.length;p++){e=this.children[p];switch(e.name){case s:{if(a.lcdDensity===e.lcddensity){r=e}else if(!e.lcddensity||e.lcddensity==="all"){i=e}else{if(!i){i=e}}break}case l:{n=e;break}case h:{r=e;break}case u:{o=e;break}default:break}}if(o){console.log("Find "+o.name);return o}if(r){console.log("Find "+r.name);return r}if(n){console.log("Find "+n.name);return n}if(i){console.log("Find "+i.name);return i}return null};UIWindowManager.prototype.openWindow=function(t,e,i,n,r){var o=null;r=r?r:{closeOldIfOpened:true};if(t){o=this.findBestFitWindowByName(t)}else{o=this.getMainWindow()}if(!o||!o.isUIWindow){alert("Can not find window: "+t);return}if(o.pendingLoadChildren){o.loadChildren()}if(this.isWindowOpen(o)){if(r.closeOldIfOpened){o.callOnClose({});this.history.remove(o.getIndex())}else if(r.openNewIfOpened){var o=this.dupChild(o.name);o.destroyWhenClose=true}else{console.log(o.name+" is open already.");return false}}if(o.openPending){o.openPending=false;console.log("This window is already open:"+t);return false}o.prepareForOpen();o.openPending=true;o.initData=n;o.onClose=e;o.callOnBeforeOpen(n);this.targetShape=o;console.log("openWindow: set targetShape:"+this.targetShape.name);if(o.isUINormalWindow){return this.openNormalWindow(o,i)}else{return this.openPopupWindow(o,i)}};UIWindowManager.prototype.openPopupWindow=function(t,e){if(e){this.closeCurrentWindow(0,true)}var i=this;var n=this.getCurrentFrame();t.relayout();function r(){if(!t.app){console.log("may be exited preview mode");return}t.show();n.setPopupWindow(t);i.postRedraw();t.callOnOpen(t.initData)}if(n){n.callOnSwitchToBack(true);if(t.isAnimationEnabled()){var o=this.getPositionInScreen();var a=AnimationFactory.create(t.getAnimationName(true),t.getAnimationDuration(true));var s=UIFrames.preparseBackendCanvas(n,t);a.setScale(this.getRealScale());a.prepare(o.x,o.y,this.w,this.h,s,r);a.setRectOfFront(t.x,t.y,t.w,t.h);a.run()}else{r()}}return true};UIWindowManager.prototype.openNormalWindow=function(t,e){if(e){this.closeCurrentWindow(0,true)}var i=this;var n=0;t.relayout();var r=this.getCurrentFrame();function o(){if(!t.app){console.log("may be exited preview mode");return}n=i.getFrameIndex(t);i.showFrame(n);i.history.push(n);r=i.getCurrentFrame();i.postRedraw();t.callOnOpen(t.initData);return}if(r){r.callOnSwitchToBack();if(t.isAnimationEnabled()){var a=this.getPositionInScreen();var s=AnimationFactory.create(t.getAnimationName(true),t.getAnimationDuration(true));var l=UIFrames.preparseBackendCanvas(r,t);s.setScale(this.getRealScale());s.prepare(a.x,a.y,this.w,this.h,l,o);s.run()}else{o()}}else{o()}return true};UIWindowManager.prototype.getCurrentWindow=function(){var t=this.getCurrentFrame();if(!t){return null}var e=t.getPopupWindow();return e?e:t};UIWindowManager.prototype.backToHomeWin=function(){var t=this.history;var e=t.length-1;var i=this.getCurrentWindow();if(!e){if(i.isUIPopupWindow){this.closeCurrentWindow(0)}return}if(e===1){if(i.isUIPopupWindow){this.closeCurrentWindow(0,true);this.closeCurrentWindow(0)}else{this.closeCurrentWindow(0)}return}var n=t[0];var r=this.getFrame(n);if(i.isAnimationEnabled()){var o=this.getPositionInScreen();var a=AnimationFactory.create(i.getAnimationName(false),i.getAnimationDuration(false));var s=UIFrames.preparseBackendCanvas(r,i);a.setScale(this.getRealScale());a.prepare(o.x,o.y,this.w,this.h,s,function(){});a.run()}for(var l=0;l<e;l++){this.closeCurrentWindow(0,true)}return};UIWindowManager.prototype.closeCurrentWindow=function(t,e){var i=this.getCurrentWindow();if(!i||i.mode===Shape.MODE_EDITING){return false}if(i.isUINormalWindow){return this.closeCurrentNormalWindow(i,t,e)}else{return this.closeCurrentPopupWindow(i,t,e)}};UIWindowManager.prototype.closeCurrentPopupWindow=function(t,e,i){var n=this;var r=this.getCurrentFrame();if(r){function o(){if(!t.app){console.log("may be exited preview mode");return}r.removePopupWindow(t);r.callOnSwitchToFront(true);n.postRedraw();t.callOnClose(e)}if(t.isAnimationEnabled()&&!i){var a=this.getPositionInScreen();var s=AnimationFactory.create(t.getAnimationName(false),t.getAnimationDuration(false));r.removePopupWindow(t);var l=UIFrames.preparseBackendCanvas(r,t);r.setPopupWindow(t);s.setScale(this.getRealScale());s.prepare(a.x,a.y,this.w,this.h,l,o);s.setRectOfFront(t.x,t.y,t.w,t.h);s.run()}else{o()}}return true};UIWindowManager.prototype.closeCurrentNormalWindow=function(t,e,i){var n=this;var r=null;if(this.history.length<2){if(i&&this.history.length){n.history.remove(n.current);t.callOnClose(e)}return false}lastWinIndex=this.history[this.history.length-2];r=this.getFrame(lastWinIndex);function o(){if(!r.app){console.log("may be exited preview mode");return}n.showFrame(lastWinIndex);r.callOnSwitchToFront();n.postRedraw();t.callOnClose(e);return}n.history.remove(n.current);if(i){o()}else if(t.isAnimationEnabled()){var a=this.getPositionInScreen();var s=AnimationFactory.create(t.getAnimationName(false),t.getAnimationDuration(false));var l=UIFrames.preparseBackendCanvas(r,t);s.setScale(this.getRealScale());s.prepare(a.x,a.y,this.w,this.h,l,o);s.run()}else{setTimeout(o,10)}return};UIWindowManager.prototype.isWindowOpen=function(t){for(var e=0;e<this.history.length;e++){var i=this.history[e];var n=this.children[i];for(var r=n;r!=null;r=r.popupWindow){if(r===t)return true}}return false};UIWindowManager.prototype.shapeCanBeChild=function(t){if(t.isUIWindow){if(this.mode==Shape.MODE_EDITING){var e=this.findChildByName(t.name);if(e){t.name=t.name+this.children.length}}return true}return false};UIWindowManager.prototype.onChildrenChanged=function(){};UIWindowManager.prototype.afterChildAppended=function(t){if(this.mode!==Shape.MODE_RUNNING&&!this.isUnpacking){
var e=this.getFrameIndex(t);this.showFrame(e)}this.onChildrenChanged();return};UIWindowManager.prototype.onChildRemoved=function(t){this.onChildrenChanged();return};UIWindowManager.prototype.scaleForDensity=function(t,e,i){if(!t||t===1){return}for(var n=0;n<this.children.length;n++){var r=this.children[n];if(!r.lcddensity||r.lcddensity==="all"){if(r.pendingLoadChildren){r.scaleInfo={};r.scaleInfo.sizeScale=t;r.scaleInfo.lcdDensity=e}else{r.scaleForDensity(t,e,i)}}}return};UIWindowManager.prototype.resize=function(t,e){var i=0;var n=0;var r=this.screenScaleMode==="fix-width";var o=this.screenScaleMode==="fix-height";var a=this.screenScaleMode==="fix-resolution";var s=this.parentShape!=null;if(this.mode===Shape.MODE_RUNNING&&(r||o||a)&&!s){var l=this.view.getCanvas();var h=l.width;var u=l.height;var p=this.designWidth;var c=this.designHeight;var f=true;var m=h>u&&p>c||h<u&&p<c;l.style.width=h+"px";l.style.height=u+"px";if(f&&m){if(r){var d=p/h;l.width=p;l.height=u*d;t=l.width;e=l.height}else if(o){var d=c/u;l.height=c;l.width=h*d;t=l.width;e=l.height}else{var y=p/h;var g=c/u;var d=Math.max(y,g);if(Math.abs(y-g)<.1){l.width=p;l.height=c;i=0;n=0;t=l.width;e=l.height}else{l.width=h*d;l.height=u*d;i=l.width-p>>1;n=l.height-c>>1;t=p;e=c}}var v=l.width/h;var _=l.height/u;WWindowManager.setInputScale(v,_)}else{l.width=h;l.height=u;WWindowManager.setInputScale(1,1);t=l.width;e=l.height}var I=cantkGetViewPort();this.app.onCanvasSized(l.width,l.height);console.log("Canvas Size: w ="+l.width+" h="+l.height);console.log("ViewPort Size: w ="+I.width+" h="+I.height);console.log("Canvas Style Size: w ="+l.style.width+" h="+l.style.height)}this.lastWin=null;this.setLeftTop(i,n);this.setSizeLimit(t,e,t,e);UIElement.prototype.resize.call(this,t,e);return};UIWindowManager.prototype.setDeviceConfig=function(t){var e=this.screenScaleMode;if(e==="fix-resolution"||e==="fix-width"||e==="fix-height"){this.oldConfig=this.deviceConfig;return}var i=this.deviceConfig;this.oldConfig=this.deviceConfig;this.deviceConfig=t;if(i&&t){if(i.lcdDensity!=t.lcdDensity){var n=this.getSizeScale(i.lcdDensity,t.lcdDensity);this.scaleForDensity(n,t.lcdDensity,true)}this.notifyDeviceConfigChanged(i,t);console.log("call this.notifyDeviceConfigChanged: "+this.type)}console.log("setDeviceConfig platform:"+t.platform);return};UIWindowManager.prototype.getDeviceConfig=function(){if(this.deviceConfig){return this.deviceConfig}else{var t=this.getDevice();if(t){return t.config}}return null};UIWindowManager.prototype.paintLoadingStatus=function(t,e){var i=t;var n=0;var r=0;var o=0;var a=0;var s=0;var l=this.w;var h=this.h;var u=Math.round(this.w*.8);i.fillStyle="White";i.fillRect(0,0,l,h);var p=this.logoImage;if(p&&p.width){a=p.width;s=p.height;n=l-a>>1;r=Math.round(h*.6-s);i.drawImage(p,n,r)}o=u;p=this.progressBarBgImage;if(p&&p.width){a=p.width;s=p.height;n=l-u>>1;r=h*.6;i.drawImage(p,0,0,a,s,n,r,o,s)}p=this.progressBarFgImage;if(p&&p.width){o=Math.round(u*e/100);a=p.width;s=p.height;n=l-u>>1;i.drawImage(p,0,0,a,s,n,r,o,s)}return};UIWindowManager.prototype.paintChildren=function(t){if(this.mode!=Shape.MODE_EDITING){if(this.forcePortrait&&this.w>this.h){var e=this.getHtmlImageByType("force-portrait-tips");t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h);this.drawImageAt(t,e,UIElement.IMAGE_DISPLAY_CENTER,0,0,this.w,this.h);return}else if(this.forceLandscape&&this.w<this.h){var e=this.getHtmlImageByType("force-landscape-tips");t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h);this.drawImageAt(t,e,UIElement.IMAGE_DISPLAY_CENTER,0,0,this.w,this.h);return}if(this.showLoadingProgress){if(!this.resLoadDone){var i=this;var n=ResLoader.getPercent();if(n<100){this.paintLoadingStatus(t,n);console.log("resloading percent:"+n);setTimeout(function(){i.postRedraw()},100)}else{this.onResLoadDone()}return}}}var r=this.getCurrentFrame();if(r){if(r.isUIDialog){t.fillStyle="white";t.fillRect(0,0,this.w,this.h)}t.save();t.beginPath();r.paintSelf(t);t.restore()}return};UIWindowManager.prototype.paintSelf=function(t){t.save();this.translate(t);this.paintSelfOnly(t);this.beforePaintChildren(t);this.paintChildren(t);this.afterPaintChildren(t);t.restore();return};UIWindowManager.prototype.paintSelfOnly=function(t){if(this.mode===Shape.MODE_EDITING){this.setThisAsCurrentWindowManager();t.fillStyle="white";t.fillRect(0,0,this.w,this.h);UIWindowManager.updateWindowThumbView(this.current)}return};UIWindowManager.prototype.isDeviceDirectionOK=function(){if(this.mode===Shape.MODE_EDITING){return true}if(this.forcePortrait&&this.w>this.h||this.forceLandscape&&this.w<this.h){console.log("Device Direction Incorrect.");return false}return true};UIWindowManager.prototype.relayout=function(){if(this.isDeviceDirectionOK()){UIElement.prototype.relayout.call(this)}else{console.log("isDeviceDirectionNotOK ignore relayout")}return this};UIWindowManager.prototype.relayoutChildren=function(){if(!this.isDeviceDirectionOK()){console.log("isDeviceDirectionNotOK ignore relayout");return}var t=this.getCurrentFrame();if(this.mode===Shape.MODE_EDITING){for(var e=0;e<this.children.length;e++){var i=this.children[e];i.relayout()}}else{if(t){t.relayout();var n=t.getPopupWindow();if(n){n.relayout()}}}return};UIWindowManager.prototype.onKeyDown=function(t){var e=this.getCurrentWindow();return e&&e.onKeyDown(t)};UIWindowManager.prototype.onKeyUp=function(t){var e=this.getCurrentWindow();return e&&e.onKeyUp(t)};UIWindowManager.prototype.setSoundEffectURLs=function(t){this.soundEffectURLs=t;return this};UIWindowManager.prototype.getSoundEffectURLs=function(){return this.soundEffectURLs};UIWindowManager.prototype.getSoundEffectNames=function(){if(!this.soundEffectURLs){return[]}var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){t[e]=decodeURI(basename(t[e]))}return t};UIWindowManager.prototype.getSoundEnable=function(){return this.soundMusicsEnalbe||this.soundEffectsEnalbe};UIWindowManager.prototype.setSoundEnable=function(t){this.setSoundEffectsEnable(t);this.setSoundMusicsEnable(t);return this};UIWindowManager.prototype.setSoundEffectsEnable=function(t){this.soundEffectsEnalbe=t;return this};UIWindowManager.prototype.setSoundMusicsEnable=function(t){this.soundMusicsEnalbe=t;if(t){this.playSoundMusic()}else{this.stopSoundMusic()}return this};UIWindowManager.prototype.loadSoundEffects=function(){if(!this.soundEffectURLs){return}UIWindowManager.soundEffects={};if(CantkRT.isCantkRTCordova()){console.log("Native Audio supported: load native Audio");this.loadSoundEffectsNative()}else if(isWebAudioSupported()){console.log("WebAudio supported: load Web Audio");this.loadSoundEffectsWebAudio()}else{console.log("WebAudio not supported: load HTML5 Audio");this.loadSoundEffectsHtml5Audio()}return this};UIWindowManager.prototype.loadSoundEffectsHtml5Audio=function(){var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){var i=t[e];ResLoader.loadAudio(i,function(t){var e={audio:t};var i=decodeURI(basename(t.src));UIWindowManager.soundEffects[i]=e})}return this};UIWindowManager.prototype.loadSoundEffectsNative=function(){var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){var i=t[e];CantkRT.createSoundEffect(i,function(t){var e={audio:t};var i=decodeURI(basename(t.src));UIWindowManager.soundEffects[i]=e;console.log("loadSoundEffectsNative success.")},function(){console.log("loadSoundEffectsNative fail.")})}return this};UIWindowManager.prototype.loadSoundEffectsWebAudio=function(){var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){var i=t[e];var n={src:[i],autoplay:false,loop:false,volume:.8};var r=decodeURI(basename(i));var o={audio:new Howl(n),playing:false};UIWindowManager.soundEffects[r]=o}return this};UIWindowManager.prototype.stopSoundEffect=function(t){for(var e in UIWindowManager.soundEffects){if(t===e||!t){var i=UIWindowManager.soundEffects[e];if(i&&i.audio){if(i.audio.stop){i.audio.stop()}else{i.audio.pause()}i.playing=false}}}return this};UIWindowManager.prototype.stopAllSound=function(){try{this.stopSoundMusic().stopSoundEffect()}catch(t){console.log(t.message)}return this};UIWindowManager.soundMusicVolume=.8;UIWindowManager.soundEffectVolume=.8;UIWindowManager.prototype.setSoundEffectVolume=function(t){UIWindowManager.soundEffectVolume=t;return this};UIWindowManager.prototype.setSoundMusicVolume=function(t){UIWindowManager.soundMusicVolume=t;var e=this.lastAudioInfo;if(e&&e.audio){UIWindowManager.setVolumeOfAudio(e.audio,UIWindowManager.soundMusicVolume)}return this};UIWindowManager.setVolumeOfAudio=function(t,e){if(typeof t.volume==="function"){t.volume(e)}else{t.volume=e}};UIWindowManager.prototype.playSoundEffect=function(t,e){if(!this.soundEffectsEnalbe){console.log("this.soundEffectsEnalbe is disable ");return this}var i=UIWindowManager.soundEffects[t];if(!i||!i.audio){console.log("not found: "+t);return this}if(e){if(i.audio.once){i.audio.once("end",e)}else{i.audio.addEventListener("ended",function(t){e()})}}UIWindowManager.setVolumeOfAudio(i.audio,UIWindowManager.soundEffectVolume);i.audio.play();console.log("playSoundEffect:"+t);return this};UIWindowManager.prototype.onPointerDownRunning=function(t,e){if(this.autoPlayPending){this.playSoundMusic();this.autoPlayPending=false}if(!e||this.popupWindow||!this.pointerDown){return}return this.callOnPointerDownHandler(t)};UIWindowManager.prototype.setSoundMusicURLs=function(t){this.soundMusicURLs=t;return this};UIWindowManager.prototype.getSoundMusicURLs=function(){return this.soundMusicURLs};UIWindowManager.prototype.loadSoundMusicHTML5=function(){var t=this;var e=this.soundMusicLoop;var i=this.soundMusicAutoPlay;var n=this.soundMusicURLs.split("\n");this.setSoundMusicsEnable(i);for(var r=0;r<n.length;r++){var o=n[r];ResLoader.loadAudio(o,function(n){var r={audio:n};var o=decodeURI(basename(n.src));if(e){n.loop="loop"}if(i){n.play();i=false}t.autoPlayPending=true;UIWindowManager.soundMusic[o]=r})}return};UIWindowManager.prototype.loadSoundMusicWebAudio=function(){var t=this;var e=this.soundMusicLoop;var i=this.soundMusicAutoPlay;var n=this.soundMusicURLs.split("\n");for(var r=0;r<n.length;r++){var o=n[r];var a={src:[o],autoplay:i,loop:e,volume:.8};var s=decodeURI(basename(o));var l={audio:new Howl(a),playing:i};if(i){this.lastAudioInfo=l}i=false;UIWindowManager.soundMusic[s]=l}return};UIWindowManager.prototype.loadSoundMusicNative=function(){var t=this;var e=this.soundMusicLoop;var i=this.soundMusicAutoPlay;var n=this.soundMusicURLs.split("\n");for(var r=0;r<n.length;r++){var o=n[r];CantkRT.createSoundMusic(o,function(t){var n={audio:t};var r=decodeURI(basename(t.src));if(e){t.loop="loop"}if(i){t.play();this.lastAudioInfo=n;i=false}UIWindowManager.soundMusic[r]=n})}return};UIWindowManager.prototype.loadSoundMusic=function(){if(!this.soundMusicURLs){return}UIWindowManager.soundMusic={};if(CantkRT.isCantkRTCordova()){console.log("Native Audio supported: load native Audio");this.loadSoundMusicNative()}else if(isWebAudioSupported()){console.log("WebAudio supported: load Web Audio");this.loadSoundMusicWebAudio()}else{this.loadSoundMusicHTML5()}this.soundMusicsPlaying=this.soundMusicAutoPlay;return this};UIWindowManager.prototype.isSoundMusicPlaying=function(t){var e=false;for(var i in UIWindowManager.soundMusic){if(t===i||!t){var n=UIWindowManager.soundMusic[i];if(n&&n.audio){if(n.playing){e=true;break}}}}return e};UIWindowManager.prototype.stopSoundMusic=function(t){for(var e in UIWindowManager.soundMusic){if(t===e||!t){var i=UIWindowManager.soundMusic[e];if(i&&i.audio){i.audio.pause();i.playing=false;this.soundMusicsPlaying=false}}}return this};UIWindowManager.prototype.playSoundMusic=function(t,e){this.stopSoundMusic();if(!this.soundMusicsEnalbe){console.log("this.soundMusicsEnalbe is disable ");return this}if(!t&&this.lastAudioInfo&&this.lastAudioInfo.audio){var i=this.lastAudioInfo;UIWindowManager.setVolumeOfAudio(i.audio,UIWindowManager.soundMusicVolume);i.audio.play();i.playing=true;this.soundMusicsPlaying=true;return this}for(var n in UIWindowManager.soundMusic){if(t===n||!t){var i=UIWindowManager.soundMusic[n];if(i&&i.audio){if(e){i.audio.once("end",e)}UIWindowManager.setVolumeOfAudio(i.audio,UIWindowManager.soundMusicVolume);i.audio.play();i.playing=true;this.lastAudioInfo=i;this.soundMusicsPlaying=true;console.log("UIWindowManager.prototype.playSoundMusic");break}}}console.log("playSoundMusic:"+t);return this};UIWindowManager.prototype.getSoundMusicNames=function(){if(!this.soundMusicURLs){return[]}var t=this.soundMusicURLs.split("\n");for(var e=0;e<t.length;e++){t[e]=basename(t[e])}return t};function UIWindowManagerCreator(){var t=["ui-window-manager","ui-window-manager",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIWindowManager;return e.initUIWindowManager(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIWindowManagerCreator);function UIImageButton(){return}UIImageButton.prototype=new UIElement;UIImageButton.prototype.isUIImageButton=true;UIImageButton.prototype.initUIImageButton=function(t,e,i){this.initUIElement(t,e,i);this.setImage(UIElement.IMAGE_NORMAL,null);this.setImage(UIElement.IMAGE_ACTIVE,null);this.setImage(UIElement.IMAGE_DISABLE,null);this.addEventNames(["onUpdateTransform"]);return this};UIImageButton.prototype.shapeCanBeChild=function(t){return false};function UIImageButtonCreator(t,e){var i=["ui-image-button","ui-image-button",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIImageButton;return n.initUIImageButton(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIImageButtonCreator(120,90));function UIImageNormalView(){return}UIImageNormalView.prototype=new UIImageView;UIImageNormalView.prototype.isUIImageNormalView=true;UIImageNormalView.prototype.initUIImageNormalView=function(t,e,i){this.userImages=[];this.cachedImages=[];this.initUIElement(t);this.initUIImageView(e,i);this.setTextType(Shape.TEXT_NONE);this.current=0;this.offsetX=0;this.offsetY=0;this.imageScale=1;this.velocityTracker=new VelocityTracker;this.interpolator=new DecelerateInterpolator;this.errorImage=UIImageView.createImage("drawapp8/images/common/failed.png",null);this.loadingImage=UIImageView.createImage("drawapp8/images/common/loading.png",null);return this};UIImageNormalView.prototype.onPointerDownRunning=function(t,e){if(e){return}this.velocityTracker.clear();return};UIImageNormalView.prototype.onPointerMoveRunning=function(t,e){if(e){return}this.offsetX=this.offsetX+this.getMoveDeltaX();this.offsetY=this.offsetY+this.getMoveDeltaY();this.addMovementForVelocityTracker();return};UIImageNormalView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().x};UIImageNormalView.prototype.onPointerUpRunning=function(t,e){if(e){return}var i=this.velocityTracker.getVelocity();var n=this.w;var r=this.h;var o=i.x/n;var a=i.y/r;var s=Math.max(o,a);var l=.5*n*o*o;var h=.5*r*a*a;l=i.x>0?l:-l;h=i.y>0?h:-h;this.scrollTo(l,h,s*1e3);return true};UIImageNormalView.prototype.scrollTo=function(t,e,i){var n=this;var r=Math.max(500,Math.min(i,1e3));var o=(new Date).getTime();var a=this.offsetX;var s=this.offsetY;var l=this.cachedImages[this.current];var h=Math.min(l.width/2,t);var u=Math.min(l.height/2,e);function p(){var t=new Date;var e=(t.getTime()-o)/r;if(e<1){n.offsetX=a+e*h;n.offsetY=s+e*u;setTimeout(p,10)}else{delete o;n.offsetX=a+h;n.offsetY=s+u}delete t;n.postRedraw()}p();return};UIImageNormalView.prototype.switchTo=function(t){var e=this.current;var i=this.userImages.length;if(t>0){if(this.current+t<i){e=this.current+t}}else{if(this.current+t>0){e=this.current+t}}};UIImageNormalView.prototype.calcImageDefaultOffset=function(){var t=this.current;if(t<0||t>=this.cachedImages.length){return}var e=this.cachedImages[t];if(!e||!e.width){return}this.imageScale=Math.min(this.w/e.width,this.h/e.height);var i=this.imageScale*e.width;var n=this.imageScale*e.height;this.offsetX=(this.w-i)/2;this.offsetY=(this.h-n)/2;return};UIImageNormalView.prototype.setCurrentImage=function(t){if(t<0||t>=this.userImages.length){return}this.current=t;this.calcImageDefaultOffset();return};UIImageNormalView.prototype.onDoubleClick=function(t,e){this.calcImageDefaultOffset();return this.callOnDoubleClickHandler(t)};UIImageNormalView.prototype.paintSelfOnly=function(t){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var e=this.cachedImages[this.current];if(!e||!e.width){return}this.imageScale=1;t.save();t.rect(0,0,this.w,this.h);t.clip();t.translate(this.offsetX,this.offsetY);t.scale(this.imageScale,this.imageScale);t.drawImage(e,0,0);t.restore();return};function UIUIImageNormalViewCreator(){var t=["ui-image-normal-view","ui-image-normal-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageNormalView;return e.initUIImageNormalView(this.type,300,300)};return}ShapeFactoryGet().addShapeCreator(new UIUIImageNormalViewCreator);function UIImageSlideView(){return}UIImageSlideView.prototype=new UIImageView;UIImageSlideView.prototype.isUIImageSlideView=true;UIImageSlideView.prototype.initUIImageSlideView=function(t,e,i){this.initUIElement(t);this.initUIImageView(e,i);this.offset=0;this.addEventNames(["onChanged"]);this.setTextType(Shape.TEXT_NONE);imageSlideViewInitCustomProp(this);return this};UIImageSlideView.prototype.onInit=function(){var t=this;this.currFrame=0;function e(){if(t.mode!=Shape.MODE_EDITING&&t.isVisible()){var i=t.getFrameDuration();t.postRedraw();setTimeout(e,i);var n=t.currFrame+1;t.animScrollTo(-t.w,n)}}var i=this.getFrameDuration();setTimeout(e,i);return};UIImageSlideView.prototype.getFrameDuration=function(){return this.frameDuration?this.frameDuration:5e3};UIImageSlideView.prototype.setFrameDuration=function(t){this.frameDuration=Math.max(1e3,Math.min(t,3e5));return};UIImageSlideView.prototype.setShowIndicator=function(t){this.showIndicator=t;return};UIImageSlideView.prototype.getFrameIndicatorParams=function(){var t=this.userImages.length;var e=Math.min(.5*this.w/t,40);var i=e*t;var n=(this.w-i)/2;var r=.8*this.h;return{offsetX:n,offsetY:r,itemSize:e,n:t}};UIImageSlideView.prototype.getCurrent=function(){return this.currFrame};UIImageSlideView.prototype.getCurrentImage=function(){var t=this.cachedImages[this.currFrame];return t};UIImageSlideView.prototype.setValue=function(t){for(var e=0;e<this.cachedImages.length;e++){var i=this.cachedImages[e];if(i.src.indexOf(t)>=0||t.indexOf(i.src)>=0){return this.setCurrent(e)}}return this};UIImageSlideView.prototype.setCurrent=function(t){this.setCurrentFrame(t);return this};UIImageSlideView.prototype.setCurrentFrame=function(t){this.offset=0;this.currFrame=(t+this.userImages.length)%this.userImages.length;this.postRedraw();this.callOnChangedHandler(this.currFrame);return this};UIImageSlideView.prototype.animScrollTo=function(t,e){var i=1e3;var n=this;var r=this.offset;var o=(new Date).getTime();var a=new DecelerateInterpolator(2);if(n.animating){return}n.animating=true;function s(){var l=new Date;var h=(l.getTime()-o)/i;var u=a.get(h);if(h<1){n.offset=r+t*u;setTimeout(s,10)}else{n.offset=0;n.setCurrentFrame(e);delete o;delete a;delete n.animating}delete l;n.postRedraw()}s();return};UIImageSlideView.prototype.onPointerDownRunning=function(t,e){if(this.isEventHandledByChild()){return}this.setEventHandled();if(!this.velocityTracker){this.velocityTracker=new VelocityTracker}this.velocityTracker.clear();return true};UIImageSlideView.prototype.isEventHandledByChild=function(){var t=UIElement.lastEvent.status;return t&UIElement.EVENT_HSCROLL_HANDLED};UIImageSlideView.prototype.setEventHandled=function(){this.setLastEventStatus(UIElement.EVENT_HSCROLL_HANDLED);return this};UIImageSlideView.prototype.onPointerMoveRunning=function(t,e){if(this.animating){this.setEventHandled();return}if(e){return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.currFrame;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}this.offset=r;this.addMovementForVelocityTracker();return};UIImageSlideView.prototype.onPointerUpRunning=function(t,e){if(this.animating){this.setEventHandled();return}if(e){return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.currFrame;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}var o=0;var a=this.offset;var s=this.currFrame;var l=this.velocityTracker.getVelocity().x;var h=a+l;if(Math.abs(a)<10){this.offset=0;return}if(Math.abs(h)>this.w/3){if(a>0){o=this.w-a;s=this.currFrame-1}else{o=-this.w-a;s=this.currFrame+1}}else{o=-a}this.animScrollTo(o,s);return};UIImageSlideView.prototype.onClick=function(t,e){if(e||this.animating){return}var i=this.getFrameIndicatorParams();var n=i.offsetX;var r=i.offsetY;var o=i.itemSize;var a=i.n;var s=t.x;var l=t.y;if(l<r||l>r+o||s<n||s>n+a*o){return}for(var h=0;h<a;h++){if(s>n&&s<n+o){this.setCurrentFrame(h);break}n+=o}return};UIImageSlideView.prototype.drawFrameIndicator=function(t,e){var i=this.getFrameIndicatorParams();var n=i.offsetX;var r=i.offsetY;var o=i.itemSize;var a=i.n;n+=o/2;r+=o/2;t.fillStyle=this.style.fillColor;t.strokeStyle=this.style.lineColor;for(var s=0;s<a;s++){t.beginPath();t.arc(n,r,10,0,Math.PI*2);n+=o;if(s===e){t.save();t.shadowColor=this.style.lineColor;t.shadowBlur=5;t.shadowOffsetX=0;t.shadowOffsetY=0;t.fill();t.stroke();t.restore()}else{t.fill()}}return};UIImageSlideView.prototype.getPrevFrame=function(){var t=(this.currFrame-1+this.userImages.length)%this.userImages.length;return this.cachedImages[t]};UIImageSlideView.prototype.getFrames=function(){return this.userImages.length};UIImageSlideView.prototype.getNextFrame=function(){var t=(this.currFrame+1)%this.userImages.length;return this.cachedImages[t]};UIImageSlideView.prototype.drawOneImage=function(t,e){var i=this.style.fillColor;if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){t.drawImage(e,0,0,e.width,e.height,0,0,this.w,this.h)}else if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO){var n={x:0,y:0};n.w=e.width;n.h=e.height;this.drawImageAt(t,e,UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO,0,0,this.w,this.h,n)}else{UIImageView.drawImageAtCenter(t,e,0,0,this.w,this.h,true,i)}return};UIImageSlideView.prototype.drawImage=function(t){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var e=(this.currFrame?this.currFrame:0)%this.userImages.length;var i=this.cachedImages[e];if(i&&i.width>0){t.save();t.rect(0,0,this.w,this.h);t.clip();t.beginPath();t.translate(this.offset,0);this.drawOneImage(t,i);var n=Math.abs(this.offset);if(this.offset<0){i=this.getNextFrame();if(i&&i.width>0){t.translate(this.w,0);this.drawOneImage(t,i)}}else if(n>0){i=this.getPrevFrame();if(i&&i.width>0){t.translate(-this.w,0);this.drawOneImage(t,i)}}t.restore();if(this.showIndicator){this.drawFrameIndicator(t,e)}}return};UIImageSlideView.prototype.shapeCanBeChild=function(t){return t.isUIButton||t.isUIGroup||t.isUILabel||t.isUIImage};function UIImageSlideViewCreator(){var t=["ui-image-slide-view","ui-image-slide-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageSlideView;return e.initUIImageSlideView(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIImageSlideViewCreator);function cantkRegisterUIElements(){return}UIWindowManager.prototype.setThisAsCurrentWindowManager=function(){};UIWindowManager.updateWindowThumbView=function(t){};UIWindowManager.drawWindowThumbView=function(t,e){};UIElement.prototype.setsd=function(t){return this};UIElement.prototype.sendsd=function(t){return this};this.Matrix2D=function(){"use strict";function t(t,e,i,n,r,o){this.setValues(t,e,i,n,r,o)}var e=t.prototype;t.DEG_TO_RAD=Math.PI/180;t.identity=null;e.setValues=function(t,e,i,n,r,o){this.a=t==null?1:t;this.b=e||0;this.c=i||0;this.d=n==null?1:n;this.tx=r||0;this.ty=o||0;return this};e.append=function(t,e,i,n,r,o){var a=this.a;var s=this.b;var l=this.c;var h=this.d;if(t!=1||e!=0||i!=0||n!=1){this.a=a*t+l*e;this.b=s*t+h*e;this.c=a*i+l*n;this.d=s*i+h*n}this.tx=a*r+l*o+this.tx;this.ty=s*r+h*o+this.ty;return this};e.prepend=function(t,e,i,n,r,o){var a=this.a;var s=this.c;var l=this.tx;this.a=t*a+i*this.b;this.b=e*a+n*this.b;this.c=t*s+i*this.d;this.d=e*s+n*this.d;this.tx=t*l+i*this.ty+r;this.ty=e*l+n*this.ty+o;return this};e.appendMatrix=function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty)};e.prependMatrix=function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty)};e.appendTransform=function(e,i,n,r,o,a,s,l,h){if(o%360){var u=o*t.DEG_TO_RAD;var p=Math.cos(u);var c=Math.sin(u)}else{p=1;c=0}if(a||s){a*=t.DEG_TO_RAD;s*=t.DEG_TO_RAD;this.append(Math.cos(s),Math.sin(s),-Math.sin(a),Math.cos(a),e,i);this.append(p*n,c*n,-c*r,p*r,0,0)}else{this.append(p*n,c*n,-c*r,p*r,e,i)}if(l||h){this.tx-=l*this.a+h*this.c;this.ty-=l*this.b+h*this.d}return this};e.prependTransform=function(e,i,n,r,o,a,s,l,h){if(o%360){var u=o*t.DEG_TO_RAD;var p=Math.cos(u);var c=Math.sin(u)}else{p=1;c=0}if(l||h){this.tx-=l;this.ty-=h}if(a||s){a*=t.DEG_TO_RAD;s*=t.DEG_TO_RAD;this.prepend(p*n,c*n,-c*r,p*r,0,0);this.prepend(Math.cos(s),Math.sin(s),-Math.sin(a),Math.cos(a),e,i)}else{this.prepend(p*n,c*n,-c*r,p*r,e,i)}return this};e.rotate=function(t){var e=Math.cos(t);var i=Math.sin(t);var n=this.a;var r=this.b;this.a=n*e+this.c*i;this.b=r*e+this.d*i;this.c=-n*i+this.c*e;this.d=-r*i+this.d*e;return this};e.skew=function(e,i){e=e*t.DEG_TO_RAD;i=i*t.DEG_TO_RAD;this.append(Math.cos(i),Math.sin(i),-Math.sin(e),Math.cos(e),0,0);return this};e.scale=function(t,e){this.a*=t;this.b*=t;this.c*=e;this.d*=e;return this};e.translate=function(t,e){this.tx+=this.a*t+this.c*e;this.ty+=this.b*t+this.d*e;return this};e.identity=function(){this.a=this.d=1;this.b=this.c=this.tx=this.ty=0;return this};e.invert=function(){var t=this.a;var e=this.b;var i=this.c;var n=this.d;var r=this.tx;var o=t*n-e*i;this.a=n/o;this.b=-e/o;this.c=-i/o;this.d=t/o;this.tx=(i*this.ty-n*r)/o;this.ty=-(t*this.ty-e*r)/o;return this};e.isIdentity=function(){return this.tx===0&&this.ty===0&&this.a===1&&this.b===0&&this.c===0&&this.d===1};e.equals=function(t){return this.tx===t.tx&&this.ty===t.ty&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d};e.transformPoint=function(t,e,i){i=i||{};i.x=t*this.a+e*this.c+this.tx;i.y=t*this.b+e*this.d+this.ty;return i};e.decompose=function(e){if(e==null){e={}}e.x=this.tx;e.y=this.ty;e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b);e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var i=Math.atan2(-this.c,this.d);var n=Math.atan2(this.b,this.a);var r=Math.abs(1-i/n);if(r<1e-5){e.rotation=n/t.DEG_TO_RAD;if(this.a<0&&this.d>=0){e.rotation+=e.rotation<=0?180:-180}e.skewX=e.skewY=0}else{e.skewX=i/t.DEG_TO_RAD;e.skewY=n/t.DEG_TO_RAD}return e};e.copy=function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)};e.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)};e.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"};t.identity=new t;return t}();function UIBody(){return}UIBody.prototype=new UIElement;UIBody.prototype.isUIBody=true;UIBody.prototype.isUIPhysicsShape=true;UIBody.prototype.initUIBody=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setCanRectSelectable(false,false);this.density=0;this.friction=0;this.restitution=0;this.addEventNames(["onBeginContact","onEndContact","onMoved"]);return this};UIBody.prototype.shapeCanBeChild=function(t){if(!UIGroup.prototype.shapeCanBeChild.call(this,t)||t.isUIJoint&&!t.isUIMouseJoint){return false}return!t.isUIPhysicsShape};UIBody.prototype.setDensity=function(t){if(this.body){for(var e=this.body.GetFixtureList();e;e=e.m_next){e.SetDensity(t)}if(t>0){this.body.SetType(b2Body.b2_dynamicBody)}else if(t===0){this.body.SetType(b2Body.b2_staticBody)}else{this.body.SetType(b2Body.b2_kinematicBody)}}return this};UIBody.prototype.setSensor=function(t){this.isSensor=t;if(this.body){for(var e=this.body.GetFixtureList();e;e=e.m_next){e.SetSensor(t)}}return this};UIBody.prototype.getDensity=function(){if(this.body){return this.body.GetFixtureList().GetDensity()}return 0};UIBody.prototype.setV=function(t,e){var i=this.body;if(i){this.setVisible(true);if(!i.IsActive()){i.SetActive(true)}if(!i.IsAwake()){i.SetAwake(true)}var n=i.GetLinearVelocity();if(t!==null&&t!==undefined){n.x=t}if(e!==null&&e!==undefined){n.y=e}i.SetLinearVelocity(n)}return this};UIBody.prototype.getV=function(){return this.body?this.body.GetLinearVelocity():{x:0,y:0}};UIBody.prototype.addV=function(t,e){var i=this.getV();if(t!==null&&t!==undefined){i.x+=t}if(e!==null&&e!==undefined){i.y+=e}return this.setV(i.x,i.y)};UIBody.prototype.getMass=function(){return this.body?this.body.GetMass():0};UIBody.prototype.applyTorque=function(t){if(this.body){this.body.ApplyTorque(t)}return this};UIBody.prototype.applyForce=function(t,e,i,n){if(this.body){var r={};var o={};i=i===undefined||i===null?this.left+(this.w>>1):i;n=n===undefined||n===null?this.top+(this.h>>1):n;r.x=t;r.y=e;o.x=Physics.toMeter(i);o.y=Physics.toMeter(n);this.body.ApplyForce(r,o)}return this};UIBody.prototype.setEnable=function(t){this.enable=t;if(this.body){this.body.SetActive(t)}return this};UIBody.prototype.setGroupIndex=function(t){this.groupIndex=t;if(this.body){for(var e=this.body.GetFixtureList();e;e=e.m_next){e.m_filter.groupIndex=t}}return this};UIBody.prototype.getGroupIndex=function(){return this.groupIndex};UIBody.prototype.setRotation=function(t){this.rotation=t;if(this.body){this.body.SetAngle(t)}return this};UIBody.prototype.needStroke=function(){return!this.noStroke&&!this.isStrokeColorTransparent()||this.mode===Shape.MODE_EDITING};UIBody.prototype.setSize=function(t,e){RShape.prototype.setSize.call(this,t,e);this.onSized();return this};UIBody.prototype.onPositionChanged=function(){var t=this.left;var e=this.top;var i=this.getWindow();if(this.body&&i&&i.isUIScene){var n={};var r=this.getParent().getPositionInWindow();t+=r.x;e+=r.y;n.x=i.toMeter(t+(this.w>>1));n.y=i.toMeter(e+(this.h>>1));this.body.SetPosition(n)}return this};UIBody.prototype.paintSelfOnly=function(t){var e=this.needStroke();var i=!this.isFillColorTransparent();if(!i&&!e){return}t.beginPath();this.drawShape(t);if(i){t.fillStyle=this.style.fillColor;t.fill()}if(e){if(this.noStroke){t.setLineDash([5,5])}t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;t.stroke()}return};function UIPath(){return}UIPath.prototype=new UIElement;UIPath.prototype.isUIPath=true;UIPath.prototype.initUIPath=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onInit"]);return this};UIPath.prototype.shapeCanBeChild=function(t){return false};UIPath.prototype.onInit=function(){this.shapesInfo=[];this.elapsedTime=0;this.pathAnimation=new PathAnimation;this.animationState=UIElement.STATE_RUNNING;this.callOnInitHandler();return};UIPath.prototype.restart=function(){this.elapsedTime=0;this.animationState=UIElement.STATE_RUNNING;var t=this.shapesInfo;var e=this.shapesInfo.length;for(var i=0;i<e;i++){var n=t[i];n.done=false;n.startTime=n.delayTime}return this};UIPath.prototype.pause=function(){this.animationState=UIElement.STATE_PAUSED;return this};UIPath.prototype.resume=function(){this.animationState=UIElement.STATE_RUNNING;return this};UIPath.prototype.hasObj=function(t){var e=this.shapesInfo;var i=this.shapesInfo.length;for(var n=0;n<i;n++){var r=e[n];if(r.shape===t){return true}}return false};UIPath.prototype.addObj=function(t,e,i,n,r){if(this.hasObj(t)){console.log("obj exist in path.");return this}var o={shape:t,onStep:e,onDone:i,noRotation:r,delayTime:n?n:0,startTime:Date.now()};o.startTime=o.delayTime+this.elapsedTime;this.shapesInfo.push(o);return this};UIPath.prototype.removeObj=function(t){var e=this.shapesInfo;var i=this.shapesInfo.length;for(var n=0;n<i;n++){var r=e[n];if(r.shape===t){e.splice(n,1);break;
}}return this};UIPath.prototype.resetObjs=function(){this.shapesInfo=[];return this};UIPath.prototype.resetPath=function(){this.pathAnimation.reset();return this};UIPath.prototype.getStartPoint=function(){return this.pathAnimation.startPoint};UIPath.prototype.getEndPoint=function(){return this.endPoint};UIPath.prototype.addPath=function(t){this.pathAnimation.addPath(t);return this};UIPath.prototype.addLine=function(t,e,i,n){return this.addPath(LinePath.create(t,e,i.x,i.y,n.x,n.y))};UIPath.prototype.addArc=function(t,e,i,n,r,o){return this.addPath(ArcPath.create(t,e,i.x,i.y,n,r,o))};UIPath.prototype.addPara=function(t,e,i,n,r){return this.addPath(ParaPath.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y))};UIPath.prototype.addSin=function(t,e,i,n,r,o,a){return this.addPath(SinPath.create(t,e,i.x,i.y,n,r,o,a))};UIPath.prototype.addBezier=function(t,e,i,n,r,o){return this.addPath(Bezier3Path.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y,o.x,o.y))};UIPath.prototype.addQuad=function(t,e,i,n,r){return this.addPath(Bezier2Path.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y))};UIPath.prototype.getDuration=function(){return this.pathAnimation.duration};UIPath.prototype.getPosition=function(t){return this.pathAnimation.getPosition(t)};UIPath.prototype.getDirection=function(t){return this.pathAnimation.getDirection(t)};UIPath.prototype.updateObjs=function(t){this.elapsedTime+=t.timeStep*UIElement.timeScale;var e=this.elapsedTime;var i=this.shapesInfo.slice();var n=this.shapesInfo.length;var r=this.pathAnimation;var o=r.getDuration();for(var a=0;a<n;a++){var s=i[a];var l=s.shape;if(!l||!l.parentShape)continue;var h=e-s.startTime;if(h>0&&!s.done){var u=r.getDirection(h);var p=r.getPosition(h);if(!l.visible){l.setVisible(true)}l.setLeftTop(p.x-(l.w>>1),p.y-(l.h>>1));if(!s.noRotation){l.setRotation(u)}if(s.onStep){var c=s.onStep;c(l,h,p,u)}if(h>o){s.done=true;if(s.onDone){var f=s.onDone;f(l)}}}}};UIPath.prototype.paintSelf=function(t){if(this.isIcon||this.mode===Shape.MODE_EDITING){UIElement.prototype.paintSelf.call(this,t);return}if(this.showPath&&!this.isStrokeColorTransparent()){t.strokeStyle=this.style.lineColor;t.lineWidth=this.style.lineWidth;this.pathAnimation.draw(t)}if(this.animationState===UIElement.STATE_RUNNING){this.updateObjs(t);t.needRedraw++}return};function UIPathCreator(){var t=["ui-path","ui-path",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPath;return e.initUIPath(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIPathCreator);function UISprite(){return}UISprite.prototype=new UIImage;UISprite.prototype.isUISprite=true;UISprite.prototype.initUISprite=function(t,e,i,n){this.initUIImage(t,e,i,n);return this};function UISpriteCreator(){var t=["ui-sprite","ui-sprite",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISprite;return e.initUISprite(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UISpriteCreator);function UIPoint(){return}UIPoint.prototype=new UIElement;UIPoint.prototype.isUIPoint=true;UIPoint.prototype.initUIPoint=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,n);return this};UIPoint.prototype.paintSelfOnly=function(t){var e=!this.isFillColorTransparent();var i=!this.isStrokeColorTransparent();if(e||i){var n=this.w>>1;var r=this.h>>1;t.beginPath();t.arc(n,r,10,0,2*Math.PI);if(e){t.fillStyle=this.style.fillColor;t.fill()}if(i){t.strokeStyle=this.style.lineColor;t.lineWidth=this.style.lineWidth;t.stroke()}}return};UIPoint.prototype.shapeCanBeChild=function(t){return false};function UIPointCreator(){var t=["ui-point","ui-point",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPoint;return e.initUIPoint(this.type,20,20,null)};return}ShapeFactoryGet().addShapeCreator(new UIPointCreator);function UITwoPoints(){return}UITwoPoints.prototype=new UIElement;UITwoPoints.prototype.initUITwoPoints=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_POINT1,null);this.setImage(UIElement.IMAGE_POINT2,null);this.points=[{x:0,y:0},{x:80,y:80}];this.regSerializer(this.twoPointsToJson,this.twoPointsFromJson);return this};UITwoPoints.prototype.twoPointsToJson=function(t){t.points=[{x:0,y:0},{x:80,y:80}];t.points[0].x=this.points[0].x;t.points[0].y=this.points[0].y;t.points[1].x=this.points[1].x;t.points[1].y=this.points[1].y;return};UITwoPoints.prototype.twoPointsFromJson=function(t){if(t.points){this.points[0].x=t.points[0].x;this.points[0].y=t.points[0].y;this.points[1].x=t.points[1].x;this.points[1].y=t.points[1].y}return};UITwoPoints.prototype.asIcon=function(){if(!this.isIcon){this.isIcon=true;this.points=[{x:0,y:0},{x:80,y:80}]}return};UITwoPoints.prototype.relayout=function(){if(this.disableRelayout||this.mode===Shape.MODE_EDITING){return}var t=getParentShapeOfShape(this);var e=t.getWidth(true);var i=t.getHeight(true);if(this.xAttr===UIElement.X_SCALE){this.points[0].x=e*this.x0Param;this.points[1].x=e*this.x1Param}if(this.yAttr===UIElement.Y_SCALE){this.points[0].y=i*this.y0Param;this.points[1].y=i*this.y1Param}return};UITwoPoints.prototype.updateLayoutParams=function(){this.xParam=1;this.yParam=1;var t=this.parentShape;if(!t){return}var e=t.getWidth(true);var i=t.getHeight(true);if(this.xAttr===UIElement.X_SCALE){this.x0Param=this.points[0].x/e;this.x1Param=this.points[1].x/e}if(this.yAttr===UIElement.Y_SCALE){this.y0Param=this.points[0].y/i;this.y1Param=this.points[1].y/i}return};UITwoPoints.prototype.hitTest=function(t){if(Math.distanceBetween(t,this.points[0])<20){return 1}if(Math.distanceBetween(t,this.points[1])<20){return 2}var e={};e.x=this.points[0].x+this.points[1].x>>1;e.y=this.points[0].y+this.points[1].y>>1;if(Math.distanceBetween(t,e)<30){return Shape.HIT_TEST_MM}return Shape.HIT_TEST_NONE};UITwoPoints.prototype.getSelectMark=function(t,e){var i=this.points.length;if(t<=i){e.x=this.points[t-1].x;e.y=this.points[t-1].y;return true}return false};UITwoPoints.prototype.onAppendedInParent=function(){if(this.isCreatingElement()){var t=this.getParent();var e=t.getPositionInView();this.points[0].x-=e.x;this.points[0].y-=e.y;this.points[1].x-=e.x;this.points[1].y-=e.y}return};UITwoPoints.prototype.drawSelectMarks=function(t){if(this.mode!==Shape.MODE_EDITING){return}t.save();t.beginPath();if(this.selected&&!this.hideSelectMark){var e=Math.floor(2/this.getRealScale());t.lineWidth=e;t.fillStyle=this.style.fillColor;t.strokeStyle=RShape.selectMarkColor;t.stroke();t.beginPath();t.lineWidth=e;for(var i=Shape.HIT_TEST_NONE+1;i<Shape.HIT_TEST_MAX;i++){if(this.getSelectMark(i,this.selectMarkPoint)){this.createSelectedMark(t,this.selectMarkPoint.x,this.selectMarkPoint.y,i==this.hitTestResult)}}t.closePath();t.stroke()}t.restore();return};UITwoPoints.prototype.getX=function(){return Math.min(this.points[0].x,this.points[1].x)};UITwoPoints.prototype.getY=function(){return Math.min(this.points[0].y,this.points[1].y)};UITwoPoints.prototype.getWidth=function(){return Math.abs(this.points[0].x-this.points[1].x)};UITwoPoints.prototype.getHeight=function(){return Math.abs(this.points[0].y-this.points[1].y)};UITwoPoints.prototype.paintSelf=function(t){t.save();if(this.isIcon){this.translate(t)}var e=null;var i=null;var n=this.points[0];var r=this.points[1];var o=this.getImageByType(UIElement.IMAGE_DEFAULT);var a=this.getImageByType(UIElement.IMAGE_POINT1);var s=this.getImageByType(UIElement.IMAGE_POINT2);var l=this.anchorSize?this.anchorSize:5;t.lineWidth=this.style.lineWidth;t.fillStyle=this.style.fillColor;t.strokeStyle=this.style.lineColor;if(o&&o.getImage()){e=o.getImage();i=o.getImageRect();UIElement.drawImageLine(t,e,this.images.display,n,r,i)}else{t.beginPath();t.moveTo(n.x,n.y);t.lineTo(r.x,r.y);t.stroke()}if(a&&a.getImage()){e=a.getImage();i=a.getImageRect();this.drawImageAt(t,e,WImage.DISPLAY_CENTER,n.x-l,n.y-l,l+l,l+l,i)}else{t.beginPath();t.arc(n.x,n.y,l,0,Math.PI*2);t.fill()}if(s&&s.getImage()){e=s.getImage();i=s.getImageRect();this.drawImageAt(t,e,WImage.DISPLAY_CENTER,r.x-l,r.y-l,l+l,l+l,i)}else{t.beginPath();t.arc(r.x,r.y,l,0,Math.PI*2);t.fill()}t.restore();this.drawSelectMarks(t);return};UITwoPoints.prototype.shapeCanBeChild=function(t){return false};UITwoPoints.prototype.getPoint=function(t){return this.points[t?1:0]};UITwoPoints.prototype.setPoint=function(t,e,i){var n=this.points[t?1:0];n.x=e;n.y=i;return};UITwoPoints.prototype.getDistance=function(){return Math.round(Math.distanceBetween(this.points[0],this.points[1]))};UITwoPoints.prototype.getAngle=function(){return Math.lineAngle(this.points[0],this.points[1])};UITwoPoints.prototype.onPointerDownCreating=function(t){switch(this.state){case Shape.STAT_CREATING_0:{this.points[0].x=t.x;this.points[0].y=t.y;this.state=Shape.STAT_CREATING_1;return true}case Shape.STAT_CREATING_1:{return true}default:{return false}}};UITwoPoints.prototype.onPointerMoveCreating=function(t){switch(this.state){case Shape.STAT_CREATING_0:{this.points[0].x=t.x;this.points[0].y=t.y;this.points[1].x=t.x+50;this.points[1].y=t.y+50;return true}case Shape.STAT_CREATING_1:{this.points[1].x=t.x;this.points[1].y=t.y;return true}default:{return false}}};UITwoPoints.prototype.onPointerUpCreating=function(t){switch(this.state){case Shape.STAT_CREATING_0:{return true}case Shape.STAT_CREATING_1:{this.state=Shape.STAT_NORMAL;return true}default:{return false}}};UITwoPoints.prototype.onPointerDownEditing=function(t){this.hitTestResult=this.hitTest(t);this.selected=this.hitTestResult!=Shape.HIT_TEST_NONE;return this.hitTestResult};UITwoPoints.prototype.onPointerMoveEditing=function(t){if(this.hitTestResult>0){var e=this.hitTestResult-1;this.points[e].x=t.x;this.points[e].y=t.y}};UITwoPoints.prototype.onPointerUpEditing=function(t){this.hitTestResult=Shape.HIT_TEST_NONE;return};UITwoPoints.prototype.getSupportedImageDisplay=function(){return["incenter","scale","tile"]};function UIImageLine(){return}UIImageLine.prototype=new UITwoPoints;UIImageLine.prototype.isUIImageLine=true;UIImageLine.prototype.initUIImageLine=function(t,e,i){this.initUITwoPoints(t);this.setImage(UIElement.IMAGE_DEFAULT,null);return this};UIImageLine.prototype.paintSelf=function(t){var e=this.getBgImage();if(e&&e.getImage()){t.save();if(this.isIcon){this.translate(t)}var i=this.points[0];var n=this.points[1];var r=e.getImageRect();UIElement.drawImageLine(t,e.getImage(),this.images.display,i,n,r);this.drawSelectMarks(t);t.restore()}else{UITwoPoints.prototype.paintSelf.call(this,t)}return};function UIImageLineCreator(){var t=["ui-image-line","ui-image-line",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageLine;return e.initUIImageLine(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIImageLineCreator);function UIPolygon(){return}UIPolygon.prototype=new UIBody;UIPolygon.prototype.isUIPolygon=true;UIPolygon.prototype.initUIPolygon=function(t,e,i){this.initUIBody(t,e,i);return this};UIPolygon.prototype.resizeBody=function(t,e){var i=[];var n=this.w>>1;var r=this.h>>1;var o=this.children.length;for(var a=0;a<o;a++){var s=this.children[a];if(!s.isUIPoint){continue}var l=s.w>>1;var h=s.h>>1;var u=(s.left+(l>>1))*t;var p=(s.top+(h>>1))*e;var c=u-l;var f=p-h;s.setLeftTop(c,f);i.push({x:Physics.toMeter(u-n),y:Physics.toMeter(p-r)})}var m=this.body.GetFixtureList().GetShape();m.SetAsArray(i,i.length);this.body.SynchronizeFixtures();this.setLeftTop(x,y);return};UIPolygon.prototype.setSize=function(t,e){var i=t/this.w;var n=e/this.h;RShape.prototype.setSize.call(this,t,e);var r=this.getWindow();this.updateLayoutParams();if(this.body&&r&&r.isUIScene){this.resizeBody(i,n)}return this};UIPolygon.prototype.shapeCanBeChild=function(t){if(!UIGroup.prototype.shapeCanBeChild.call(this,t)||t.isUIJoint&&!t.isUIMouseJoint){return false}if(t.isUIPoint){return true}return!t.isUIPhysicsShape};UIPolygon.prototype.drawShape=function(t){var e=0;var i=0;for(var n=0;n<this.children.length;n++){var r=this.children[n];if(!r.isUIPoint){continue}var o=r.left+(r.w>>1);var a=r.top+(r.h>>1);if(n%5===0){e=o;i=a;if(n>0){t.closePath()}t.moveTo(o,a)}else{t.lineTo(o,a)}}t.lineTo(e,i)};function UIPolygonCreator(){var t=["ui-polygon","ui-polygon",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPolygon;return e.initUIPolygon(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIPolygonCreator);function UIBox(){return}UIBox.prototype=new UIBody;UIBox.prototype.isUIBox=true;UIBox.prototype.initUIBox=function(t,e,i){this.initUIBody(t,e,i);return this};UIBox.prototype.shapeCanBeChild=function(t){if(!UIGroup.prototype.shapeCanBeChild.call(this,t)||t.isUIJoint&&!t.isUIMouseJoint){return false}return!t.isUIPhysicsShape};UIBox.prototype.onSized=function(){var t=this.getWindow();this.updateLayoutParams();if(this.body&&t&&t.isUIScene){var e=this.left;var i=this.top;var n=this.body.GetFixtureList().GetShape();var r=this.getWidth(true)>>1;var o=this.getHeight(true)>>1;n.SetAsBox(Physics.toMeter(r),Physics.toMeter(o));this.body.SynchronizeFixtures();this.setLeftTop(e,i)}};UIBox.prototype.drawShape=function(t){var e=this.getHMargin();var i=this.getVMargin();var n=this.getWidth(true);var r=this.getHeight(true);t.rect(e,i,n,r);return};function UIBoxCreator(){var t=["ui-box","ui-box",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIBox;return e.initUIBox(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIBoxCreator);function UIOneJoint(){return}UIOneJoint.prototype=new UIElement;UIOneJoint.prototype.isUIJoint=true;UIOneJoint.prototype.isUIOneJoint=true;UIOneJoint.prototype.initUIOneJoint=function(t){this.initUIElement(t);this.setDefSize(20,20);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_POINT,null);return this};UIOneJoint.prototype.paintSelfOnly=function(t){var e=this.getImageByType(UIElement.IMAGE_POINT);if(e&&e.getImage()){var i=e.getImage();var n=e.getImageRect();this.drawImageAt(t,i,this.images.display,0,0,this.w,this.h,n)}else{var r=!this.isFillColorTransparent();var o=!this.isStrokeColorTransparent();if(r||o){var a=this.w>>1;var s=this.h>>1;t.beginPath();t.arc(a,s,10,0,2*Math.PI);if(r){t.fillStyle=this.style.fillColor;t.fill()}if(o){t.strokeStyle=this.style.lineColor;t.lineWidth=this.style.lineWidth;t.stroke()}}}return};UIOneJoint.prototype.shapeCanBeChild=function(t){return false};function UIOneJointCreator(){var t=["ui-one-joint","ui-one-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIOneJoint;return e.initUIOneJoint(this.type)};return}(function(t,e){i.POOL_MAX=1e3;i.TIME_STEP=60;i.MEASURE=100;i.EULER="euler";i.RK2="runge-kutta2";i.RK4="runge-kutta4";i.VERLET="verlet";i.PARTICLE_CREATED="partilcleCreated";i.PARTICLE_UPDATE="partilcleUpdate";i.PARTICLE_SLEEP="particleSleep";i.PARTICLE_DEAD="partilcleDead";i.PROTON_UPDATE="protonUpdate";i.PROTON_UPDATE_AFTER="protonUpdateAfter";i.EMITTER_ADDED="emitterAdded";i.EMITTER_REMOVED="emitterRemoved";i.amendChangeTabsBug=true;i.TextureBuffer={};i.TextureCanvasBuffer={};function i(t,e){this.proParticleCount=i.Util.initValue(t,i.POOL_MAX);this.integrationType=i.Util.initValue(e,i.EULER);this.emitters=[];this.renderers=[];this.time=0;this.oldTime=0;i.pool=new i.ParticlePool(this.proParticleCount);i.integrator=new i.NumericalIntegration(this.integrationType)}i.prototype={addRender:function(t){t.proton=this;this.renderers.push(t.proton)},addEmitter:function(t){this.emitters.push(t);t.parent=this;this.dispatchEvent(new i.Event({type:i.EMITTER_ADDED,emitter:t}))},removeEmitter:function(t){var e=this.emitters.indexOf(t);this.emitters.splice(e,1);t.parent=null;this.dispatchEvent(new i.Event({type:i.EMITTER_REMOVED,emitter:t}))},update:function(){this.dispatchEvent(new i.Event({type:i.PROTON_UPDATE}));if(!this.oldTime)this.oldTime=(new Date).getTime();var t=(new Date).getTime();this.elapsed=(t-this.oldTime)/1e3;if(i.amendChangeTabsBug)this.amendChangeTabsBug();this.oldTime=t;if(this.elapsed>0){for(var e=0;e<this.emitters.length;e++){this.emitters[e].update(this.elapsed)}}this.dispatchEvent(new i.Event({type:i.PROTON_UPDATE_AFTER}))},amendChangeTabsBug:function(){if(this.elapsed>.5){this.oldTime=(new Date).getTime();this.elapsed=0}},getCount:function(){var t=0;var e=this.emitters.length;for(var i=0;i<e;i++){t+=this.emitters[i].particles.length}return t},destory:function(){var t=this.emitters.length;for(var e=0;e<t;e++){this.emitters[e].destory();delete this.emitters[e]}this.emitters=[];this.time=0;this.oldTime=0;i.pool.release()}};t.Proton=i;function n(){this.initialize()}var r=n.prototype;n.initialize=function(t){t.addEventListener=r.addEventListener;t.removeEventListener=r.removeEventListener;t.removeAllEventListeners=r.removeAllEventListeners;t.hasEventListener=r.hasEventListener;t.dispatchEvent=r.dispatchEvent};r._listeners=null;r.initialize=function(){};r.addEventListener=function(t,e){var i=this._listeners;if(!i){i=this._listeners={}}else{this.removeEventListener(t,e)}var n=i[t];if(!n){n=i[t]=[]}n.push(e);return e};r.removeEventListener=function(t,e){var i=this._listeners;if(!i){return}var n=i[t];if(!n){return}for(var r=0,o=n.length;r<o;r++){if(n[r]==e){if(o==1){delete i[t]}else{n.splice(r,1)}break}}};r.removeAllEventListeners=function(t){if(!t){this._listeners=null}else if(this._listeners){delete this._listeners[t]}};r.dispatchEvent=function(t){var e=false,i=this._listeners;if(t&&i){var n=i[t.type];if(!n)return e;n=n.slice();for(var r=0,o=n.length;r<o;r++){var a=n[r];e=e||a(t)}}return!!e};r.hasEventListener=function(t){var e=this._listeners;return!!(e&&e[t])};i.EventDispatcher=n;i.EventDispatcher.initialize(i.prototype);function o(t){this.type=t["type"];this.particle=t["particle"];this.emitter=t["emitter"]}o.PARTICLE_CREATED=i.PARTICLE_CREATED;o.PARTICLE_UPDATA=i.PARTICLE_UPDATA;o.PARTICLE_SLEEP=i.PARTICLE_SLEEP;o.PARTICLE_DEAD=i.PARTICLE_DEAD;i.Event=o;var a=a||{initValue:function(t,i){var t=t!=null&&t!=e?t:i;return t},isArray:function(t){return typeof t==="object"&&t.hasOwnProperty("length")},destroyArray:function(t){t.length=0},destroyObject:function(t){for(var e in t)delete t[e]},getVector2D:function(t,e){if(typeof t=="object"){return t}else{var n=new i.Vector2D(t,e);return n}},judgeVector2D:function(t){var e="";if(t.hasOwnProperty("x")||t.hasOwnProperty("y")||t.hasOwnProperty("p")||t.hasOwnProperty("position"))e+="p";if(t.hasOwnProperty("vx")||t.hasOwnProperty("vx")||t.hasOwnProperty("v")||t.hasOwnProperty("velocity"))e+="v";if(t.hasOwnProperty("ax")||t.hasOwnProperty("ax")||t.hasOwnProperty("a")||t.hasOwnProperty("accelerate"))e+="a";return e},setVector2DByObject:function(t,e){if(e.hasOwnProperty("x"))t.p.x=e["x"];if(e.hasOwnProperty("y"))t.p.y=e["y"];if(e.hasOwnProperty("vx"))t.v.x=e["vx"];if(e.hasOwnProperty("vy"))t.v.y=e["vy"];if(e.hasOwnProperty("ax"))t.a.x=e["ax"];if(e.hasOwnProperty("ay"))t.a.y=e["ay"];if(e.hasOwnProperty("p"))particle.p.copy(e["p"]);if(e.hasOwnProperty("v"))particle.v.copy(e["v"]);if(e.hasOwnProperty("a"))particle.a.copy(e["a"]);if(e.hasOwnProperty("position"))particle.p.copy(e["position"]);if(e.hasOwnProperty("velocity"))particle.v.copy(e["velocity"]);if(e.hasOwnProperty("accelerate"))particle.a.copy(e["accelerate"])},addPrototypeByObject:function(t,e,n){for(var r in e){if(n){if(n.indexOf(r)<0)t[r]=i.Util.getSpanValue(e[r])}else{t[r]=i.Util.getSpanValue(e[r])}}return t},setPrototypeByObject:function(t,e,n){for(var r in e){if(t.hasOwnProperty(r)){if(n){if(n.indexOf(r)<0)t[r]=i.Util.getSpanValue(e[r])}else{t[r]=i.Util.getSpanValue(e[r])}}}return t},setSpanValue:function(t,e,n){if(t instanceof i.Span){return t}else{if(!e){return new i.Span(t)}else{if(!n)return new i.Span(t,e);else return new i.Span(t,e,n)}}},getSpanValue:function(t){if(t instanceof i.Span)return t.getValue();else return t},inherits:function(t,e){t._super_=e;if(Object["create"]){t.prototype=Object.create(e.prototype,{constructor:{value:t}})}else{var i=function(){};i.prototype=e.prototype;t.prototype=new i;t.prototype.constructor=t}},getImageData:function(t,e,i){t.drawImage(e,i.x,i.y);var n=t.getImageData(i.x,i.y,i.width,i.height);t.clearRect(i.x,i.y,i.width,i.height);return n},getImage:function(t,e,i,n){if(typeof t=="string"){this.loadAndSetImage(t,e,i,n)}else if(typeof t=="object"){this.loadAndSetImage(t.src,e,i,n)}else if(t instanceof Image){this.loadedImage(t.src,e,i,n,t)}},loadedImage:function(t,e,n,r,o){e.target=o;e.transform.src=t;if(!i.TextureBuffer[t])i.TextureBuffer[t]=e.target;if(n){if(i.TextureCanvasBuffer[t]){e.transform.canvas=i.TextureCanvasBuffer[t]}else{var a=i.WebGLUtil.nhpot(e.target.width);var s=i.WebGLUtil.nhpot(e.target.height);e.transform.canvas=i.DomUtil.createCanvas("canvas"+t,a,s);var l=e.transform.canvas.getContext("2d");l.drawImage(e.target,0,0,e.target.width,e.target.height);i.TextureCanvasBuffer[t]=e.transform.canvas}}if(r)r(e)},loadAndSetImage:function(t,e,n,r){if(i.TextureBuffer[t]){this.loadedImage(t,e,n,r,i.TextureBuffer[t])}else{var o=this;var a=new Image;a.onload=function(i){o.loadedImage(t,e,n,r,i.target)};a.src=t}},hexToRGB:function(t){var e=t.charAt(0)=="#"?t.substring(1,7):t;var i=parseInt(e.substring(0,2),16);var n=parseInt(e.substring(2,4),16);var r=parseInt(e.substring(4,6),16);return{r:i,g:n,b:r}},rgbToHex:function(t){return"rgb("+t.r+", "+t.g+", "+t.b+")"}};i.Util=a;var s=s||{ipot:function(t){return(t&t-1)==0},nhpot:function(t){--t;for(var e=1;e<32;e<<=1){t=t|t>>e}return t+1},makeTranslation:function(t,e){return[1,0,0,0,1,0,t,e,1]},makeRotation:function(t){var e=Math.cos(t);var i=Math.sin(t);return[e,-i,0,i,e,0,0,0,1]},makeScale:function(t,e){return[t,0,0,0,e,0,0,0,1]},matrixMultiply:function(t,e){var i=t[0*3+0];var n=t[0*3+1];var r=t[0*3+2];var o=t[1*3+0];var a=t[1*3+1];var s=t[1*3+2];var l=t[2*3+0];var h=t[2*3+1];var u=t[2*3+2];var p=e[0*3+0];var c=e[0*3+1];var f=e[0*3+2];var m=e[1*3+0];var d=e[1*3+1];var y=e[1*3+2];var g=e[2*3+0];var v=e[2*3+1];var _=e[2*3+2];return[i*p+n*m+r*g,i*c+n*d+r*v,i*f+n*y+r*_,o*p+a*m+s*g,o*c+a*d+s*v,o*f+a*y+s*_,l*p+h*m+u*g,l*c+h*d+u*v,l*f+h*y+u*_]}};i.WebGLUtil=s;var l=l||{createCanvas:function(t,e,i,n){var r=document.createElement("canvas");var o=n?n:"absolute";r.id=t;r.width=e;r.height=i;r.style.position=o;r.style.opacity=0;this.transformDom(r,-500,-500,0,0);return r},transformDom:function(t,e,i,n,r){t.style.WebkitTransform="translate("+e+"px, "+i+"px) "+"scale("+n+") "+"rotate("+r+"deg)";t.style.MozTransform="translate("+e+"px, "+i+"px) "+"scale("+n+") "+"rotate("+r+"deg)";t.style.OTransform="translate("+e+"px, "+i+"px) "+"scale("+n+") "+"rotate("+r+"deg)";t.style.msTransform="translate("+e+"px, "+i+"px) "+"scale("+n+") "+"rotate("+r+"deg)";t.style.transform="translate("+e+"px, "+i+"px) "+"scale("+n+") "+"rotate("+r+"deg)"}};i.DomUtil=l;function h(){this.mats=[];this.size=0;for(var t=0;t<20;t++)this.mats.push(i.Mat3.create([0,0,0,0,0,0,0,0,0]))}h.prototype.set=function(t,e){if(e==0)i.Mat3.set(t,this.mats[0]);else i.Mat3.multiply(this.mats[e-1],t,this.mats[e]);this.size=Math.max(this.size,e+1)};h.prototype.push=function(t){if(this.size==0)i.Mat3.set(t,this.mats[0]);else i.Mat3.multiply(this.mats[this.size-1],t,this.mats[this.size]);this.size++};h.prototype.pop=function(){if(this.size>0)this.size--};h.prototype.top=function(){return this.mats[this.size-1]};i.MStack=h;u.ID=0;function u(t){this.id="particle_"+u.ID++;this.reset(true);i.Util.setPrototypeByObject(this,t)}u.prototype={getDirection:function(){return Math.atan2(this.v.x,-this.v.y)*(180/Math.PI)},reset:function(t){this.life=Infinity;this.age=0;this.energy=1;this.dead=false;this.sleep=false;this.target=null;this.sprite=null;this.parent=null;this.mass=1;this.radius=10;this.alpha=1;this.scale=1;this.rotation=0;this.color=null;this.easing=i.ease.setEasingByName(i.easeLinear);if(t){this.transform={};this.p=new i.Vector2D;this.v=new i.Vector2D;this.a=new i.Vector2D;this.old={p:new i.Vector2D,v:new i.Vector2D,a:new i.Vector2D};this.behaviours=[]}else{i.Util.destroyObject(this.transform);this.p.set(0,0);this.v.set(0,0);this.a.set(0,0);this.old.p.set(0,0);this.old.v.set(0,0);this.old.a.set(0,0);this.removeAllBehaviours()}this.transform.rgb={r:255,g:255,b:255};return this},update:function(t,e){if(!this.sleep){this.age+=t;var i=this.behaviours.length,n;for(n=0;n<i;n++){if(this.behaviours[n])this.behaviours[n].applyBehaviour(this,t,e)}}else{}if(this.age>=this.life){this.destory()}else{var r=this.easing(this.age/this.life);this.energy=Math.max(1-r,0)}},addBehaviour:function(t){this.behaviours.push(t);if(t.hasOwnProperty("parents"))t.parents.push(this);t.initialize(this)},addBehaviours:function(t){var e=t.length,i;for(i=0;i<e;i++){this.addBehaviour(t[i])}},removeBehaviour:function(t){var e=this.behaviours.indexOf(t);if(e>-1){var t=this.behaviours.splice(e,1);t.parents=null}},removeAllBehaviours:function(){i.Util.destroyArray(this.behaviours)},destory:function(){this.removeAllBehaviours();this.energy=0;this.dead=true;this.parent=null}};i.Particle=u;function p(t,e){this.proParticleCount=i.Util.initValue(t,0);this.releaseTime=i.Util.initValue(e,-1);this.poolList=[];this.timeoutID=0;for(var n=0;n<this.proParticleCount;n++){this.add()}if(this.releaseTime>0)this.timeoutID=setTimeout(this.release,this.releaseTime/1e3)}p.prototype={create:function(t){if(t)return new newTypeParticle;else return new i.Particle},getCount:function(){return this.poolList.length},add:function(){return this.poolList.push(this.create())},get:function(){if(this.poolList.length===0){return this.create()}else{return this.poolList.pop().reset()}},set:function(t){if(this.poolList.length<i.POOL_MAX)return this.poolList.push(t)},release:function(){for(var t=0;t<this.poolList.length;t++){if(this.poolList[t]["destory"])this.poolList[t].destory();delete this.poolList[t]}this.poolList=[]}};i.ParticlePool=p;var c={randomAToB:function(t,e,i){if(!i)return t+Math.random()*(e-t);else return Math.floor(Math.random()*(e-t))+t},randomFloating:function(t,e,i){return c.randomAToB(t-e,t+e,i)},randomZone:function(t){},degreeTransform:function(t){return t*Math.PI/180},toColor16:function st(t){return"#"+t.toString(16)},randomColor:function(){return"#"+("00000"+(Math.random()*16777216<<0).toString(16)).slice(-6)}};i.MathUtils=c;var f=function(t){this.type=i.Util.initValue(t,i.EULER)};f.prototype={integrate:function(t,e,i){this.eulerIntegrate(t,e,i)},eulerIntegrate:function(t,e,i){if(!t.sleep){t.old.p.copy(t.p);t.old.v.copy(t.v);t.a.multiplyScalar(1/t.mass);t.v.add(t.a.multiplyScalar(e));t.p.add(t.old.v.multiplyScalar(e));if(i)t.v.multiplyScalar(i);t.a.clear()}}};i.NumericalIntegration=f;var m=function(t,e){this.x=t||0;this.y=e||0};m.prototype={set:function(t,e){this.x=t;this.y=e;return this},setX:function(t){this.x=t;return this},setY:function(t){this.y=t;return this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}},getGradient:function(){if(this.x!=0)return Math.atan2(this.y,this.x);else if(this.y>0)return Math.PI/2;else if(this.y<0)return-Math.PI/2},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},copy:function(t){this.x=t.x;this.y=t.y;return this},add:function(t,i){if(i!==e){return this.addVectors(t,i)}this.x+=t.x;this.y+=t.y;return this},addXY:function(t,e){this.x+=t;this.y+=e;return this},addVectors:function(t,e){this.x=t.x+e.x;this.y=t.y+e.y;return this},addScalar:function(t){this.x+=t;this.y+=t;return this},sub:function(t,i){if(i!==e){return this.subVectors(t,i)}this.x-=t.x;this.y-=t.y;return this},subVectors:function(t,e){this.x=t.x-e.x;this.y=t.y-e.y;return this},multiplyScalar:function(t){this.x*=t;this.y*=t;return this},divideScalar:function(t){if(t!==0){this.x/=t;this.y/=t}else{this.set(0,0)}return this},min:function(t){if(this.x>t.x){this.x=t.x}if(this.y>t.y){this.y=t.y}return this},max:function(t){if(this.x<t.x){this.x=t.x}if(this.y<t.y){this.y=t.y}return this},clamp:function(t,e){if(this.x<t.x){this.x=t.x}else if(this.x>e.x){this.x=e.x}if(this.y<t.y){this.y=t.y}else if(this.y>e.y){this.y=e.y}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},rotate:function(t){var e=this.x;var i=this.y;this.x=e*Math.cos(t)+i*Math.sin(t);this.y=-e*Math.sin(t)+i*Math.cos(t);return this},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},setLength:function(t){var e=this.length();if(e!==0&&t!==e){this.multiplyScalar(t/e)}return this},lerp:function(t,e){this.x+=(t.x-this.x)*e;this.y+=(t.y-this.y)*e;return this},equals:function(t){return t.x===this.x&&t.y===this.y},toArray:function(){return[this.x,this.y]},clear:function(){this.x=0;this.y=0;return this},clone:function(){return new i.Vector2D(this.x,this.y)}};i.Vector2D=m;var d=function(t,e){this.r=Math.abs(t)||0;this.tha=e||0};d.prototype={set:function(t,e){this.r=t;this.tha=e;return this},setR:function(t){this.r=t;return this},setTha:function(t){this.tha=t;return this},copy:function(t){this.r=t.r;this.tha=t.tha;return this},toVector:function(){return new i.Vector2D(this.getX(),this.getY())},getX:function(){return this.r*Math.sin(this.tha)},getY:function(){return-this.r*Math.cos(this.tha)},normalize:function(){this.r=1;return this},equals:function(t){return t.r===this.r&&t.tha===this.tha},toArray:function(){return[this.r,this.tha]},clear:function(){this.r=0;this.tha=0;return this},clone:function(){return new i.Polar2D(this.r,this.tha)}};i.Polar2D=d;function y(t,e,n){this.isArray=false;if(i.Util.isArray(t)){this.isArray=true;this.a=t}else{this.a=i.Util.initValue(t,1);this.b=i.Util.initValue(e,this.a);this.center=i.Util.initValue(n,false)}}y.prototype={getValue:function(t){if(this.isArray){return this.a[Math.floor(this.a.length*Math.random())]}else{if(!this.center)return i.MathUtils.randomAToB(this.a,this.b,t);else return i.MathUtils.randomFloating(this.a,this.b,t)}}};i.Span=y;i.getSpan=function(t,e,n){return new i.Span(t,e,n)};function g(t){if(i.Util.isArray(t)){this.colorArr=t}else{this.colorArr=[t]}}i.Util.inherits(g,i.Span);g.prototype.getValue=function(){var t=this.colorArr[Math.floor(this.colorArr.length*Math.random())];if(t=="random"||t=="Random")return i.MathUtils.randomColor();else return t};i.ColorSpan=g;function v(t,e,i,n){this.x=t;this.y=e;this.width=i;this.height=n;this.bottom=this.y+this.height;this.right=this.x+this.width}v.prototype={contains:function(t,e){if(t<=this.right&&t>=this.x&&e<=this.bottom&&e>=this.y)return true;else return false}};i.Rectangle=v;var _=_||{create:function(t){var e=new Float32Array(9);if(t)this.set(t,e);return e},set:function(t,e){for(var i=0;i<9;i++)e[i]=t[i];return e},multiply:function(t,e,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[6],h=t[7],u=e[0],p=e[1],c=e[2],f=e[3],m=e[4],d=e[6],y=e[7];i[0]=u*n+p*a;i[1]=u*r+p*s;i[2]=o*c;i[3]=f*n+m*a;i[4]=f*r+m*s;i[6]=d*n+y*a+l;i[7]=d*r+y*s+h;return i},inverse:function(t,e){var i=t[0],n=t[1],r=t[3],o=t[4],a=t[6],s=t[7],l=o,h=-r,u=s*r-o*a,p=i*l+n*h,c;c=1/p;e[0]=l*c;e[1]=-n*c;e[3]=h*c;e[4]=i*c;e[6]=u*c;e[7]=(-s*i+n*a)*c;return e},multiplyVec2:function(t,e,i){var n=e[0],r=e[1];i[0]=n*t[0]+r*t[3]+t[6];i[1]=n*t[1]+r*t[4]+t[7];return i}};i.Mat3=_;I.id=0;function I(t,e){this.id="Behaviour_"+I.id++;this.life=i.Util.initValue(t,Infinity);this.easing=i.ease.setEasingByName(e);this.age=0;this.energy=1;this.dead=false;this.parents=[];this.name="Behaviour"}I.prototype={reset:function(t,e){this.life=i.Util.initValue(t,Infinity);this.easing=i.Util.initValue(e,i.ease.setEasingByName(i.easeLinear))},normalizeForce:function(t){return t.multiplyScalar(i.MEASURE);
},normalizeValue:function(t){return t*i.MEASURE},initialize:function(t){},applyBehaviour:function(t,e,i){this.age+=e;if(this.age>=this.life||this.dead){this.energy=0;this.dead=true;this.destory()}else{var n=this.easing(t.age/t.life);this.energy=Math.max(1-n,0)}},destory:function(){var t;var e=this.parents.length,i;for(i=0;i<e;i++){this.parents[i].removeBehaviour(this)}this.parents=[]}};i.Behaviour=I;function w(t,e){this.numPan=i.Util.initValue(t,1);this.timePan=i.Util.initValue(e,1);this.numPan=i.Util.setSpanValue(this.numPan);this.timePan=i.Util.setSpanValue(this.timePan);this.startTime=0;this.nextTime=0;this.init()}w.prototype={init:function(){this.startTime=0;this.nextTime=this.timePan.getValue()},getValue:function(t){this.startTime+=t;if(this.startTime>=this.nextTime){this.startTime=0;this.nextTime=this.timePan.getValue();if(this.numPan.b==1){if(this.numPan.getValue(false)>.5)return 1;else return 0}else{return this.numPan.getValue(true)}}return 0}};i.Rate=w;function x(){}x.prototype.reset=function(){};x.prototype.init=function(t,e){if(e){this.initialize(e)}else{this.initialize(t)}};x.prototype.initialize=function(t){};i.Initialize=x;var S={initialize:function(t,e,n){var r=n.length,o;for(o=0;o<r;o++){if(n[o]instanceof i.Initialize)n[o].init(t,e);else i.InitializeUtil.init(t,e,n[o])}i.InitializeUtil.bindEmitter(t,e)},init:function(t,e,n){i.Util.setPrototypeByObject(e,n);i.Util.setVector2DByObject(e,n)},bindEmitter:function(t,e){if(t.bindEmitter){e.p.add(t.p);e.v.add(t.v);e.a.add(t.a);e.v.rotate(i.MathUtils.degreeTransform(t.rotation))}}};i.InitializeUtil=S;function T(t,e,n){T._super_.call(this);this.lifePan=i.Util.setSpanValue(t,e,n)}i.Util.inherits(T,i.Initialize);T.prototype.initialize=function(t){if(this.lifePan.a==Infinity)t.life=Infinity;else t.life=this.lifePan.getValue()};i.Life=T;function C(t){C._super_.call(this);this.zone=i.Util.initValue(t,new i.PointZone)}i.Util.inherits(C,i.Initialize);C.prototype.reset=function(t){this.zone=i.Util.initValue(t,new i.PointZone)};C.prototype.initialize=function(t){this.zone.getPosition();t.p.x=this.zone.vector.x;t.p.y=this.zone.vector.y};i.Position=C;i.P=C;function b(t,e,n){b._super_.call(this);this.rPan=i.Util.setSpanValue(t);this.thaPan=i.Util.setSpanValue(e);this.type=i.Util.initValue(n,"vector")}i.Util.inherits(b,i.Initialize);b.prototype.reset=function(t,e,n){this.rPan=i.Util.setSpanValue(t);this.thaPan=i.Util.setSpanValue(e);this.type=i.Util.initValue(n,"vector")};b.prototype.normalizeVelocity=function(t){return t*i.MEASURE};b.prototype.initialize=function(t){if(this.type=="p"||this.type=="P"||this.type=="polar"){var e=new i.Polar2D(this.normalizeVelocity(this.rPan.getValue()),this.thaPan.getValue()*Math.PI/180);t.v.x=e.getX();t.v.y=e.getY()}else{t.v.x=this.normalizeVelocity(this.rPan.getValue());t.v.y=this.normalizeVelocity(this.thaPan.getValue())}};i.Velocity=b;i.V=b;function D(t,e,n){D._super_.call(this);this.massPan=i.Util.setSpanValue(t,e,n)}i.Util.inherits(D,i.Initialize);D.prototype.initialize=function(t){t.mass=this.massPan.getValue()};i.Mass=D;function E(t,e,n){E._super_.call(this);this.radius=i.Util.setSpanValue(t,e,n)}i.Util.inherits(E,i.Initialize);E.prototype.reset=function(t,e,n){this.radius=i.Util.setSpanValue(t,e,n)};E.prototype.initialize=function(t){t.radius=this.radius.getValue();t.transform.oldRadius=t.radius};i.Radius=E;function A(t,e,n){A._super_.call(this);this.image=this.setSpanValue(t);this.w=i.Util.initValue(e,20);this.h=i.Util.initValue(n,this.w)}i.Util.inherits(A,i.Initialize);A.prototype.initialize=function(t){var e=this.image.getValue();if(typeof e=="string"){t.target={width:this.w,height:this.h,src:e}}else{t.target=e}};A.prototype.setSpanValue=function(t){if(t instanceof i.ColorSpan){return t}else{return new i.ColorSpan(t)}};i.ImageTarget=A;function U(t,e,n,r){U._super_.call(this,n,r);this.force=this.normalizeForce(new i.Vector2D(t,e));this.name="Force"}i.Util.inherits(U,i.Behaviour);U.prototype.reset=function(t,e,n,r){this.force=this.normalizeForce(new i.Vector2D(t,e));if(n)U._super_.prototype.reset.call(this,n,r)};U.prototype.applyBehaviour=function(t,e,i){U._super_.prototype.applyBehaviour.call(this,t,e,i);t.a.add(this.force)};i.Force=U;i.F=U;function M(t,e,n,r,o){M._super_.call(this,r,o);this.targetPosition=i.Util.initValue(t,new i.Vector2D);this.radius=i.Util.initValue(n,1e3);this.force=i.Util.initValue(this.normalizeValue(e),100);this.radiusSq=this.radius*this.radius;this.attractionForce=new i.Vector2D;this.lengthSq=0;this.name="Attraction"}i.Util.inherits(M,i.Behaviour);M.prototype.reset=function(t,e,n,r,o){this.targetPosition=i.Util.initValue(t,new i.Vector2D);this.radius=i.Util.initValue(n,1e3);this.force=i.Util.initValue(this.normalizeValue(e),100);this.radiusSq=this.radius*this.radius;this.attractionForce=new i.Vector2D;this.lengthSq=0;if(r)M._super_.prototype.reset.call(this,r,o)};M.prototype.applyBehaviour=function(t,e,i){M._super_.prototype.applyBehaviour.call(this,t,e,i);this.attractionForce.copy(this.targetPosition);this.attractionForce.sub(t.p);this.lengthSq=this.attractionForce.lengthSq();if(this.lengthSq>4e-6&&this.lengthSq<this.radiusSq){this.attractionForce.normalize();this.attractionForce.multiplyScalar(1-this.lengthSq/this.radiusSq);this.attractionForce.multiplyScalar(this.force);t.a.add(this.attractionForce)}};i.Attraction=M;function P(t,e,i,n,r){P._super_.call(this,n,r);this.reset(t,e,i);this.time=0;this.name="RandomDrift"}i.Util.inherits(P,i.Behaviour);P.prototype.reset=function(t,e,n,r,o){this.panFoce=new i.Vector2D(t,e);this.panFoce=this.normalizeForce(this.panFoce);this.delay=n;if(r)P._super_.prototype.reset.call(this,r,o)};P.prototype.applyBehaviour=function(t,e,n){P._super_.prototype.applyBehaviour.call(this,t,e,n);this.time+=e;if(this.time>=this.delay){t.a.addXY(i.MathUtils.randomAToB(-this.panFoce.x,this.panFoce.x),i.MathUtils.randomAToB(-this.panFoce.y,this.panFoce.y));this.time=0}};i.RandomDrift=P;function B(t,e,i,n,r){B._super_.call(this,t,e,i,n,r);this.force*=-1;this.name="Repulsion"}i.Util.inherits(B,i.Attraction);B.prototype.reset=function(t,e,i,n,r){B._super_.prototype.reset.call(this,t,e,i,n,r);this.force*=-1};i.Repulsion=B;function L(t,e,i){L._super_.call(this,0,t,e,i);this.name="Gravity"}i.Util.inherits(L,i.Force);L.prototype.reset=function(t,e,i){L._super_.prototype.reset.call(this,0,t,e,i)};i.Gravity=L;i.G=L;function R(t,e,i,n,r){R._super_.call(this,n,r);this.reset(t,e,i);this.name="Collision"}i.Util.inherits(R,i.Behaviour);R.prototype.reset=function(t,e,n,r,o){this.emitter=i.Util.initValue(t,null);this.mass=i.Util.initValue(e,true);this.callback=i.Util.initValue(n,null);this.collisionPool=[];this.delta=new i.Vector2D;if(r)R._super_.prototype.reset.call(this,r,o)};R.prototype.applyBehaviour=function(t,e,i){var n=this.emitter?this.emitter.particles.slice(i):this.pool.slice(i);var r;var o;var a;var s,l;var h=n.length;for(var u=0;u<h;u++){r=n[u];if(r!==t){this.delta.copy(r.p);this.delta.sub(t.p);o=this.delta.lengthSq();distance=t.radius+r.radius;if(o<=distance*distance){a=distance-Math.sqrt(o);a+=.5;totalMass=t.mass+r.mass;s=this.mass?r.mass/totalMass:.5;l=this.mass?t.mass/totalMass:.5;t.p.add(this.delta.clone().normalize().multiplyScalar(a*-s));r.p.add(this.delta.normalize().multiplyScalar(a*l));if(this.callback)this.callback(t,r)}}}};i.Collision=R;function O(t,e,i,n){O._super_.call(this,i,n);this.reset(t,e);this.name="CrossZone"}i.Util.inherits(O,i.Behaviour);O.prototype.reset=function(t,e,n,r){this.zone=t;this.zone.crossType=i.Util.initValue(e,"dead");if(n)O._super_.prototype.reset.call(this,n,r)};O.prototype.applyBehaviour=function(t,e,i){O._super_.prototype.applyBehaviour.call(this,t,e,i);this.zone.crossing(t)};i.CrossZone=O;function V(t,e,i,n){V._super_.call(this,i,n);this.reset(t,e);this.name="Alpha"}i.Util.inherits(V,i.Behaviour);V.prototype.reset=function(t,n,r,o){if(n==null||n==e)this.same=true;else this.same=false;this.a=i.Util.setSpanValue(i.Util.initValue(t,1));this.b=i.Util.setSpanValue(n);if(r)V._super_.prototype.reset.call(this,r,o)};V.prototype.initialize=function(t){t.transform.alphaA=this.a.getValue();if(this.same)t.transform.alphaB=t.transform.alphaA;else t.transform.alphaB=this.b.getValue()};V.prototype.applyBehaviour=function(t,e,i){V._super_.prototype.applyBehaviour.call(this,t,e,i);t.alpha=t.transform.alphaB+(t.transform.alphaA-t.transform.alphaB)*this.energy;if(t.alpha<.001)t.alpha=0};i.Alpha=V;function W(t,e,i,n){W._super_.call(this,i,n);this.reset(t,e);this.name="Scale"}i.Util.inherits(W,i.Behaviour);W.prototype.reset=function(t,n,r,o){if(n==null||n==e)this.same=true;else this.same=false;this.a=i.Util.setSpanValue(i.Util.initValue(t,1));this.b=i.Util.setSpanValue(n);if(r)W._super_.prototype.reset.call(this,r,o)};W.prototype.initialize=function(t){t.transform.scaleA=this.a.getValue();t.transform.oldRadius=t.radius;if(this.same)t.transform.scaleB=t.transform.scaleA;else t.transform.scaleB=this.b.getValue()};W.prototype.applyBehaviour=function(t,e,i){W._super_.prototype.applyBehaviour.call(this,t,e,i);t.scale=t.transform.scaleB+(t.transform.scaleA-t.transform.scaleB)*this.energy;if(t.scale<1e-4)t.scale=0;t.radius=t.transform.oldRadius*t.scale};i.Scale=W;function k(t,e,i,n,r){k._super_.call(this,n,r);this.reset(t,e,i);this.name="Rotate"}i.Util.inherits(k,i.Behaviour);k.prototype.reset=function(t,n,r,o,a){if(n==null||n==e)this.same=true;else this.same=false;this.a=i.Util.setSpanValue(i.Util.initValue(t,"Velocity"));this.b=i.Util.setSpanValue(i.Util.initValue(n,0));this.style=i.Util.initValue(r,"to");if(o)k._super_.prototype.reset.call(this,o,a)};k.prototype.initialize=function(t){t.rotation=this.a.getValue();t.transform.rotationA=this.a.getValue();if(!this.same)t.transform.rotationB=this.b.getValue()};k.prototype.applyBehaviour=function(t,e,i){k._super_.prototype.applyBehaviour.call(this,t,e,i);if(!this.same){if(this.style=="to"||this.style=="TO"||this.style=="_"){t.rotation+=t.transform.rotationB+(t.transform.rotationA-t.transform.rotationB)*this.energy}else{t.rotation+=t.transform.rotationB}}else if(this.a.a=="V"||this.a.a=="Velocity"||this.a.a=="v"){t.rotation=t.getDirection()}};i.Rotate=k;function F(t,e,i,n){F._super_.call(this,i,n);this.reset(t,e);this.name="Color"}i.Util.inherits(F,i.Behaviour);F.prototype.reset=function(t,e,i,n){this.color1=this.setSpanValue(t);this.color2=this.setSpanValue(e);if(i)F._super_.prototype.reset.call(this,i,n)};F.prototype.initialize=function(t){t.color=this.color1.getValue();t.transform.beginRGB=i.Util.hexToRGB(t.color);if(this.color2)t.transform.endRGB=i.Util.hexToRGB(this.color2.getValue())};F.prototype.applyBehaviour=function(t,e,i){if(this.color2){F._super_.prototype.applyBehaviour.call(this,t,e,i);t.transform.rgb.r=t.transform.endRGB.r+(t.transform.beginRGB.r-t.transform.endRGB.r)*this.energy;t.transform.rgb.g=t.transform.endRGB.g+(t.transform.beginRGB.g-t.transform.endRGB.g)*this.energy;t.transform.rgb.b=t.transform.endRGB.b+(t.transform.beginRGB.b-t.transform.endRGB.b)*this.energy;t.transform.rgb.r=parseInt(t.transform.rgb.r,10);t.transform.rgb.g=parseInt(t.transform.rgb.g,10);t.transform.rgb.b=parseInt(t.transform.rgb.b,10)}else{t.transform.rgb.r=t.transform.beginRGB.r;t.transform.rgb.g=t.transform.beginRGB.g;t.transform.rgb.b=t.transform.beginRGB.b}};F.prototype.setSpanValue=function(t){if(t){if(t instanceof i.ColorSpan){return t}else{return new i.ColorSpan(t)}}else{return null}};i.Color=F;function N(t,e,n,r){N._super_.call(this,n,r);this.distanceVec=new i.Vector2D;this.centerPoint=i.Util.initValue(t,new i.Vector2D);this.force=i.Util.initValue(this.normalizeValue(e),100);this.name="GravityWell"}i.Util.inherits(N,i.Behaviour);N.prototype.reset=function(t,e,n,r){this.distanceVec=new i.Vector2D;this.centerPoint=i.Util.initValue(t,new i.Vector2D);this.force=i.Util.initValue(this.normalizeValue(e),100);if(n)N._super_.prototype.reset.call(this,n,r)};N.prototype.initialize=function(t){};N.prototype.applyBehaviour=function(t,e,i){this.distanceVec.set(this.centerPoint.x-t.p.x,this.centerPoint.y-t.p.y);var n=this.distanceVec.lengthSq();if(n!=0){var r=this.distanceVec.length();var o=this.force*e/(n*r);t.v.x+=o*this.distanceVec.x;t.v.y+=o*this.distanceVec.y}};i.GravityWell=N;G.ID=0;function G(t){this.initializes=[];this.particles=[];this.behaviours=[];this.emitTime=0;this.emitTotalTimes=-1;this.damping=.006;this.bindEmitter=true;this.rate=new i.Rate(1,.1);G._super_.call(this,t);this.id="emitter_"+G.ID++}i.Util.inherits(G,i.Particle);i.EventDispatcher.initialize(G.prototype);G.prototype.emit=function(t,e){this.emitTime=0;this.emitTotalTimes=i.Util.initValue(t,Infinity);if(e==true||e=="life"||e=="destroy"){if(t=="once")this.life=1;else this.life=this.emitTotalTimes}if(e&&!isNaN(e)){this.life=e}this.rate.init()};G.prototype.stopEmit=function(){this.emitTotalTimes=-1;this.emitTime=0};G.prototype.removeAllParticles=function(){for(var t=0;t<this.particles.length;t++)this.particles[t].dead=true};G.prototype.createParticle=function(t,e){var n=i.pool.get();this.setupParticle(n,t,e);this.dispatchEvent(new i.Event({type:i.PARTICLE_CREATED,particle:n}));return n};G.prototype.addSelfInitialize=function(t){if(t["init"]){t.init(this)}else{this.initAll()}};G.prototype.addInitialize=function(){var t=arguments.length,e;for(e=0;e<t;e++){this.initializes.push(arguments[e])}};G.prototype.removeInitialize=function(t){var e=this.initializes.indexOf(t);if(e>-1){this.initializes.splice(e,1)}};G.prototype.removeInitializers=function(){i.Util.destroyArray(this.initializes)};G.prototype.addBehaviour=function(){var t=arguments.length,e;for(e=0;e<t;e++){this.behaviours.push(arguments[e]);if(arguments[e].hasOwnProperty("parents"))arguments[e].parents.push(this)}};G.prototype.removeBehaviour=function(t){var e=this.behaviours.indexOf(t);if(e>-1)this.behaviours.splice(e,1)};G.prototype.removeAllBehaviours=function(){i.Util.destroyArray(this.behaviours)};G.prototype.integrate=function(t){var e=1-this.damping;i.integrator.integrate(this,t,e);var n=this.particles.length,r;for(r=0;r<n;r++){var o=this.particles[r];o.update(t,r);i.integrator.integrate(o,t,e);this.dispatchEvent(new i.Event({type:i.PARTICLE_UPDATE,particle:o}))}};G.prototype.emitting=function(t){if(this.emitTotalTimes=="once"){var e=this.rate.getValue(99999),i;for(i=0;i<e;i++){this.createParticle()}this.emitTotalTimes="none"}else if(!isNaN(this.emitTotalTimes)){this.emitTime+=t;if(this.emitTime<this.emitTotalTimes){var e=this.rate.getValue(t),i;for(i=0;i<e;i++){this.createParticle()}}}};G.prototype.update=function(t){this.age+=t;if(this.age>=this.life||this.dead){this.destroy()}this.emitting(t);this.integrate(t);var e;var n=this.particles.length,r;for(r=n-1;r>=0;r--){e=this.particles[r];if(e.dead){i.pool.set(e);this.particles.splice(r,1);this.dispatchEvent(new i.Event({type:i.PARTICLE_DEAD,particle:e}))}}};G.prototype.setupParticle=function(t,e,n){var r=this.initializes;var o=this.behaviours;if(e){if(e instanceof Array)r=e;else r=[e]}if(n){if(n instanceof Array)o=n;else o=[n]}i.InitializeUtil.initialize(this,t,r);t.addBehaviours(o);t.parent=this;this.particles.push(t)};G.prototype.destroy=function(){this.dead=true;this.emitTotalTimes=-1;if(this.particles.length==0){this.removeInitializers();this.removeAllBehaviours();if(this.parent)this.parent.removeEmitter(this)}};i.Emitter=G;function H(t){this.selfBehaviours=[];H._super_.call(this,t)}i.Util.inherits(H,i.Emitter);H.prototype.addSelfBehaviour=function(){var t=arguments.length,e;for(e=0;e<t;e++){this.selfBehaviours.push(arguments[e])}};H.prototype.removeSelfBehaviour=function(t){var e=this.selfBehaviours.indexOf(t);if(e>-1)this.selfBehaviours.splice(e,1)};H.prototype.update=function(t){H._super_.prototype.update.call(this,t);if(!this.sleep){var e=this.selfBehaviours.length,i;for(i=0;i<e;i++){this.selfBehaviours[i].applyBehaviour(this,t,i)}}};i.BehaviourEmitter=H;function Y(e,n,r){this.mouseTarget=i.Util.initValue(e,t);this.ease=i.Util.initValue(n,.7);this._allowEmitting=false;this.initEventHandler();Y._super_.call(this,r)}i.Util.inherits(Y,i.Emitter);Y.prototype.initEventHandler=function(){var t=this;this.mousemoveHandler=function(e){t.mousemove.call(t,e)};this.mousedownHandler=function(e){t.mousedown.call(t,e)};this.mouseupHandler=function(e){t.mouseup.call(t,e)};this.mouseTarget.addEventListener("mousemove",this.mousemoveHandler,false)};Y.prototype.emit=function(){this._allowEmitting=true};Y.prototype.stopEmit=function(){this._allowEmitting=false};Y.prototype.mousemove=function(t){if(t.layerX||t.layerX==0){this.p.x+=(t.layerX-this.p.x)*this.ease;this.p.y+=(t.layerY-this.p.y)*this.ease}else if(t.offsetX||t.offsetX==0){this.p.x+=(t.offsetX-this.p.x)*this.ease;this.p.y+=(t.offsetY-this.p.y)*this.ease}if(this._allowEmitting)Y._super_.prototype.emit.call(this,"once")};Y.prototype.destroy=function(){Y._super_.prototype.destroy.call(this);this.mouseTarget.removeEventListener("mousemove",this.mousemoveHandler,false)};i.FollowEmitter=Y;var J=J||{easeLinear:function(t){return t},easeInQuad:function(t){return Math.pow(t,2)},easeOutQuad:function(t){return-(Math.pow(t-1,2)-1)},easeInOutQuad:function(t){if((t/=.5)<1)return.5*Math.pow(t,2);return-.5*((t-=2)*t-2)},easeInCubic:function(t){return Math.pow(t,3)},easeOutCubic:function(t){return Math.pow(t-1,3)+1},easeInOutCubic:function(t){if((t/=.5)<1)return.5*Math.pow(t,3);return.5*(Math.pow(t-2,3)+2)},easeInQuart:function(t){return Math.pow(t,4)},easeOutQuart:function(t){return-(Math.pow(t-1,4)-1)},easeInOutQuart:function(t){if((t/=.5)<1)return.5*Math.pow(t,4);return-.5*((t-=2)*Math.pow(t,3)-2)},easeInSine:function(t){return-Math.cos(t*(Math.PI/2))+1},easeOutSine:function(t){return Math.sin(t*(Math.PI/2))},easeInOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},easeInExpo:function(t){return t===0?0:Math.pow(2,10*(t-1))},easeOutExpo:function(t){return t===1?1:-Math.pow(2,-10*t)+1},easeInOutExpo:function(t){if(t===0)return 0;if(t===1)return 1;if((t/=.5)<1)return.5*Math.pow(2,10*(t-1));return.5*(-Math.pow(2,-10*--t)+2)},easeInCirc:function(t){return-(Math.sqrt(1-t*t)-1)},easeOutCirc:function(t){return Math.sqrt(1-Math.pow(t-1,2))},easeInOutCirc:function(t){if((t/=.5)<1)return-.5*(Math.sqrt(1-t*t)-1);return.5*(Math.sqrt(1-(t-=2)*t)+1)},easeInBack:function(t){var e=1.70158;return t*t*((e+1)*t-e)},easeOutBack:function(t){var e=1.70158;return(t=t-1)*t*((e+1)*t+e)+1},easeInOutBack:function(t){var e=1.70158;if((t/=.5)<1)return.5*(t*t*(((e*=1.525)+1)*t-e));return.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},setEasingByName:function(t){switch(t){case"easeLinear":return i.ease.easeLinear;break;case"easeInQuad":return i.ease.easeInQuad;break;case"easeOutQuad":return i.ease.easeOutQuad;break;case"easeInOutQuad":return i.ease.easeInOutQuad;break;case"easeInCubic":return i.ease.easeInCubic;break;case"easeOutCubic":return i.ease.easeOutCubic;break;case"easeInOutCubic":return i.ease.easeInOutCubic;break;case"easeInQuart":return i.ease.easeInQuart;break;case"easeOutQuart":return i.ease.easeOutQuart;break;case"easeInOutQuart":return i.ease.easeInOutQuart;break;case"easeInSine":return i.ease.easeInSine;break;case"easeOutSine":return i.ease.easeOutSine;break;case"easeInOutSine":return i.ease.easeInOutSine;break;case"easeInExpo":return i.ease.easeInExpo;break;case"easeOutExpo":return i.ease.easeOutExpo;break;case"easeInOutExpo":return i.ease.easeInOutExpo;break;case"easeInCirc":return i.ease.easeInCirc;break;case"easeOutCirc":return i.ease.easeOutCirc;break;case"easeInOutCirc":return i.ease.easeInOutCirc;break;case"easeInBack":return i.ease.easeInBack;break;case"easeOutBack":return i.ease.easeOutBack;break;case"easeInOutBack":return i.ease.easeInOutBack;break;default:return i.ease.easeLinear;break}}};i.ease=J;i.easeLinear="easeLinear";i.easeInQuad="easeInQuad";i.easeOutQuad="easeOutQuad";i.easeInOutQuad="easeInOutQuad";i.easeInCubic="easeInCubic";i.easeOutCubic="easeOutCubic";i.easeInOutCubic="easeInOutCubic";i.easeInQuart="easeInQuart";i.easeOutQuart="easeOutQuart";i.easeInOutQuart="easeInOutQuart";i.easeInSine="easeInSine";i.easeOutSine="easeOutSine";i.easeInOutSine="easeInOutSine";i.easeInExpo="easeInExpo";i.easeOutExpo="easeOutExpo";i.easeInOutExpo="easeInOutExpo";i.easeInCirc="easeInCirc";i.easeOutCirc="easeOutCirc";i.easeInOutCirc="easeInOutCirc";i.easeInBack="easeInBack";i.easeOutBack="easeOutBack";i.easeInOutBack="easeInOutBack";function X(t,e,n){this.element=n;this.type=i.Util.initValue(t,"canvas");this.proton=e;this.renderer=this.getRenderer()}X.prototype={start:function(){this.addEventHandler();this.renderer.start()},stop:function(){this.renderer.stop()},resize:function(t,e){this.renderer.resize(t,e)},setStroke:function(t,e){if(this.renderer.hasOwnProperty("stroke"))this.renderer.setStroke(t,e);else alert("Sorry this renderer do not suppest stroke method!")},createImageData:function(t){if(this.renderer instanceof i.PixelRender)this.renderer.createImageData(t)},setMaxRadius:function(t){if(this.renderer instanceof i.WebGLRender)this.renderer.setMaxRadius(t)},blendEquation:function(t){if(this.renderer instanceof i.WebGLRender)this.renderer.blendEquation(t)},blendFunc:function(t,e){if(this.renderer instanceof i.WebGLRender)this.renderer.blendFunc(t,e)},setType:function(t){this.type=t;this.renderer=this.getRenderer()},getRenderer:function(){switch(this.type){case"dom":return new i.DomRender(this.proton,this.element);break;case"canvas":return new i.CanvasRender(this.proton,this.element);break;case"webgl":return new i.WebGLRender(this.proton,this.element);break;case"easel":return new i.EaselRender(this.proton,this.element);break;case"easeljs":return new i.EaselRender(this.proton,this.element);break;case"pixel":return new i.PixelRender(this.proton,this.element);break;default:return new i.BaseRender(this.proton,this.element)}},render:function(t){this.renderer.render(t)},addEventHandler:function(){if(this.onProtonUpdate)this.renderer.onProtonUpdate=this.onProtonUpdate;if(this.onParticleCreated)this.renderer.onParticleCreated=this.onParticleCreated;if(this.onParticleUpdate)this.renderer.onParticleUpdate=this.onParticleUpdate;if(this.onParticleDead)this.renderer.onParticleDead=this.onParticleDead}};i.Renderer=X;function z(t,e,i){this.proton=t;this.element=e;this.stroke=i}z.prototype={start:function(){var t=this;this.proton.addEventListener(i.PROTON_UPDATE,function(e){t.onProtonUpdate.call(t)});this.proton.addEventListener(i.PROTON_UPDATE_AFTER,function(e){t.onProtonUpdateAfter.call(t)});this.proton.addEventListener(i.EMITTER_ADDED,function(e){t.onEmitterAdded.call(t,e.emitter)});this.proton.addEventListener(i.EMITTER_REMOVED,function(e){t.onEmitterRemoved.call(t,e.emitter)});var e=this.proton.emitters.length,n;for(n=0;n<e;n++){var r=this.proton.emitters[n];this.addEmitterListener(r)}},resize:function(t,e){},addEmitterListener:function(t){var e=this;t.addEventListener(i.PARTICLE_CREATED,function(t){e.onParticleCreated.call(e,t.particle)});t.addEventListener(i.PARTICLE_UPDATE,function(t){e.onParticleUpdate.call(e,t.particle)});t.addEventListener(i.PARTICLE_DEAD,function(t){e.onParticleDead.call(e,t.particle)})},stop:function(){var t=this.proton.emitters.length,e;this.proton.removeAllEventListeners();for(e=0;e<t;e++){var i=this.proton.emitters[e];i.removeAllEventListeners()}},onEmitterAdded:function(t){this.addEmitterListener(t)},onEmitterRemoved:function(t){t.removeAllEventListeners()},onProtonUpdate:function(){},onProtonUpdateAfter:function(){},onParticleCreated:function(t){},onParticleUpdate:function(t){},onParticleDead:function(t){}};i.BaseRender=z;function K(t,e){K._super_.call(this,t,e);this.stroke=null}i.Util.inherits(K,i.BaseRender);K.prototype.start=function(){K._super_.prototype.start.call(this)};K.prototype.setStroke=function(t,e){t=i.Util.initValue(t,"#000000");e=i.Util.initValue(e,1);this.stroke={color:t,thinkness:e}};K.prototype.onProtonUpdate=function(){};K.prototype.onParticleCreated=function(t){if(t.target){var e=this;i.Util.getImage(t.target,t,false,function(t){e.setImgInDIV.call(e,t)})}else{t.transform.canvas=i.DomUtil.createCanvas(t.id+"_canvas",t.radius+1,t.radius+1,"absolute");t.transform.bakOldRadius=t.radius;if(this.stroke){t.transform.canvas.width=2*t.radius+this.stroke.thinkness*2;t.transform.canvas.height=2*t.radius+this.stroke.thinkness*2}else{t.transform.canvas.width=2*t.radius+1;t.transform.canvas.height=2*t.radius+1}t.transform.context=t.transform.canvas.getContext("2d");t.transform.context.fillStyle=t.color;t.transform.context.beginPath();t.transform.context.arc(t.radius,t.radius,t.radius,0,Math.PI*2,true);if(this.stroke){t.transform.context.strokeStyle=this.stroke.color;t.transform.context.lineWidth=this.stroke.thinkness;t.transform.context.stroke()}t.transform.context.closePath();t.transform.context.fill();this.element.appendChild(t.transform.canvas)}};K.prototype.onParticleUpdate=function(t){if(t.target){if(t.target instanceof Image){t.transform.canvas.style.opacity=t.alpha;i.DomUtil.transformDom(t.transform.canvas,t.p.x-t.target.width/2,t.p.y-t.target.height/2,t.scale,t.rotation)}}else{t.transform.canvas.style.opacity=t.alpha;if(t.transform["oldRadius"])i.DomUtil.transformDom(t.transform.canvas,t.p.x-t.transform.oldRadius,t.p.y-t.transform.oldRadius,t.scale,t.rotation);else i.DomUtil.transformDom(t.transform.canvas,t.p.x-t.transform.bakOldRadius,t.p.y-t.transform.bakOldRadius,t.scale,t.rotation)}};K.prototype.onParticleDead=function(t){if(t.transform.canvas)this.element.removeChild(t.transform.canvas)};K.prototype.setImgInDIV=function(t){t.transform.canvas=i.DomUtil.createCanvas(t.id+"_canvas",t.target.width+1,t.target.height+1,"absolute",t.p.x-t.radius,t.p.y-t.radius);t.transform.context=t.transform.canvas.getContext("2d");t.transform.context.drawImage(t.target,0,0,t.target.width,t.target.height);this.element.appendChild(t.transform.canvas)};i.DomRender=K;function j(t,e,i){j._super_.call(this,t,e);this.stroke=i}i.Util.inherits(j,i.BaseRender);j.prototype.resize=function(t,e){};j.prototype.start=function(){j._super_.prototype.start.call(this)};j.prototype.onProtonUpdate=function(){};j.prototype.onParticleCreated=function(t){if(t.target){t.target=t.target.clone();if(!t.target.parent){if(!!t.target["image"]){t.target.regX=t.target.image.width/2;t.target.regY=t.target.image.height/2}this.element.addChild(t.target)}}else{var e=new createjs.Graphics;if(this.stroke){if(this.stroke==true){e.beginStroke("#000000")}else if(this.stroke instanceof String){e.beginStroke(this.stroke)}}e.beginFill(t.color).drawCircle(0,0,t.radius);var i=new createjs.Shape(e);t.target=i;this.element.addChild(t.target)}};j.prototype.onParticleUpdate=function(t){if(t.target){t.target.x=t.p.x;t.target.y=t.p.y;t.target.alpha=t.alpha;t.target.scaleX=t.target.scaleY=t.scale;t.target.rotation=t.rotation}};j.prototype.onParticleDead=function(t){if(t.target){if(t.target.parent)t.target.parent.removeChild(t.target)}};i.EaselRender=j;function q(t,e){q._super_.call(this,t,e);this.stroke=null;this.context=this.element.getContext("2d");this.bufferCache={}}i.Util.inherits(q,i.BaseRender);q.prototype.resize=function(t,e){this.element.width=t;this.element.height=e};q.prototype.start=function(){q._super_.prototype.start.call(this)};q.prototype.setStroke=function(t,e){t=i.Util.initValue(t,"#000000");e=i.Util.initValue(e,1);this.stroke={color:t,thinkness:e}};q.prototype.onProtonUpdate=function(){this.context.clearRect(0,0,this.element.width,this.element.height)};q.prototype.onParticleCreated=function(t){if(t.target)i.Util.getImage(t.target,t,false);else t.color=t.color?t.color:"#ff0000"};q.prototype.onParticleUpdate=function(t){if(t.target){if(t.target instanceof Image){var e=t.target.width*t.scale|0;var n=t.target.height*t.scale|0;var r=t.p.x-e/2;var o=t.p.y-n/2;if(!!t.color){if(!t.transform["buffer"])t.transform.buffer=this.getBuffer(t.target);var a=t.transform.buffer.getContext("2d");a.clearRect(0,0,t.transform.buffer.width,t.transform.buffer.height);a.globalAlpha=t.alpha;a.drawImage(t.target,0,0);a.globalCompositeOperation="source-atop";a.fillStyle=i.Util.rgbToHex(t.transform.rgb);a.fillRect(0,0,t.transform.buffer.width,t.transform.buffer.height);a.globalCompositeOperation="source-over";a.globalAlpha=1;this.context.drawImage(t.transform.buffer,0,0,t.transform.buffer.width,t.transform.buffer.height,r,o,e,n)}else{this.context.save();this.context.globalAlpha=t.alpha;this.context.translate(t.p.x,t.p.y);this.context.rotate(i.MathUtils.degreeTransform(t.rotation));this.context.translate(-t.p.x,-t.p.y);this.context.drawImage(t.target,0,0,t.target.width,t.target.height,r,o,e,n);this.context.globalAlpha=1;this.context.restore()}}}else{if(t.transform["rgb"])this.context.fillStyle="rgba("+t.transform.rgb.r+","+t.transform.rgb.g+","+t.transform.rgb.b+","+t.alpha+")";else this.context.fillStyle=t.color;this.context.beginPath();this.context.arc(t.p.x,t.p.y,t.radius,0,Math.PI*2,true);if(this.stroke){this.context.strokeStyle=this.stroke.color;this.context.lineWidth=this.stroke.thinkness;this.context.stroke()}this.context.closePath();this.context.fill()}};q.prototype.onParticleDead=function(t){};q.prototype.getBuffer=function(t){if(t instanceof Image){var e=t.width+"_"+t.height;var i=this.bufferCache[e];if(!i){i=document.createElement("canvas");i.width=t.width;i.height=t.height;this.bufferCache[e]=i}return i}};i.CanvasRender=q;function Z(t,e,i){Z._super_.call(this,t,e);this.context=this.element.getContext("2d");this.imageData=null;this.rectangle=null;this.rectangle=i;this.createImageData(i)}i.Util.inherits(Z,i.BaseRender);Z.prototype.resize=function(t,e){this.element.width=t;this.element.height=e};Z.prototype.createImageData=function(t){if(!t)this.rectangle=new i.Rectangle(0,0,this.element.width,this.element.height);else this.rectangle=t;this.imageData=this.context.createImageData(this.rectangle.width,this.rectangle.height);this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)};Z.prototype.start=function(){Z._super_.prototype.start.call(this)};Z.prototype.onProtonUpdate=function(){this.context.clearRect(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height);this.imageData=this.context.getImageData(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height)};Z.prototype.onProtonUpdateAfter=function(){this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)};Z.prototype.onParticleCreated=function(t){};Z.prototype.onParticleUpdate=function(t){if(this.imageData){this.setPixel(this.imageData,Math.floor(t.p.x-this.rectangle.x),Math.floor(t.p.y-this.rectangle.y),t)}};Z.prototype.setPixel=function(t,e,i,n){var r=n.transform.rgb;if(e<0||e>this.element.width||i<0||i>this.elementwidth)return;var o=((i>>0)*t.width+(e>>0))*4;t.data[o]=r.r;t.data[o+1]=r.g;t.data[o+2]=r.b;t.data[o+3]=n.alpha*255};Z.prototype.onParticleDead=function(t){};i.PixelRender=Z;function Q(t,e){Q._super_.call(this,t,e);this.gl=this.element.getContext("experimental-webgl",{antialias:true,stencil:false,depth:false});if(!this.gl)alert("Sorry your browser do not suppest WebGL!");this.initVar();this.setMaxRadius();this.initShaders();this.initBuffers();this.gl.blendEquation(this.gl.FUNC_ADD);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.enable(this.gl.BLEND)}i.Util.inherits(Q,i.BaseRender);Q.prototype.resize=function(t,e){this.umat[4]=-2;this.umat[7]=1;this.smat[0]=1/t;this.smat[4]=1/e;this.mstack.set(this.umat,0);this.mstack.set(this.smat,1);this.gl.viewport(0,0,t,e);this.element.width=t;this.element.height=e};Q.prototype.setMaxRadius=function(t){this.circleCanvasURL=this.createCircle(t)};Q.prototype.getVertexShader=function(){var t=["uniform vec2 viewport;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 tMat;","varying vec2 vTextureCoord;","varying float alpha;","void main() {","vec3 v = tMat * vec3(aVertexPosition, 1.0);","gl_Position = vec4(v.x, v.y, 0, 1);","vTextureCoord = aTextureCoord;","alpha = tMat[0][2];","}"].join("\n");return t};Q.prototype.getFragmentShader=function(){var t=["precision mediump float;","varying vec2 vTextureCoord;","varying float alpha;","uniform sampler2D uSampler;","uniform vec4 color;","uniform bool useTexture;","uniform vec3 uColor;","void main() {","vec4 textureColor = texture2D(uSampler, vTextureCoord);","gl_FragColor = textureColor * vec4(uColor, 1.0);","gl_FragColor.w *= alpha;","}"].join("\n");
return t};Q.prototype.initVar=function(){this.mstack=new i.MStack;this.umat=i.Mat3.create([2,0,1,0,-2,0,-1,1,1]);this.smat=i.Mat3.create([1/100,0,1,0,1/100,0,0,0,1]);this.texturebuffers={}};Q.prototype.start=function(){Q._super_.prototype.start.call(this);this.resize(this.element.width,this.element.height)};Q.prototype.blendEquation=function(t){this.gl.blendEquation(this.gl[t])};Q.prototype.blendFunc=function(t,e){this.gl.blendFunc(this.gl[t],this.gl[e])};Q.prototype.getShader=function(t,e,i){var n;if(i)n=t.createShader(t.FRAGMENT_SHADER);else n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e);t.compileShader(n);if(!t.getShaderParameter(n,t.COMPILE_STATUS)){alert(t.getShaderInfoLog(n));return null}return n};Q.prototype.initShaders=function(){var t=this.getShader(this.gl,this.getFragmentShader(),true);var e=this.getShader(this.gl,this.getVertexShader(),false);this.sprogram=this.gl.createProgram();this.gl.attachShader(this.sprogram,e);this.gl.attachShader(this.sprogram,t);this.gl.linkProgram(this.sprogram);if(!this.gl.getProgramParameter(this.sprogram,this.gl.LINK_STATUS))alert("Could not initialise shaders");this.gl.useProgram(this.sprogram);this.sprogram.vpa=this.gl.getAttribLocation(this.sprogram,"aVertexPosition");this.sprogram.tca=this.gl.getAttribLocation(this.sprogram,"aTextureCoord");this.gl.enableVertexAttribArray(this.sprogram.tca);this.gl.enableVertexAttribArray(this.sprogram.vpa);this.sprogram.tMatUniform=this.gl.getUniformLocation(this.sprogram,"tMat");this.sprogram.samplerUniform=this.gl.getUniformLocation(this.sprogram,"uSampler");this.sprogram.useTex=this.gl.getUniformLocation(this.sprogram,"useTexture");this.sprogram.color=this.gl.getUniformLocation(this.sprogram,"uColor");this.gl.uniform1i(this.sprogram.useTex,1)};Q.prototype.initBuffers=function(){this.unitIBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer);var t=[0,3,1,0,2,3];this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),this.gl.STATIC_DRAW);var e=[];for(var i=0;i<100;i++)e.push(i);idx=new Uint16Array(e);this.unitI33=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitI33);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,idx,this.gl.STATIC_DRAW);e=[];for(i=0;i<100;i++)e.push(i,i+1,i+2);idx=new Uint16Array(e);this.stripBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.stripBuffer);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,idx,this.gl.STATIC_DRAW)};Q.prototype.createCircle=function(t){this.circleCanvasRadius=i.WebGLUtil.nhpot(i.Util.initValue(t,32));var e=i.DomUtil.createCanvas("circle_canvas",this.circleCanvasRadius*2,this.circleCanvasRadius*2);var n=e.getContext("2d");n.beginPath();n.arc(this.circleCanvasRadius,this.circleCanvasRadius,this.circleCanvasRadius,0,Math.PI*2,true);n.closePath();n.fillStyle="#FFF";n.fill();return e.toDataURL()};Q.prototype.setImgInCanvas=function(t){var e=t.target.width;var n=t.target.height;var r=i.WebGLUtil.nhpot(t.target.width);var o=i.WebGLUtil.nhpot(t.target.height);var a=t.target.width/r;var s=t.target.height/o;if(!this.texturebuffers[t.transform.src])this.texturebuffers[t.transform.src]=[this.gl.createTexture(),this.gl.createBuffer(),this.gl.createBuffer()];t.transform.texture=this.texturebuffers[t.transform.src][0];t.transform.vcBuffer=this.texturebuffers[t.transform.src][1];t.transform.tcBuffer=this.texturebuffers[t.transform.src][2];this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.transform.tcBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,a,0,0,s,s,s]),this.gl.STATIC_DRAW);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.transform.vcBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,e,0,0,n,e,n]),this.gl.STATIC_DRAW);var l=t.transform.canvas.getContext("2d");var h=l.getImageData(0,0,r,o);this.gl.bindTexture(this.gl.TEXTURE_2D,t.transform.texture);this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,h);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_NEAREST);this.gl.generateMipmap(this.gl.TEXTURE_2D);t.transform.textureLoaded=true;t.transform.textureWidth=e;t.transform.textureHeight=n};Q.prototype.setStroke=function(t,e){};Q.prototype.onProtonUpdate=function(){};Q.prototype.onParticleCreated=function(t){var e=this;t.transform.textureLoaded=false;t.transform.tmat=i.Mat3.create();t.transform.tmat[8]=1;t.transform.imat=i.Mat3.create();t.transform.imat[8]=1;if(t.target){i.Util.getImage(t.target,t,true,function(t){e.setImgInCanvas.call(e,t);t.transform.oldScale=1})}else{i.Util.getImage(this.circleCanvasURL,t,true,function(t){e.setImgInCanvas.call(e,t);t.transform.oldScale=t.radius/e.circleCanvasRadius})}};Q.prototype.onParticleUpdate=function(t){if(t.transform.textureLoaded){this.updateMatrix(t);this.gl.uniform3f(this.sprogram.color,t.transform.rgb.r/255,t.transform.rgb.g/255,t.transform.rgb.b/255);this.gl.uniformMatrix3fv(this.sprogram.tMatUniform,false,this.mstack.top());this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.transform.vcBuffer);this.gl.vertexAttribPointer(this.sprogram.vpa,2,this.gl.FLOAT,false,0,0);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.transform.tcBuffer);this.gl.vertexAttribPointer(this.sprogram.tca,2,this.gl.FLOAT,false,0,0);this.gl.bindTexture(this.gl.TEXTURE_2D,t.transform.texture);this.gl.uniform1i(this.sprogram.samplerUniform,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);this.mstack.pop()}};Q.prototype.onParticleDead=function(t){};Q.prototype.updateMatrix=function(t){var e=i.WebGLUtil.makeTranslation(-t.transform.textureWidth/2,-t.transform.textureHeight/2);var n=i.WebGLUtil.makeTranslation(t.p.x,t.p.y);var r=t.rotation*(Math.PI/180);var o=i.WebGLUtil.makeRotation(r);var a=t.scale*t.transform.oldScale;var s=i.WebGLUtil.makeScale(a,a);var l=i.WebGLUtil.matrixMultiply(e,s);l=i.WebGLUtil.matrixMultiply(l,o);l=i.WebGLUtil.matrixMultiply(l,n);i.Mat3.inverse(l,t.transform.imat);l[2]=t.alpha;this.mstack.push(l)};i.WebGLRender=Q;function $(){this.vector=new i.Vector2D(0,0);this.random=0;this.crossType="dead";this.alert=true}$.prototype={getPosition:function(){},crossing:function(t){}};i.Zone=$;function tt(t,e,n,r,o){tt._super_.call(this);if(n-t>=0){this.x1=t;this.y1=e;this.x2=n;this.y2=r}else{this.x1=n;this.y1=r;this.x2=t;this.y2=e}this.dx=this.x2-this.x1;this.dy=this.y2-this.y1;this.minx=Math.min(this.x1,this.x2);this.miny=Math.min(this.y1,this.y2);this.maxx=Math.max(this.x1,this.x2);this.maxy=Math.max(this.y1,this.y2);this.dot=this.x2*this.y1-this.x1*this.y2;this.xxyy=this.dx*this.dx+this.dy*this.dy;this.gradient=this.getGradient();this.length=this.getLength();this.direction=i.Util.initValue(o,">")}i.Util.inherits(tt,i.Zone);tt.prototype.getPosition=function(){this.random=Math.random();this.vector.x=this.x1+this.random*this.length*Math.cos(this.gradient);this.vector.y=this.y1+this.random*this.length*Math.sin(this.gradient);return this.vector};tt.prototype.getDirection=function(t,e){var i=this.dy;var n=-this.dx;var r=this.dot;var o=n==0?1:n;if((i*t+n*e+r)*o>0)return true;else return false};tt.prototype.getDistance=function(t,e){var i=this.dy;var n=-this.dx;var r=this.dot;var o=i*t+n*e+r;return o/Math.sqrt(this.xxyy)};tt.prototype.getSymmetric=function(t){var e=t.getGradient();var i=this.getGradient();var n=2*(i-e);var r=t.x;var o=t.y;t.x=r*Math.cos(n)-o*Math.sin(n);t.y=r*Math.sin(n)+o*Math.cos(n);return t};tt.prototype.getGradient=function(){return Math.atan2(this.dy,this.dx)};tt.prototype.getRange=function(t,e){var i=Math.abs(this.getGradient());if(i<=Math.PI/4){if(t.p.x<this.maxx&&t.p.x>this.minx){e()}}else{if(t.p.y<this.maxy&&t.p.y>this.miny){e()}}};tt.prototype.getLength=function(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)};tt.prototype.crossing=function(t){var e=this;if(this.crossType=="dead"){if(this.direction==">"||this.direction=="R"||this.direction=="right"||this.direction=="down"){this.getRange(t,function(){if(e.getDirection(t.p.x,t.p.y))t.dead=true})}else{this.getRange(t,function(){if(!e.getDirection(t.p.x,t.p.y))t.dead=true})}}else if(this.crossType=="bound"){this.getRange(t,function(){if(e.getDistance(t.p.x,t.p.y)<=t.radius){if(e.dx==0){t.v.x*=-1}else if(e.dy==0){t.v.y*=-1}else{e.getSymmetric(t.v)}}})}else if(this.crossType=="cross"){if(this.alert){alert("Sorry lineZone does not support cross method");this.alert=false}}};i.LineZone=tt;function et(t,e,i){et._super_.call(this);this.x=t;this.y=e;this.radius=i;this.angle=0;this.center={x:this.x,y:this.y}}i.Util.inherits(et,i.Zone);et.prototype.getPosition=function(){this.random=Math.random();this.angle=Math.PI*2*Math.random();this.vector.x=this.x+this.random*this.radius*Math.cos(this.angle);this.vector.y=this.y+this.random*this.radius*Math.sin(this.angle);return this.vector};et.prototype.setCenter=function(t,e){this.center.x=t;this.center.y=e};et.prototype.crossing=function(t){var e=t.p.distanceTo(this.center);if(this.crossType=="dead"){if(e-t.radius>this.radius)t.dead=true}else if(this.crossType=="bound"){if(e+t.radius>=this.radius)this.getSymmetric(t)}else if(this.crossType=="cross"){if(this.alert){alert("Sorry CircleZone does not support cross method");this.alert=false}}};et.prototype.getSymmetric=function(t){var e=t.v.getGradient();var i=this.getGradient(t);var n=2*(i-e);var r=t.v.x;var o=t.v.y;t.v.x=r*Math.cos(n)-o*Math.sin(n);t.v.y=r*Math.sin(n)+o*Math.cos(n)};et.prototype.getGradient=function(t){return-Math.PI/2+Math.atan2(t.p.y-this.center.y,t.p.x-this.center.x)};i.CircleZone=et;function it(t,e){it._super_.call(this);this.x=t;this.y=e}i.Util.inherits(it,i.Zone);it.prototype.getPosition=function(){this.vector.x=this.x;this.vector.y=this.y;return this.vector};it.prototype.crossing=function(t){if(this.alert){alert("Sorry PointZone does not support crossing method");this.alert=false}};i.PointZone=it;function nt(t,e,i,n){nt._super_.call(this);this.x=t;this.y=e;this.width=i;this.height=n}i.Util.inherits(nt,i.Zone);nt.prototype.getPosition=function(){this.vector.x=this.x+Math.random()*this.width;this.vector.y=this.y+Math.random()*this.height;return this.vector};nt.prototype.crossing=function(t){if(this.crossType=="dead"){if(t.p.x+t.radius<this.x)t.dead=true;else if(t.p.x-t.radius>this.x+this.width)t.dead=true;if(t.p.y+t.radius<this.y)t.dead=true;else if(t.p.y-t.radius>this.y+this.height)t.dead=true}else if(this.crossType=="bound"){if(t.p.x-t.radius<this.x){t.p.x=this.x+t.radius;t.v.x*=-1}else if(t.p.x+t.radius>this.x+this.width){t.p.x=this.x+this.width-t.radius;t.v.x*=-1}if(t.p.y-t.radius<this.y){t.p.y=this.y+t.radius;t.v.y*=-1}else if(t.p.y+t.radius>this.y+this.height){t.p.y=this.y+this.height-t.radius;t.v.y*=-1}}else if(this.crossType=="cross"){if(t.p.x+t.radius<this.x&&t.v.x<=0)t.p.x=this.x+this.width+t.radius;else if(t.p.x-t.radius>this.x+this.width&&t.v.x>=0)t.p.x=this.x-t.radius;if(t.p.y+t.radius<this.y&&t.v.y<=0)t.p.y=this.y+this.height+t.radius;else if(t.p.y-t.radius>this.y+this.height&&t.v.y>=0)t.p.y=this.y-t.radius}};i.RectZone=nt;function rt(t,e,i,n){rt._super_.call(this);this.reset(t,e,i,n)}i.Util.inherits(rt,i.Zone);rt.prototype.reset=function(t,e,n,r){this.imageData=t;this.x=i.Util.initValue(e,0);this.y=i.Util.initValue(n,0);this.d=i.Util.initValue(r,2);this.vectors=[];this.setVectors()};rt.prototype.setVectors=function(){var t,e;var i=this.imageData.width;var n=this.imageData.height;for(t=0;t<i;t+=this.d){for(e=0;e<n;e+=this.d){var r=((e>>0)*i+(t>>0))*4;if(this.imageData.data[r+3]>0){this.vectors.push({x:t+this.x,y:e+this.y})}}}return this.vector};rt.prototype.getBound=function(t,e){var i=((e>>0)*this.imageData.width+(t>>0))*4;if(this.imageData.data[i+3]>0)return true;else return false};rt.prototype.getPosition=function(){return this.vector.copy(this.vectors[Math.floor(Math.random()*this.vectors.length)])};rt.prototype.getColor=function(t,e){t-=this.x;e-=this.y;var i=((e>>0)*this.imageData.width+(t>>0))*4;return{r:this.imageData.data[i],g:this.imageData.data[i+1],b:this.imageData.data[i+2],a:this.imageData.data[i+3]}};rt.prototype.crossing=function(t){if(this.crossType=="dead"){if(this.getBound(t.p.x-this.x,t.p.y-this.y))t.dead=true;else t.dead=false}else if(this.crossType=="bound"){if(!this.getBound(t.p.x-this.x,t.p.y-this.y))t.v.negate()}};i.ImageZone=rt;var ot=function(){if(t.console&&t.console.log){var e=arguments;if(typeof arguments[0]=="string"){if(arguments[0].indexOf("+")==0){var i=parseInt(arguments[0]);if(ot.once<i){delete e[0];console.log(e);ot.once++}}else{console.log(e)}}else{console.log(e)}}};ot.once=0;i.log=ot;var at=at||{addEventListener:function(t,e){t.addEventListener(i.PROTON_UPDATE,function(t){e()})},setStyle:function(t){var e=t||"#ff0000";var n=i.Util.hexToRGB(e);var r="rgba("+n.r+","+n.g+","+n.b+","+.5+")";return r},drawZone:function(t,e,n,r){var o=e.getContext("2d");var a=this.setStyle();this.addEventListener(t,function(){if(r)o.clearRect(0,0,e.width,e.height);if(n instanceof i.PointZone){o.beginPath();o.fillStyle=a;o.arc(n.x,n.y,10,0,Math.PI*2,true);o.fill();o.closePath()}else if(n instanceof i.LineZone){o.beginPath();o.strokeStyle=a;o.moveTo(n.x1,n.y1);o.lineTo(n.x2,n.y2);o.stroke();o.closePath()}else if(n instanceof i.RectZone){o.beginPath();o.strokeStyle=a;o.drawRect(n.x,n.y,n.width,n.height);o.stroke();o.closePath()}else if(n instanceof i.CircleZone){o.beginPath();o.strokeStyle=a;o.arc(n.x,n.y,n.radius,0,Math.PI*2,true);o.stroke();o.closePath()}})},drawEmitter:function(t,e,i,n){var r=e.getContext("2d");var o=this.setStyle();this.addEventListener(t,function(){if(n)r.clearRect(0,0,e.width,e.height);r.beginPath();r.fillStyle=o;r.arc(i.p.x,i.p.y,10,0,Math.PI*2,true);r.fill();r.closePath()})},test:{},setTest:function(t,e){this.test[t]=e},getTest:function(t){if(this.test.hasOwnProperty(t))return this.test[t];else return false}};i.Debug=at})(window);(function(){var t=0;var e=["ms","moz","webkit","o"];for(var i=0;i<e.length&&!window.requestAnimationFrame;++i){window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(e,i){var n=(new Date).getTime();var r=Math.max(0,16-(n-t));var o=window.setTimeout(function(){e(n+r)},r);t=n+r;return o};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(t){clearTimeout(t)}})();function UIFourJoint(){return}UIFourJoint.prototype=new UIElement;UIFourJoint.prototype.isUIJoint=true;UIFourJoint.prototype.isUIFourJoint=true;UIFourJoint.prototype.initUIFourJoint=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.points=[{x:0,y:80},{x:0,y:0},{x:80,y:0},{x:80,y:80}];this.regSerializer(this.fourJointToJson,this.fourJointFromJson);return this};UIFourJoint.prototype.fourJointToJson=function(t){t.points=[{},{},{},{}];t.points[0].x=this.points[0].x;t.points[0].y=this.points[0].y;t.points[1].x=this.points[1].x;t.points[1].y=this.points[1].y;t.points[2].x=this.points[2].x;t.points[2].y=this.points[2].y;t.points[3].x=this.points[3].x;t.points[3].y=this.points[3].y;return};UIFourJoint.prototype.fourJointFromJson=function(t){if(t.points){this.points=t.points}return};UIFourJoint.prototype.asIcon=function(){if(!this.isIcon){this.isIcon=true;this.points=[{x:0,y:80},{x:20,y:0},{x:60,y:0},{x:80,y:80}]}return};UIFourJoint.prototype.relayout=function(){if(this.disableRelayout||this.mode===Shape.MODE_EDITING){return}var t=getParentShapeOfShape(this);var e=t.getWidth(true);var i=t.getHeight(true);if(this.xAttr===UIElement.X_SCALE){this.points[0].x=e*this.x0Param;this.points[1].x=e*this.x1Param;this.points[2].x=e*this.x2Param;this.points[3].x=e*this.x3Param}if(this.yAttr===UIElement.Y_SCALE){this.points[0].y=i*this.y0Param;this.points[1].y=i*this.y1Param;this.points[2].y=i*this.y2Param;this.points[3].y=i*this.y3Param}return};UIFourJoint.prototype.updateLayoutParams=function(){this.xParam=1;this.yParam=1;var t=this.parentShape;if(!t){return}var e=t.getWidth(true);var i=t.getHeight(true);if(this.xAttr===UIElement.X_SCALE){this.x0Param=this.points[0].x/e;this.x1Param=this.points[1].x/e;this.x2Param=this.points[2].x/e;this.x3Param=this.points[3].x/e}if(this.yAttr===UIElement.Y_SCALE){this.y0Param=this.points[0].y/i;this.y1Param=this.points[1].y/i;this.y2Param=this.points[2].y/i;this.y3Param=this.points[3].y/i}return};UIFourJoint.prototype.hitTest=function(t){if(Math.distanceBetween(t,this.points[0])<20){return 1}if(Math.distanceBetween(t,this.points[1])<20){return 2}if(Math.distanceBetween(t,this.points[2])<20){return 3}if(Math.distanceBetween(t,this.points[3])<20){return 4}return Shape.HIT_TEST_NONE};UIFourJoint.prototype.getSelectMark=function(t,e){var i=this.points.length;if(t<=i){e.x=this.points[t-1].x;e.y=this.points[t-1].y;return true}return false};UIFourJoint.prototype.onAppendedInParent=function(){if(this.isCreatingElement()){var t=this.getParent();var e=t.getPositionInView();this.points[0].x-=e.x;this.points[0].y-=e.y;this.points[1].x-=e.x;this.points[1].y-=e.y;this.points[2].x-=e.x;this.points[2].y-=e.y;this.points[3].x-=e.x;this.points[3].y-=e.y}return};UIFourJoint.prototype.drawSelectMarks=function(t){return UITwoJoint.prototype.drawSelectMarks.call(this,t)};UIFourJoint.prototype.getMinMaxX=function(){var t=this.points[0].x;var e=t;for(var i=0;i<this.points.length;i++){var n=this.points[i];if(n.x>t){t=n.x}if(n.x<e){e=n.x}}return{min:e,max:t}};UIFourJoint.prototype.getMinMaxY=function(){var t=this.points[0].y;var e=t;for(var i=0;i<this.points.length;i++){var n=this.points[i];if(n.y>t){t=n.y}if(n.y<e){e=n.y}}return{min:e,max:t}};UIFourJoint.prototype.getX=function(){return this.getMinMaxX().min};UIFourJoint.prototype.getY=function(){return this.getMinMaxY().min};UIFourJoint.prototype.getWidth=function(){var t=this.getMinMaxX();return t.max-t.min};UIFourJoint.prototype.getHeight=function(){var t=this.getMinMaxY();return t.max-t.min};UIFourJoint.prototype.paintSelf=function(t){t.save();if(this.isIcon){this.translate(t)}var e=this.anchorSize?this.anchorSize:5;t.lineWidth=this.style.lineWidth;t.fillStyle=this.style.fillColor;t.strokeStyle=this.style.lineColor;t.beginPath();t.moveTo(this.points[0].x,this.points[0].y);t.lineTo(this.points[1].x,this.points[1].y);t.lineTo(this.points[2].x,this.points[2].y);t.lineTo(this.points[3].x,this.points[3].y);t.stroke();t.beginPath();t.arc(this.points[0].x,this.points[0].y,e,0,Math.PI*2);t.fill();t.beginPath();t.arc(this.points[1].x,this.points[1].y,e,0,Math.PI*2);t.fill();t.beginPath();t.arc(this.points[2].x,this.points[2].y,e,0,Math.PI*2);t.fill();t.beginPath();t.arc(this.points[3].x,this.points[3].y,e,0,Math.PI*2);t.fill();t.beginPath();t.restore();this.drawSelectMarks(t);return};UIFourJoint.prototype.shapeCanBeChild=function(t){return false};UIFourJoint.prototype.onPointerDownNormal=function(t){this.hitTestResult=this.hitTest(t);this.selected=this.hitTestResult!=Shape.HIT_TEST_NONE;return this.hitTestResult};UIFourJoint.prototype.onPointerMoveNormal=function(t){if(this.mode===Shape.MODE_EDITING&&this.hitTestResult>0){var e=this.hitTestResult-1;this.points[e].x=t.x;this.points[e].y=t.y}};UIFourJoint.prototype.onPointerUpNormal=function(t){this.hitTestResult=Shape.HIT_TEST_NONE;return};UIFourJoint.prototype.onPointerDownCreating=function(t){switch(this.state){case Shape.STAT_CREATING_0:{this.state=Shape.STAT_NORMAL}default:{return false}}};UIFourJoint.prototype.onPointerMoveCreating=function(t){switch(this.state){case Shape.STAT_CREATING_0:{this.points[0].x=t.x;this.points[0].y=t.y+80;this.points[1].x=t.x+20;this.points[1].y=t.y;this.points[2].x=t.x+60;this.points[2].y=t.y;this.points[3].x=t.x+80;this.points[3].y=t.y+80;return true}default:{return false}}};function UIFourJointCreator(){var t=["ui-four-joint","ui-four-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFourJoint;return e.initUIFourJoint(this.type,200,200)};return}var __extends=this&&this.__extends||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i];function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)};var Matrix=function(){function t(t,e,i,n,r,o){if(t===void 0){t=1}if(e===void 0){e=0}if(i===void 0){i=0}if(n===void 0){n=1}if(r===void 0){r=0}if(o===void 0){o=0}this.a=t;this.b=e;this.c=i;this.d=n;this.tx=r;this.ty=o}var e=t.prototype;e.prepend=function(t,e,i,n,r,o){var a=this.tx;if(t!=1||e!=0||i!=0||n!=1){var s=this.a;var l=this.c;this.a=s*t+this.b*i;this.b=s*e+this.b*n;this.c=l*t+this.d*i;this.d=l*e+this.d*n}this.tx=a*t+this.ty*i+r;this.ty=a*e+this.ty*n+o;return this};e.append=function(t,e,i,n,r,o){var a=this.a;var s=this.b;var l=this.c;var h=this.d;if(t!=1||e!=0||i!=0||n!=1){this.a=t*a+e*l;this.b=t*s+e*h;this.c=i*a+n*l;this.d=i*s+n*h}this.tx=r*a+o*l+this.tx;this.ty=r*s+o*h+this.ty;return this};e.prependTransform=function(t,e,i,n,r,o,a,s,l){if(r%360){var h=r;var u=egret.NumberUtils.cos(h);var p=egret.NumberUtils.sin(h)}else{u=1;p=0}if(s||l){this.tx-=s;this.ty-=l}if(o||a){this.prepend(u*i,p*i,-p*n,u*n,0,0);this.prepend(egret.NumberUtils.cos(a),egret.NumberUtils.sin(a),-egret.NumberUtils.sin(o),egret.NumberUtils.cos(o),t,e)}else{this.prepend(u*i,p*i,-p*n,u*n,t,e)}return this};e.appendTransform=function(t,e,i,n,r,o,a,s,l){if(r%360){var h=r;var u=egret.NumberUtils.cos(h);var p=egret.NumberUtils.sin(h)}else{u=1;p=0}if(o||a){this.append(egret.NumberUtils.cos(a),egret.NumberUtils.sin(a),-egret.NumberUtils.sin(o),egret.NumberUtils.cos(o),t,e);this.append(u*i,p*i,-p*n,u*n,0,0)}else{this.append(u*i,p*i,-p*n,u*n,t,e)}if(s||l){this.tx-=s*this.a+l*this.c;this.ty-=s*this.b+l*this.d}return this};e.rotate=function(t){var e=Math.cos(t);var i=Math.sin(t);var n=this.a;var r=this.c;var o=this.tx;this.a=n*e-this.b*i;this.b=n*i+this.b*e;this.c=r*e-this.d*i;this.d=r*i+this.d*e;this.tx=o*e-this.ty*i;this.ty=o*i+this.ty*e;return this};e.skew=function(t,e){this.append(egret.NumberUtils.cos(e),egret.NumberUtils.sin(e),-egret.NumberUtils.sin(t),egret.NumberUtils.cos(t),0,0);return this};e.scale=function(t,e){this.a*=t;this.d*=e;this.c*=t;this.b*=e;this.tx*=t;this.ty*=e;return this};e.translate=function(t,e){this.tx+=t;this.ty+=e;return this};e.identity=function(){this.a=this.d=1;this.b=this.c=this.tx=this.ty=0;return this};e.identityMatrix=function(t){this.a=t.a;this.b=t.b;this.c=t.c;this.d=t.d;this.tx=t.tx;this.ty=t.ty;return this};e.invert=function(){var t=this.a;var e=this.b;var i=this.c;var n=this.d;var r=this.tx;var o=t*n-e*i;this.a=n/o;this.b=-e/o;this.c=-i/o;this.d=t/o;this.tx=(i*this.ty-n*r)/o;this.ty=-(t*this.ty-e*r)/o;return this};t.transformCoords=function(t,e,i){var n=egret.Point.identity;n.x=t.a*e+t.c*i+t.tx;n.y=t.d*i+t.b*e+t.ty;return n};e.toArray=function(t){if(!this.array){this.array=new Float32Array(9)}if(t){this.array[0]=this.a;this.array[1]=this.b;this.array[2]=0;this.array[3]=this.c;this.array[4]=this.d;this.array[5]=0;this.array[6]=this.tx;this.array[7]=this.ty;this.array[8]=1}else{this.array[0]=this.a;this.array[1]=this.b;this.array[2]=this.tx;this.array[3]=this.c;this.array[4]=this.d;this.array[5]=this.ty;this.array[6]=0;this.array[7]=0;this.array[8]=1}return this.array};e.setTo=function(t,e,i,n,r,o){this.a=t;this.b=e;this.c=i;this.d=n;this.tx=r;this.ty=o};e.copyFrom=function(t){this.identityMatrix(t)};e.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)};e.concat=function(t){var e=this.a;var i=this.b;var n=this.c;var r=this.d;var o=this.tx;var a=this.ty;var s=t.a;var l=t.b;var h=t.c;var u=t.d;var p=t.tx;var c=t.ty;var f=e*s;var m=0;var d=0;var y=r*u;var g=o*s+p;var v=a*u+c;if(i!=0||n!=0||l!=0||h!=0){f+=i*h;y+=n*l;m+=e*l+i*u;d+=n*s+r*h;g+=a*h;v+=o*l}this.a=f;this.b=m;this.c=d;this.d=y;this.tx=g;this.ty=v};e.deltaTransformPoint=function(t){var e=this;var i=e.a*t.x+e.c*t.y;var n=e.b*t.x+e.d*t.y;return new egret.Point(i,n)};e.transformPoint=function(t){var e=this;var i=e.a*t.x+e.c*t.y+e.tx;var n=e.b*t.x+e.d*t.y+e.ty;return new egret.Point(i,n)};e.toString=function(){return"(a="+this.a+", b="+this.b+", c="+this.c+", d="+this.d+", tx="+this.tx+", ty="+this.ty+")"};e.createBox=function(t,e,i,n,r){if(i===void 0){i=0}if(n===void 0){n=0}if(r===void 0){r=0}var o=this;if(i!==0){i=i/egret.Matrix.DEG_TO_RAD;var a=egret.NumberUtils.cos(i);var s=egret.NumberUtils.sin(i);o.a=a*t;o.b=s*e;o.c=-s*t;o.d=a*e}else{o.a=t;o.b=0;o.c=0;o.d=e}o.tx=n;o.ty=r};e.createGradientBox=function(t,e,i,n,r){if(i===void 0){i=0}if(n===void 0){n=0}if(r===void 0){r=0}this.createBox(t/1638.4,e/1638.4,i,n+t/2,r+e/2)};t.identity=new t;t.DEG_TO_RAD=Math.PI/180;return t}();var Rectangle=function(){function t(t,e,i,n){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=0}if(n===void 0){n=0}this.x=t;this.y=e;this.width=i;this.height=n}var e=t.prototype;Object.defineProperty(e,"left",{get:function(){return this.x},set:function(t){this.width+=this.x-t;this.x=t},enumerable:true,configurable:true});Object.defineProperty(e,"right",{get:function(){return this.x+this.width},set:function(t){this.width=t-this.x},enumerable:true,configurable:true});Object.defineProperty(e,"top",{get:function(){return this.y},set:function(t){this.height+=this.y-t;this.y=t},enumerable:true,configurable:true});Object.defineProperty(e,"bottom",{get:function(){return this.y+this.height},set:function(t){this.height=t-this.y},enumerable:true,configurable:true});Object.defineProperty(e,"topLeft",{get:function(){return new egret.Point(this.left,this.top)},set:function(t){this.top=t.y;this.left=t.x},enumerable:true,configurable:true});Object.defineProperty(e,"bottomRight",{get:function(){return new egret.Point(this.right,this.bottom)},set:function(t){this.bottom=t.y;this.right=t.x},enumerable:true,configurable:true});e.initialize=function(t,e,i,n){this.x=t;this.y=e;this.width=i;this.height=n;return this};e.contains=function(t,e){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e};e.intersects=function(t){return Math.max(this.x,t.x)<=Math.min(this.right,t.right)&&Math.max(this.y,t.y)<=Math.min(this.bottom,t.bottom)};e.setEmpty=function(){this.x=0;this.y=0;this.width=0;this.height=0};e.clone=function(){return new t(this.x,this.y,this.width,this.height)};e.containsPoint=function(t){if(this.x<t.x&&this.x+this.width>t.x&&this.y<t.y&&this.y+this.height>t.y){return true}return false};e.setTo=function(t,e,i,n){this.initialize(t,e,i,n)};e.copyFrom=function(t){this.x=t.x;this.y=t.y;this.width=t.width;this.height=t.height};e.inflate=function(t,e){this.x-=t;this.width+=2*t;this.y-=e;this.height+=2*e};e.isEmpty=function(){return this.width==0||this.height==0};e.containsRect=function(t){var e=t.x+t.width;var i=t.y+t.height;var n=this.x+this.width;var r=this.y+this.height;return t.x>=this.x&&t.x<n&&t.y>=this.y&&t.y<r&&e>this.x&&e<=n&&i>this.y&&i<=r};e.equals=function(t){if(this===t){return true}return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height};e.inflatePoint=function(t){this.inflate(t.x,t.y)};e.intersection=function(t){var e=this.clone();var i=e.x;var n=e.y;var r=t.x;var o=t.y;var a=Math.max(i,r);var s=Math.min(i+e.width,r+t.width);if(a<=s){var l=Math.max(n,o);var h=Math.min(n+e.height,o+t.height);if(l<=h){e.setTo(a,l,s-a,h-l);return e}}e.setEmpty();return e};e.offset=function(t,e){this.x+=t;this.y+=e};e.offsetPoint=function(t){this.offset(t.x,t.y)};e.toString=function(){return"(x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"};e.union=function(t){var e=this.clone();if(t.isEmpty()){return e}if(e.isEmpty()){e.copyFrom(t);return e}var i=Math.min(e.x,t.x);var n=Math.min(e.y,t.y);e.setTo(i,n,Math.max(e.right,t.right)-i,Math.max(e.bottom,t.bottom)-n);return e};t.identity=new t(0,0,0,0);return t}();var DisplayObjectProperties=function(){function t(){this._name=null;this._explicitWidth=NaN;this._explicitHeight=NaN;this._x=0;this._y=0;this._scaleX=1;this._scaleY=1;this._anchorOffsetX=0;this._anchorOffsetY=0;this._anchorX=0;this._anchorY=0;this._rotation=0;this._alpha=1;this._skewX=0;this._skewY=0;this._blendMode=null;this._touchEnabled=t.defaultTouchEnabled;this._visible=true;this._worldAlpha=1;this._scrollRect=null;this._cacheAsBitmap=false;this._parent=null;this._stage=null;this._needDraw=false;this._filters=null;this._hasWidthSet=false;this._hasHeightSet=false;this._normalDirty=true;this._sizeDirty=true;this._isContainer=false}t.defaultTouchEnabled=false;return t}();var DisplayObjectPrivateProperties=function(){function t(){this._hitTestPointTexture=null;this._rectW=0;this._rectH=0;this._cacheDirty=false}return t}();var DisplayObject=function(){function t(){this._texture_to_render=null;this._worldBounds=null;this.__hack_local_matrix=null;this._sizeChangeCallBack=null;this._sizeChangeCallTarget=null;this.mask=null;this.renderTexture=null;this._DO_Props_=new DisplayObjectProperties;this._DO_Privs_=new DisplayObjectPrivateProperties;this._worldTransform=new Matrix;this._worldBounds=new Rectangle(0,0,0,0);this._DO_Privs_._cacheBounds=new Rectangle(0,0,0,0)}t.prototype._setDirty=function(){this._DO_Props_._normalDirty=true};t.prototype.getDirty=function(){return this._DO_Props_._normalDirty||this._DO_Props_._sizeDirty};t.prototype._setParentSizeDirty=function(){var t=this._DO_Props_._parent;if(t){if(!(t._DO_Props_._hasWidthSet||t._DO_Props_._hasHeightSet)){t._setSizeDirty()}else{t._setCacheDirty()}}};t.prototype._setSizeDirty=function(){var t=this;var e=t._DO_Props_;if(e._sizeDirty){return}e._sizeDirty=true;this._setDirty();this._setCacheDirty();this._setParentSizeDirty();if(t._sizeChangeCallBack!=null){if(t._sizeChangeCallTarget==e._parent){t._sizeChangeCallBack.call(t._sizeChangeCallTarget)}else{t._sizeChangeCallBack=null;t._sizeChangeCallTarget=null}}};t.prototype._clearDirty=function(){this._DO_Props_._normalDirty=false};t.prototype._clearSizeDirty=function(){this._DO_Props_._sizeDirty=false};Object.defineProperty(t.prototype,"name",{get:function(){return this._DO_Props_._name},set:function(t){this._DO_Props_._name=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"parent",{get:function(){return this._DO_Props_._parent},enumerable:true,configurable:true});t.prototype._parentChanged=function(t){this._DO_Props_._parent=t};Object.defineProperty(t.prototype,"x",{get:function(){return this._DO_Props_._x},set:function(t){this._setX(t)},enumerable:true,configurable:true});t.prototype._setX=function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._x!=t){this._DO_Props_._x=t;this._setDirty();this._setParentSizeDirty()}};Object.defineProperty(t.prototype,"y",{get:function(){return this._DO_Props_._y},set:function(t){this._setY(t)},enumerable:true,configurable:true});t.prototype._setY=function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._y!=t){this._DO_Props_._y=t;this._setDirty();this._setParentSizeDirty()}};Object.defineProperty(t.prototype,"scaleX",{get:function(){return this._DO_Props_._scaleX},set:function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._scaleX!=t){this._DO_Props_._scaleX=t;this._setDirty();this._setParentSizeDirty()}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scaleY",{get:function(){return this._DO_Props_._scaleY},set:function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._scaleY!=t){this._DO_Props_._scaleY=t;this._setDirty();this._setParentSizeDirty()}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"anchorOffsetX",{get:function(){return this._DO_Props_._anchorOffsetX},set:function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._anchorOffsetX!=t){this._DO_Props_._anchorOffsetX=t;this._setDirty();this._setParentSizeDirty()}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"anchorOffsetY",{get:function(){return this._DO_Props_._anchorOffsetY},set:function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._anchorOffsetY!=t){this._DO_Props_._anchorOffsetY=t;
this._setDirty();this._setParentSizeDirty()}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"anchorX",{get:function(){return this._DO_Props_._anchorX},set:function(t){this._setAnchorX(t)},enumerable:true,configurable:true});t.prototype._setAnchorX=function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._anchorX!=t){this._DO_Props_._anchorX=t;this._setDirty();this._setParentSizeDirty()}};Object.defineProperty(t.prototype,"anchorY",{get:function(){return this._DO_Props_._anchorY},set:function(t){this._setAnchorY(t)},enumerable:true,configurable:true});t.prototype._setAnchorY=function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._anchorY!=t){this._DO_Props_._anchorY=t;this._setDirty();this._setParentSizeDirty()}};Object.defineProperty(t.prototype,"visible",{get:function(){return this._DO_Props_._visible},set:function(t){this._setVisible(t)},enumerable:true,configurable:true});t.prototype._setVisible=function(t){if(this._DO_Props_._visible!=t){this._DO_Props_._visible=t;this._setSizeDirty()}};Object.defineProperty(t.prototype,"rotation",{get:function(){return this._DO_Props_._rotation},set:function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._rotation!=t){this._DO_Props_._rotation=t;this._setDirty();this._setParentSizeDirty()}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"alpha",{get:function(){return this._DO_Props_._alpha},set:function(t){this._setAlpha(t)},enumerable:true,configurable:true});t.prototype._setAlpha=function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._alpha!=t){this._DO_Props_._alpha=t;this._setDirty();this._setCacheDirty()}};Object.defineProperty(t.prototype,"skewX",{get:function(){return this._DO_Props_._skewX},set:function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._skewX!=t){this._DO_Props_._skewX=t;this._setDirty();this._setParentSizeDirty()}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"skewY",{get:function(){return this._DO_Props_._skewY},set:function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._skewY!=t){this._DO_Props_._skewY=t;this._setDirty();this._setParentSizeDirty()}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"touchEnabled",{get:function(){return this._DO_Props_._touchEnabled},set:function(t){this._setTouchEnabled(t)},enumerable:true,configurable:true});t.prototype._setTouchEnabled=function(t){this._DO_Props_._touchEnabled=t};Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._DO_Props_._blendMode},set:function(t){this._DO_Props_._blendMode=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scrollRect",{get:function(){return this._DO_Props_._scrollRect},set:function(t){this._setScrollRect(t)},enumerable:true,configurable:true});t.prototype._setScrollRect=function(t){this._DO_Props_._scrollRect=t;this._setSizeDirty()};Object.defineProperty(t.prototype,"measuredWidth",{get:function(){return this._measureBounds().width},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"measuredHeight",{get:function(){return this._measureBounds().height},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"explicitWidth",{get:function(){return this._DO_Props_._explicitWidth},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"explicitHeight",{get:function(){return this._DO_Props_._explicitHeight},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"width",{get:function(){return this._getWidth()},set:function(t){this._setWidth(t)},enumerable:true,configurable:true});t.prototype._getWidth=function(){return this._getSize(Rectangle.identity).width};Object.defineProperty(t.prototype,"height",{get:function(){return this._getHeight()},set:function(t){this._setHeight(t)},enumerable:true,configurable:true});t.prototype._getHeight=function(){return this._getSize(Rectangle.identity).height};t.prototype._setWidth=function(t){this._setSizeDirty();this._setCacheDirty();this._DO_Props_._explicitWidth=t;this._DO_Props_._hasWidthSet=typeof t==="number"&&!isNaN(t)};t.prototype._setHeight=function(t){this._setSizeDirty();this._setCacheDirty();this._DO_Props_._explicitHeight=t;this._DO_Props_._hasHeightSet=typeof t==="number"&&!isNaN(t)};Object.defineProperty(t.prototype,"worldAlpha",{get:function(){return this._DO_Props_._worldAlpha},set:function(t){this._DO_Props_._worldAlpha=t},enumerable:true,configurable:true});t.prototype._draw=function(t){var e=this;if(!e._DO_Props_._visible){e.destroyCacheBounds();return}var i=e.drawCacheTexture(t);if(i){e.destroyCacheBounds();return}var n=MainContext.__use_new_draw&&e._DO_Props_._isContainer;if(e._hasFilters()&&!n){this._setGlobalFilters(t)}t.setAlpha(e.worldAlpha,e.blendMode);t.setTransform(e._worldTransform);var r=e.mask||e._DO_Props_._scrollRect;if(r&&!n){t.pushMask(r)}e._render(t);if(r&&!n){t.popMask()}if(e._hasFilters()&&!n){this._removeGlobalFilters(t)}e.destroyCacheBounds()};t.prototype._setGlobalFilters=function(e){var i=this;var n;if(i._DO_Props_._filters){n=i._DO_Props_._filters.concat()}else{n=[]}if(this._transform){var r=this._transform._colorTransform;var o=t.color;o[0]=r._redMultiplier;o[4]=r._redOffset;o[6]=r._greenMultiplier;o[9]=r._greenOffset;o[12]=r._blueMultiplier;o[14]=r._blueOffset;o[18]=r._alphaMultiplier;o[19]=r._alphaOffset;t.colorMatrixFilter._matrix=o;n.push(t.colorMatrixFilter)}e.setGlobalFilters(n)};t.prototype._removeGlobalFilters=function(t){t.setGlobalFilters(null)};t.prototype._hasFilters=function(){var t=this._DO_Props_._filters&&this._DO_Props_._filters.length>0;if(this._transform){var e=this._transform._colorTransform;if(e._redMultiplier!=1||e._redOffset!=0||e._greenMultiplier!=1||e._greenOffset!=0||e._blueMultiplier!=1||e._blueOffset!=0||e._alphaMultiplier!=1||e._alphaOffset!=0){t=true}}return t};t.prototype._pushMask=function(t){var e=this;t.setTransform(e._worldTransform);var i=e.mask||e._DO_Props_._scrollRect;if(i){t.pushMask(i)}};t.prototype._popMask=function(t){t.popMask()};t.prototype.drawCacheTexture=function(t){var e=this;if(e._DO_Props_._cacheAsBitmap==false){return false}var i=e.getBounds(Rectangle.identity);if(e._DO_Privs_._cacheDirty||e._texture_to_render==null||Math.round(i.width)-e._texture_to_render._textureWidth>=1||Math.round(i.height)-e._texture_to_render._textureHeight>=1){var n=e._makeBitmapCache();e._DO_Privs_._cacheDirty=!n}if(e._texture_to_render==null)return false;var r=e._texture_to_render;var o=r._offsetX;var a=r._offsetY;var s=r._textureWidth;var l=r._textureHeight;e._updateTransform();t.setAlpha(e.worldAlpha,e.blendMode);t.setTransform(e._worldTransform);var h=egret.RenderFilter.getInstance();h.drawImage(t,e,0,0,s,l,o,a,s,l);return true};Object.defineProperty(t.prototype,"needDraw",{get:function(){return this._DO_Props_._needDraw},set:function(t){this._DO_Props_._needDraw=t},enumerable:true,configurable:true});t.prototype._updateTransform=function(){var t=this;var e=t._DO_Props_;if(!e._visible){return}t._calculateWorldTransform();if(MainContext._renderLoopPhase==MainContext.PHASE_TRANSFORM){if(t.needDraw||t._texture_to_render||e._cacheAsBitmap){MainContext.instance.addDraw(t._draw,t)}}};t.prototype._calculateWorldTransform=function(){var t=this;var e=t._DO_Props_;var i=t._worldTransform;var n=e._parent;if(n){i.identityMatrix(n._worldTransform)}else{i.identityMatrix(new Matrix)}this._getMatrix(i);var r=e._scrollRect;if(r){i.append(1,0,0,1,-r.x,-r.y)}if(n){t.worldAlpha=n.worldAlpha*e._alpha}else{t.worldAlpha=e._alpha}};t.prototype._render=function(t){};t.prototype.getBounds=function(t,e){if(e===void 0){e=true}var i=this._DO_Props_;var n=this._DO_Privs_;var r=this._measureBounds();var o=i._hasWidthSet?i._explicitWidth:r.width;var a=i._hasHeightSet?i._explicitHeight:r.height;n._rectW=r.width;n._rectH=r.height;this._clearSizeDirty();var s=r.x;var l=r.y;var h=0,u=0;if(e){if(i._anchorX!=0||i._anchorY!=0){h=o*i._anchorX;u=a*i._anchorY}else{h=i._anchorOffsetX;u=i._anchorOffsetY}}n._cacheBounds.initialize(s-h,l-u,o,a);var p=n._cacheBounds;if(!t){t=new Rectangle}return t.initialize(p.x,p.y,p.width,p.height)};t.prototype.destroyCacheBounds=function(){var t=this._DO_Privs_;t._cacheBounds.x=0;t._cacheBounds.y=0;t._cacheBounds.width=0;t._cacheBounds.height=0};t.prototype._getConcatenatedMatrix=function(){var e=t.identityMatrixForGetConcatenated.identity();var i=this;while(i!=null){var n=i._DO_Props_;if(n._anchorX!=0||n._anchorY!=0){var r=i._getSize(Rectangle.identity);e.prependTransform(n._x,n._y,n._scaleX,n._scaleY,n._rotation,n._skewX,n._skewY,r.width*n._anchorX,r.height*n._anchorY)}else{e.prependTransform(n._x,n._y,n._scaleX,n._scaleY,n._rotation,n._skewX,n._skewY,n._anchorOffsetX,n._anchorOffsetY)}if(n._scrollRect){e.prepend(1,0,0,1,-n._scrollRect.x,-n._scrollRect.y)}i=n._parent}return e};t.prototype.localToGlobal=function(t,e,i){if(t===void 0){t=0}if(e===void 0){e=0}var n=this._getConcatenatedMatrix();n.append(1,0,0,1,t,e);if(!i){i=new egret.Point}i.x=n.tx;i.y=n.ty;return i};t.prototype.globalToLocal=function(t,e,i){if(t===void 0){t=0}if(e===void 0){e=0}var n=this._getConcatenatedMatrix();n.invert();n.append(1,0,0,1,t,e);if(!i){i=new egret.Point}i.x=n.tx;i.y=n.ty;return i};t.prototype._getMatrix=function(t){if(!t){t=Matrix.identity.identity()}var e=this;var i=e._DO_Props_;var n,r;var o=this._getOffsetPoint();n=o.x;r=o.y;var a=e.__hack_local_matrix;if(a){t.append(a.a,a.b,a.c,a.d,a.tx,a.ty);t.append(1,0,0,1,-n,-r)}else{t.appendTransform(i._x,i._y,i._scaleX,i._scaleY,i._rotation,i._skewX,i._skewY,n,r)}return t};t.prototype._getSize=function(t){var e=this;var i=e._DO_Props_;if(i._hasHeightSet&&i._hasWidthSet){this._clearSizeDirty();return t.initialize(0,0,i._explicitWidth,i._explicitHeight)}this._measureSize(t);if(i._hasWidthSet){t.width=i._explicitWidth}if(i._hasHeightSet){t.height=i._explicitHeight}return t};t.prototype._measureSize=function(t){var e=this;var i=e._DO_Props_;var n=e._DO_Privs_;if(i._sizeDirty){t=this._measureBounds();n._rectW=t.width;n._rectH=t.height;this._clearSizeDirty()}else{t.width=n._rectW;t.height=n._rectH}t.x=0;t.y=0;return t};t.prototype._measureBounds=function(){return Rectangle.identity.initialize(0,0,0,0)};t.prototype._getOffsetPoint=function(){var t=this;var e=t._DO_Props_;var i=e._anchorOffsetX;var n=e._anchorOffsetY;if(e._anchorX!=0||e._anchorY!=0){var r=t._getSize(Rectangle.identity);i=e._anchorX*r.width;n=e._anchorY*r.height}var o={};o.x=i;o.y=n;return o};Object.defineProperty(t.prototype,"cacheAsBitmap",{get:function(){return this._DO_Props_._cacheAsBitmap},set:function(t){this._DO_Props_._cacheAsBitmap=t;if(t){egret.callLater(this._makeBitmapCache,this)}else{this._texture_to_render=null}},enumerable:true,configurable:true});t.prototype._makeBitmapCache=function(){if(!this.renderTexture){this.renderTexture=new egret.RenderTexture}var t=this.renderTexture.drawToTexture(this);if(t){this._texture_to_render=this.renderTexture}else{this._texture_to_render=null}return t};t.prototype._setCacheDirty=function(t){if(t===void 0){t=true}this._DO_Privs_._cacheDirty=t};t.getTransformBounds=function(t,e){var i=t.x,n=t.y;var r=t.width,o=t.height;if(i||n){e.appendTransform(0,0,1,1,0,0,0,-i,-n)}var a=r*e.a,s=r*e.b;var l=o*e.c,h=o*e.d;var u=e.tx,p=e.ty;var c=u,f=u,m=p,d=p;if((i=a+u)<c){c=i}else if(i>f){f=i}if((i=a+l+u)<c){c=i}else if(i>f){f=i}if((i=l+u)<c){c=i}else if(i>f){f=i}if((n=s+p)<m){m=n}else if(n>d){d=n}if((n=s+h+p)<m){m=n}else if(n>d){d=n}if((n=h+p)<m){m=n}else if(n>d){d=n}return t.initialize(c,m,f-c,d-m)};Object.defineProperty(t.prototype,"filters",{get:function(){return this._DO_Props_._filters},set:function(t){this._DO_Props_._filters=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"transform",{get:function(){if(!this._transform){this._transform=new egret.Transform(this)}return this._transform},enumerable:true,configurable:true});t.color=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];t.identityMatrixForGetConcatenated=new Matrix;t._enterFrameCallBackList=[];t._renderCallBackList=[];return t}();var DisplayObjectContainer=function(t){__extends(e,t);function e(){t.call(this);this._touchChildren=true;this._children=[];this._DO_Props_._isContainer=true}Object.defineProperty(e.prototype,"touchChildren",{get:function(){return this._touchChildren},set:function(t){this._touchChildren=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numChildren",{get:function(){return this._children.length},enumerable:true,configurable:true});e.prototype.setChildIndex=function(t,e){this.doSetChildIndex(t,e)};e.prototype.doSetChildIndex=function(t,e){var i=this._children.indexOf(t);if(i<0){egret.$error(1006)}this._children.splice(i,1);if(e<0||this._children.length<=e){this._children.push(t)}else{this._children.splice(e,0,t)}};e.prototype.addChild=function(t){var e=this._children.length;if(t.parent==this)e--;return this._doAddChild(t,e)};e.prototype.addChildAt=function(t,e){return this._doAddChild(t,e)};e.prototype._doAddChild=function(t,i,n){if(n===void 0){n=true}if(t==this)return t;if(i<0||i>this._children.length){egret.$error(1007);return t}var r=t.parent;if(r==this){this.doSetChildIndex(t,i);return t}if(r){var o=r._children.indexOf(t);if(o>=0){r._doRemoveChild(o)}}this._children.splice(i,0,t);t._parentChanged(this);if(n)var a=0;if(this._DO_Props_._stage){t._onAddToStage();var s=e.__EVENT__ADD_TO_STAGE_LIST;while(s.length>0){var l=s.shift();if(n){var h=0}}}t._setDirty();this._setSizeDirty();return t};e.prototype.removeChild=function(t){var e=this._children.indexOf(t);if(e>=0){return this._doRemoveChild(e)}else{egret.$error(1008);return null}};e.prototype.removeChildAt=function(t){if(t>=0&&t<this._children.length){return this._doRemoveChild(t)}else{egret.$error(1007);return null}};e.prototype._doRemoveChild=function(t,i){if(i===void 0){i=true}var n=this._children;var r=n[t];if(i){var o=0}if(this._DO_Props_._stage){r._onRemoveFromStage();var a=e.__EVENT__REMOVE_FROM_STAGE_LIST;while(a.length>0){var s=a.shift();if(i){var l=0}s._DO_Props_._stage=null}}r._parentChanged(null);n.splice(t,1);this._setSizeDirty();return r};e.prototype.getChildAt=function(t){if(t>=0&&t<this._children.length){return this._children[t]}else{egret.$error(1007);return null}};e.prototype.contains=function(t){while(t){if(t==this){return true}t=t.parent}return false};e.prototype.swapChildrenAt=function(t,e){if(t>=0&&t<this._children.length&&e>=0&&e<this._children.length){this._swapChildrenAt(t,e)}else{egret.$error(1007)}};e.prototype.swapChildren=function(t,e){var i=this._children.indexOf(t);var n=this._children.indexOf(e);if(i==-1||n==-1){egret.$error(1008)}else{this._swapChildrenAt(i,n)}};e.prototype._swapChildrenAt=function(t,e){if(t==e){return}var i=this._children;var n=i[t];i[t]=i[e];i[e]=n};e.prototype.getChildIndex=function(t){return this._children.indexOf(t)};e.prototype.removeChildren=function(){var t=this._children;for(var e=t.length-1;e>=0;e--){this._doRemoveChild(e)}};e.prototype._updateTransform=function(){var e=this;if(!e._DO_Props_._visible){return}if(e._hasFilters()){egret.RenderCommand.push(e._setGlobalFilters,e)}var i=e.mask||e._DO_Props_._scrollRect;if(i){egret.RenderCommand.push(e._pushMask,e)}t.prototype._updateTransform.call(this);if(!e._DO_Props_._cacheAsBitmap||!e._texture_to_render){for(var n=0,r=e._children,o=r.length;n<o;n++){var a=r[n];a._updateTransform()}}if(i){egret.RenderCommand.push(e._popMask,e)}if(e._hasFilters()){egret.RenderCommand.push(e._removeGlobalFilters,e)}};e.prototype._render=function(t){if(!egret.MainContext.__use_new_draw){var e=this;for(var i=0,n=e._children,r=n.length;i<r;i++){var o=n[i];o._draw(t)}}};e.prototype._measureBounds=function(){var t=this;var e=0,i=0,n=0,r=0;var o=t._children;var a=o.length;for(var s=0;s<a;s++){var l=o[s];if(!l.visible){continue}var h=l.getBounds(Rectangle.identity,false);var u=h.x;var p=h.y;var c=h.width;var f=h.height;var m=l._getMatrix();var d=DisplayObject.getTransformBounds(Rectangle.identity.initialize(u,p,c,f),m);var y=d.x,g=d.y,v=d.width+d.x,_=d.height+d.y;if(y<e||s==0){e=y}if(v>i||s==0){i=v}if(g<n||s==0){n=g}if(_>r||s==0){r=_}}return Rectangle.identity.initialize(e,n,i-e,r-n)};e.prototype.hitTest=function(e,i,n){if(n===void 0){n=false}var r=this;var o;if(!r._DO_Props_._visible){return null}if(r._DO_Props_._scrollRect){if(e<r._DO_Props_._scrollRect.x||i<r._DO_Props_._scrollRect.y||e>r._DO_Props_._scrollRect.x+r._DO_Props_._scrollRect.width||i>r._DO_Props_._scrollRect.y+r._DO_Props_._scrollRect.height){return null}}else if(r.mask){if(r.mask.x>e||e>r.mask.x+r.mask.width||r.mask.y>i||i>r.mask.y+r.mask.height){return null}}var a=r._children;var s=a.length;var l=r._touchChildren;for(var h=s-1;h>=0;h--){var u=a[h];var p=u._getMatrix();var c=u.scrollRect;if(c){p.append(1,0,0,1,-c.x,-c.y)}p.invert();var f=egret.Matrix.transformCoords(p,e,i);var m=u.hitTest(f.x,f.y,true);if(m){if(!l){return r}if(m._DO_Props_._touchEnabled&&l){return m}o=r}}if(o){return o}else if(r._texture_to_render){return t.prototype.hitTest.call(this,e,i,n)}return null};e.prototype._onAddToStage=function(){var e=this;t.prototype._onAddToStage.call(this);var i=e._children;var n=i.length;for(var r=0;r<n;r++){var o=this._children[r];o._onAddToStage()}};e.prototype._onRemoveFromStage=function(){var e=this;t.prototype._onRemoveFromStage.call(this);var i=e._children;var n=i.length;for(var r=0;r<n;r++){var o=i[r];o._onRemoveFromStage()}};e.prototype.getChildByName=function(t){var e=this._children;var i=e.length;var n;for(var r=0;r<i;r++){n=e[r];if(n.name==t){return n}}return null};e.__EVENT__ADD_TO_STAGE_LIST=[];e.__EVENT__REMOVE_FROM_STAGE_LIST=[];return e}(DisplayObject);var MainContext=function(){function t(){this.timeScale=1;this.drawList=[];this.container=null;this.rendererContext=null;this.texture_scale_factor=1}t.PHASE_DRAW="draw";t.PHASE_TRANSFORM="updateTransform";t.prototype.setRenderContext=function(t){this.rendererContext=t};t.prototype.setObjectContainer=function(t){this.container=t};t.prototype.addDraw=function(t,e){this.drawList.push({callback:t,thisObject:e})};t.prototype.run=function(){var t=this;var e=Date.now();function i(){var n=Date.now();var r=n-e;t.renderLoop(r);dragonBones.WorldClock.clock.advanceTime(r/1e3);window.requestAnimationFrame(i);e=n}window.requestAnimationFrame(i)};t.prototype.setScale=function(t,e){this.container.scaleX=t;this.container.scaleY=e};t.prototype.setPosition=function(t,e){this.container.x=t;this.container.y=e};t.prototype.renderLoop=function(e){this.init(e);this.startRender();t._renderLoopPhase=t.PHASE_TRANSFORM;this.container._updateTransform();t._renderLoopPhase=t.PHASE_DRAW;t.instance.draw(this);this.endRender()};t.prototype.draw=function(t){var e=this.drawList.length;for(var i=0;i<e;i++){var n=this.drawList[i];t.canvasContext.save();n.callback.call(n.thisObject,t);t.canvasContext.restore()}this.drawList.length=0;return};return t}();MainContext.instance=new MainContext;var CanvasRenderer=function(){var t={NORMAL:"normal",ADD:"add",ERASE:"erase",ERASE_REVERSE:"eraseReverse"};function e(t){this.texture_scale_factor=1}var i="x-canvas";var n=1280;var r=800;e.prototype.setScale=function(t,e){this.container.scaleX=t;this.container.scaleY=e};e.prototype.setPosition=function(t,e){this.container.x=t;this.container.y=e};e.prototype.uninit=function(){this.container=null;this.canvasContext=null};e.prototype.init=function(t){this.canvasContext=t;var e=this.canvasContext.setTransform;this.bkTransform=e;var i=this;this.canvasContext.setTransform=function(t,e,n,r,o,a){i._matrixA=t;i._matrixB=e;i._matrixC=n;i._matrixD=r;i._matrixTx=o;i._matrixTy=a;this.transform(t,e,n,r,o,a)};this._matrixA=1;this._matrixB=0;this._matrixC=0;this._matrixD=1;this._matrixTx=0;this._matrixTy=0;this._transformTx=0;this._transformTy=0;this.initBlendMode()};e.prototype.clearScreen=function(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)};e.prototype.startRender=function(){this.canvasContext.save()};e.prototype.endRender=function(){this.canvasContext.restore();this.canvasContext.setTransform(1,0,0,1,0,0);this.canvasContext.setTransform=this.bkTransform;this.bkTransform=null};e.prototype.drawImage=function(t,e,i,n,r,o,a,s,l,h){if(h===void 0){h=undefined}o+=this._transformTx;a+=this._transformTy;this.canvasContext.drawImage(t._bitmapData,e,i,n,r,o,a,s,l)};e.prototype.setTransform=function(t){if(t.a==1&&t.b==0&&t.c==0&&t.d==1&&this._matrixA==1&&this._matrixB==0&&this._matrixC==0&&this._matrixD==1){this._transformTx=t.tx-this._matrixTx;this._transformTy=t.ty-this._matrixTy;return}this._transformTx=this._transformTy=0;if(this._matrixA!=t.a||this._matrixB!=t.b||this._matrixC!=t.c||this._matrixD!=t.d||this._matrixTx!=t.tx||this._matrixTy!=t.ty){this.canvasContext.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty)}};e.prototype.setAlpha=function(e,i){this.canvasContext.globalAlpha=e;if(i){this.blendValue=this.blendModes[i];this.canvasContext.globalCompositeOperation=this.blendValue}else if(this.blendValue!=t.NORMAL){this.blendValue=this.blendModes[t.NORMAL];this.canvasContext.globalCompositeOperation=this.blendValue}};e.prototype.initBlendMode=function(){this.blendModes={};this.blendModes[t.NORMAL]="source-over";this.blendModes[t.ADD]="lighter";this.blendModes[t.ERASE]="destination-out";this.blendModes[t.ERASE_REVERSE]="destination-in"};return e}();var Bitmap=function(t){__extends(e,t);function e(e){t.call(this);this._texture=null;this.fillMode="scale";if(e){this._texture=e;this._setSizeDirty()}this.needDraw=true}Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){if(t==this._texture){return}this._setSizeDirty();this._texture=t},enumerable:true,configurable:true});e.prototype._render=function(t){var i=this._texture;if(!i){this._texture_to_render=null;return}this._texture_to_render=i;var n=this._DO_Props_._hasWidthSet?this._DO_Props_._explicitWidth:i._textureWidth;var r=this._DO_Props_._hasHeightSet?this._DO_Props_._explicitHeight:i._textureHeight;e._drawBitmap(t,n,r,this)};e._drawBitmap=function(t,e,i,n){var r=n._texture_to_render;if(!r){return}var o=r._textureWidth;var a=r._textureHeight;var s=r._offsetX;var l=r._offsetY;var h=r._bitmapWidth||o;var u=r._bitmapHeight||a;var p=e/o;s=Math.round(s*p);e=Math.round(h*p);var c=i/a;l=Math.round(l*c);i=Math.round(u*c);t.drawImage(r,r._bitmapX,r._bitmapY,h,u,s,l,e,i)};return e}(DisplayObject);var SpriteSheet=function(){function t(t){this._sourceWidth=0;this._sourceHeight=0;this._bitmapX=0;this._bitmapY=0;this._textureMap={};this.texture=t;this._sourceWidth=t.width;this._sourceHeight=t.height;this._bitmapX=0;this._bitmapY=0}var e=t.prototype;e.getTexture=function(t){return this._textureMap[t]};e.createTexture=function(t,e,i,n,r,o,a,s,l){if(o===void 0){o=0}if(a===void 0){a=0}if(typeof s==="undefined"){s=o+n}if(typeof l==="undefined"){l=a+r}var h=new Object;h._bitmapData=this.texture;var u=MainContext.instance.texture_scale_factor;h._bitmapX=this._bitmapX+e;h._bitmapY=this._bitmapY+i;h._bitmapWidth=n*u;h._bitmapHeight=r*u;h._offsetX=o;h._offsetY=a;h._textureWidth=s*u;h._textureHeight=l*u;h._sourceWidth=this._sourceWidth;h._sourceHeight=this._sourceHeight;this._textureMap[t]=h;return h};e.dispose=function(){if(this.texture){this.texture.dispose()}};return t}();var __define=this.__define||function(t,e,i,n){Object.defineProperty(t,e,{configurable:true,enumerable:true,get:i,set:n})};var dragonBones;(function(t){var e=function(){function t(){}var e=__define,i=t;p=i.prototype;t.DATA_VERSION="4.0";t.PARENT_COORDINATE_DATA_VERSION="3.0";t.VERSION="4.1.9";return t}();t.DragonBones=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(t){this._animationStateCount=0;this._armature=t;this._animationList=[];this._animationStateList=[];this._timeScale=1;this._isPlaying=false;this.tweenEnabled=true}var i=__define,n=e;p=n.prototype;p.dispose=function(){if(!this._armature){return}this._resetAnimationStateList();this._animationList.length=0;this._armature=null;this._animationDataList=null;this._animationList=null;this._animationStateList=null};p._resetAnimationStateList=function(){var e=this._animationStateList.length;var i;while(e--){i=this._animationStateList[e];i._resetTimelineStateList();t.AnimationState._returnObject(i)}this._animationStateList.length=0};p.gotoAndPlay=function(i,n,r,o,a,s,l,h,u){if(n===void 0){n=-1}if(r===void 0){r=-1}if(o===void 0){o=NaN}if(a===void 0){a=0}if(s===void 0){s=null}if(l===void 0){l=e.SAME_LAYER_AND_GROUP}if(h===void 0){h=true}if(u===void 0){u=true}if(!this._animationDataList){return null}var p=this._animationDataList.length;var c;while(p--){if(this._animationDataList[p].name==i){c=this._animationDataList[p];break}}if(!c){return null}var f=this._isPlaying==false;this._isPlaying=true;this._isFading=true;n=n<0?c.fadeTime<0?.3:c.fadeTime:n;var m;if(r<0){m=c.scale<0?1:c.scale}else{m=r*1e3/c.duration}o=isNaN(o)?c.playTimes:o;var d;switch(l){case e.NONE:break;case e.SAME_LAYER:p=this._animationStateList.length;while(p--){d=this._animationStateList[p];if(d.layer==a){d.fadeOut(n,h)}}break;case e.SAME_GROUP:p=this._animationStateList.length;while(p--){d=this._animationStateList[p];if(d.group==s){d.fadeOut(n,h)}}break;case e.ALL:p=this._animationStateList.length;while(p--){d=this._animationStateList[p];d.fadeOut(n,h)}break;case e.SAME_LAYER_AND_GROUP:default:p=this._animationStateList.length;while(p--){d=this._animationStateList[p];if(d.layer==a&&d.group==s){d.fadeOut(n,h)}}break}this._lastAnimationState=t.AnimationState._borrowObject();this._lastAnimationState._layer=a;this._lastAnimationState._group=s;this._lastAnimationState.autoTween=this.tweenEnabled;this._lastAnimationState._fadeIn(this._armature,c,n,1/m,o,u);this.addState(this._lastAnimationState);var y=this._armature.getSlots(false);p=y.length;while(p--){var g=y[p];if(g.childArmature){g.childArmature.animation.gotoAndPlay(i,n)}}if(f){this._armature.advanceTime(0)}return this._lastAnimationState};p.gotoAndStop=function(t,i,n,r,o,a,s,l){if(n===void 0){n=-1}if(r===void 0){r=0}if(o===void 0){o=-1}if(a===void 0){a=0}if(s===void 0){s=null}if(l===void 0){l=e.ALL}var h=this.getState(t,a);if(!h){h=this.gotoAndPlay(t,r,o,NaN,a,s,l)}if(n>=0){h.setCurrentTime(h.totalTime*n)}else{h.setCurrentTime(i)}h.stop();return h};p.play=function(){if(!this._animationDataList||this._animationDataList.length==0){return}if(!this._lastAnimationState){this.gotoAndPlay(this._animationDataList[0].name)}else if(!this._isPlaying){this._isPlaying=true}else{this.gotoAndPlay(this._lastAnimationState.name)}};p.stop=function(){this._isPlaying=false};p.getState=function(t,e){if(e===void 0){e=0}var i=this._animationStateList.length;while(i--){var n=this._animationStateList[i];if(n.name==t&&n.layer==e){return n}}return null};p.hasAnimation=function(t){var e=this._animationDataList.length;while(e--){if(this._animationDataList[e].name==t){return true}}return false};p._advanceTime=function(t){if(!this._isPlaying){return}var e=false;t*=this._timeScale;var i=this._animationStateList.length;while(i--){var n=this._animationStateList[i];if(n._advanceTime(t)){this.removeState(n)}else if(n.fadeState!=1){e=true}}this._isFading=e};p._updateAnimationStates=function(){var t=this._animationStateList.length;while(t--){this._animationStateList[t]._updateTimelineStates()}};p.addState=function(t){if(this._animationStateList.indexOf(t)<0){this._animationStateList.unshift(t);this._animationStateCount=this._animationStateList.length}};p.removeState=function(e){var i=this._animationStateList.indexOf(e);if(i>=0){this._animationStateList.splice(i,1);t.AnimationState._returnObject(e);if(this._lastAnimationState==e){if(this._animationStateList.length>0){this._lastAnimationState=this._animationStateList[0]}else{this._lastAnimationState=null}}this._animationStateCount=this._animationStateList.length}};i(p,"movementList",function(){return this._animationList});i(p,"movementID",function(){return this.lastAnimationName});i(p,"lastAnimationState",function(){return this._lastAnimationState});i(p,"lastAnimationName",function(){return this._lastAnimationState?this._lastAnimationState.name:null});i(p,"animationList",function(){return this._animationList});i(p,"isPlaying",function(){return this._isPlaying&&!this.isComplete});i(p,"isComplete",function(){if(this._lastAnimationState){if(!this._lastAnimationState.isComplete){return false}var t=this._animationStateList.length;while(t--){if(!this._animationStateList[t].isComplete){return false}}return true}return true});i(p,"timeScale",function(){return this._timeScale},function(t){if(isNaN(t)||t<0){t=1}this._timeScale=t});i(p,"animationDataList",function(){return this._animationDataList},function(t){this._animationDataList=t;this._animationList.length=0;for(var e=0,i=this._animationDataList.length;e<i;e++){var n=this._animationDataList[e];this._animationList[this._animationList.length]=n.name}});e.NONE="none";e.SAME_LAYER="sameLayer";e.SAME_GROUP="sameGroup";e.SAME_LAYER_AND_GROUP="sameLayerAndGroup";e.ALL="all";return e}();t.Animation=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._layer=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._currentPlayTimes=0;this._totalTime=0;this._currentTime=0;this._lastTime=0;this._fadeState=0;this._playTimes=0;this._timelineStateList=[];this._slotTimelineStateList=[];this._boneMasks=[]}var i=__define,n=e;p=n.prototype;e._borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e._returnObject=function(t){t.clear();if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}};e._clear=function(){var i=e._pool.length;while(i--){e._pool[i].clear()}e._pool.length=0;t.TimelineState._clear()};p.clear=function(){this._resetTimelineStateList();this._boneMasks.length=0;this._armature=null;this._clip=null};p._resetTimelineStateList=function(){var e=this._timelineStateList.length;while(e--){t.TimelineState._returnObject(this._timelineStateList[e])}this._timelineStateList.length=0;e=this._slotTimelineStateList.length;while(e--){t.SlotTimelineState._returnObject(this._slotTimelineStateList[e])}this._slotTimelineStateList.length=0};p.containsBoneMask=function(t){return this._boneMasks.length==0||this._boneMasks.indexOf(t)>=0};p.addBoneMask=function(t,e){if(e===void 0){e=true}this.addBoneToBoneMask(t);if(e){var i=this._armature.getBone(t);if(i){var n=this._armature.getBones(false);var r=n.length;while(r--){var o=n[r];if(i.contains(o)){this.addBoneToBoneMask(o.name)}}}}this._updateTimelineStates();return this};p.removeBoneMask=function(t,e){if(e===void 0){e=true}this.removeBoneFromBoneMask(t);if(e){var i=this._armature.getBone(t);if(i){var n=this._armature.getBones(false);var r=n.length;while(r--){var o=n[r];if(i.contains(o)){this.removeBoneFromBoneMask(o.name)}}}}this._updateTimelineStates();return this};p.removeAllMixingTransform=function(){this._boneMasks.length=0;this._updateTimelineStates();return this};p.addBoneToBoneMask=function(t){if(this._clip.getTimeline(t)&&this._boneMasks.indexOf(t)<0){this._boneMasks.push(t)}};p.removeBoneFromBoneMask=function(t){var e=this._boneMasks.indexOf(t);if(e>=0){this._boneMasks.splice(e,1)}};p._updateTimelineStates=function(){var t;var e;var i=this._timelineStateList.length;var n;while(i--){t=this._timelineStateList[i];if(!this._armature.getBone(t.name)){this.removeTimelineState(t)}}i=this._slotTimelineStateList.length;while(i--){e=this._slotTimelineStateList[i];if(!this._armature.getSlot(e.name)){this.removeSlotTimelineState(e)}}if(this._boneMasks.length>0){i=this._timelineStateList.length;while(i--){t=this._timelineStateList[i];if(this._boneMasks.indexOf(t.name)<0){this.removeTimelineState(t)}}for(i=0,n=this._boneMasks.length;i<n;i++){var r=this._boneMasks[i];this.addTimelineState(r)}}else{for(i=0,n=this._clip.timelineList.length;i<n;i++){var o=this._clip.timelineList[i];this.addTimelineState(o.name)}}for(i=0,n=this._clip.slotTimelineList.length;i<n;i++){var a=this._clip.slotTimelineList[i];this.addSlotTimelineState(a.name)}};p.addTimelineState=function(e){
var i=this._armature.getBone(e);if(i){for(var n=0,r=this._timelineStateList.length;n<r;n++){var o=this._timelineStateList[n];if(o.name==e){return}}var a=t.TimelineState._borrowObject();a._fadeIn(i,this,this._clip.getTimeline(e));this._timelineStateList.push(a)}};p.removeTimelineState=function(e){var i=this._timelineStateList.indexOf(e);this._timelineStateList.splice(i,1);t.TimelineState._returnObject(e)};p.addSlotTimelineState=function(e){var i=this._armature.getSlot(e);if(i){for(var n=0,r=this._slotTimelineStateList.length;n<r;n++){var o=this._slotTimelineStateList[n];if(o.name==e){return}}var a=t.SlotTimelineState._borrowObject();a._fadeIn(i,this,this._clip.getSlotTimeline(e));this._slotTimelineStateList.push(a)}};p.removeSlotTimelineState=function(e){var i=this._slotTimelineStateList.indexOf(e);this._slotTimelineStateList.splice(i,1);t.SlotTimelineState._returnObject(e)};p.play=function(){this._isPlaying=true;return this};p.stop=function(){this._isPlaying=false;return this};p._fadeIn=function(t,e,i,n,r,o){this._armature=t;this._clip=e;this._pausePlayheadInFade=o;this._name=this._clip.name;this._totalTime=this._clip.duration;this.autoTween=this._clip.autoTween;this.setTimeScale(n);this.setPlayTimes(r);this._isComplete=false;this._currentFrameIndex=-1;this._currentPlayTimes=-1;if(Math.round(this._totalTime*this._clip.frameRate*.001)<2||n==Infinity){this._currentTime=this._totalTime}else{this._currentTime=-1}this._time=0;this._boneMasks.length=0;this._isFadeOut=false;this._fadeWeight=0;this._fadeTotalWeight=1;this._fadeState=-1;this._fadeCurrentTime=0;this._fadeBeginTime=this._fadeCurrentTime;this._fadeTotalTime=i*this._timeScale;this._isPlaying=true;this.displayControl=true;this.lastFrameAutoTween=true;this.additiveBlending=false;this.weight=1;this.fadeOutTime=i;this._updateTimelineStates();return this};p.fadeOut=function(t,e){if(!this._armature){return null}if(isNaN(t)||t<0){t=0}this._pausePlayheadInFade=e;if(this._isFadeOut){if(t>this._fadeTotalTime/this._timeScale-(this._fadeCurrentTime-this._fadeBeginTime)){return this}}else{for(var i=0,n=this._timelineStateList.length;i<n;i++){var r=this._timelineStateList[i];r._fadeOut()}}this._isFadeOut=true;this._fadeTotalWeight=this._fadeWeight;this._fadeState=-1;this._fadeBeginTime=this._fadeCurrentTime;this._fadeTotalTime=this._fadeTotalWeight>=0?t*this._timeScale:0;this.displayControl=false;return this};p._advanceTime=function(t){t*=this._timeScale;this.advanceFadeTime(t);if(this._fadeWeight){this.advanceTimelinesTime(t)}return this._isFadeOut&&this._fadeState==1};p.advanceFadeTime=function(e){var i=false;var n=false;if(this._fadeBeginTime>=0){var r=this._fadeState;this._fadeCurrentTime+=e<0?-e:e;if(this._fadeCurrentTime>=this._fadeBeginTime+this._fadeTotalTime){if(this._fadeWeight==1||this._fadeWeight==0){r=1;if(this._pausePlayheadInFade){this._pausePlayheadInFade=false;this._currentTime=-1}}this._fadeWeight=this._isFadeOut?0:1}else if(this._fadeCurrentTime>=this._fadeBeginTime){r=0;this._fadeWeight=(this._fadeCurrentTime-this._fadeBeginTime)/this._fadeTotalTime*this._fadeTotalWeight;if(this._isFadeOut){this._fadeWeight=this._fadeTotalWeight-this._fadeWeight}}else{r=-1;this._fadeWeight=this._isFadeOut?1:0}if(this._fadeState!=r){if(this._fadeState==-1){i=true}if(r==1){n=true}this._fadeState=r}}var o;if(i){if(this._isFadeOut){if(this._armature.hasEventListener(t.AnimationEvent.FADE_OUT)){o=new t.AnimationEvent(t.AnimationEvent.FADE_OUT);o.animationState=this;this._armature._eventList.push(o)}}else{this.hideBones();if(this._armature.hasEventListener(t.AnimationEvent.FADE_IN)){o=new t.AnimationEvent(t.AnimationEvent.FADE_IN);o.animationState=this;this._armature._eventList.push(o)}}}if(n){if(this._isFadeOut){if(this._armature.hasEventListener(t.AnimationEvent.FADE_OUT_COMPLETE)){o=new t.AnimationEvent(t.AnimationEvent.FADE_OUT_COMPLETE);o.animationState=this;this._armature._eventList.push(o)}}else{if(this._armature.hasEventListener(t.AnimationEvent.FADE_IN_COMPLETE)){o=new t.AnimationEvent(t.AnimationEvent.FADE_IN_COMPLETE);o.animationState=this;this._armature._eventList.push(o)}}}};p.advanceTimelinesTime=function(e){if(this._isPlaying&&!this._pausePlayheadInFade){this._time+=e}var i=false;var n=false;var r=false;var o=false;var a=0;var s=this._time*1e3;if(this._playTimes==0){o=false;a=Math.ceil(Math.abs(s)/this._totalTime)||1;if(s>=0){s-=Math.floor(s/this._totalTime)*this._totalTime}else{s-=Math.ceil(s/this._totalTime)*this._totalTime}if(s<0){s+=this._totalTime}}else{var l=this._playTimes*this._totalTime;if(s>=l){s=l;o=true}else if(s<=-l){s=-l;o=true}else{o=false}if(s<0){s+=l}a=Math.ceil(s/this._totalTime)||1;if(s>=0){s-=Math.floor(s/this._totalTime)*this._totalTime}else{s-=Math.ceil(s/this._totalTime)*this._totalTime}if(o){s=this._totalTime}}this._isComplete=o;var h=this._time*1e3/this._totalTime;var u=0;var p=0;for(u=0,p=this._timelineStateList.length;u<p;u++){var c=this._timelineStateList[u];c._update(h);this._isComplete=c._isComplete&&this._isComplete}for(u=0,p=this._slotTimelineStateList.length;u<p;u++){var f=this._slotTimelineStateList[u];f._update(h);this._isComplete=c._isComplete&&this._isComplete}if(this._currentTime!=s){if(this._currentPlayTimes!=a){if(this._currentPlayTimes>0&&a>1){r=true}this._currentPlayTimes=a}if(this._currentTime<0){i=true}if(this._isComplete){n=true}this._lastTime=this._currentTime;this._currentTime=s;this.updateMainTimeline(o)}var m;if(i){if(this._armature.hasEventListener(t.AnimationEvent.START)){m=new t.AnimationEvent(t.AnimationEvent.START);m.animationState=this;this._armature._eventList.push(m)}}if(n){if(this._armature.hasEventListener(t.AnimationEvent.COMPLETE)){m=new t.AnimationEvent(t.AnimationEvent.COMPLETE);m.animationState=this;this._armature._eventList.push(m)}if(this.autoFadeOut){this.fadeOut(this.fadeOutTime,true)}}else if(r){if(this._armature.hasEventListener(t.AnimationEvent.LOOP_COMPLETE)){m=new t.AnimationEvent(t.AnimationEvent.LOOP_COMPLETE);m.animationState=this;this._armature._eventList.push(m)}}};p.updateMainTimeline=function(t){var e=this._clip.frameList;if(e.length>0){var i;var n;for(var r=0,o=this._clip.frameList.length;r<o;++r){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration||this._currentTime<this._lastTime){this._currentFrameIndex++;this._lastTime=this._currentTime;if(this._currentFrameIndex>=e.length){if(t){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}n=e[this._currentFrameIndex];if(i){this._armature._arriveAtFrame(i,null,this,true)}this._currentFrameDuration=n.duration;this._currentFramePosition=n.position;i=n}if(n){this._armature._arriveAtFrame(n,null,this,false)}}};p.hideBones=function(){for(var t=0,e=this._clip.hideTimelineNameMap.length;t<e;t++){var i=this._clip.hideTimelineNameMap[t];var n=this._armature.getBone(i);if(n){n._hideSlots()}}var r;for(t=0,e=this._clip.hideSlotTimelineNameMap.length;t<e;t++){r=this._clip.hideSlotTimelineNameMap[t];var o=this._armature.getSlot(r);if(o){o._resetToOrigin()}}};p.setAdditiveBlending=function(t){this.additiveBlending=t;return this};p.setAutoFadeOut=function(t,e){if(e===void 0){e=-1}this.autoFadeOut=t;if(e>=0){this.fadeOutTime=e*this._timeScale}return this};p.setWeight=function(t){if(isNaN(t)||t<0){t=1}this.weight=t;return this};p.setFrameTween=function(t,e){this.autoTween=t;this.lastFrameAutoTween=e;return this};p.setCurrentTime=function(t){if(t<0||isNaN(t)){t=0}this._time=t;this._currentTime=this._time*1e3;return this};p.setTimeScale=function(t){if(isNaN(t)||t==Infinity){t=1}this._timeScale=t;return this};p.setPlayTimes=function(t){if(t===void 0){t=0}if(Math.round(this._totalTime*.001*this._clip.frameRate)<2){this._playTimes=t<0?-1:1}else{this._playTimes=t<0?-t:t}this.autoFadeOut=t<0?true:false;return this};i(p,"name",function(){return this._name});i(p,"layer",function(){return this._layer});i(p,"group",function(){return this._group});i(p,"clip",function(){return this._clip});i(p,"isComplete",function(){return this._isComplete});i(p,"isPlaying",function(){return this._isPlaying&&!this._isComplete});i(p,"currentPlayTimes",function(){return this._currentPlayTimes<0?0:this._currentPlayTimes});i(p,"totalTime",function(){return this._totalTime*.001});i(p,"currentTime",function(){return this._currentTime<0?0:this._currentTime*.001});i(p,"fadeWeight",function(){return this._fadeWeight});i(p,"fadeState",function(){return this._fadeState});i(p,"fadeTotalTime",function(){return this._fadeTotalTime});i(p,"timeScale",function(){return this._timeScale});i(p,"playTimes",function(){return this._playTimes});e._pool=[];return e}();t.AnimationState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._totalTime=0;this._currentTime=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._updateMode=0;this._durationColor=new t.ColorTransform}var i=__define,n=e;p=n.prototype;e._borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e._returnObject=function(t){if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}t.clear()};e._clear=function(){var t=e._pool.length;while(t--){e._pool[t].clear()}e._pool.length=0};p.clear=function(){if(this._slot){this._slot._removeState(this);this._slot=null}this._armature=null;this._animation=null;this._animationState=null;this._timelineData=null};p._fadeIn=function(t,e,i){this._slot=t;this._armature=this._slot.armature;this._animation=this._armature.animation;this._animationState=e;this._timelineData=i;this.name=i.name;this._totalTime=this._timelineData.duration;this._rawAnimationScale=this._animationState.clip.scale;this._isComplete=false;this._blendEnabled=false;this._tweenColor=false;this._currentFrameIndex=-1;this._currentTime=-1;this._tweenEasing=NaN;this._weight=1;switch(this._timelineData.frameList.length){case 0:this._updateMode=0;break;case 1:this._updateMode=1;break;default:this._updateMode=-1;break}this._slot._addState(this)};p._fadeOut=function(){};p._update=function(t){if(this._updateMode==-1){this.updateMultipleFrame(t)}else if(this._updateMode==1){this._updateMode=0;this.updateSingleFrame()}};p.updateMultipleFrame=function(t){var e=0;t/=this._timelineData.scale;t+=this._timelineData.offset;var i=this._totalTime*t;var n=this._animationState.playTimes;if(n==0){this._isComplete=false;e=Math.ceil(Math.abs(i)/this._totalTime)||1;if(i>=0){i-=Math.floor(i/this._totalTime)*this._totalTime}else{i-=Math.ceil(i/this._totalTime)*this._totalTime}if(i<0){i+=this._totalTime}}else{var r=n*this._totalTime;if(i>=r){i=r;this._isComplete=true}else if(i<=-r){i=-r;this._isComplete=true}else{this._isComplete=false}if(i<0){i+=r}e=Math.ceil(i/this._totalTime)||1;if(this._isComplete){i=this._totalTime}else{if(i>=0){i-=Math.floor(i/this._totalTime)*this._totalTime}else{i-=Math.ceil(i/this._totalTime)*this._totalTime}}}if(this._currentTime!=i){this._currentTime=i;var o=this._timelineData.frameList;var a;var s;for(var l=0,h=this._timelineData.frameList.length;l<h;++l){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration){this._currentFrameIndex++;if(this._currentFrameIndex>=o.length){if(this._isComplete){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}s=o[this._currentFrameIndex];if(a){this._slot._arriveAtFrame(a,this,this._animationState,true)}this._currentFrameDuration=s.duration;this._currentFramePosition=s.position;a=s}if(s){this._slot._arriveAtFrame(s,this,this._animationState,false);this._blendEnabled=s.displayIndex>=0;if(this._blendEnabled){this.updateToNextFrame(e)}else{this._tweenEasing=NaN;this._tweenColor=false}}if(this._blendEnabled){this.updateTween()}}};p.updateToNextFrame=function(t){if(t===void 0){t=0}var e=this._currentFrameIndex+1;if(e>=this._timelineData.frameList.length){e=0}var i=this._timelineData.frameList[this._currentFrameIndex];var n=this._timelineData.frameList[e];var r=false;if(e==0&&(!this._animationState.lastFrameAutoTween||this._animationState.playTimes&&this._animationState.currentPlayTimes>=this._animationState.playTimes&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+t-this._timelineData.offset)*this._timelineData.scale>.999999)){this._tweenEasing=NaN;r=false}else if(i.displayIndex<0||n.displayIndex<0){this._tweenEasing=NaN;r=false}else if(this._animationState.autoTween){this._tweenEasing=this._animationState.clip.tweenEasing;if(isNaN(this._tweenEasing)){this._tweenEasing=i.tweenEasing;this._tweenCurve=i.curve;if(isNaN(this._tweenEasing)&&this._tweenCurve==null){r=false}else{if(this._tweenEasing==10){this._tweenEasing=0}r=true}}else{r=true}}else{this._tweenEasing=i.tweenEasing;this._tweenCurve=i.curve;if((isNaN(this._tweenEasing)||this._tweenEasing==10)&&this._tweenCurve==null){this._tweenEasing=NaN;r=false}else{r=true}}if(r){if(i.color&&n.color){this._durationColor.alphaOffset=n.color.alphaOffset-i.color.alphaOffset;this._durationColor.redOffset=n.color.redOffset-i.color.redOffset;this._durationColor.greenOffset=n.color.greenOffset-i.color.greenOffset;this._durationColor.blueOffset=n.color.blueOffset-i.color.blueOffset;this._durationColor.alphaMultiplier=n.color.alphaMultiplier-i.color.alphaMultiplier;this._durationColor.redMultiplier=n.color.redMultiplier-i.color.redMultiplier;this._durationColor.greenMultiplier=n.color.greenMultiplier-i.color.greenMultiplier;this._durationColor.blueMultiplier=n.color.blueMultiplier-i.color.blueMultiplier;if(this._durationColor.alphaOffset||this._durationColor.redOffset||this._durationColor.greenOffset||this._durationColor.blueOffset||this._durationColor.alphaMultiplier||this._durationColor.redMultiplier||this._durationColor.greenMultiplier||this._durationColor.blueMultiplier){this._tweenColor=true}else{this._tweenColor=false}}else if(i.color){this._tweenColor=true;this._durationColor.alphaOffset=-i.color.alphaOffset;this._durationColor.redOffset=-i.color.redOffset;this._durationColor.greenOffset=-i.color.greenOffset;this._durationColor.blueOffset=-i.color.blueOffset;this._durationColor.alphaMultiplier=1-i.color.alphaMultiplier;this._durationColor.redMultiplier=1-i.color.redMultiplier;this._durationColor.greenMultiplier=1-i.color.greenMultiplier;this._durationColor.blueMultiplier=1-i.color.blueMultiplier}else if(n.color){this._tweenColor=true;this._durationColor.alphaOffset=n.color.alphaOffset;this._durationColor.redOffset=n.color.redOffset;this._durationColor.greenOffset=n.color.greenOffset;this._durationColor.blueOffset=n.color.blueOffset;this._durationColor.alphaMultiplier=n.color.alphaMultiplier-1;this._durationColor.redMultiplier=n.color.redMultiplier-1;this._durationColor.greenMultiplier=n.color.greenMultiplier-1;this._durationColor.blueMultiplier=n.color.blueMultiplier-1}else{this._tweenColor=false}}else{this._tweenColor=false}if(!this._tweenColor&&this._animationState.displayControl){if(i.color){this._slot._updateDisplayColor(i.color.alphaOffset,i.color.redOffset,i.color.greenOffset,i.color.blueOffset,i.color.alphaMultiplier,i.color.redMultiplier,i.color.greenMultiplier,i.color.blueMultiplier,true)}else if(this._slot._isColorChanged){this._slot._updateDisplayColor(0,0,0,0,1,1,1,1,false)}}};p.updateTween=function(){var e=this._timelineData.frameList[this._currentFrameIndex];if(this._tweenColor&&this._animationState.displayControl){var i=(this._currentTime-this._currentFramePosition)/this._currentFrameDuration;if(this._tweenCurve!=null){i=this._tweenCurve.getValueByProgress(i)}else if(this._tweenEasing){i=t.MathUtil.getEaseValue(i,this._tweenEasing)}if(e.color){this._slot._updateDisplayColor(e.color.alphaOffset+this._durationColor.alphaOffset*i,e.color.redOffset+this._durationColor.redOffset*i,e.color.greenOffset+this._durationColor.greenOffset*i,e.color.blueOffset+this._durationColor.blueOffset*i,e.color.alphaMultiplier+this._durationColor.alphaMultiplier*i,e.color.redMultiplier+this._durationColor.redMultiplier*i,e.color.greenMultiplier+this._durationColor.greenMultiplier*i,e.color.blueMultiplier+this._durationColor.blueMultiplier*i,true)}else{this._slot._updateDisplayColor(this._durationColor.alphaOffset*i,this._durationColor.redOffset*i,this._durationColor.greenOffset*i,this._durationColor.blueOffset*i,1+this._durationColor.alphaMultiplier*i,1+this._durationColor.redMultiplier*i,1+this._durationColor.greenMultiplier*i,1+this._durationColor.blueMultiplier*i,true)}}};p.updateSingleFrame=function(){var t=this._timelineData.frameList[0];this._slot._arriveAtFrame(t,this,this._animationState,false);this._isComplete=true;this._tweenEasing=NaN;this._tweenColor=false;this._blendEnabled=t.displayIndex>=0;if(this._blendEnabled){if(this._animationState.displayControl){if(t.color){this._slot._updateDisplayColor(t.color.alphaOffset,t.color.redOffset,t.color.greenOffset,t.color.blueOffset,t.color.alphaMultiplier,t.color.redMultiplier,t.color.greenMultiplier,t.color.blueMultiplier,true)}else if(this._slot._isColorChanged){this._slot._updateDisplayColor(0,0,0,0,1,1,1,1,false)}}}};e.HALF_PI=Math.PI*.5;e.DOUBLE_PI=Math.PI*2;e._pool=[];return e}();t.SlotTimelineState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._totalTime=0;this._currentTime=0;this._lastTime=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._updateMode=0;this._transform=new t.DBTransform;this._pivot=new t.Point;this._durationTransform=new t.DBTransform;this._durationPivot=new t.Point;this._durationColor=new t.ColorTransform}var i=__define,n=e;p=n.prototype;e._borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e._returnObject=function(t){if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}t.clear()};e._clear=function(){var t=e._pool.length;while(t--){e._pool[t].clear()}e._pool.length=0};p.clear=function(){if(this._bone){this._bone._removeState(this);this._bone=null}this._armature=null;this._animation=null;this._animationState=null;this._timelineData=null;this._originTransform=null;this._originPivot=null};p._fadeIn=function(t,e,i){this._bone=t;this._armature=this._bone.armature;this._animation=this._armature.animation;this._animationState=e;this._timelineData=i;this._originTransform=this._timelineData.originTransform;this._originPivot=this._timelineData.originPivot;this.name=i.name;this._totalTime=this._timelineData.duration;this._rawAnimationScale=this._animationState.clip.scale;this._isComplete=false;this._tweenTransform=false;this._tweenScale=false;this._currentFrameIndex=-1;this._currentTime=-1;this._tweenEasing=NaN;this._weight=1;this._transform.x=0;this._transform.y=0;this._transform.scaleX=1;this._transform.scaleY=1;this._transform.skewX=0;this._transform.skewY=0;this._pivot.x=0;this._pivot.y=0;this._durationTransform.x=0;this._durationTransform.y=0;this._durationTransform.scaleX=1;this._durationTransform.scaleY=1;this._durationTransform.skewX=0;this._durationTransform.skewY=0;this._durationPivot.x=0;this._durationPivot.y=0;switch(this._timelineData.frameList.length){case 0:this._updateMode=0;break;case 1:this._updateMode=1;break;default:this._updateMode=-1;break}this._bone._addState(this)};p._fadeOut=function(){this._transform.skewX=t.TransformUtil.formatRadian(this._transform.skewX);this._transform.skewY=t.TransformUtil.formatRadian(this._transform.skewY)};p._update=function(t){if(this._updateMode==-1){this.updateMultipleFrame(t)}else if(this._updateMode==1){this._updateMode=0;this.updateSingleFrame()}};p.updateMultipleFrame=function(t){var e=0;t/=this._timelineData.scale;t+=this._timelineData.offset;var i=this._totalTime*t;var n=this._animationState.playTimes;if(n==0){this._isComplete=false;e=Math.ceil(Math.abs(i)/this._totalTime)||1;if(i>=0){i-=Math.floor(i/this._totalTime)*this._totalTime}else{i-=Math.ceil(i/this._totalTime)*this._totalTime}if(i<0){i+=this._totalTime}}else{var r=n*this._totalTime;if(i>=r){i=r;this._isComplete=true}else if(i<=-r){i=-r;this._isComplete=true}else{this._isComplete=false}if(i<0){i+=r}e=Math.ceil(i/this._totalTime)||1;if(this._isComplete){i=this._totalTime}else{if(i>=0){i-=Math.floor(i/this._totalTime)*this._totalTime}else{i-=Math.ceil(i/this._totalTime)*this._totalTime}}}if(this._currentTime!=i){this._lastTime=this._currentTime;this._currentTime=i;var o=this._timelineData.frameList;var a;var s;for(var l=0,h=this._timelineData.frameList.length;l<h;++l){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration||this._currentTime<this._lastTime){this._currentFrameIndex++;this._lastTime=this._currentTime;if(this._currentFrameIndex>=o.length){if(this._isComplete){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}s=o[this._currentFrameIndex];if(a){this._bone._arriveAtFrame(a,this,this._animationState,true)}this._currentFrameDuration=s.duration;this._currentFramePosition=s.position;a=s}if(s){this._bone._arriveAtFrame(s,this,this._animationState,false);this.updateToNextFrame(e)}this.updateTween()}};p.updateToNextFrame=function(e){if(e===void 0){e=0}var i=this._currentFrameIndex+1;if(i>=this._timelineData.frameList.length){i=0}var n=this._timelineData.frameList[this._currentFrameIndex];var r=this._timelineData.frameList[i];var o=false;if(i==0&&(!this._animationState.lastFrameAutoTween||this._animationState.playTimes&&this._animationState.currentPlayTimes>=this._animationState.playTimes&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+e-this._timelineData.offset)*this._timelineData.scale>.999999)){this._tweenEasing=NaN;o=false}else if(n.displayIndex<0||r.displayIndex<0){this._tweenEasing=NaN;o=false}else if(this._animationState.autoTween){this._tweenEasing=this._animationState.clip.tweenEasing;if(isNaN(this._tweenEasing)){this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if(isNaN(this._tweenEasing)&&this._tweenCurve==null){o=false}else{if(this._tweenEasing==10){this._tweenEasing=0}o=true}}else{o=true}}else{this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if((isNaN(this._tweenEasing)||this._tweenEasing==10)&&this._tweenCurve==null){this._tweenEasing=NaN;o=false}else{o=true}}if(o){this._durationTransform.x=r.transform.x-n.transform.x;this._durationTransform.y=r.transform.y-n.transform.y;this._durationTransform.skewX=r.transform.skewX-n.transform.skewX;this._durationTransform.skewY=r.transform.skewY-n.transform.skewY;this._durationTransform.scaleX=r.transform.scaleX-n.transform.scaleX+r.scaleOffset.x;this._durationTransform.scaleY=r.transform.scaleY-n.transform.scaleY+r.scaleOffset.y;this._durationTransform.normalizeRotation();if(i==0){this._durationTransform.skewX=t.TransformUtil.formatRadian(this._durationTransform.skewX);this._durationTransform.skewY=t.TransformUtil.formatRadian(this._durationTransform.skewY)}this._durationPivot.x=r.pivot.x-n.pivot.x;this._durationPivot.y=r.pivot.y-n.pivot.y;if(this._durationTransform.x||this._durationTransform.y||this._durationTransform.skewX||this._durationTransform.skewY||this._durationTransform.scaleX||this._durationTransform.scaleY||this._durationPivot.x||this._durationPivot.y){this._tweenTransform=true;this._tweenScale=n.tweenScale}else{this._tweenTransform=false;this._tweenScale=false}}else{this._tweenTransform=false;this._tweenScale=false}if(!this._tweenTransform){if(this._animationState.additiveBlending){this._transform.x=n.transform.x;this._transform.y=n.transform.y;this._transform.skewX=n.transform.skewX;this._transform.skewY=n.transform.skewY;this._transform.scaleX=n.transform.scaleX;this._transform.scaleY=n.transform.scaleY;this._pivot.x=n.pivot.x;this._pivot.y=n.pivot.y}else{this._transform.x=this._originTransform.x+n.transform.x;this._transform.y=this._originTransform.y+n.transform.y;this._transform.skewX=this._originTransform.skewX+n.transform.skewX;this._transform.skewY=this._originTransform.skewY+n.transform.skewY;this._transform.scaleX=this._originTransform.scaleX*n.transform.scaleX;this._transform.scaleY=this._originTransform.scaleY*n.transform.scaleY;this._pivot.x=this._originPivot.x+n.pivot.x;this._pivot.y=this._originPivot.y+n.pivot.y}this._bone.invalidUpdate()}else if(!this._tweenScale){if(this._animationState.additiveBlending){this._transform.scaleX=n.transform.scaleX;this._transform.scaleY=n.transform.scaleY}else{this._transform.scaleX=this._originTransform.scaleX*n.transform.scaleX;this._transform.scaleY=this._originTransform.scaleY*n.transform.scaleY}}};p.updateTween=function(){var e=this._timelineData.frameList[this._currentFrameIndex];if(this._tweenTransform){var i=(this._currentTime-this._currentFramePosition)/this._currentFrameDuration;if(this._tweenCurve!=null){i=this._tweenCurve.getValueByProgress(i)}else if(this._tweenEasing){i=t.MathUtil.getEaseValue(i,this._tweenEasing)}var n=e.transform;var r=e.pivot;if(this._animationState.additiveBlending){this._transform.x=n.x+this._durationTransform.x*i;this._transform.y=n.y+this._durationTransform.y*i;this._transform.skewX=n.skewX+this._durationTransform.skewX*i;this._transform.skewY=n.skewY+this._durationTransform.skewY*i;if(this._tweenScale){this._transform.scaleX=n.scaleX+this._durationTransform.scaleX*i;this._transform.scaleY=n.scaleY+this._durationTransform.scaleY*i}this._pivot.x=r.x+this._durationPivot.x*i;this._pivot.y=r.y+this._durationPivot.y*i}else{this._transform.x=this._originTransform.x+n.x+this._durationTransform.x*i;this._transform.y=this._originTransform.y+n.y+this._durationTransform.y*i;this._transform.skewX=this._originTransform.skewX+n.skewX+this._durationTransform.skewX*i;this._transform.skewY=this._originTransform.skewY+n.skewY+this._durationTransform.skewY*i;if(this._tweenScale){this._transform.scaleX=this._originTransform.scaleX*n.scaleX+this._durationTransform.scaleX*i;this._transform.scaleY=this._originTransform.scaleY*n.scaleY+this._durationTransform.scaleY*i}this._pivot.x=this._originPivot.x+r.x+this._durationPivot.x*i;this._pivot.y=this._originPivot.y+r.y+this._durationPivot.y*i}this._bone.invalidUpdate()}};p.updateSingleFrame=function(){var t=this._timelineData.frameList[0];this._bone._arriveAtFrame(t,this,this._animationState,false);this._isComplete=true;this._tweenEasing=NaN;this._tweenTransform=false;this._tweenScale=false;this._tweenColor=false;if(this._animationState.additiveBlending){this._transform.x=t.transform.x;this._transform.y=t.transform.y;this._transform.skewX=t.transform.skewX;this._transform.skewY=t.transform.skewY;this._transform.scaleX=t.transform.scaleX;this._transform.scaleY=t.transform.scaleY;this._pivot.x=t.pivot.x;this._pivot.y=t.pivot.y}else{this._transform.x=this._originTransform.x+t.transform.x;this._transform.y=this._originTransform.y+t.transform.y;this._transform.skewX=this._originTransform.skewX+t.transform.skewX;this._transform.skewY=this._originTransform.skewY+t.transform.skewY;this._transform.scaleX=this._originTransform.scaleX*t.transform.scaleX;this._transform.scaleY=this._originTransform.scaleY*t.transform.scaleY;this._pivot.x=this._originPivot.x+t.pivot.x;this._pivot.y=this._originPivot.y+t.pivot.y}this._bone.invalidUpdate()};e.HALF_PI=Math.PI*.5;e.DOUBLE_PI=Math.PI*2;e._pool=[];return e}();t.TimelineState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e){if(t===void 0){t=-1}if(e===void 0){e=1}this._time=t>=0?t:(new Date).getTime()*.001;this._timeScale=isNaN(e)?1:e;this._animatableList=[]}var e=__define,i=t;p=i.prototype;e(p,"time",function(){return this._time});e(p,"timeScale",function(){return this._timeScale},function(t){if(isNaN(t)||t<0){t=1}this._timeScale=t});p.contains=function(t){return this._animatableList.indexOf(t)>=0};p.add=function(t){if(t&&this._animatableList.indexOf(t)==-1){this._animatableList.push(t)}};p.remove=function(t){var e=this._animatableList.indexOf(t);if(e>=0){this._animatableList[e]=null}};p.clear=function(){this._animatableList.length=0};p.advanceTime=function(t){if(t===void 0){t=-1}if(t<0){t=(new Date).getTime()*.001-this._time}t*=this._timeScale;this._time+=t;var e=this._animatableList.length;if(e==0){return}var i=0;for(var n=0;n<e;n++){var r=this._animatableList[n];if(r){if(i!=n){this._animatableList[i]=r;this._animatableList[n]=null}r.advanceTime(t);i++}}if(i!=n){e=this._animatableList.length;while(n<e){this._animatableList[i++]=this._animatableList[n++]}this._animatableList.length=i}};t.clock=new t;return t}();t.WorldClock=e})(dragonBones||(dragonBones={}));var __extends=this.__extends||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i];function n(){this.constructor=t}n.prototype=e.prototype;t.prototype=new n};var dragonBones;(function(t){var e=function(){function t(){}t.prototype.hasEventListener=function(t){if(this._listenersMap&&this._listenersMap[t]){return true}return false};t.prototype.addEventListener=function(t,e){if(t&&e){if(!this._listenersMap){this._listenersMap={}}var i=this._listenersMap[t];if(i){this.removeEventListener(t,e)}if(i){i.push(e)}else{this._listenersMap[t]=[e]}}};t.prototype.removeEventListener=function(t,e){if(!this._listenersMap||!t||!e){return}var i=this._listenersMap[t];if(i){var n=i.length;for(var r=0;r<n;r++){if(i[r].toString()===e.toString()){if(n==1){i.length=0}else{i.splice(r,1)}}}}};t.prototype.removeAllEventListeners=function(t){if(t){delete this._listenersMap[t]}else{this._listenersMap=null}};t.prototype.dispatchEvent=function(t){if(t){var e=this._listenersMap[t.type];if(e){t.target=this;var i=e.concat();var n=e.length;for(var r=0;r<n;r++){i[r](t)}}}};return t}();t.EventDispatcher=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);if(e._instance){throw new Error("Singleton already constructed!")}}var i=__define,n=e;p=n.prototype;e.getInstance=function(){if(!e._instance){e._instance=new e}return e._instance};return e}(t.EventDispatcher);t.SoundEventManager=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(i){e.call(this);this._display=i;this._animation=new t.Animation(this);this._slotsZOrderChanged=false;this._slotList=[];this._boneList=[];this._eventList=[];this._delayDispose=false;this._lockDispose=false;this._armatureData=null}var n=__define,r=i;p=r.prototype;n(p,"armatureData",function(){return this._armatureData});n(p,"display",function(){return this._display});p.getDisplay=function(){return this._display};n(p,"animation",function(){return this._animation});p.dispose=function(){this._delayDispose=true;if(!this._animation||this._lockDispose){return}this.userData=null;this._animation.dispose();var t=this._slotList.length;while(t--){this._slotList[t].dispose()}t=this._boneList.length;while(t--){this._boneList[t].dispose()}this._armatureData=null;this._animation=null;this._slotList=null;this._boneList=null;this._eventList=null};p.invalidUpdate=function(t){if(t===void 0){t=null}if(t){var e=this.getBone(t);if(e){e.invalidUpdate()}}else{var i=this._boneList.length;while(i--){this._boneList[i].invalidUpdate()}}};p.advanceTime=function(e){this._lockDispose=true;this._animation._advanceTime(e);e*=this._animation.timeScale;var i=this._animation._isFading;var n=this._boneList.length;while(n--){var r=this._boneList[n];r._update(i)}n=this._slotList.length;while(n--){var o=this._slotList[n];o._update();if(o._isShowDisplay){var a=o.childArmature;if(a){a.advanceTime(e)}}}if(this._slotsZOrderChanged){this.updateSlotsZOrder();if(this.hasEventListener(t.ArmatureEvent.Z_ORDER_UPDATED)){this.dispatchEvent(new t.ArmatureEvent(t.ArmatureEvent.Z_ORDER_UPDATED))}}if(this._eventList.length>0){for(var n=0,s=this._eventList.length;n<s;n++){var l=this._eventList[n];this.dispatchEvent(l)}this._eventList.length=0}this._lockDispose=false;if(this._delayDispose){this.dispose()}};p.resetAnimation=function(){this.animation.stop();
this.animation._resetAnimationStateList();for(var t=0,e=this._boneList.length;t<e;t++){this._boneList[t]._removeAllStates()}};p.getSlots=function(t){if(t===void 0){t=true}return t?this._slotList.concat():this._slotList};p.getSlot=function(t){var e=this._slotList.length;for(var i=0;i<e;i++){var n=this._slotList[i];if(n.name==t){return n}}return null};p.getSlotByDisplay=function(t){if(t){var e=this._slotList.length;for(var i=0;i<e;i++){var n=this._slotList[i];if(n.display==t){return n}}}return null};p.addSlot=function(t,e){var i=this.getBone(e);if(i){i.addSlot(t)}else{throw new Error}};p.removeSlot=function(t){if(!t||t.armature!=this){throw new Error}t.parent.removeSlot(t)};p.removeSlotByName=function(t){var e=this.getSlot(t);if(e){this.removeSlot(e)}return e};p.getBones=function(t){if(t===void 0){t=true}return t?this._boneList.concat():this._boneList};p.getBone=function(t){var e=this._boneList.length;for(var i=0;i<e;i++){var n=this._boneList[i];if(n.name==t){return n}}return null};p.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return e?e.parent:null};p.addBone=function(t,e,i){if(e===void 0){e=null}if(i===void 0){i=false}var n;if(e){n=this.getBone(e);if(!n){throw new Error}}if(n){n.addChildBone(t,i)}else{if(t.parent){t.parent.removeChildBone(t,i)}t._setArmature(this);if(!i){this._updateAnimationAfterBoneListChanged()}}};p.removeBone=function(t,e){if(e===void 0){e=false}if(!t||t.armature!=this){throw new Error}if(t.parent){t.parent.removeChildBone(t,e)}else{t._setArmature(null);if(!e){this._updateAnimationAfterBoneListChanged(false)}}};p.removeBoneByName=function(t){var e=this.getBone(t);if(e){this.removeBone(e)}return e};p._addBoneToBoneList=function(t){if(this._boneList.indexOf(t)<0){this._boneList[this._boneList.length]=t}};p._removeBoneFromBoneList=function(t){var e=this._boneList.indexOf(t);if(e>=0){this._boneList.splice(e,1)}};p._addSlotToSlotList=function(t){if(this._slotList.indexOf(t)<0){this._slotList[this._slotList.length]=t}};p._removeSlotFromSlotList=function(t){var e=this._slotList.indexOf(t);if(e>=0){this._slotList.splice(e,1)}};p.updateSlotsZOrder=function(){this._slotList.sort(this.sortSlot);var t=this._slotList.length;while(t--){var e=this._slotList[t];if(e._isShowDisplay){e._addDisplayToContainer(this._display)}}this._slotsZOrderChanged=false};p._updateAnimationAfterBoneListChanged=function(t){if(t===void 0){t=true}if(t){this.sortBoneList()}this._animation._updateAnimationStates()};p.sortBoneList=function(){var e=this._boneList.length;if(e==0){return}var i=[];while(e--){var n=0;var r=this._boneList[e];var o=r;while(o){n++;o=o.parent}i[e]=[n,r]}i.sort(t.ArmatureData.sortBoneDataHelpArrayDescending);e=i.length;while(e--){this._boneList[e]=i[e][1]}i.length=0};p._arriveAtFrame=function(e,n,r,o){if(e.event&&this.hasEventListener(t.FrameEvent.ANIMATION_FRAME_EVENT)){var a=new t.FrameEvent(t.FrameEvent.ANIMATION_FRAME_EVENT);a.animationState=r;a.frameLabel=e.event;this._eventList.push(a)}if(e.sound&&i._soundManager.hasEventListener(t.SoundEvent.SOUND)){var s=new t.SoundEvent(t.SoundEvent.SOUND);s.armature=this;s.animationState=r;s.sound=e.sound;i._soundManager.dispatchEvent(s)}if(e.action){if(r.displayControl){this.animation.gotoAndPlay(e.action)}}};p.sortSlot=function(t,e){return t.zOrder<e.zOrder?1:-1};p.getAnimation=function(){return this._animation};i._soundManager=t.SoundEventManager.getInstance();return i}(t.EventDispatcher);t.Armature=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0}var e=__define,i=t;p=i.prototype;p.invert=function(){var t=this.a;var e=this.b;var i=this.c;var n=this.d;var r=this.tx;var o=t*n-e*i;this.a=n/o;this.b=-e/o;this.c=-i/o;this.d=t/o;this.tx=(i*this.ty-n*r)/o;this.ty=-(t*this.ty-e*r)/o};p.concat=function(t){var e=t.a;var i=t.b;var n=t.c;var r=t.d;var o=this.tx;var a=this.ty;if(e!=1||i!=0||n!=0||r!=1){var s=this.a;var l=this.b;var h=this.c;var u=this.d;this.a=s*e+l*n;this.b=s*i+l*r;this.c=h*e+u*n;this.d=h*i+u*r}this.tx=o*e+a*n+t.tx;this.ty=o*i+a*r+t.ty};p.copyFrom=function(t){this.tx=t.tx;this.ty=t.ty;this.a=t.a;this.b=t.b;this.c=t.c;this.d=t.d};return t}();t.Matrix=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.x=0;this.y=0;this.skewX=0;this.skewY=0;this.scaleX=1;this.scaleY=1}var i=__define,n=e;p=n.prototype;i(p,"rotation",function(){return this.skewX},function(t){this.skewX=this.skewY=t});p.copy=function(t){this.x=t.x;this.y=t.y;this.skewX=t.skewX;this.skewY=t.skewY;this.scaleX=t.scaleX;this.scaleY=t.scaleY};p.add=function(t){this.x+=t.x;this.y+=t.y;this.skewX+=t.skewX;this.skewY+=t.skewY;this.scaleX*=t.scaleX;this.scaleY*=t.scaleY};p.minus=function(t){this.x-=t.x;this.y-=t.y;this.skewX-=t.skewX;this.skewY-=t.skewY;this.scaleX/=t.scaleX;this.scaleY/=t.scaleY};p.normalizeRotation=function(){this.skewX=t.TransformUtil.normalizeRotation(this.skewX);this.skewY=t.TransformUtil.normalizeRotation(this.skewY)};p.toString=function(){var t="x:"+this.x+" y:"+this.y+" skewX:"+this.skewX+" skewY:"+this.skewY+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY;return t};return e}();t.DBTransform=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._globalTransformMatrix=new t.Matrix;this._global=new t.DBTransform;this._origin=new t.DBTransform;this._offset=new t.DBTransform;this._offset.scaleX=this._offset.scaleY=1;this._visible=true;this._armature=null;this._parent=null;this.userData=null;this.inheritRotation=true;this.inheritScale=true;this.inheritTranslation=true}var i=__define,n=e;p=n.prototype;i(p,"global",function(){return this._global});i(p,"origin",function(){return this._origin});i(p,"offset",function(){return this._offset});i(p,"armature",function(){return this._armature});p._setArmature=function(t){this._armature=t};i(p,"parent",function(){return this._parent});p._setParent=function(t){this._parent=t};p.dispose=function(){this.userData=null;this._globalTransformMatrix=null;this._global=null;this._origin=null;this._offset=null;this._armature=null;this._parent=null};p._calculateRelativeParentTransform=function(){};p._calculateParentTransform=function(){if(this.parent&&(this.inheritTranslation||this.inheritRotation||this.inheritScale)){var i=this._parent._globalTransformForChild;var n=this._parent._globalTransformMatrixForChild;if(!this.inheritTranslation||!this.inheritRotation||!this.inheritScale){i=e._tempParentGlobalTransform;i.copy(this._parent._globalTransformForChild);if(!this.inheritTranslation){i.x=0;i.y=0}if(!this.inheritScale){i.scaleX=1;i.scaleY=1}if(!this.inheritRotation){i.skewX=0;i.skewY=0}n=e._tempParentGlobalTransformMatrix;t.TransformUtil.transformToMatrix(i,n,true)}return{parentGlobalTransform:i,parentGlobalTransformMatrix:n}}return null};p._updateGlobal=function(){this._calculateRelativeParentTransform();var e=this._calculateParentTransform();if(e!=null){var i=e.parentGlobalTransformMatrix;var n=e.parentGlobalTransform;var r=this._global.x;var o=this._global.y;this._global.x=i.a*r+i.c*o+i.tx;this._global.y=i.d*o+i.b*r+i.ty;if(this.inheritRotation){this._global.skewX+=n.skewX;this._global.skewY+=n.skewY}if(this.inheritScale){this._global.scaleX*=n.scaleX;this._global.scaleY*=n.scaleY}}t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix,true);return e};e._tempParentGlobalTransformMatrix=new t.Matrix;e._tempParentGlobalTransform=new t.DBTransform;return e}();t.DBObject=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this);this.applyOffsetTranslationToChild=true;this.applyOffsetRotationToChild=true;this.applyOffsetScaleToChild=false;this._needUpdate=0;this._tween=new t.DBTransform;this._tweenPivot=new t.Point;this._tween.scaleX=this._tween.scaleY=1;this._boneList=[];this._slotList=[];this._timelineStateList=[];this._needUpdate=2;this._isColorChanged=false}var n=__define,r=i;p=r.prototype;i.initWithBoneData=function(t){var e=new i;e.name=t.name;e.inheritRotation=t.inheritRotation;e.inheritScale=t.inheritScale;e.origin.copy(t.transform);return e};p.dispose=function(){if(!this._boneList){return}e.prototype.dispose.call(this);var t=this._boneList.length;while(t--){this._boneList[t].dispose()}t=this._slotList.length;while(t--){this._slotList[t].dispose()}this._tween=null;this._tweenPivot=null;this._boneList=null;this._slotList=null;this._timelineStateList=null};p.contains=function(t){if(!t){throw new Error}if(t==this){return false}var e=t;while(!(e==this||e==null)){e=e.parent}return e==this};p.addChildBone=function(t,e){if(e===void 0){e=false}if(!t){throw new Error}if(t==this||t.contains(this)){throw new Error}if(t.parent==this){return}if(t.parent){t.parent.removeChildBone(t,e)}this._boneList[this._boneList.length]=t;t._setParent(this);t._setArmature(this._armature);if(this._armature&&!e){this._armature._updateAnimationAfterBoneListChanged()}};p.removeChildBone=function(t,e){if(e===void 0){e=false}if(!t){throw new Error}var i=this._boneList.indexOf(t);if(i<0){throw new Error}this._boneList.splice(i,1);t._setParent(null);t._setArmature(null);if(this._armature&&!e){this._armature._updateAnimationAfterBoneListChanged(false)}};p.addSlot=function(t){if(!t){throw new Error}if(t.parent){t.parent.removeSlot(t)}this._slotList[this._slotList.length]=t;t._setParent(this);t.setArmature(this._armature)};p.removeSlot=function(t){if(!t){throw new Error}var e=this._slotList.indexOf(t);if(e<0){throw new Error}this._slotList.splice(e,1);t._setParent(null);t.setArmature(null)};p._setArmature=function(t){if(this._armature==t){return}if(this._armature){this._armature._removeBoneFromBoneList(this);this._armature._updateAnimationAfterBoneListChanged(false)}this._armature=t;if(this._armature){this._armature._addBoneToBoneList(this)}var e=this._boneList.length;while(e--){this._boneList[e]._setArmature(this._armature)}e=this._slotList.length;while(e--){this._slotList[e].setArmature(this._armature)}};p.getBones=function(t){if(t===void 0){t=true}return t?this._boneList.concat():this._boneList};p.getSlots=function(t){if(t===void 0){t=true}return t?this._slotList.concat():this._slotList};p.invalidUpdate=function(){this._needUpdate=2};p._calculateRelativeParentTransform=function(){this._global.scaleX=this._origin.scaleX*this._tween.scaleX*this._offset.scaleX;this._global.scaleY=this._origin.scaleY*this._tween.scaleY*this._offset.scaleY;this._global.skewX=this._origin.skewX+this._tween.skewX+this._offset.skewX;this._global.skewY=this._origin.skewY+this._tween.skewY+this._offset.skewY;this._global.x=this._origin.x+this._tween.x+this._offset.x;this._global.y=this._origin.y+this._tween.y+this._offset.y};p._update=function(e){if(e===void 0){e=false}this._needUpdate--;if(e||this._needUpdate>0||this._parent&&this._parent._needUpdate>0){this._needUpdate=1}else{return}this.blendingTimeline();var i=this._updateGlobal();var n=i?i.parentGlobalTransform:null;var r=i?i.parentGlobalTransformMatrix:null;var o=this._offset.x!=0||this._offset.y!=0;var a=this._offset.scaleX!=0||this._offset.scaleY!=0;var s=this._offset.skewX!=0||this._offset.skewY!=0;if((!o||this.applyOffsetTranslationToChild)&&(!a||this.applyOffsetScaleToChild)&&(!s||this.applyOffsetRotationToChild)){this._globalTransformForChild=this._global;this._globalTransformMatrixForChild=this._globalTransformMatrix}else{if(!this._tempGlobalTransformForChild){this._tempGlobalTransformForChild=new t.DBTransform}this._globalTransformForChild=this._tempGlobalTransformForChild;if(!this._tempGlobalTransformMatrixForChild){this._tempGlobalTransformMatrixForChild=new t.Matrix}this._globalTransformMatrixForChild=this._tempGlobalTransformMatrixForChild;this._globalTransformForChild.x=this._origin.x+this._tween.x;this._globalTransformForChild.y=this._origin.y+this._tween.y;this._globalTransformForChild.scaleX=this._origin.scaleX*this._tween.scaleX;this._globalTransformForChild.scaleY=this._origin.scaleY*this._tween.scaleY;this._globalTransformForChild.skewX=this._origin.skewX+this._tween.skewX;this._globalTransformForChild.skewY=this._origin.skewY+this._tween.skewY;if(this.applyOffsetTranslationToChild){this._globalTransformForChild.x+=this._offset.x;this._globalTransformForChild.y+=this._offset.y}if(this.applyOffsetScaleToChild){this._globalTransformForChild.scaleX*=this._offset.scaleX;this._globalTransformForChild.scaleY*=this._offset.scaleY}if(this.applyOffsetRotationToChild){this._globalTransformForChild.skewX+=this._offset.skewX;this._globalTransformForChild.skewY+=this._offset.skewY}t.TransformUtil.transformToMatrix(this._globalTransformForChild,this._globalTransformMatrixForChild,true);if(r){this._globalTransformMatrixForChild.concat(r);t.TransformUtil.matrixToTransform(this._globalTransformMatrixForChild,this._globalTransformForChild,this._globalTransformForChild.scaleX*n.scaleX>=0,this._globalTransformForChild.scaleY*n.scaleY>=0)}}};p._updateColor=function(t,e,i,n,r,o,a,s,l){var h=this._slotList.length;for(var u=0;u<h;u++){var p=this._slotList[u];p._updateDisplayColor(t,e,i,n,r,o,a,s)}this._isColorChanged=l};p._hideSlots=function(){var t=this._slotList.length;for(var e=0;e<t;e++){var i=this._slotList[e];i._changeDisplay(-1)}};p._arriveAtFrame=function(e,n,r,o){var a=r.displayControl&&(!this.displayController||this.displayController==r.name)&&r.containsBoneMask(this.name);if(a){var s=e;var l=s.displayIndex;var h;if(e.event&&this._armature.hasEventListener(t.FrameEvent.BONE_FRAME_EVENT)){var u=new t.FrameEvent(t.FrameEvent.BONE_FRAME_EVENT);u.bone=this;u.animationState=r;u.frameLabel=e.event;this._armature._eventList.push(u)}if(e.sound&&i._soundManager.hasEventListener(t.SoundEvent.SOUND)){var p=new t.SoundEvent(t.SoundEvent.SOUND);p.armature=this._armature;p.animationState=r;p.sound=e.sound;i._soundManager.dispatchEvent(p)}if(e.action){var c=this._slotList.length;for(var f=0;f<c;f++){h=this._slotList[f];var m=h.childArmature;if(m){m.animation.gotoAndPlay(e.action)}}}}};p._addState=function(t){if(this._timelineStateList.indexOf(t)<0){this._timelineStateList.push(t);this._timelineStateList.sort(this.sortState)}};p._removeState=function(t){var e=this._timelineStateList.indexOf(t);if(e>=0){this._timelineStateList.splice(e,1)}};p._removeAllStates=function(){this._timelineStateList.length=0};p.blendingTimeline=function(){var t;var e;var i;var n;var r=this._timelineStateList.length;if(r==1){t=this._timelineStateList[0];n=t._animationState.weight*t._animationState.fadeWeight;t._weight=n;e=t._transform;i=t._pivot;this._tween.x=e.x*n;this._tween.y=e.y*n;this._tween.skewX=e.skewX*n;this._tween.skewY=e.skewY*n;this._tween.scaleX=1+(e.scaleX-1)*n;this._tween.scaleY=1+(e.scaleY-1)*n;this._tweenPivot.x=i.x*n;this._tweenPivot.y=i.y*n}else if(r>1){var o=0;var a=0;var s=0;var l=0;var h=1;var u=1;var p=0;var c=0;var f=1;var m=0;var d=this._timelineStateList[r-1]._animationState.layer;var y=0;while(r--){t=this._timelineStateList[r];y=t._animationState.layer;if(d!=y){if(m>=f){t._weight=0;break}else{f-=m}}d=y;n=t._animationState.weight*t._animationState.fadeWeight*f;t._weight=n;if(n){e=t._transform;i=t._pivot;o+=e.x*n;a+=e.y*n;s+=e.skewX*n;l+=e.skewY*n;h+=(e.scaleX-1)*n;u+=(e.scaleY-1)*n;p+=i.x*n;c+=i.y*n;m+=n}}this._tween.x=o;this._tween.y=a;this._tween.skewX=s;this._tween.skewY=l;this._tween.scaleX=h;this._tween.scaleY=u;this._tweenPivot.x=p;this._tweenPivot.y=c}};p.sortState=function(t,e){return t._animationState.layer<e._animationState.layer?-1:1};n(p,"childArmature",function(){if(this.slot){return this.slot.childArmature}return null});n(p,"display",function(){if(this.slot){return this.slot.display}return null},function(t){if(this.slot){this.slot.display=t}});n(p,"node",function(){return this._offset});n(p,"visible",undefined,function(t){if(this._visible!=t){this._visible=t;var e=this._slotList.length;for(var i=0;i<e;i++){var n=this._slotList[i];n._updateDisplayVisible(this._visible)}}});n(p,"slot",function(){return this._slotList.length>0?this._slotList[0]:null});i._soundManager=t.SoundEventManager.getInstance();return i}(t.DBObject);t.Bone=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(i){e.call(this);this._currentDisplayIndex=0;if(i!=this){throw new Error(egret.getString(4001))}this._displayList=[];this._timelineStateList=[];this._currentDisplayIndex=-1;this._originZOrder=0;this._tweenZOrder=0;this._offsetZOrder=0;this._isShowDisplay=false;this._colorTransform=new t.ColorTransform;this._displayDataList=null;this._currentDisplay=null;this.inheritRotation=true;this.inheritScale=true}var n=__define,r=i;p=r.prototype;p.initWithSlotData=function(t){this.name=t.name;this.blendMode=t.blendMode;this._originZOrder=t.zOrder;this._displayDataList=t.displayDataList;this._originDisplayIndex=t.displayIndex};p.dispose=function(){if(!this._displayList){return}e.prototype.dispose.call(this);this._displayList.length=0;this._displayDataList=null;this._displayList=null;this._currentDisplay=null};p.sortState=function(t,e){return t._animationState.layer<e._animationState.layer?-1:1};p._addState=function(t){if(this._timelineStateList.indexOf(t)<0){this._timelineStateList.push(t);this._timelineStateList.sort(this.sortState)}};p._removeState=function(t){var e=this._timelineStateList.indexOf(t);if(e>=0){this._timelineStateList.splice(e,1)}};p.setArmature=function(t){if(this._armature==t){return}if(this._armature){this._armature._removeSlotFromSlotList(this)}this._armature=t;if(this._armature){this._armature._addSlotToSlotList(this);this._armature._slotsZOrderChanged=true;this._addDisplayToContainer(this._armature.display)}else{this._removeDisplayFromContainer()}};p._update=function(){if(this._parent._needUpdate<=0&&!this._needUpdate){return}this._updateGlobal();this._updateTransform();this._needUpdate=false};p._calculateRelativeParentTransform=function(){this._global.scaleX=this._origin.scaleX*this._offset.scaleX;this._global.scaleY=this._origin.scaleY*this._offset.scaleY;this._global.skewX=this._origin.skewX+this._offset.skewX;this._global.skewY=this._origin.skewY+this._offset.skewY;this._global.x=this._origin.x+this._offset.x+this._parent._tweenPivot.x;this._global.y=this._origin.y+this._offset.y+this._parent._tweenPivot.y};p.updateChildArmatureAnimation=function(){if(this.childArmature){if(this._isShowDisplay){if(this._armature&&this._armature.animation.lastAnimationState&&this.childArmature.animation.hasAnimation(this._armature.animation.lastAnimationState.name)){this.childArmature.animation.gotoAndPlay(this._armature.animation.lastAnimationState.name)}else{this.childArmature.animation.play()}}else{this.childArmature.animation.stop();this.childArmature.animation._lastAnimationState=null}}};p._changeDisplay=function(t){if(t===void 0){t=0}if(t<0){if(this._isShowDisplay){this._isShowDisplay=false;this._removeDisplayFromContainer();this.updateChildArmatureAnimation()}}else if(this._displayList.length>0){var e=this._displayList.length;if(t>=e){t=e-1}if(this._currentDisplayIndex!=t){this._isShowDisplay=true;this._currentDisplayIndex=t;this._updateSlotDisplay();this.updateChildArmatureAnimation();if(this._displayDataList&&this._displayDataList.length>0&&this._currentDisplayIndex<this._displayDataList.length){this._origin.copy(this._displayDataList[this._currentDisplayIndex].transform)}this._needUpdate=true}else if(!this._isShowDisplay){this._isShowDisplay=true;if(this._armature){this._armature._slotsZOrderChanged=true;this._addDisplayToContainer(this._armature.display)}this.updateChildArmatureAnimation()}}};p._updateSlotDisplay=function(){var e=-1;if(this._currentDisplay){e=this._getDisplayIndex();this._removeDisplayFromContainer()}var i=this._displayList[this._currentDisplayIndex];if(i){if(i instanceof t.Armature){this._currentDisplay=i.display}else{this._currentDisplay=i}}else{this._currentDisplay=null}this._updateDisplay(this._currentDisplay);if(this._currentDisplay){if(this._armature&&this._isShowDisplay){if(e<0){this._armature._slotsZOrderChanged=true;this._addDisplayToContainer(this._armature.display)}else{this._addDisplayToContainer(this._armature.display,e)}}this._updateDisplayBlendMode(this._blendMode);this._updateDisplayColor(this._colorTransform.alphaOffset,this._colorTransform.redOffset,this._colorTransform.greenOffset,this._colorTransform.blueOffset,this._colorTransform.alphaMultiplier,this._colorTransform.redMultiplier,this._colorTransform.greenMultiplier,this._colorTransform.blueMultiplier,true);this._updateDisplayVisible(this._visible);this._updateTransform()}};n(p,"visible",undefined,function(t){if(this._visible!=t){this._visible=t;this._updateDisplayVisible(this._visible)}});n(p,"displayList",function(){return this._displayList},function(t){if(!t){throw new Error}if(this._currentDisplayIndex<0){this._currentDisplayIndex=0}var e=this._displayList.length=t.length;while(e--){this._displayList[e]=t[e]}var i=this._currentDisplayIndex;this._currentDisplayIndex=-1;this._changeDisplay(i)});n(p,"display",function(){return this._currentDisplay},function(t){if(this._currentDisplayIndex<0){this._currentDisplayIndex=0}if(this._displayList[this._currentDisplayIndex]==t){return}this._displayList[this._currentDisplayIndex]=t;this._updateSlotDisplay();this.updateChildArmatureAnimation();this._updateTransform()});p.getDisplay=function(){return this.display};p.setDisplay=function(t){this.display=t};n(p,"childArmature",function(){if(this._displayList[this._currentDisplayIndex]instanceof t.Armature){return this._displayList[this._currentDisplayIndex]}return null},function(t){this.display=t});n(p,"zOrder",function(){return this._originZOrder+this._tweenZOrder+this._offsetZOrder},function(t){if(this.zOrder!=t){this._offsetZOrder=t-this._originZOrder-this._tweenZOrder;if(this._armature){this._armature._slotsZOrderChanged=true}}});n(p,"blendMode",function(){return this._blendMode},function(t){if(this._blendMode!=t){this._blendMode=t;this._updateDisplayBlendMode(this._blendMode)}});p._updateDisplay=function(t){throw new Error("")};p._getDisplayIndex=function(){throw new Error(egret.getString(4001))};p._addDisplayToContainer=function(t,e){if(e===void 0){e=-1}throw new Error(egret.getString(4001))};p._removeDisplayFromContainer=function(){throw new Error(egret.getString(4001))};p._updateTransform=function(){throw new Error(egret.getString(4001))};p._updateDisplayVisible=function(t){throw new Error(egret.getString(4001))};p._updateDisplayColor=function(t,e,i,n,r,o,a,s,l){if(l===void 0){l=false}this._colorTransform.alphaOffset=t;this._colorTransform.redOffset=e;this._colorTransform.greenOffset=i;this._colorTransform.blueOffset=n;this._colorTransform.alphaMultiplier=r;this._colorTransform.redMultiplier=o;this._colorTransform.greenMultiplier=a;this._colorTransform.blueMultiplier=s;this._isColorChanged=l};p._updateDisplayBlendMode=function(t){throw new Error("Abstract method needs to be implemented in subclass!")};p._arriveAtFrame=function(t,e,i,n){var r=i.displayControl&&i.containsBoneMask(this.parent.name);if(r){var o=t;var a=o.displayIndex;var s;this._changeDisplay(a);this._updateDisplayVisible(o.visible);if(a>=0){if(!isNaN(o.zOrder)&&o.zOrder!=this._tweenZOrder){this._tweenZOrder=o.zOrder;this._armature._slotsZOrderChanged=true}}if(t.action){if(this.childArmature){this.childArmature.animation.gotoAndPlay(t.action)}}}};p._updateGlobal=function(){this._calculateRelativeParentTransform();t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix,true);var e=this._calculateParentTransform();if(e){this._globalTransformMatrix.concat(e.parentGlobalTransformMatrix);t.TransformUtil.matrixToTransform(this._globalTransformMatrix,this._global,this._global.scaleX*e.parentGlobalTransform.scaleX>=0,this._global.scaleY*e.parentGlobalTransform.scaleY>=0)}return e};p._resetToOrigin=function(){this._changeDisplay(this._originDisplayIndex);this._updateDisplayColor(0,0,0,0,1,1,1,1,true)};return i}(t.DBObject);t.Slot=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.slotTimelineCacheList=[];this.slotTimelineCacheDic={};this.frameNum=0}var i=__define,n=e;p=n.prototype;e.initWithAnimationData=function(i,n){var r=new e;r.name=i.name;var o=i.timelineList;var a;var s;var l;var h;var u;for(var p=0,c=o.length;p<c;p++){a=o[p].name;for(var f=0,m=n.slotDataList.length;f<m;f++){l=n.slotDataList[f];u=l.name;if(l.parent==a){if(r.slotTimelineCacheDic[u]==null){h=new t.SlotTimelineCache;h.name=u;r.slotTimelineCacheList.push(h);r.slotTimelineCacheDic[u]=h}}}}return r};p.initSlotTimelineCacheDic=function(t,e){var i;for(var n in this.slotTimelineCacheDic){var r=this.slotTimelineCacheDic[n];i=r.name;r.cacheGenerator=t[i];r.currentFrameCache=e[i]}};p.bindCacheUserSlotDic=function(t){for(var e in t){this.slotTimelineCacheDic[e].bindCacheUser(t[e])}};p.addFrame=function(){this.frameNum++;var t;for(var e=0,i=this.slotTimelineCacheList.length;e<i;e++){t=this.slotTimelineCacheList[e];t.addFrame()}};p.update=function(t){var e=Math.floor(t*(this.frameNum-1));var i;for(var n=0,r=this.slotTimelineCacheList.length;n<r;n++){i=this.slotTimelineCacheList[n];i.update(e)}};return e}();t.AnimationCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.animationCacheDic={};this.slotFrameCacheDic={}}var i=__define,n=e;p=n.prototype;e.initWithArmatureData=function(t,i){if(i===void 0){i=0}var n=new e;n.armatureData=t;if(i<=0){var r=t.animationDataList[0];if(r){n.frameRate=r.frameRate}}else{n.frameRate=i}return n};p.initAllAnimationCache=function(){var e=this.armatureData.animationDataList.length;for(var i=0;i<e;i++){var n=this.armatureData.animationDataList[i];this.animationCacheDic[n.name]=t.AnimationCache.initWithAnimationData(n,this.armatureData)}};p.initAnimationCache=function(e){this.animationCacheDic[e]=t.AnimationCache.initWithAnimationData(this.armatureData.getAnimationData(e),this.armatureData)};p.bindCacheUserArmatures=function(t){var e=t.length;for(var i=0;i<e;i++){var n=t[i];this.bindCacheUserArmature(n)}};p.bindCacheUserArmature=function(t){t.animation.animationCacheManager=this;var e;for(var i in t._slotDic){e=t._slotDic[i];e.frameCache=this.slotFrameCacheDic[e.name]}};p.setCacheGeneratorArmature=function(e){this.cacheGeneratorArmature=e;var i;for(var n in e._slotDic){i=e._slotDic[n];this.slotFrameCacheDic[i.name]=new t.SlotFrameCache}for(var r in this.animationCacheDic){var o=this.animationCacheDic[r];o.initSlotTimelineCacheDic(e._slotDic,this.slotFrameCacheDic)}};p.generateAllAnimationCache=function(t){for(var e in this.animationCacheDic){var i=this.animationCacheDic[e];this.generateAnimationCache(i.name,t)}};p.generateAnimationCache=function(t,e){var i=this.cacheGeneratorArmature.enableCache;this.cacheGeneratorArmature.enableCache=false;var n=this.animationCacheDic[t];if(!n){return}var r=this.cacheGeneratorArmature.getAnimation().animationState;var o=1/this.frameRate;if(e){this.cacheGeneratorArmature.getAnimation().gotoAndPlay(t,0,-1,0)}else{this.cacheGeneratorArmature.getAnimation().gotoAndPlay(t,0,-1,1)}var a=this.cacheGeneratorArmature.enableEventDispatch;this.cacheGeneratorArmature.enableEventDispatch=false;var s;do{s=r.progress;this.cacheGeneratorArmature.advanceTime(o);n.addFrame()}while(r.progress>=s&&r.progress<1);this.cacheGeneratorArmature.enableEventDispatch=a;this.resetCacheGeneratorArmature();this.cacheGeneratorArmature.enableCache=i};p.resetCacheGeneratorArmature=function(){this.cacheGeneratorArmature.resetAnimation()};p.getAnimationCache=function(t){return this.animationCacheDic[t]};return e}();t.AnimationCacheManager=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.globalTransform=new t.DBTransform;this.globalTransformMatrix=new t.Matrix}var i=__define,n=e;p=n.prototype;p.copy=function(t){this.globalTransform=t.globalTransform;this.globalTransformMatrix=t.globalTransformMatrix};p.clear=function(){this.globalTransform=e.ORIGIN_TRAMSFORM;this.globalTransformMatrix=e.ORIGIN_MATRIX};e.ORIGIN_TRAMSFORM=new t.DBTransform;e.ORIGIN_MATRIX=new t.Matrix;return e}();t.FrameCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);this.displayIndex=-1}var i=__define,n=e;p=n.prototype;p.copy=function(e){t.prototype.copy.call(this,e);this.colorTransform=e.colorTransform;this.displayIndex=e.displayIndex};p.clear=function(){t.prototype.clear.call(this);this.colorTransform=null;this.displayIndex=-1};return e}(t.FrameCache);t.SlotFrameCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.frameCacheList=new Array}var e=__define,i=t;p=i.prototype;p.addFrame=function(){};p.update=function(t){if(t===void 0){t=0}this.currentFrameCache.copy(this.frameCacheList[t])};p.bindCacheUser=function(t){t.frameCache=this.currentFrameCache};return t}();t.TimelineCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this)}var n=__define,r=i;p=r.prototype;p.addFrame=function(){var e=new t.SlotFrameCache;e.globalTransform.copy(this.cacheGenerator.global);e.globalTransformMatrix.copyFrom(this.cacheGenerator.globalTransformMatrix);if(this.cacheGenerator.colorChanged){e.colorTransform=t.ColorTransformUtil.cloneColor(this.cacheGenerator.colorTransform)}e.displayIndex=this.cacheGenerator.displayIndex;this.frameCacheList.push(e)};return i}(t.TimelineCache);t.SlotTimelineCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){function e(t,e,i){if(e===void 0){e=false}if(i===void 0){i=false}this.bubbles=e;this.cancelable=i;this.type=t}var i=__define,n=e;p=n.prototype;return e}();t.Event=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(e,i){if(i===void 0){i=false}t.call(this,e)}var i=__define,n=e;p=n.prototype;i(e,"MOVEMENT_CHANGE",function(){return e.FADE_IN});i(p,"movementID",function(){return this.animationName});i(p,"armature",function(){return this.target});i(p,"animationName",function(){return this.animationState.name});e.FADE_IN="fadeIn";e.FADE_OUT="fadeOut";e.START="start";e.COMPLETE="complete";e.LOOP_COMPLETE="loopComplete";e.FADE_IN_COMPLETE="fadeInComplete";e.FADE_OUT_COMPLETE="fadeOutComplete";return e}(t.Event);t.AnimationEvent=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(e){t.call(this,e)}var i=__define,n=e;p=n.prototype;e.Z_ORDER_UPDATED="zOrderUpdated";return e}(t.Event);t.ArmatureEvent=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(e,i){if(i===void 0){i=false}t.call(this,e)}var i=__define,n=e;p=n.prototype;i(e,"MOVEMENT_FRAME_EVENT",function(){return e.ANIMATION_FRAME_EVENT});i(p,"armature",function(){return this.target});e.ANIMATION_FRAME_EVENT="animationFrameEvent";e.BONE_FRAME_EVENT="boneFrameEvent";return e}(t.Event);t.FrameEvent=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(e,i){if(i===void 0){i=false}t.call(this,e)}var i=__define,n=e;p=n.prototype;e.SOUND="sound";return e}(t.Event);t.SoundEvent=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(n,e);function n(t){e.call(this);this.dragonBonesDataDic={};this.textureAtlasDic={};if(t!=this){throw new Error(egret.getString(4001))}}var r=__define,o=n;p=o.prototype;p.dispose=function(t){if(t===void 0){t=true}if(t){for(var e in this.dragonBonesDataDic){this.dragonBonesDataDic[e].dispose();delete this.dragonBonesDataDic[e]}for(var i in this.textureAtlasDic){this.textureAtlasDic[i].dispose();delete this.textureAtlasDic[i]}}this.dragonBonesDataDic=null;this.textureAtlasDic=null};p.getDragonBonesData=function(t){return this.dragonBonesDataDic[t]};p.getSkeletonData=function(t){return this.getDragonBonesData(t)};p.addDragonBonesData=function(t,e){if(e===void 0){e=null}if(!t){throw new Error;
}e=e||t.name;if(!e){throw new Error(egret.getString(4002))}this.dragonBonesDataDic[e]=t};p.addSkeletonData=function(t,e){if(e===void 0){e=null}this.addDragonBonesData(t,e)};p.removeDragonBonesData=function(t){delete this.dragonBonesDataDic[t]};p.removeSkeletonData=function(t){delete this.dragonBonesDataDic[t]};p.getTextureAtlas=function(t){return this.textureAtlasDic[t]};p.addTextureAtlas=function(t,e){if(e===void 0){e=null}if(!t){throw new Error}if(!e&&t.hasOwnProperty("name")){e=t.name}if(!e){throw new Error(egret.getString(4002))}this.textureAtlasDic[e]=t};p.removeTextureAtlas=function(t){delete this.textureAtlasDic[t]};p.getTextureDisplay=function(t,e,i,n){if(e===void 0){e=null}if(i===void 0){i=NaN}if(n===void 0){n=NaN}var r;if(e){r=this.textureAtlasDic[e]}else{for(e in this.textureAtlasDic){r=this.textureAtlasDic[e];if(r.getRegion(t)){break}r=null}}if(!r){return null}if(isNaN(i)||isNaN(n)){var o=this.dragonBonesDataDic[e];o=o?o:this.findFirstDragonBonesData();if(o){var a=o.getDisplayDataByName(t);if(a){i=a.pivot.x;n=a.pivot.y}}}return this._generateDisplay(r,t,i,n)};p.buildArmature=function(t,e,i,n){if(e===void 0){e=null}if(i===void 0){i=null}if(n===void 0){n=null}var r={};if(this.fillBuildArmatureDataPackageArmatureInfo(t,e,r)){this.fillBuildArmatureDataPackageTextureInfo(i,r)}var o=r.dragonBonesData;var a=r.armatureData;var s=r.textureAtlas;if(!a||!s){return null}return this.buildArmatureUsingArmatureDataFromTextureAtlas(o,a,s,n)};p.buildFastArmature=function(t,e,n,r){if(e===void 0){e=null}if(n===void 0){n=null}if(r===void 0){r=null}var o=new i;if(this.fillBuildArmatureDataPackageArmatureInfo(t,e,o)){this.fillBuildArmatureDataPackageTextureInfo(n,o)}var a=o.dragonBonesData;var s=o.armatureData;var l=o.textureAtlas;if(!s||!l){return null}return this.buildFastArmatureUsingArmatureDataFromTextureAtlas(a,s,l,r)};p.buildArmatureUsingArmatureDataFromTextureAtlas=function(t,e,i,n){if(n===void 0){n=null}var r=this._generateArmature();r.name=e.name;r.__dragonBonesData=t;r._armatureData=e;r.animation.animationDataList=e.animationDataList;this._buildBones(r);this._buildSlots(r,n,i);r.advanceTime(0);return r};p.buildFastArmatureUsingArmatureDataFromTextureAtlas=function(t,e,i,n){if(n===void 0){n=null}var r=this._generateFastArmature();r.name=e.name;r.__dragonBonesData=t;r._armatureData=e;r.animation.animationDataList=e.animationDataList;this._buildFastBones(r);this._buildFastSlots(r,n,i);r.advanceTime(0);return r};p.copyAnimationsToArmature=function(e,i,n,r){if(n===void 0){n=null}if(r===void 0){r=true}var o={};if(!this.fillBuildArmatureDataPackageArmatureInfo(i,n,o)){return false}var a=o.armatureData;e.animation.animationDataList=a.animationDataList;var s=a.getSkinData("");var l;var h;var u=e.getSlots(false);var p;var c;var f=0;var m;var d;var y=u.length;for(var g=0;g<y;g++){p=u[g];c=p.displayList;f=c.length;for(var v=0;v<f;v++){m=c[v];if(m instanceof t.Armature){d=m;l=s.getSlotData(p.name);h=l.displayDataList[v];if(h.type==t.DisplayData.ARMATURE){this.copyAnimationsToArmature(d,h.name,o.dragonBonesDataName,r)}}}}return true};p.fillBuildArmatureDataPackageArmatureInfo=function(t,e,i){if(e){i.dragonBonesDataName=e;i.dragonBonesData=this.dragonBonesDataDic[e];i.armatureData=i.dragonBonesData.getArmatureDataByName(t);return true}else{for(e in this.dragonBonesDataDic){i.dragonBonesData=this.dragonBonesDataDic[e];i.armatureData=i.dragonBonesData.getArmatureDataByName(t);if(i.armatureData){i.dragonBonesDataName=e;return true}}}return false};p.fillBuildArmatureDataPackageTextureInfo=function(t,e){e.textureAtlas=this.textureAtlasDic[t?t:e.dragonBonesDataName]};p.findFirstDragonBonesData=function(){for(var t in this.dragonBonesDataDic){var e=this.dragonBonesDataDic[t];if(e){return e}}return null};p.findFirstTextureAtlas=function(){for(var t in this.textureAtlasDic){var e=this.textureAtlasDic[t];if(e){return e}}return null};p._buildBones=function(e){var i=e.armatureData.boneDataList;var n;var r;var o;for(var a=0;a<i.length;a++){n=i[a];r=t.Bone.initWithBoneData(n);o=n.parent;if(o&&e.armatureData.getBoneData(o)==null){o=null}e.addBone(r,o,true)}e._updateAnimationAfterBoneListChanged()};p._buildSlots=function(e,i,n){var r=e.armatureData.getSkinData(i);if(!r){return}e.armatureData.setSkinData(i);var o=[];var a=e.armatureData.slotDataList;var s;var l;var h;for(var u=0;u<a.length;u++){s=a[u];h=e.getBone(s.parent);if(!h){continue}l=this._generateSlot();l.initWithSlotData(s);h.addSlot(l);o.length=0;var p=s.displayDataList.length;while(p--){var c=s.displayDataList[p];switch(c.type){case t.DisplayData.ARMATURE:var f=this.buildArmatureUsingArmatureDataFromTextureAtlas(e.__dragonBonesData,e.__dragonBonesData.getArmatureDataByName(c.name),n,i);o[p]=f;break;case t.DisplayData.IMAGE:default:o[p]=this._generateDisplay(n,c.name,c.pivot.x,c.pivot.y);break}}for(var m=0,d=o.length;m<d;m++){var y=o[m];if(!y){continue}if(y instanceof t.Armature){y=y.display}if(y.hasOwnProperty("name")){try{y["name"]=l.name}catch(g){}}}l.displayList=o;l._changeDisplay(s.displayIndex)}};p._buildFastBones=function(e){var i=e.armatureData.boneDataList;var n;var r;for(var o=0;o<i.length;o++){n=i[o];r=t.FastBone.initWithBoneData(n);e.addBone(r,n.parent)}};p._buildFastSlots=function(e,i,n){var r=e.armatureData.getSkinData(i);if(!r){return}e.armatureData.setSkinData(i);var o=[];var a=e.armatureData.slotDataList;var s;var l;for(var h=0;h<a.length;h++){o.length=0;s=a[h];l=this._generateFastSlot();l.initWithSlotData(s);var u=s.displayDataList.length;while(u--){var p=s.displayDataList[u];switch(p.type){case t.DisplayData.ARMATURE:var c=this.buildFastArmatureUsingArmatureDataFromTextureAtlas(e.__dragonBonesData,e.__dragonBonesData.getArmatureDataByName(p.name),n,i);o[u]=c;l.hasChildArmature=true;break;case t.DisplayData.IMAGE:default:o[u]=this._generateDisplay(n,p.name,p.pivot.x,p.pivot.y);break}}var f=o.length;for(var m=0;m<f;m++){var d=o[m];if(!d){continue}if(d instanceof t.FastArmature){d=d.display}if(d.hasOwnProperty("name")){try{d["name"]=l.name}catch(y){}}}l.initDisplayList(o.concat());e.addSlot(l,s.parent);l._changeDisplayIndex(s.displayIndex)}};p._generateArmature=function(){return null};p._generateSlot=function(){return null};p._generateFastArmature=function(){return null};p._generateFastSlot=function(){return null};p._generateDisplay=function(t,e,i,n){return null};n._helpMatrix=new t.Matrix;return n}(t.EventDispatcher);t.BaseFactory=e;var i=function(){function t(){}var e=__define,i=t;p=i.prototype;return t}();t.BuildArmatureDataPackage=i})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(i){e.call(this);this.isCacheManagerExclusive=false;this._enableEventDispatch=true;this.useCache=true;this._display=i;this._animation=new t.FastAnimation(this);this._slotsZOrderChanged=false;this._armatureData=null;this.boneList=[];this._boneDic={};this.slotList=[];this._slotDic={};this.slotHasChildArmatureList=[];this._eventList=[];this._delayDispose=false;this._lockDispose=false}var n=__define,r=i;p=r.prototype;p.dispose=function(){this._delayDispose=true;if(!this._animation||this._lockDispose){return}this.userData=null;this._animation.dispose();var t=this.slotList.length;while(t--){this.slotList[t].dispose()}t=this.boneList.length;while(t--){this.boneList[t].dispose()}this.slotList.length=0;this.boneList.length=0;this._armatureData=null;this._animation=null;this.slotList=null;this.boneList=null;this._eventList=null};p.advanceTime=function(t){this._lockDispose=true;this._animation.advanceTime(t);var e;var i;var n=0;if(this._animation.animationState.isUseCache()){if(!this.useCache){this.useCache=true}n=this.slotList.length;while(n--){i=this.slotList[n];i.updateByCache()}}else{if(this.useCache){this.useCache=false;n=this.slotList.length;while(n--){i=this.slotList[n];i.switchTransformToBackup()}}n=this.boneList.length;while(n--){e=this.boneList[n];e.update()}n=this.slotList.length;while(n--){i=this.slotList[n];i._update()}}n=this.slotHasChildArmatureList.length;while(n--){i=this.slotHasChildArmatureList[n];var r=i.childArmature;if(r){r.advanceTime(t)}}if(this._slotsZOrderChanged){this.updateSlotsZOrder()}while(this._eventList.length>0){this.dispatchEvent(this._eventList.shift())}this._lockDispose=false;if(this._delayDispose){this.dispose()}};p.enableAnimationCache=function(e,i,n){if(i===void 0){i=null}if(n===void 0){n=true}var r=t.AnimationCacheManager.initWithArmatureData(this.armatureData,e);if(i){var o=i.length;for(var a=0;a<o;a++){var s=i[a];r.initAnimationCache(s)}}else{r.initAllAnimationCache()}r.setCacheGeneratorArmature(this);r.generateAllAnimationCache(n);r.bindCacheUserArmature(this);this.enableCache=true;return r};p.getBone=function(t){return this._boneDic[t]};p.getSlot=function(t){return this._slotDic[t]};p.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return e?e.parent:null};p.getSlotByDisplay=function(t){if(t){for(var e=0,i=this.slotList.length;e<i;e++){if(this.slotList[e].display==t){return this.slotList[e]}}}return null};p.getSlots=function(t){if(t===void 0){t=true}return t?this.slotList.concat():this.slotList};p._updateBonesByCache=function(){var t=this.boneList.length;var e;while(t--){e=this.boneList[t];e.update()}};p.addBone=function(t,e){if(e===void 0){e=null}var i;if(e){i=this.getBone(e);i.boneList.push(t)}t.armature=this;t.setParent(i);this.boneList.unshift(t);this._boneDic[t.name]=t};p.addSlot=function(t,e){var i=this.getBone(e);if(i){t.armature=this;t.setParent(i);i.slotList.push(t);t._addDisplayToContainer(this.display);this.slotList.push(t);this._slotDic[t.name]=t;if(t.hasChildArmature){this.slotHasChildArmatureList.push(t)}}else{throw new Error}};p.updateSlotsZOrder=function(){this.slotList.sort(this.sortSlot);var t=this.slotList.length;while(t--){var e=this.slotList[t];if(e._frameCache&&e._frameCache.displayIndex>=0||!e._frameCache&&e.displayIndex>=0){e._addDisplayToContainer(this._display)}}this._slotsZOrderChanged=false};p.sortBoneList=function(){var e=this.boneList.length;if(e==0){return}var i=[];while(e--){var n=0;var r=this.boneList[e];var o=r;while(o){n++;o=o.parent}i[e]=[n,r]}i.sort(t.ArmatureData.sortBoneDataHelpArrayDescending);e=i.length;while(e--){this.boneList[e]=i[e][1]}i.length=0};p.arriveAtFrame=function(e,i){if(e.event&&this.hasEventListener(t.FrameEvent.ANIMATION_FRAME_EVENT)){var n=new t.FrameEvent(t.FrameEvent.ANIMATION_FRAME_EVENT);n.animationState=i;n.frameLabel=e.event;this._addEvent(n)}if(e.action){this.animation.gotoAndPlay(e.action)}};p.invalidUpdate=function(t){if(t===void 0){t=null}if(t){var e=this.getBone(t);if(e){e.invalidUpdate()}}else{var i=this.boneList.length;while(i--){this.boneList[i].invalidUpdate()}}};p.resetAnimation=function(){this.animation.animationState._resetTimelineStateList();var t=this.boneList.length;for(var e=0;e<t;e++){var i=this.boneList[e];i._timelineState=null}this.animation.stop()};p.sortSlot=function(t,e){return t.zOrder<e.zOrder?1:-1};p.getAnimation=function(){return this._animation};n(p,"armatureData",function(){return this._armatureData});n(p,"animation",function(){return this._animation});n(p,"display",function(){return this._display});n(p,"enableCache",function(){return this._enableCache},function(t){this._enableCache=t});n(p,"enableEventDispatch",function(){return this._enableEventDispatch},function(t){this._enableEventDispatch=t});p._addEvent=function(t){if(this._enableEventDispatch){this._eventList.push(t)}};return i}(t.EventDispatcher);t.FastArmature=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._globalTransformMatrix=new t.Matrix;this._global=new t.DBTransform;this._origin=new t.DBTransform;this._visible=true;this.armature=null;this._parent=null;this.userData=null;this.inheritRotation=true;this.inheritScale=true;this.inheritTranslation=true}var i=__define,n=e;p=n.prototype;p.updateByCache=function(){this._global=this._frameCache.globalTransform;this._globalTransformMatrix=this._frameCache.globalTransformMatrix};p.switchTransformToBackup=function(){if(!this._globalBackup){this._globalBackup=new t.DBTransform;this._globalTransformMatrixBackup=new t.Matrix}this._global=this._globalBackup;this._globalTransformMatrix=this._globalTransformMatrixBackup};p.setParent=function(t){this._parent=t};p.dispose=function(){this.userData=null;this._globalTransformMatrix=null;this._global=null;this._origin=null;this.armature=null;this._parent=null};p._calculateParentTransform=function(){if(this.parent&&(this.inheritTranslation||this.inheritRotation||this.inheritScale)){var i=this._parent._global;var n=this._parent._globalTransformMatrix;if(!this.inheritTranslation&&(i.x!=0||i.y!=0)||!this.inheritRotation&&(i.skewX!=0||i.skewY!=0)||!this.inheritScale&&(i.scaleX!=1||i.scaleY!=1)){i=e._tempParentGlobalTransform;i.copy(this._parent._global);if(!this.inheritTranslation){i.x=0;i.y=0}if(!this.inheritScale){i.scaleX=1;i.scaleY=1}if(!this.inheritRotation){i.skewX=0;i.skewY=0}n=t.DBObject._tempParentGlobalTransformMatrix;t.TransformUtil.transformToMatrix(i,n)}e.tempOutputObj.parentGlobalTransform=i;e.tempOutputObj.parentGlobalTransformMatrix=n;return e.tempOutputObj}return null};p._updateGlobal=function(){this._calculateRelativeParentTransform();var e=this._calculateParentTransform();if(e!=null){var i=e.parentGlobalTransformMatrix;var n=e.parentGlobalTransform;var r=this._global.x;var o=this._global.y;this._global.x=i.a*r+i.c*o+i.tx;this._global.y=i.d*o+i.b*r+i.ty;if(this.inheritRotation){this._global.skewX+=n.skewX;this._global.skewY+=n.skewY}if(this.inheritScale){this._global.scaleX*=n.scaleX;this._global.scaleY*=n.scaleY}}t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix,true);return e};p._calculateRelativeParentTransform=function(){};i(p,"name",function(){return this._name},function(t){this._name=t});i(p,"global",function(){return this._global});i(p,"globalTransformMatrix",function(){return this._globalTransformMatrix});i(p,"origin",function(){return this._origin});i(p,"parent",function(){return this._parent});i(p,"visible",function(){return this._visible},function(t){this._visible=t});i(p,"frameCache",undefined,function(t){this._frameCache=t});e._tempParentGlobalTransform=new t.DBTransform;e.tempOutputObj={};return e}();t.FastDBObject=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this);this.slotList=[];this.boneList=[];this._needUpdate=0;this._needUpdate=2;this._tweenPivot=new t.Point}var n=__define,r=i;p=r.prototype;i.initWithBoneData=function(t){var e=new i;e.name=t.name;e.inheritRotation=t.inheritRotation;e.inheritScale=t.inheritScale;e.origin.copy(t.transform);return e};p.getBones=function(t){if(t===void 0){t=true}return t?this.boneList.concat():this.boneList};p.getSlots=function(t){if(t===void 0){t=true}return t?this.slotList.concat():this.slotList};p.dispose=function(){e.prototype.dispose.call(this);this._timelineState=null;this._tweenPivot=null};p.invalidUpdate=function(){this._needUpdate=2};p._calculateRelativeParentTransform=function(){this._global.copy(this._origin);if(this._timelineState){this._global.add(this._timelineState._transform)}};p.updateByCache=function(){e.prototype.updateByCache.call(this);this._global=this._frameCache.globalTransform;this._globalTransformMatrix=this._frameCache.globalTransformMatrix};p.update=function(t){if(t===void 0){t=false}this._needUpdate--;if(t||this._needUpdate>0||this._parent&&this._parent._needUpdate>0){this._needUpdate=1}else{return}this.blendingTimeline();this._updateGlobal()};p._hideSlots=function(){var t=this.slotList.length;for(var e=0;e<t;e++){var i=this.slotList[e];i.hideSlots()}};p.blendingTimeline=function(){if(this._timelineState){this._tweenPivot.x=this._timelineState._pivot.x;this._tweenPivot.y=this._timelineState._pivot.y}};p.arriveAtFrame=function(e,i){var n;if(e.event&&this.armature.hasEventListener(t.FrameEvent.BONE_FRAME_EVENT)){var r=new t.FrameEvent(t.FrameEvent.BONE_FRAME_EVENT);r.bone=this;r.animationState=i;r.frameLabel=e.event;this.armature._addEvent(r)}};n(p,"childArmature",function(){var t=this.slot;if(t){return t.childArmature}return null});n(p,"display",function(){var t=this.slot;if(t){return t.display}return null},function(t){var e=this.slot;if(e){e.display=t}});n(p,"visible",undefined,function(t){if(this._visible!=t){this._visible=t;for(var e=0,i=this.armature.slotList.length;e<i;e++){if(this.armature.slotList[e].parent==this){this.armature.slotList[e]._updateDisplayVisible(this._visible)}}}});n(p,"slot",function(){return this.slotList.length>0?this.slotList[0]:null});return i}(t.FastDBObject);t.FastBone=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(i){e.call(this);this._currentDisplayIndex=0;if(i!=this){throw new Error("Abstract class can not be instantiated!")}this.hasChildArmature=false;this._currentDisplayIndex=-1;this._originZOrder=0;this._tweenZOrder=0;this._offsetZOrder=0;this._colorTransform=new t.ColorTransform;this._isColorChanged=false;this._displayDataList=null;this._currentDisplay=null;this.inheritRotation=true;this.inheritScale=true}var n=__define,r=i;p=r.prototype;p.initWithSlotData=function(t){this.name=t.name;this.blendMode=t.blendMode;this._originZOrder=t.zOrder;this._displayDataList=t.displayDataList;this._originDisplayIndex=t.displayIndex};p.dispose=function(){if(!this._displayList){return}e.prototype.dispose.call(this);this._displayDataList=null;this._displayList=null;this._currentDisplay=null};p.updateByCache=function(){e.prototype.updateByCache.call(this);this._updateTransform();var i=this._frameCache.colorTransform;var n=i!=null;if(this.colorChanged!=n||this.colorChanged&&n&&!t.ColorTransformUtil.isEqual(this._colorTransform,i)){i=i||t.ColorTransformUtil.originalColor;this._updateDisplayColor(i.alphaOffset,i.redOffset,i.greenOffset,i.blueOffset,i.alphaMultiplier,i.redMultiplier,i.greenMultiplier,i.blueMultiplier,n)}this._changeDisplayIndex(this._frameCache.displayIndex)};p._update=function(){if(this._parent._needUpdate<=0){return}this._updateGlobal();this._updateTransform()};p._calculateRelativeParentTransform=function(){this._global.copy(this._origin);this._global.x+=this._parent._tweenPivot.x;this._global.y+=this._parent._tweenPivot.y};p.initDisplayList=function(t){this._displayList=t};p.clearCurrentDisplay=function(){if(this.hasChildArmature){var t=this.childArmature;if(t){t.resetAnimation()}}var e=this._getDisplayIndex();this._removeDisplayFromContainer();return e};p._changeDisplayIndex=function(t){if(t===void 0){t=0}if(this._currentDisplayIndex==t){return}var e=-1;if(this._currentDisplayIndex>=0){e=this.clearCurrentDisplay()}this._currentDisplayIndex=t;if(this._currentDisplayIndex<this._displayDataList.length&&this._currentDisplayIndex>=0){this._origin.copy(this._displayDataList[this._currentDisplayIndex].transform);this.initCurrentDisplay(e)}};p.changeSlotDisplay=function(t){var e=this.clearCurrentDisplay();this._displayList[this._currentDisplayIndex]=t;this.initCurrentDisplay(e)};p.initCurrentDisplay=function(e){if(e===void 0){e=0}var i=this._displayList[this._currentDisplayIndex];if(i){if(i instanceof t.FastArmature){this._currentDisplay=i.display}else{this._currentDisplay=i}}else{this._currentDisplay=null}this._updateDisplay(this._currentDisplay);if(this._currentDisplay){if(e!=-1){this._addDisplayToContainer(this.armature.display,e)}else{this.armature._slotsZOrderChanged=true;this._addDisplayToContainer(this.armature.display)}if(this._blendMode){this._updateDisplayBlendMode(this._blendMode)}if(this._isColorChanged){this._updateDisplayColor(this._colorTransform.alphaOffset,this._colorTransform.redOffset,this._colorTransform.greenOffset,this._colorTransform.blueOffset,this._colorTransform.alphaMultiplier,this._colorTransform.redMultiplier,this._colorTransform.greenMultiplier,this._colorTransform.blueMultiplier,true)}this._updateTransform();if(i instanceof t.FastArmature){var n=i;if(this.armature&&this.armature.animation.animationState&&n.animation.hasAnimation(this.armature.animation.animationState.name)){n.animation.gotoAndPlay(this.armature.animation.animationState.name)}else{n.animation.play()}}}};n(p,"visible",undefined,function(t){if(this._visible!=t){this._visible=t;this._updateDisplayVisible(this._visible)}});n(p,"displayList",function(){return this._displayList},function(t){if(!t){throw new Error}var e=t[this._currentDisplayIndex];var i=this._currentDisplayIndex>=0&&this._displayList[this._currentDisplayIndex]!=e;this._displayList=t;if(i){this.changeSlotDisplay(e)}});n(p,"display",function(){return this._currentDisplay},function(t){if(this._currentDisplayIndex<0){return}if(this._displayList[this._currentDisplayIndex]==t){return}this.changeSlotDisplay(t)});n(p,"childArmature",function(){return this._displayList[this._currentDisplayIndex]instanceof t.Armature||this._displayList[this._currentDisplayIndex]instanceof t.FastArmature?this._displayList[this._currentDisplayIndex]:null},function(t){this.display=t});n(p,"zOrder",function(){return this._originZOrder+this._tweenZOrder+this._offsetZOrder},function(t){if(this.zOrder!=t){this._offsetZOrder=t-this._originZOrder-this._tweenZOrder;if(this.armature){this.armature._slotsZOrderChanged=true}}});n(p,"blendMode",function(){return this._blendMode},function(t){if(this._blendMode!=t){this._blendMode=t;this._updateDisplayBlendMode(this._blendMode)}});n(p,"colorTransform",function(){return this._colorTransform});n(p,"displayIndex",function(){return this._currentDisplayIndex});n(p,"colorChanged",function(){return this._isColorChanged});p._updateDisplay=function(t){throw new Error("Abstract method needs to be implemented in subclass!")};p._getDisplayIndex=function(){throw new Error("Abstract method needs to be implemented in subclass!")};p._addDisplayToContainer=function(t,e){if(e===void 0){e=-1}throw new Error("Abstract method needs to be implemented in subclass!")};p._removeDisplayFromContainer=function(){throw new Error("Abstract method needs to be implemented in subclass!")};p._updateTransform=function(){throw new Error("Abstract method needs to be implemented in subclass!")};p._updateDisplayVisible=function(t){throw new Error("Abstract method needs to be implemented in subclass!")};p._updateDisplayColor=function(t,e,i,n,r,o,a,s,l){if(l===void 0){l=false}this._colorTransform.alphaOffset=t;this._colorTransform.redOffset=e;this._colorTransform.greenOffset=i;this._colorTransform.blueOffset=n;this._colorTransform.alphaMultiplier=r;this._colorTransform.redMultiplier=o;this._colorTransform.greenMultiplier=a;this._colorTransform.blueMultiplier=s;this._isColorChanged=l};p._updateDisplayBlendMode=function(t){throw new Error("Abstract method needs to be implemented in subclass!")};p._arriveAtFrame=function(t,e){var i=t;var n=i.displayIndex;this._changeDisplayIndex(n);this._updateDisplayVisible(i.visible);if(n>=0){if(!isNaN(i.zOrder)&&i.zOrder!=this._tweenZOrder){this._tweenZOrder=i.zOrder;this.armature._slotsZOrderChanged=true}}if(t.action){var r=this.childArmature;if(r){r.getAnimation().gotoAndPlay(t.action)}}};p.hideSlots=function(){this._changeDisplayIndex(-1);this._removeDisplayFromContainer();if(this._frameCache){this._frameCache.clear()}};p._updateGlobal=function(){this._calculateRelativeParentTransform();t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix,true);var e=this._calculateParentTransform();if(e){this._globalTransformMatrix.concat(e.parentGlobalTransformMatrix);t.TransformUtil.matrixToTransform(this._globalTransformMatrix,this._global,this._global.scaleX*e.parentGlobalTransform.scaleX>=0,this._global.scaleY*e.parentGlobalTransform.scaleY>=0)}return e};p._resetToOrigin=function(){this._changeDisplayIndex(this._originDisplayIndex);this._updateDisplayColor(0,0,0,0,1,1,1,1,true)};return i}(t.FastDBObject);t.FastSlot=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(e){this.animationState=new t.FastAnimationState;this._armature=e;this.animationState._armature=e;this.animationList=[];this._animationDataObj={};this._isPlaying=false;this._timeScale=1}var i=__define,n=e;p=n.prototype;p.dispose=function(){if(!this._armature){return}this._armature=null;this._animationDataList=null;this.animationList=null;this.animationState=null};p.gotoAndPlay=function(t,e,i,n){if(e===void 0){e=-1}if(i===void 0){i=-1}if(n===void 0){n=NaN}if(!this._animationDataList){return null}var r=this._animationDataObj[t];if(!r){return null}this._isPlaying=true;e=e<0?r.fadeTime<0?.3:r.fadeTime:e;var o;if(i<0){o=r.scale<0?1:r.scale}else{o=i*1e3/r.duration}n=isNaN(n)?r.playTimes:n;this.animationState._fadeIn(r,n,1/o,e);if(this._armature.enableCache&&this.animationCacheManager){this.animationState.animationCache=this.animationCacheManager.getAnimationCache(t)}var a=this._armature.slotHasChildArmatureList.length;while(a--){var s=this._armature.slotHasChildArmatureList[a];var l=s.childArmature;if(l){l.getAnimation().gotoAndPlay(t)}}return this.animationState};p.gotoAndStop=function(t,e,i,n,r){if(i===void 0){i=-1}if(n===void 0){n=0}if(r===void 0){r=-1}if(this.animationState.name!=t){this.gotoAndPlay(t,n,r)}if(i>=0){this.animationState.setCurrentTime(this.animationState.totalTime*i)}else{this.animationState.setCurrentTime(e)}this.animationState.stop();return this.animationState};p.play=function(){if(!this._animationDataList){return}if(!this.animationState.name){this.gotoAndPlay(this._animationDataList[0].name)}else if(!this._isPlaying){this._isPlaying=true}else{this.gotoAndPlay(this.animationState.name)}};p.stop=function(){this._isPlaying=false};p.advanceTime=function(t){if(!this._isPlaying){return}this.animationState._advanceTime(t*this._timeScale)};p.hasAnimation=function(t){return this._animationDataObj[t]!=null};i(p,"timeScale",function(){return this._timeScale},function(t){if(isNaN(t)||t<0){t=1}this._timeScale=t});i(p,"animationDataList",function(){return this._animationDataList},function(t){this._animationDataList=t;this.animationList.length=0;var e=this._animationDataList.length;for(var i=0;i<e;i++){var n=this._animationDataList[i];this.animationList.push(n.name);this._animationDataObj[n.name]=n}});i(p,"movementList",function(){return this.animationList});i(p,"movementID",function(){return this.lastAnimationName});p.isPlaying=function(){return this._isPlaying&&!this.isComplete};i(p,"isComplete",function(){return this.animationState.isComplete});i(p,"lastAnimationState",function(){return this.animationState});i(p,"lastAnimationName",function(){return this.animationState?this.animationState.name:null});return e}();t.FastAnimation=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._boneTimelineStateList=[];this._slotTimelineStateList=[];this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._currentPlayTimes=0;this._totalTime=0;this._currentTime=0;this._lastTime=0;this._playTimes=0;this._fading=false}var i=__define,n=e;p=n.prototype;p.dispose=function(){this._resetTimelineStateList();this._armature=null};p.play=function(){this._isPlaying=true;return this};p.stop=function(){this._isPlaying=false;return this};p.setCurrentTime=function(t){if(t<0||isNaN(t)){t=0}this._time=t;this._currentTime=this._time*1e3;return this};p._resetTimelineStateList=function(){var e=this._boneTimelineStateList.length;while(e--){t.FastBoneTimelineState.returnObject(this._boneTimelineStateList[e])}this._boneTimelineStateList.length=0;e=this._slotTimelineStateList.length;while(e--){t.FastSlotTimelineState.returnObject(this._slotTimelineStateList[e])}this._slotTimelineStateList.length=0;this.name=null};p._fadeIn=function(t,e,i,n){this.animationData=t;this.name=this.animationData.name;this._totalTime=this.animationData.duration;this.autoTween=t.autoTween;this.setTimeScale(i);this.setPlayTimes(e);this._isComplete=false;this._currentFrameIndex=-1;this._currentPlayTimes=-1;if(Math.round(this._totalTime*this.animationData.frameRate*.001)<2){this._currentTime=this._totalTime}else{this._currentTime=-1}this._fadeTotalTime=n*this._timeScale;this._fading=this._fadeTotalTime>0;this._isPlaying=true;if(this._armature.enableCache&&this.animationCache&&this._fading&&this._boneTimelineStateList){this.updateTransformTimeline(this.progress)}this._time=0;this._progress=0;this._updateTimelineStateList();this.hideBones();return};p._updateTimelineStateList=function(){this._resetTimelineStateList();var e;var i=this.animationData.timelineList.length;for(var n=0;n<i;n++){var r=this.animationData.timelineList[n];e=r.name;var o=this._armature.getBone(e);if(o){var a=t.FastBoneTimelineState.borrowObject();a.fadeIn(o,this,r);this._boneTimelineStateList.push(a)}}var s=this.animationData.slotTimelineList.length;for(var l=0;l<s;l++){var h=this.animationData.slotTimelineList[l];e=h.name;var u=this._armature.getSlot(e);if(u&&u.displayList.length>0){var p=t.FastSlotTimelineState.borrowObject();p.fadeIn(u,this,h);this._slotTimelineStateList.push(p)}}};p._advanceTime=function(t){t*=this._timeScale;if(this._fading){this._time+=t;this._progress=this._time/this._fadeTotalTime;if(this._progress>=1){this._progress=0;this._time=0;this._fading=false}}if(this._fading){var e=this._boneTimelineStateList.length;for(var i=0;i<e;i++){var n=this._boneTimelineStateList[i];n.updateFade(this.progress)}var r=this._slotTimelineStateList.length;for(var o=0;o<r;o++){var a=this._slotTimelineStateList[o];a.updateFade(this.progress)}}else{this.advanceTimelinesTime(t)}};p.advanceTimelinesTime=function(e){this._time+=e;var i=false;var n=false;var r=false;var o=false;var a=0;var s=this._time*1e3;if(this._playTimes==0||s<this._playTimes*this._totalTime){o=false;this._progress=s/this._totalTime;a=Math.ceil(this.progress)||1;this._progress-=Math.floor(this.progress);s%=this._totalTime}else{a=this._playTimes;s=this._totalTime;o=true;this._progress=1}this._isComplete=o;if(this.isUseCache()){this.animationCache.update(this.progress)}else{this.updateTransformTimeline(this.progress)}if(this._currentTime!=s){if(this._currentPlayTimes!=a){if(this._currentPlayTimes>0&&a>1){n=true}this._currentPlayTimes=a}if(this._currentTime<0){i=true}if(this._isComplete){r=true}this._lastTime=this._currentTime;this._currentTime=s;this.updateMainTimeline(o)}var l;if(i){if(this._armature.hasEventListener(t.AnimationEvent.START)){l=new t.AnimationEvent(t.AnimationEvent.START);l.animationState=this;this._armature._addEvent(l)}}if(r){if(this._armature.hasEventListener(t.AnimationEvent.COMPLETE)){l=new t.AnimationEvent(t.AnimationEvent.COMPLETE);l.animationState=this;this._armature._addEvent(l)}}else if(n){if(this._armature.hasEventListener(t.AnimationEvent.LOOP_COMPLETE)){l=new t.AnimationEvent(t.AnimationEvent.LOOP_COMPLETE);l.animationState=this;this._armature._addEvent(l)}}};p.updateTransformTimeline=function(t){var e=this._boneTimelineStateList.length;var i;var n;if(this._isComplete){while(e--){i=this._boneTimelineStateList[e];i.update(t);this._isComplete=i._isComplete&&this._isComplete}e=this._slotTimelineStateList.length;while(e--){n=this._slotTimelineStateList[e];n.update(t);this._isComplete=n._isComplete&&this._isComplete}}else{while(e--){i=this._boneTimelineStateList[e];i.update(t)}e=this._slotTimelineStateList.length;while(e--){n=this._slotTimelineStateList[e];n.update(t)}}};p.updateMainTimeline=function(t){var e=this.animationData.frameList;if(e.length>0){var i;var n;for(var r=0,o=this.animationData.frameList.length;r<o;++r){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration||this._currentTime<this._lastTime){this._lastTime=this._currentTime;this._currentFrameIndex++;if(this._currentFrameIndex>=e.length){if(t){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}n=e[this._currentFrameIndex];if(i){this._armature.arriveAtFrame(i,this)}this._currentFrameDuration=n.duration;this._currentFramePosition=n.position;i=n}
if(n){this._armature.arriveAtFrame(n,this)}}};p.setTimeScale=function(t){if(isNaN(t)||t==Infinity){t=1}this._timeScale=t;return this};p.setPlayTimes=function(t){if(t===void 0){t=0}if(Math.round(this._totalTime*.001*this.animationData.frameRate)<2){this._playTimes=1}else{this._playTimes=t}return this};i(p,"playTimes",function(){return this._playTimes});i(p,"currentPlayTimes",function(){return this._currentPlayTimes<0?0:this._currentPlayTimes});i(p,"isComplete",function(){return this._isComplete});i(p,"isPlaying",function(){return this._isPlaying&&!this._isComplete});i(p,"totalTime",function(){return this._totalTime*.001});i(p,"currentTime",function(){return this._currentTime<0?0:this._currentTime*.001});p.isUseCache=function(){return this._armature.enableCache&&this.animationCache&&!this._fading};p.hideBones=function(){var t=this.animationData.hideTimelineNameMap.length;for(var e=0;e<t;e++){var i=this.animationData.hideTimelineNameMap[e];var n=this._armature.getBone(i);if(n){n._hideSlots()}}var r;for(e=0,t=this.animationData.hideSlotTimelineNameMap.length;e<t;e++){r=this.animationData.hideSlotTimelineNameMap[e];var o=this._armature.getSlot(r);if(o){o._resetToOrigin()}}};i(p,"progress",function(){return this._progress});return e}();t.FastAnimationState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._totalTime=0;this._currentTime=0;this._lastTime=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._updateMode=0;this._transform=new t.DBTransform;this._durationTransform=new t.DBTransform;this._transformToFadein=new t.DBTransform;this._pivot=new t.Point;this._durationPivot=new t.Point}var i=__define,n=e;p=n.prototype;e.borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e.returnObject=function(t){if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}t.clear()};e.clear=function(){var t=e._pool.length;while(t--){e._pool[t].clear()}e._pool.length=0};p.clear=function(){if(this._bone){this._bone._timelineState=null;this._bone=null}this._animationState=null;this._timelineData=null;this._originPivot=null};p.fadeIn=function(e,i,n){this._bone=e;this._animationState=i;this._timelineData=n;this.name=n.name;this._totalTime=this._timelineData.duration;this._isComplete=false;this._tweenTransform=false;this._currentFrameIndex=-1;this._currentTime=-1;this._tweenEasing=NaN;this._durationPivot.x=0;this._durationPivot.y=0;this._pivot.x=0;this._pivot.y=0;this._originPivot=this._timelineData.originPivot;switch(this._timelineData.frameList.length){case 0:this._updateMode=0;break;case 1:this._updateMode=1;break;default:this._updateMode=-1;break}if(i._fadeTotalTime>0){var r;if(this._bone._timelineState){this._transformToFadein.copy(this._bone._timelineState._transform)}else{this._transformToFadein=new t.DBTransform}var o=this._timelineData.frameList[0];this._durationTransform.copy(o.transform);this._durationTransform.minus(this._transformToFadein)}this._bone._timelineState=this};p.updateFade=function(t){this._transform.x=this._transformToFadein.x+this._durationTransform.x*t;this._transform.y=this._transformToFadein.y+this._durationTransform.y*t;this._transform.scaleX=this._transformToFadein.scaleX*(1+(this._durationTransform.scaleX-1)*t);this._transform.scaleY=this._transformToFadein.scaleX*(1+(this._durationTransform.scaleY-1)*t);this._transform.rotation=this._transformToFadein.rotation+this._durationTransform.rotation*t;this._bone.invalidUpdate()};p.update=function(t){if(this._updateMode==1){this._updateMode=0;this.updateSingleFrame()}else if(this._updateMode==-1){this.updateMultipleFrame(t)}};p.updateSingleFrame=function(){var t=this._timelineData.frameList[0];this._bone.arriveAtFrame(t,this._animationState);this._isComplete=true;this._tweenEasing=NaN;this._tweenTransform=false;this._pivot.x=this._originPivot.x+t.pivot.x;this._pivot.y=this._originPivot.y+t.pivot.y;this._transform.copy(t.transform);this._bone.invalidUpdate()};p.updateMultipleFrame=function(t){var e=0;t/=this._timelineData.scale;t+=this._timelineData.offset;var i=this._totalTime*t;var n=this._animationState.playTimes;if(n==0){this._isComplete=false;e=Math.ceil(Math.abs(i)/this._totalTime)||1;i-=Math.floor(i/this._totalTime)*this._totalTime;if(i<0){i+=this._totalTime}}else{var r=n*this._totalTime;if(i>=r){i=r;this._isComplete=true}else if(i<=-r){i=-r;this._isComplete=true}else{this._isComplete=false}if(i<0){i+=r}e=Math.ceil(i/this._totalTime)||1;if(this._isComplete){i=this._totalTime}else{i-=Math.floor(i/this._totalTime)*this._totalTime}}if(this._currentTime!=i){this._lastTime=this._currentTime;this._currentTime=i;var o=this._timelineData.frameList;var a;var s;for(var l=0,h=this._timelineData.frameList.length;l<h;++l){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration||this._currentTime<this._lastTime){this._currentFrameIndex++;this._lastTime=this._currentTime;if(this._currentFrameIndex>=o.length){if(this._isComplete){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}s=o[this._currentFrameIndex];if(a){this._bone.arriveAtFrame(a,this._animationState)}this._currentFrameDuration=s.duration;this._currentFramePosition=s.position;a=s}if(s){this._bone.arriveAtFrame(s,this._animationState);this.updateToNextFrame(e)}if(this._tweenTransform){this.updateTween()}}};p.updateToNextFrame=function(e){if(e===void 0){e=0}var i=this._currentFrameIndex+1;if(i>=this._timelineData.frameList.length){i=0}var n=this._timelineData.frameList[this._currentFrameIndex];var r=this._timelineData.frameList[i];var o=false;if(i==0&&(this._animationState.playTimes&&this._animationState.currentPlayTimes>=this._animationState.playTimes&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+e-this._timelineData.offset)*this._timelineData.scale>.999999)){this._tweenEasing=NaN;o=false}else if(this._animationState.autoTween){this._tweenEasing=this._animationState.animationData.tweenEasing;if(isNaN(this._tweenEasing)){this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if(isNaN(this._tweenEasing)&&this._tweenCurve==null){o=false}else{if(this._tweenEasing==10){this._tweenEasing=0}o=true}}else{o=true}}else{this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if((isNaN(this._tweenEasing)||this._tweenEasing==10)&&this._tweenCurve==null){this._tweenEasing=NaN;o=false}else{o=true}}if(o){this._durationTransform.x=r.transform.x-n.transform.x;this._durationTransform.y=r.transform.y-n.transform.y;this._durationTransform.skewX=r.transform.skewX-n.transform.skewX;this._durationTransform.skewY=r.transform.skewY-n.transform.skewY;this._durationTransform.scaleX=r.transform.scaleX-n.transform.scaleX+r.scaleOffset.x;this._durationTransform.scaleY=r.transform.scaleY-n.transform.scaleY+r.scaleOffset.y;this._durationPivot.x=r.pivot.x-n.pivot.x;this._durationPivot.y=r.pivot.y-n.pivot.y;this._durationTransform.normalizeRotation();if(i==0){this._durationTransform.skewX=t.TransformUtil.formatRadian(this._durationTransform.skewX);this._durationTransform.skewY=t.TransformUtil.formatRadian(this._durationTransform.skewY)}if(this._durationTransform.x||this._durationTransform.y||this._durationTransform.skewX||this._durationTransform.skewY||this._durationTransform.scaleX!=1||this._durationTransform.scaleY!=1||this._durationPivot.x||this._durationPivot.y){this._tweenTransform=true}else{this._tweenTransform=false}}else{this._tweenTransform=false}if(!this._tweenTransform){this._transform.copy(n.transform);this._pivot.x=this._originPivot.x+n.pivot.x;this._pivot.y=this._originPivot.y+n.pivot.y;this._bone.invalidUpdate()}};p.updateTween=function(){var e=(this._currentTime-this._currentFramePosition)/this._currentFrameDuration;if(this._tweenCurve){e=this._tweenCurve.getValueByProgress(e)}else if(this._tweenEasing){e=t.MathUtil.getEaseValue(e,this._tweenEasing)}var i=this._timelineData.frameList[this._currentFrameIndex];var n=i.transform;var r=i.pivot;this._transform.x=n.x+this._durationTransform.x*e;this._transform.y=n.y+this._durationTransform.y*e;this._transform.skewX=n.skewX+this._durationTransform.skewX*e;this._transform.skewY=n.skewY+this._durationTransform.skewY*e;this._transform.scaleX=n.scaleX+this._durationTransform.scaleX*e;this._transform.scaleY=n.scaleY+this._durationTransform.scaleY*e;this._pivot.x=r.x+this._durationPivot.x*e;this._pivot.y=r.y+this._durationPivot.y*e;this._bone.invalidUpdate()};e._pool=[];return e}();t.FastBoneTimelineState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._totalTime=0;this._currentTime=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._updateMode=0;this._durationColor=new t.ColorTransform}var i=__define,n=e;p=n.prototype;e.borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e.returnObject=function(t){if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}t.clear()};e.clear=function(){var t=e._pool.length;while(t--){e._pool[t].clear()}e._pool.length=0};p.clear=function(){this._slot=null;this._armature=null;this._animation=null;this._animationState=null;this._timelineData=null};p.fadeIn=function(t,e,i){this._slot=t;this._armature=this._slot.armature;this._animation=this._armature.animation;this._animationState=e;this._timelineData=i;this.name=i.name;this._totalTime=this._timelineData.duration;this._isComplete=false;this._blendEnabled=false;this._tweenColor=false;this._currentFrameIndex=-1;this._currentTime=-1;this._tweenEasing=NaN;this._weight=1;switch(this._timelineData.frameList.length){case 0:this._updateMode=0;break;case 1:this._updateMode=1;break;default:this._updateMode=-1;break}};p.updateFade=function(t){};p.update=function(t){if(this._updateMode==-1){this.updateMultipleFrame(t)}else if(this._updateMode==1){this._updateMode=0;this.updateSingleFrame()}};p.updateMultipleFrame=function(t){var e=0;t/=this._timelineData.scale;t+=this._timelineData.offset;var i=this._totalTime*t;var n=this._animationState.playTimes;if(n==0){this._isComplete=false;e=Math.ceil(Math.abs(i)/this._totalTime)||1;i-=Math.floor(i/this._totalTime)*this._totalTime;if(i<0){i+=this._totalTime}}else{var r=n*this._totalTime;if(i>=r){i=r;this._isComplete=true}else if(i<=-r){i=-r;this._isComplete=true}else{this._isComplete=false}if(i<0){i+=r}e=Math.ceil(i/this._totalTime)||1;if(this._isComplete){i=this._totalTime}else{i-=Math.floor(i/this._totalTime)*this._totalTime}}if(this._currentTime!=i){this._currentTime=i;var o=this._timelineData.frameList;var a;var s;for(var l=0,h=this._timelineData.frameList.length;l<h;++l){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration){this._currentFrameIndex++;if(this._currentFrameIndex>=o.length){if(this._isComplete){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}s=o[this._currentFrameIndex];if(a){this._slot._arriveAtFrame(a,this._animationState)}this._currentFrameDuration=s.duration;this._currentFramePosition=s.position;a=s}if(s){this._slot._arriveAtFrame(s,this._animationState);this._blendEnabled=s.displayIndex>=0;if(this._blendEnabled){this.updateToNextFrame(e)}else{this._tweenEasing=NaN;this._tweenColor=false}}if(this._blendEnabled){this.updateTween()}}};p.updateToNextFrame=function(e){if(e===void 0){e=0}var i=this._currentFrameIndex+1;if(i>=this._timelineData.frameList.length){i=0}var n=this._timelineData.frameList[this._currentFrameIndex];var r=this._timelineData.frameList[i];var o=false;if(i==0&&(this._animationState.playTimes&&this._animationState.currentPlayTimes>=this._animationState.playTimes&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+e-this._timelineData.offset)*this._timelineData.scale>.999999)){this._tweenEasing=NaN;o=false}else if(n.displayIndex<0||r.displayIndex<0){this._tweenEasing=NaN;o=false}else if(this._animationState.autoTween){this._tweenEasing=this._animationState.animationData.tweenEasing;if(isNaN(this._tweenEasing)){this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if(isNaN(this._tweenEasing)&&this._tweenCurve==null){o=false}else{if(this._tweenEasing==10){this._tweenEasing=0}o=true}}else{o=true}}else{this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if((isNaN(this._tweenEasing)||this._tweenEasing==10)&&this._tweenCurve==null){this._tweenEasing=NaN;o=false}else{o=true}}if(o){if(n.color||r.color){t.ColorTransformUtil.minus(r.color||t.ColorTransformUtil.originalColor,n.color||t.ColorTransformUtil.originalColor,this._durationColor);this._tweenColor=this._durationColor.alphaOffset!=0||this._durationColor.redOffset!=0||this._durationColor.greenOffset!=0||this._durationColor.blueOffset!=0||this._durationColor.alphaMultiplier!=0||this._durationColor.redMultiplier!=0||this._durationColor.greenMultiplier!=0||this._durationColor.blueMultiplier!=0}else{this._tweenColor=false}}else{this._tweenColor=false}if(!this._tweenColor){var a;var s;if(n.color){a=n.color;s=true}else{a=t.ColorTransformUtil.originalColor;s=false}if(this._slot._isColorChanged||s){if(!t.ColorTransformUtil.isEqual(this._slot._colorTransform,a)){this._slot._updateDisplayColor(a.alphaOffset,a.redOffset,a.greenOffset,a.blueOffset,a.alphaMultiplier,a.redMultiplier,a.greenMultiplier,a.blueMultiplier,s)}}}};p.updateTween=function(){var e=this._timelineData.frameList[this._currentFrameIndex];if(this._tweenColor){var i=(this._currentTime-this._currentFramePosition)/this._currentFrameDuration;if(this._tweenCurve!=null){i=this._tweenCurve.getValueByProgress(i)}else if(this._tweenEasing){i=t.MathUtil.getEaseValue(i,this._tweenEasing)}if(e.color){this._slot._updateDisplayColor(e.color.alphaOffset+this._durationColor.alphaOffset*i,e.color.redOffset+this._durationColor.redOffset*i,e.color.greenOffset+this._durationColor.greenOffset*i,e.color.blueOffset+this._durationColor.blueOffset*i,e.color.alphaMultiplier+this._durationColor.alphaMultiplier*i,e.color.redMultiplier+this._durationColor.redMultiplier*i,e.color.greenMultiplier+this._durationColor.greenMultiplier*i,e.color.blueMultiplier+this._durationColor.blueMultiplier*i,true)}else{this._slot._updateDisplayColor(this._durationColor.alphaOffset*i,this._durationColor.redOffset*i,this._durationColor.greenOffset*i,this._durationColor.blueOffset*i,this._durationColor.alphaMultiplier*i+1,this._durationColor.redMultiplier*i+1,this._durationColor.greenMultiplier*i+1,this._durationColor.blueMultiplier*i+1,true)}}};p.updateSingleFrame=function(){var e=this._timelineData.frameList[0];this._slot._arriveAtFrame(e,this._animationState);this._isComplete=true;this._tweenEasing=NaN;this._tweenColor=false;this._blendEnabled=e.displayIndex>=0;if(this._blendEnabled){var i;var n;if(e.color){i=e.color;n=true}else{i=t.ColorTransformUtil.originalColor;n=false}if(this._slot._isColorChanged||n){if(!t.ColorTransformUtil.isEqual(this._slot._colorTransform,i)){this._slot._updateDisplayColor(i.alphaOffset,i.redOffset,i.greenOffset,i.blueOffset,i.alphaMultiplier,i.redMultiplier,i.greenMultiplier,i.blueMultiplier,n)}}}};e.HALF_PI=Math.PI*.5;e.DOUBLE_PI=Math.PI*2;e._pool=[];return e}();t.FastSlotTimelineState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e){if(t===void 0){t=0}if(e===void 0){e=0}this.x=t;this.y=e}var e=__define,i=t;p=i.prototype;p.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"};return t}();t.Point=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e,i,n){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=0}if(n===void 0){n=0}this.x=t;this.y=e;this.width=i;this.height=n}var e=__define,i=t;p=i.prototype;return t}();t.Rectangle=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.duration=0;this._frameList=[];this.duration=0;this.scale=1}var e=__define,i=t;p=i.prototype;p.dispose=function(){var t=this._frameList.length;while(t--){this._frameList[t].dispose()}this._frameList=null};p.addFrame=function(t){if(!t){throw new Error}if(this._frameList.indexOf(t)<0){this._frameList[this._frameList.length]=t}else{throw new Error}};e(p,"frameList",function(){return this._frameList});return t}();t.Timeline=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);this.frameRate=0;this.playTimes=0;this.lastFrameDuration=0;this.fadeTime=0;this.playTimes=0;this.autoTween=true;this.tweenEasing=NaN;this.hideTimelineNameMap=[];this.hideSlotTimelineNameMap=[];this._timelineList=[];this._slotTimelineList=[]}var i=__define,n=e;p=n.prototype;i(p,"timelineList",function(){return this._timelineList});i(p,"slotTimelineList",function(){return this._slotTimelineList});p.dispose=function(){t.prototype.dispose.call(this);this.hideTimelineNameMap=null;var e=0;var i=0;for(e=0,i=this._timelineList.length;e<i;e++){var n=this._timelineList[e];n.dispose()}this._timelineList=null;for(e=0,i=this._slotTimelineList.length;e<i;e++){var r=this._slotTimelineList[e];r.dispose()}this._slotTimelineList=null};p.getTimeline=function(t){var e=this._timelineList.length;while(e--){if(this._timelineList[e].name==t){return this._timelineList[e]}}return null};p.addTimeline=function(t){if(!t){throw new Error}if(this._timelineList.indexOf(t)<0){this._timelineList[this._timelineList.length]=t}};p.getSlotTimeline=function(t){var e=this._slotTimelineList.length;while(e--){if(this._slotTimelineList[e].name==t){return this._slotTimelineList[e]}}return null};p.addSlotTimeline=function(t){if(!t){throw new Error}if(this._slotTimelineList.indexOf(t)<0){this._slotTimelineList[this._slotTimelineList.length]=t}};return e}(t.Timeline);t.AnimationData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this._boneDataList=[];this._skinDataList=[];this._slotDataList=[];this._animationDataList=[]}var e=__define,i=t;p=i.prototype;t.sortBoneDataHelpArray=function(t,e){return t[0]>e[0]?1:-1};t.sortBoneDataHelpArrayDescending=function(t,e){return t[0]>e[0]?-1:1};p.setSkinData=function(t){var e=0;var i=this._slotDataList.length;for(e=0;e<i;e++){this._slotDataList[e].dispose()}var n;if(!t&&this._skinDataList.length>0){n=this._skinDataList[0]}else{e=0,i=this._skinDataList.length;for(;e<i;e++){if(this._skinDataList[e].name==t){n=this._skinDataList[e];break}}}if(n){var r;e=0,i=n.slotDataList.length;for(e=0;e<i;e++){r=this.getSlotData(n.slotDataList[e].name);if(r){var o=0;var a=n.slotDataList[e].displayDataList.length;for(o=0;o<a;o++){r.addDisplayData(n.slotDataList[e].displayDataList[o])}}}}};p.dispose=function(){var t=this._boneDataList.length;while(t--){this._boneDataList[t].dispose()}t=this._skinDataList.length;while(t--){this._skinDataList[t].dispose()}t=this._slotDataList.length;while(t--){this._slotDataList[t].dispose()}t=this._animationDataList.length;while(t--){this._animationDataList[t].dispose()}this._boneDataList=null;this._slotDataList=null;this._skinDataList=null;this._animationDataList=null};p.getBoneData=function(t){var e=this._boneDataList.length;while(e--){if(this._boneDataList[e].name==t){return this._boneDataList[e]}}return null};p.getSlotData=function(t){var e=this._slotDataList.length;while(e--){if(this._slotDataList[e].name==t){return this._slotDataList[e]}}return null};p.getSkinData=function(t){if(!t&&this._skinDataList.length>0){return this._skinDataList[0]}var e=this._skinDataList.length;while(e--){if(this._skinDataList[e].name==t){return this._skinDataList[e]}}return null};p.getAnimationData=function(t){var e=this._animationDataList.length;while(e--){if(this._animationDataList[e].name==t){return this._animationDataList[e]}}return null};p.addBoneData=function(t){if(!t){throw new Error}if(this._boneDataList.indexOf(t)<0){this._boneDataList[this._boneDataList.length]=t}else{throw new Error}};p.addSlotData=function(t){if(!t){throw new Error}if(this._slotDataList.indexOf(t)<0){this._slotDataList[this._slotDataList.length]=t}else{throw new Error}};p.addSkinData=function(t){if(!t){throw new Error}if(this._skinDataList.indexOf(t)<0){this._skinDataList[this._skinDataList.length]=t}else{throw new Error}};p.addAnimationData=function(t){if(!t){throw new Error}if(this._animationDataList.indexOf(t)<0){this._animationDataList[this._animationDataList.length]=t}};p.sortBoneDataList=function(){var e=this._boneDataList.length;if(e==0){return}var i=[];while(e--){var n=this._boneDataList[e];var r=0;var o=n;while(o){r++;o=this.getBoneData(o.parent)}i[e]=[r,n]}i.sort(t.sortBoneDataHelpArray);e=i.length;while(e--){this._boneDataList[e]=i[e][1]}};e(p,"boneDataList",function(){return this._boneDataList});e(p,"slotDataList",function(){return this._slotDataList});e(p,"skinDataList",function(){return this._skinDataList});e(p,"animationDataList",function(){return this._animationDataList});return t}();t.ArmatureData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.length=0;this.global=new t.DBTransform;this.transform=new t.DBTransform;this.inheritRotation=true;this.inheritScale=false}var i=__define,n=e;p=n.prototype;p.dispose=function(){this.global=null;this.transform=null};return e}();t.BoneData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.alphaMultiplier=1;this.alphaOffset=0;this.blueMultiplier=1;this.blueOffset=0;this.greenMultiplier=1;this.greenOffset=0;this.redMultiplier=1;this.redOffset=0}var e=__define,i=t;p=i.prototype;return t}();t.ColorTransform=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._dataChanged=false;this._pointList=[];this.sampling=new Array(e.SamplingTimes);for(var i=0;i<e.SamplingTimes-1;i++){this.sampling[i]=new t.Point}}var i=__define,n=e;p=n.prototype;p.getValueByProgress=function(t){if(this._dataChanged){this.refreshSampling()}for(var i=0;i<e.SamplingTimes-1;i++){var n=this.sampling[i];if(n.x>=t){if(i==0){return n.y*t/n.x}else{var r=this.sampling[i-1];return r.y+(n.y-r.y)*(t-r.x)/(n.x-r.x)}}}return n.y+(1-n.y)*(t-n.x)/(1-n.x)};p.refreshSampling=function(){for(var t=0;t<e.SamplingTimes-1;t++){this.bezierCurve(e.SamplingStep*(t+1),this.sampling[t])}this._dataChanged=false};p.bezierCurve=function(t,e){var i=1-t;e.x=3*this.point1.x*t*i*i+3*this.point2.x*t*t*i+Math.pow(t,3);e.y=3*this.point1.y*t*i*i+3*this.point2.y*t*t*i+Math.pow(t,3)};i(p,"pointList",function(){return this._pointList},function(t){this._pointList=t;this._dataChanged=true});p.isCurve=function(){return this.point1.x!=0||this.point1.y!=0||this.point2.x!=1||this.point2.y!=1};i(p,"point1",function(){return this.pointList[0]});i(p,"point2",function(){return this.pointList[1]});e.SamplingTimes=20;e.SamplingStep=.05;return e}();t.CurveData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.transform=new t.DBTransform;this.pivot=new t.Point}var i=__define,n=e;p=n.prototype;p.dispose=function(){this.transform=null;this.pivot=null};e.ARMATURE="armature";e.IMAGE="image";return e}();t.DisplayData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this._armatureDataList=[];this._displayDataDictionary={}}var e=__define,i=t;p=i.prototype;p.dispose=function(){for(var t=0,e=this._armatureDataList.length;t<e;t++){var i=this._armatureDataList[t];i.dispose()}this._armatureDataList=null;this.removeAllDisplayData();this._displayDataDictionary=null};e(p,"armatureDataList",function(){return this._armatureDataList});p.getArmatureDataByName=function(t){var e=this._armatureDataList.length;while(e--){if(this._armatureDataList[e].name==t){return this._armatureDataList[e]}}return null};p.addArmatureData=function(t){if(!t){throw new Error}if(this._armatureDataList.indexOf(t)<0){this._armatureDataList[this._armatureDataList.length]=t}else{throw new Error}};p.removeArmatureData=function(t){var e=this._armatureDataList.indexOf(t);if(e>=0){this._armatureDataList.splice(e,1)}};p.removeArmatureDataByName=function(t){var e=this._armatureDataList.length;while(e--){if(this._armatureDataList[e].name==t){this._armatureDataList.splice(e,1)}}};p.getDisplayDataByName=function(t){return this._displayDataDictionary[t]};p.addDisplayData=function(t){this._displayDataDictionary[t.name]=t};p.removeDisplayDataByName=function(t){delete this._displayDataDictionary[t]};p.removeAllDisplayData=function(){for(var t in this._displayDataDictionary){delete this._displayDataDictionary[t]}};return t}();t.DragonBonesData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.position=0;this.duration=0;this.position=0;this.duration=0}var e=__define,i=t;p=i.prototype;p.dispose=function(){};return t}();t.Frame=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this._slotDataList=[]}var e=__define,i=t;p=i.prototype;p.dispose=function(){var t=this._slotDataList.length;while(t--){this._slotDataList[t].dispose()}this._slotDataList=null};p.getSlotData=function(t){var e=this._slotDataList.length;while(e--){if(this._slotDataList[e].name==t){return this._slotDataList[e]}}return null};p.addSlotData=function(t){if(!t){throw new Error}if(this._slotDataList.indexOf(t)<0){this._slotDataList[this._slotDataList.length]=t}else{throw new Error}};e(p,"slotDataList",function(){return this._slotDataList});return t}();t.SkinData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this._displayDataList=[];this.zOrder=0}var e=__define,i=t;p=i.prototype;p.dispose=function(){this._displayDataList.length=0};p.addDisplayData=function(t){if(!t){throw new Error}if(this._displayDataList.indexOf(t)<0){this._displayDataList[this._displayDataList.length]=t}else{throw new Error}};p.getDisplayData=function(t){var e=this._displayDataList.length;while(e--){if(this._displayDataList[e].name==t){return this._displayDataList[e]}}return null};e(p,"displayDataList",function(){return this._displayDataList});return t}();t.SlotData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);this.displayIndex=0;this.tweenEasing=10;this.displayIndex=0;this.visible=true;this.zOrder=NaN}var i=__define,n=e;p=n.prototype;p.dispose=function(){t.prototype.dispose.call(this);this.color=null};return e}(t.Frame);t.SlotFrame=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);this.offset=0}var i=__define,n=e;p=n.prototype;p.dispose=function(){t.prototype.dispose.call(this)};return e}(t.Timeline);t.SlotTimeline=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this);this.tweenRotate=0;this.displayIndex=0;this.tweenEasing=10;this.tweenRotate=0;this.tweenScale=true;this.displayIndex=0;this.visible=true;this.zOrder=NaN;this.global=new t.DBTransform;this.transform=new t.DBTransform;this.pivot=new t.Point;this.scaleOffset=new t.Point}var n=__define,r=i;p=r.prototype;p.dispose=function(){e.prototype.dispose.call(this);this.global=null;this.transform=null;this.pivot=null;this.scaleOffset=null;this.color=null};return i}(t.Frame);t.TransformFrame=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this);this.originTransform=new t.DBTransform;this.originTransform.scaleX=1;this.originTransform.scaleY=1;this.originPivot=new t.Point;this.offset=0}var n=__define,r=i;p=r.prototype;p.dispose=function(){e.prototype.dispose.call(this);this.originTransform=null;this.originPivot=null};return i}(t.Timeline);t.TransformTimeline=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e;p=n.prototype;e.parseDragonBonesData=function(i){if(!i){throw new Error}var n=i[t.ConstValues.A_VERSION];n=n.toString();if(n.toString()!=t.DragonBones.DATA_VERSION&&n.toString()!=t.DragonBones.PARENT_COORDINATE_DATA_VERSION&&n.toString()!="2.3"){throw new Error("Nonsupport version!")}var r=e.getNumber(i,t.ConstValues.A_FRAME_RATE,0)||0;var o=new t.DragonBonesData;o.name=i[t.ConstValues.A_NAME];o.isGlobal=i[t.ConstValues.A_IS_GLOBAL]=="0"?false:true;e.tempDragonBonesData=o;var a=i[t.ConstValues.ARMATURE];for(var s=0,l=a.length;s<l;s++){var h=a[s];o.addArmatureData(e.parseArmatureData(h,r))}e.tempDragonBonesData=null;return o};e.parseArmatureData=function(i,n){var r=new t.ArmatureData;r.name=i[t.ConstValues.A_NAME];var o;var a;var s=i[t.ConstValues.BONE];for(o=0,a=s.length;o<a;o++){var l=s[o];r.addBoneData(e.parseBoneData(l))}var h=i[t.ConstValues.SKIN];for(o=0,a=h.length;o<a;o++){var u=h[o];var p=u[t.ConstValues.SLOT];for(var c=0,f=p.length;c<f;c++){var m=p[c];r.addSlotData(e.parseSlotData(m))}}for(o=0,a=h.length;o<a;o++){var d=h[o];r.addSkinData(e.parseSkinData(d))}if(e.tempDragonBonesData.isGlobal){t.DBDataUtil.transformArmatureData(r)}r.sortBoneDataList();var y=i[t.ConstValues.ANIMATION];for(o=0,a=y.length;o<a;o++){var g=y[o];var v=e.parseAnimationData(g,n);t.DBDataUtil.addHideTimeline(v,r);t.DBDataUtil.transformAnimationData(v,r,e.tempDragonBonesData.isGlobal);r.addAnimationData(v)}return r};e.parseBoneData=function(i){var n=new t.BoneData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.length=Number(i[t.ConstValues.A_LENGTH])||0;n.inheritRotation=e.getBoolean(i,t.ConstValues.A_INHERIT_ROTATION,true);n.inheritScale=e.getBoolean(i,t.ConstValues.A_INHERIT_SCALE,true);e.parseTransform(i[t.ConstValues.TRANSFORM],n.transform);if(e.tempDragonBonesData.isGlobal){n.global.copy(n.transform)}return n};e.parseSkinData=function(i){var n=new t.SkinData;n.name=i[t.ConstValues.A_NAME];var r=i[t.ConstValues.SLOT];for(var o=0,a=r.length;o<a;o++){var s=r[o];n.addSlotData(e.parseSkinSlotData(s))}return n};e.parseSkinSlotData=function(i){var n=new t.SlotData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.zOrder=i[t.ConstValues.A_Z_ORDER];n.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,0)||0;n.blendMode=i[t.ConstValues.A_BLENDMODE];var r=i[t.ConstValues.DISPLAY];for(var o=0;r&&o<r.length;o++){var a=r[o];n.addDisplayData(e.parseDisplayData(a))}return n};e.parseSlotData=function(i){var n=new t.SlotData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.zOrder=i[t.ConstValues.A_Z_ORDER];n.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,0)||0;n.blendMode=i[t.ConstValues.A_BLENDMODE];n.displayIndex=0;return n};e.parseDisplayData=function(i){var n=new t.DisplayData;n.name=i[t.ConstValues.A_NAME];n.type=i[t.ConstValues.A_TYPE];e.parseTransform(i[t.ConstValues.TRANSFORM],n.transform,n.pivot);if(e.tempDragonBonesData!=null){e.tempDragonBonesData.addDisplayData(n)}return n};e.parseAnimationData=function(i,n){var r=new t.AnimationData;r.name=i[t.ConstValues.A_NAME];r.frameRate=n;r.duration=Math.round((e.getNumber(i,t.ConstValues.A_DURATION,1)||1)*1e3/n);r.playTimes=e.getNumber(i,t.ConstValues.A_LOOP,1);r.playTimes=r.playTimes!=NaN?r.playTimes:1;r.fadeTime=e.getNumber(i,t.ConstValues.A_FADE_IN_TIME,0)||0;r.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,NaN);r.autoTween=e.getBoolean(i,t.ConstValues.A_AUTO_TWEEN,true);var o=i[t.ConstValues.FRAME];var a=0;var s=0;if(o){for(a=0,s=o.length;a<s;a++){var l=o[a];var h=e.parseTransformFrame(l,n);r.addFrame(h)}}e.parseTimeline(i,r);var u=r.duration;var p=[];var c=[];var f=i[t.ConstValues.TIMELINE];var m;if(f){for(a=0,s=f.length;a<s;a++){var d=f[a];var y=e.parseTransformTimeline(d,r.duration,n);y=e.parseTransformTimeline(d,r.duration,n);u=Math.min(u,y.frameList[y.frameList.length-1].duration);r.addTimeline(y);var g=e.parseSlotTimeline(d,r.duration,n);r.addSlotTimeline(g);if(r.autoTween&&!m){var v;for(var _=0,I=g.frameList.length;_<I;_++){v=g.frameList[_];if(v&&v.displayIndex<0){
m=true;break}}}}var w=r.tweenEasing;if(m){s=r.slotTimelineList.length;for(a=0;a<s;a++){g=r.slotTimelineList[a];y=r.timelineList[a];var x;var S;var T;for(_=0,I=g.frameList.length;_<I;_++){S=g.frameList[_];x=y.frameList[_];T=_==I-1?g.frameList[0]:g.frameList[_+1];if(S.displayIndex<0||T.displayIndex<0){x.tweenEasing=S.tweenEasing=NaN}else if(w==10){x.tweenEasing=S.tweenEasing=0}else if(!isNaN(w)){x.tweenEasing=S.tweenEasing=w}else if(x.tweenEasing==10){x.tweenEasing=0}}}r.autoTween=false}}if(r.frameList.length>0){u=Math.min(u,r.frameList[r.frameList.length-1].duration)}r.lastFrameDuration=u;return r};e.parseSlotTimeline=function(i,n,r){var o=new t.SlotTimeline;o.name=i[t.ConstValues.A_NAME];o.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;o.offset=e.getNumber(i,t.ConstValues.A_OFFSET,0)||0;o.duration=n;var a=i[t.ConstValues.FRAME];for(var s=0,l=a.length;s<l;s++){var h=a[s];var u=e.parseSlotFrame(h,r);o.addFrame(u)}e.parseTimeline(i,o);return o};e.parseSlotFrame=function(i,n){var r=new t.SlotFrame;e.parseFrame(i,r,n);r.visible=!e.getBoolean(i,t.ConstValues.A_HIDE,false);r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,10);r.displayIndex=Math.floor(e.getNumber(i,t.ConstValues.A_DISPLAY_INDEX,0)||0);r.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,e.tempDragonBonesData.isGlobal?NaN:0);var o=i[t.ConstValues.COLOR_TRANSFORM];if(o){r.color=new t.ColorTransform;e.parseColorTransform(o,r.color)}return r};e.parseTransformTimeline=function(i,n,r){var o=new t.TransformTimeline;o.name=i[t.ConstValues.A_NAME];o.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;o.offset=e.getNumber(i,t.ConstValues.A_OFFSET,0)||0;o.originPivot.x=e.getNumber(i,t.ConstValues.A_PIVOT_X,0)||0;o.originPivot.y=e.getNumber(i,t.ConstValues.A_PIVOT_Y,0)||0;o.duration=n;var a=i[t.ConstValues.FRAME];for(var s=0,l=a.length;s<l;s++){var h=a[s];var u=e.parseTransformFrame(h,r);o.addFrame(u)}e.parseTimeline(i,o);return o};e.parseTransformFrame=function(i,n){var r=new t.TransformFrame;e.parseFrame(i,r,n);r.visible=!e.getBoolean(i,t.ConstValues.A_HIDE,false);r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,10);r.tweenRotate=Math.floor(e.getNumber(i,t.ConstValues.A_TWEEN_ROTATE,0)||0);r.tweenScale=e.getBoolean(i,t.ConstValues.A_TWEEN_SCALE,true);e.parseTransform(i[t.ConstValues.TRANSFORM],r.transform,r.pivot);if(e.tempDragonBonesData.isGlobal){r.global.copy(r.transform)}r.scaleOffset.x=e.getNumber(i,t.ConstValues.A_SCALE_X_OFFSET,0)||0;r.scaleOffset.y=e.getNumber(i,t.ConstValues.A_SCALE_Y_OFFSET,0)||0;return r};e.parseTimeline=function(t,e){var i=0;var n;var r=e.frameList;for(var o=0,a=r.length;o<a;o++){n=r[o];n.position=i;i+=n.duration}if(n){n.duration=e.duration-n.position}};e.parseFrame=function(e,i,n){if(n===void 0){n=0}i.duration=Math.round((e[t.ConstValues.A_DURATION]||1)*1e3/n);i.action=e[t.ConstValues.A_ACTION];i.event=e[t.ConstValues.A_EVENT];i.sound=e[t.ConstValues.A_SOUND]};e.parseTransform=function(i,n,r){if(r===void 0){r=null}if(i){if(n){n.x=e.getNumber(i,t.ConstValues.A_X,0)||0;n.y=e.getNumber(i,t.ConstValues.A_Y,0)||0;n.skewX=e.getNumber(i,t.ConstValues.A_SKEW_X,0)*t.ConstValues.ANGLE_TO_RADIAN||0;n.skewY=e.getNumber(i,t.ConstValues.A_SKEW_Y,0)*t.ConstValues.ANGLE_TO_RADIAN||0;n.scaleX=e.getNumber(i,t.ConstValues.A_SCALE_X,1)||0;n.scaleY=e.getNumber(i,t.ConstValues.A_SCALE_Y,1)||0}if(r){r.x=e.getNumber(i,t.ConstValues.A_PIVOT_X,0)||0;r.y=e.getNumber(i,t.ConstValues.A_PIVOT_Y,0)||0}}};e.parseColorTransform=function(i,n){if(i){if(n){n.alphaOffset=e.getNumber(i,t.ConstValues.A_ALPHA_OFFSET,0);n.redOffset=e.getNumber(i,t.ConstValues.A_RED_OFFSET,0);n.greenOffset=e.getNumber(i,t.ConstValues.A_GREEN_OFFSET,0);n.blueOffset=e.getNumber(i,t.ConstValues.A_BLUE_OFFSET,0);n.alphaMultiplier=e.getNumber(i,t.ConstValues.A_ALPHA_MULTIPLIER,100)*.01;n.redMultiplier=e.getNumber(i,t.ConstValues.A_RED_MULTIPLIER,100)*.01;n.greenMultiplier=e.getNumber(i,t.ConstValues.A_GREEN_MULTIPLIER,100)*.01;n.blueMultiplier=e.getNumber(i,t.ConstValues.A_BLUE_MULTIPLIER,100)*.01}}};e.getBoolean=function(t,e,i){if(t&&e in t){switch(String(t[e])){case"0":case"NaN":case"":case"false":case"null":case"undefined":return false;case"1":case"true":default:return true}}return i};e.getNumber=function(t,e,i){if(t&&e in t){switch(String(t[e])){case"NaN":case"":case"false":case"null":case"undefined":return NaN;default:return Number(t[e])}}return i};return e}();t.Data3Parser=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e;p=n.prototype;e.parseTextureAtlasData=function(i,n){if(n===void 0){n=1}var r={};var o;var a=i[t.ConstValues.SUB_TEXTURE];for(var s=0,l=a.length;s<l;s++){var h=a[s];var u=h[t.ConstValues.A_NAME];var p=new t.Rectangle;p.x=e.getNumber(h,t.ConstValues.A_X,0)/n;p.y=e.getNumber(h,t.ConstValues.A_Y,0)/n;p.width=e.getNumber(h,t.ConstValues.A_WIDTH,0)/n;p.height=e.getNumber(h,t.ConstValues.A_HEIGHT,0)/n;var c=h[t.ConstValues.A_ROTATED]=="true";var f=e.getNumber(h,t.ConstValues.A_FRAME_WIDTH,0)/n;var m=e.getNumber(h,t.ConstValues.A_FRAME_HEIGHT,0)/n;if(f>0&&m>0){o=new t.Rectangle;o.x=e.getNumber(h,t.ConstValues.A_FRAME_X,0)/n;o.y=e.getNumber(h,t.ConstValues.A_FRAME_Y,0)/n;o.width=f;o.height=m}else{o=null}r[u]=new t.TextureData(p,o,c)}return r};e.parseDragonBonesData=function(i){if(!i){throw new Error}var n=i[t.ConstValues.A_VERSION];n=n.toString();if(n.toString()!=t.DragonBones.DATA_VERSION&&n.toString()!=t.DragonBones.PARENT_COORDINATE_DATA_VERSION&&n.toString()!="2.3"){throw new Error(egret.getString(4003))}else if(n.toString()==t.DragonBones.PARENT_COORDINATE_DATA_VERSION||n.toString()=="2.3"){return t.Data3Parser.parseDragonBonesData(i)}var r=e.getNumber(i,t.ConstValues.A_FRAME_RATE,0)||0;var o=new t.DragonBonesData;o.name=i[t.ConstValues.A_NAME];o.isGlobal=i[t.ConstValues.A_IS_GLOBAL]=="0"?false:true;e.tempDragonBonesData=o;var a=i[t.ConstValues.ARMATURE];for(var s=0,l=a.length;s<l;s++){var h=a[s];o.addArmatureData(e.parseArmatureData(h,r))}e.tempDragonBonesData=null;return o};e.parseArmatureData=function(i,n){var r=new t.ArmatureData;r.name=i[t.ConstValues.A_NAME];var o=i[t.ConstValues.BONE];var a;var s;for(a=0,s=o.length;a<s;a++){var l=o[a];r.addBoneData(e.parseBoneData(l))}var h=i[t.ConstValues.SLOT];for(a=0,s=h.length;a<s;a++){var u=h[a];r.addSlotData(e.parseSlotData(u))}var p=i[t.ConstValues.SKIN];for(a=0,s=p.length;a<s;a++){var c=p[a];r.addSkinData(e.parseSkinData(c))}if(e.tempDragonBonesData.isGlobal){t.DBDataUtil.transformArmatureData(r)}r.sortBoneDataList();var f=i[t.ConstValues.ANIMATION];for(a=0,s=f.length;a<s;a++){var m=f[a];var d=e.parseAnimationData(m,n);t.DBDataUtil.addHideTimeline(d,r,true);t.DBDataUtil.transformAnimationData(d,r,e.tempDragonBonesData.isGlobal);r.addAnimationData(d)}return r};e.parseBoneData=function(i){var n=new t.BoneData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.length=Number(i[t.ConstValues.A_LENGTH])||0;n.inheritRotation=e.getBoolean(i,t.ConstValues.A_INHERIT_ROTATION,true);n.inheritScale=e.getBoolean(i,t.ConstValues.A_INHERIT_SCALE,true);e.parseTransform(i[t.ConstValues.TRANSFORM],n.transform);if(e.tempDragonBonesData.isGlobal){n.global.copy(n.transform)}return n};e.parseSkinData=function(i){var n=new t.SkinData;n.name=i[t.ConstValues.A_NAME];var r=i[t.ConstValues.SLOT];for(var o=0,a=r.length;o<a;o++){var s=r[o];n.addSlotData(e.parseSlotDisplayData(s))}return n};e.parseSlotData=function(i){var n=new t.SlotData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,0)||0;n.displayIndex=e.getNumber(i,t.ConstValues.A_DISPLAY_INDEX,0);n.blendMode=i[t.ConstValues.A_BLENDMODE];return n};e.parseSlotDisplayData=function(i){var n=new t.SlotData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,0)||0;var r=i[t.ConstValues.DISPLAY];for(var o=0;r&&o<r.length;o++){var a=r[o];n.addDisplayData(e.parseDisplayData(a))}return n};e.parseDisplayData=function(i){var n=new t.DisplayData;n.name=i[t.ConstValues.A_NAME];n.type=i[t.ConstValues.A_TYPE];e.parseTransform(i[t.ConstValues.TRANSFORM],n.transform,n.pivot);n.pivot.x=NaN;n.pivot.y=NaN;if(e.tempDragonBonesData!=null){e.tempDragonBonesData.addDisplayData(n)}return n};e.parseAnimationData=function(i,n){var r=new t.AnimationData;r.name=i[t.ConstValues.A_NAME];r.frameRate=n;r.duration=Math.round((e.getNumber(i,t.ConstValues.A_DURATION,1)||1)*1e3/n);r.playTimes=e.getNumber(i,t.ConstValues.A_PLAY_TIMES,1);r.playTimes=r.playTimes!=NaN?r.playTimes:1;r.fadeTime=e.getNumber(i,t.ConstValues.A_FADE_IN_TIME,0)||0;r.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,NaN);r.autoTween=e.getBoolean(i,t.ConstValues.A_AUTO_TWEEN,true);var o=i[t.ConstValues.FRAME];var a=0;var s=0;if(o){for(a=0,s=o.length;a<s;a++){var l=o[a];var h=e.parseTransformFrame(l,n);r.addFrame(h)}}e.parseTimeline(i,r);var u=r.duration;var p=i[t.ConstValues.BONE];if(p){for(a=0,s=p.length;a<s;a++){var c=p[a];if(c){var f=e.parseTransformTimeline(c,r.duration,n);if(f.frameList.length>0){u=Math.min(u,f.frameList[f.frameList.length-1].duration)}r.addTimeline(f)}}}var m=i[t.ConstValues.SLOT];if(m){for(a=0,s=m.length;a<s;a++){var d=m[a];if(d){var y=e.parseSlotTimeline(d,r.duration,n);if(y.frameList.length>0){u=Math.min(u,y.frameList[y.frameList.length-1].duration);r.addSlotTimeline(y)}}}}if(r.frameList.length>0){u=Math.min(u,r.frameList[r.frameList.length-1].duration)}r.lastFrameDuration=u;return r};e.parseTransformTimeline=function(i,n,r){var o=new t.TransformTimeline;o.name=i[t.ConstValues.A_NAME];o.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;o.offset=e.getNumber(i,t.ConstValues.A_OFFSET,0)||0;o.originPivot.x=e.getNumber(i,t.ConstValues.A_PIVOT_X,0)||0;o.originPivot.y=e.getNumber(i,t.ConstValues.A_PIVOT_Y,0)||0;o.duration=n;var a=i[t.ConstValues.FRAME];for(var s=0,l=a.length;s<l;s++){var h=a[s];var u=e.parseTransformFrame(h,r);o.addFrame(u)}e.parseTimeline(i,o);return o};e.parseSlotTimeline=function(i,n,r){var o=new t.SlotTimeline;o.name=i[t.ConstValues.A_NAME];o.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;o.offset=e.getNumber(i,t.ConstValues.A_OFFSET,0)||0;o.duration=n;var a=i[t.ConstValues.FRAME];for(var s=0,l=a.length;s<l;s++){var h=a[s];var u=e.parseSlotFrame(h,r);o.addFrame(u)}e.parseTimeline(i,o);return o};e.parseTransformFrame=function(i,n){var r=new t.TransformFrame;e.parseFrame(i,r,n);r.visible=!e.getBoolean(i,t.ConstValues.A_HIDE,false);r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,10);r.tweenRotate=Math.floor(e.getNumber(i,t.ConstValues.A_TWEEN_ROTATE,0)||0);r.tweenScale=e.getBoolean(i,t.ConstValues.A_TWEEN_SCALE,true);r.displayIndex=Math.floor(e.getNumber(i,t.ConstValues.A_DISPLAY_INDEX,0)||0);e.parseTransform(i[t.ConstValues.TRANSFORM],r.transform,r.pivot);if(e.tempDragonBonesData.isGlobal){r.global.copy(r.transform)}r.scaleOffset.x=e.getNumber(i,t.ConstValues.A_SCALE_X_OFFSET,0)||0;r.scaleOffset.y=e.getNumber(i,t.ConstValues.A_SCALE_Y_OFFSET,0)||0;return r};e.parseSlotFrame=function(i,n){var r=new t.SlotFrame;e.parseFrame(i,r,n);r.visible=!e.getBoolean(i,t.ConstValues.A_HIDE,false);r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,10);r.displayIndex=Math.floor(e.getNumber(i,t.ConstValues.A_DISPLAY_INDEX,0)||0);r.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,e.tempDragonBonesData.isGlobal?NaN:0);var o=i[t.ConstValues.COLOR];if(o){r.color=new t.ColorTransform;e.parseColorTransform(o,r.color)}return r};e.parseTimeline=function(t,e){var i=0;var n;var r=e.frameList;for(var o=0,a=r.length;o<a;o++){n=r[o];n.position=i;i+=n.duration}if(n){n.duration=e.duration-n.position}};e.parseFrame=function(e,i,n){if(n===void 0){n=0}i.duration=Math.round((e[t.ConstValues.A_DURATION]||1)*1e3/n);i.action=e[t.ConstValues.A_ACTION];i.event=e[t.ConstValues.A_EVENT];i.sound=e[t.ConstValues.A_SOUND];var r=e[t.ConstValues.A_CURVE];if(r!=null&&r.length==4){i.curve=new t.CurveData;i.curve.pointList=[new t.Point(r[0],r[1]),new t.Point(r[2],r[3])]}};e.parseTransform=function(i,n,r){if(r===void 0){r=null}if(i){if(n){n.x=e.getNumber(i,t.ConstValues.A_X,0)||0;n.y=e.getNumber(i,t.ConstValues.A_Y,0)||0;n.skewX=e.getNumber(i,t.ConstValues.A_SKEW_X,0)*t.ConstValues.ANGLE_TO_RADIAN||0;n.skewY=e.getNumber(i,t.ConstValues.A_SKEW_Y,0)*t.ConstValues.ANGLE_TO_RADIAN||0;n.scaleX=e.getNumber(i,t.ConstValues.A_SCALE_X,1)||0;n.scaleY=e.getNumber(i,t.ConstValues.A_SCALE_Y,1)||0}if(r){r.x=e.getNumber(i,t.ConstValues.A_PIVOT_X,0)||0;r.y=e.getNumber(i,t.ConstValues.A_PIVOT_Y,0)||0}}};e.parseColorTransform=function(i,n){if(n){n.alphaOffset=e.getNumber(i,t.ConstValues.A_ALPHA_OFFSET,0);n.redOffset=e.getNumber(i,t.ConstValues.A_RED_OFFSET,0);n.greenOffset=e.getNumber(i,t.ConstValues.A_GREEN_OFFSET,0);n.blueOffset=e.getNumber(i,t.ConstValues.A_BLUE_OFFSET,0);n.alphaMultiplier=e.getNumber(i,t.ConstValues.A_ALPHA_MULTIPLIER,100)*.01;n.redMultiplier=e.getNumber(i,t.ConstValues.A_RED_MULTIPLIER,100)*.01;n.greenMultiplier=e.getNumber(i,t.ConstValues.A_GREEN_MULTIPLIER,100)*.01;n.blueMultiplier=e.getNumber(i,t.ConstValues.A_BLUE_MULTIPLIER,100)*.01}};e.getBoolean=function(t,e,i){if(t&&e in t){switch(String(t[e])){case"0":case"NaN":case"":case"false":case"null":case"undefined":return false;case"1":case"true":default:return true}}return i};e.getNumber=function(t,e,i){if(t&&e in t){switch(String(t[e])){case"NaN":case"":case"false":case"null":case"undefined":return NaN;default:return Number(t[e])}}return i};return e}();t.DataParser=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e,i){this.region=t;this.frame=e;this.rotated=i}var e=__define,i=t;p=i.prototype;return t}();t.TextureData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e;p=n.prototype;e.cloneColor=function(e){var i=new t.ColorTransform;i.redMultiplier=e.redMultiplier;i.greenMultiplier=e.greenMultiplier;i.blueMultiplier=e.blueMultiplier;i.alphaMultiplier=e.alphaMultiplier;i.redOffset=e.redOffset;i.greenOffset=e.greenOffset;i.blueOffset=e.blueOffset;i.alphaOffset=e.alphaOffset;return i};e.isEqual=function(t,e){return t.alphaOffset==e.alphaOffset&&t.redOffset==e.redOffset&&t.greenOffset==e.greenOffset&&t.blueOffset==e.blueOffset&&t.alphaMultiplier==e.alphaMultiplier&&t.redMultiplier==e.redMultiplier&&t.greenMultiplier==e.greenMultiplier&&t.blueMultiplier==e.blueMultiplier};e.minus=function(t,e,i){i.alphaOffset=t.alphaOffset-e.alphaOffset;i.redOffset=t.redOffset-e.redOffset;i.greenOffset=t.greenOffset-e.greenOffset;i.blueOffset=t.blueOffset-e.blueOffset;i.alphaMultiplier=t.alphaMultiplier-e.alphaMultiplier;i.redMultiplier=t.redMultiplier-e.redMultiplier;i.greenMultiplier=t.greenMultiplier-e.greenMultiplier;i.blueMultiplier=t.blueMultiplier-e.blueMultiplier};e.originalColor=new t.ColorTransform;return e}();t.ColorTransformUtil=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){}var e=__define,i=t;p=i.prototype;t.ANGLE_TO_RADIAN=Math.PI/180;t.RADIAN_TO_ANGLE=180/Math.PI;t.DRAGON_BONES="dragonBones";t.ARMATURE="armature";t.SKIN="skin";t.BONE="bone";t.SLOT="slot";t.DISPLAY="display";t.ANIMATION="animation";t.TIMELINE="timeline";t.FRAME="frame";t.TRANSFORM="transform";t.COLOR_TRANSFORM="colorTransform";t.COLOR="color";t.RECTANGLE="rectangle";t.ELLIPSE="ellipse";t.TEXTURE_ATLAS="TextureAtlas";t.SUB_TEXTURE="SubTexture";t.A_ROTATED="rotated";t.A_FRAME_X="frameX";t.A_FRAME_Y="frameY";t.A_FRAME_WIDTH="frameWidth";t.A_FRAME_HEIGHT="frameHeight";t.A_VERSION="version";t.A_IMAGE_PATH="imagePath";t.A_FRAME_RATE="frameRate";t.A_NAME="name";t.A_IS_GLOBAL="isGlobal";t.A_PARENT="parent";t.A_LENGTH="length";t.A_TYPE="type";t.A_FADE_IN_TIME="fadeInTime";t.A_DURATION="duration";t.A_SCALE="scale";t.A_OFFSET="offset";t.A_LOOP="loop";t.A_PLAY_TIMES="playTimes";t.A_EVENT="event";t.A_EVENT_PARAMETERS="eventParameters";t.A_SOUND="sound";t.A_ACTION="action";t.A_HIDE="hide";t.A_AUTO_TWEEN="autoTween";t.A_TWEEN_EASING="tweenEasing";t.A_TWEEN_ROTATE="tweenRotate";t.A_TWEEN_SCALE="tweenScale";t.A_DISPLAY_INDEX="displayIndex";t.A_Z_ORDER="z";t.A_BLENDMODE="blendMode";t.A_WIDTH="width";t.A_HEIGHT="height";t.A_INHERIT_SCALE="inheritScale";t.A_INHERIT_ROTATION="inheritRotation";t.A_X="x";t.A_Y="y";t.A_SKEW_X="skX";t.A_SKEW_Y="skY";t.A_SCALE_X="scX";t.A_SCALE_Y="scY";t.A_PIVOT_X="pX";t.A_PIVOT_Y="pY";t.A_ALPHA_OFFSET="aO";t.A_RED_OFFSET="rO";t.A_GREEN_OFFSET="gO";t.A_BLUE_OFFSET="bO";t.A_ALPHA_MULTIPLIER="aM";t.A_RED_MULTIPLIER="rM";t.A_GREEN_MULTIPLIER="gM";t.A_BLUE_MULTIPLIER="bM";t.A_CURVE="curve";t.A_SCALE_X_OFFSET="scXOffset";t.A_SCALE_Y_OFFSET="scYOffset";t.A_SCALE_MODE="scaleMode";t.A_FIXED_ROTATION="fixedRotation";return t}();t.ConstValues=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e;p=n.prototype;e.transformArmatureData=function(e){var i=e.boneDataList;var n=i.length;while(n--){var r=i[n];if(r.parent){var o=e.getBoneData(r.parent);if(o){r.transform.copy(r.global);t.TransformUtil.globalToLocal(r.transform,o.global)}}}};e.transformArmatureDataAnimations=function(t){var i=t.animationDataList;var n=i.length;while(n--){e.transformAnimationData(i[n],t,false)}};e.transformRelativeAnimationData=function(t,e){};e.transformAnimationData=function(i,n,r){if(!r){e.transformRelativeAnimationData(i,n);return}var o=n.getSkinData(null);var a=n.boneDataList;var s;if(o){s=o.slotDataList}for(var l=0;l<a.length;l++){var h=a[l];var u=i.getTimeline(h.name);var p=i.getSlotTimeline(h.name);if(!u&&!p){continue}var c=null;if(s){for(var f=0,m=s.length;f<m;f++){c=s[f];if(c.parent==h.name){break}}}var d=u.frameList;if(p){var y=p.frameList}var g=null;var v=null;var _=null;var I=d.length;for(var f=0;f<I;f++){var w=d[f];e.setFrameTransform(i,n,h,w);w.transform.x-=h.transform.x;w.transform.y-=h.transform.y;w.transform.skewX-=h.transform.skewX;w.transform.skewY-=h.transform.skewY;w.transform.scaleX/=h.transform.scaleX;w.transform.scaleY/=h.transform.scaleY;if(_){var x=w.transform.skewX-_.transform.skewX;if(_.tweenRotate){if(_.tweenRotate>0){if(x<0){w.transform.skewX+=Math.PI*2;w.transform.skewY+=Math.PI*2}if(_.tweenRotate>1){w.transform.skewX+=Math.PI*2*(_.tweenRotate-1);w.transform.skewY+=Math.PI*2*(_.tweenRotate-1)}}else{if(x>0){w.transform.skewX-=Math.PI*2;w.transform.skewY-=Math.PI*2}if(_.tweenRotate<1){w.transform.skewX+=Math.PI*2*(_.tweenRotate+1);w.transform.skewY+=Math.PI*2*(_.tweenRotate+1)}}}else{w.transform.skewX=_.transform.skewX+t.TransformUtil.formatRadian(w.transform.skewX-_.transform.skewX);w.transform.skewY=_.transform.skewY+t.TransformUtil.formatRadian(w.transform.skewY-_.transform.skewY)}}_=w}if(p&&y){I=y.length;for(var f=0;f<I;f++){var S=y[f];if(!p.transformed){if(c){S.zOrder-=c.zOrder}}}p.transformed=true}u.transformed=true}};e.setFrameTransform=function(i,n,r,o){o.transform.copy(o.global);var a=n.getBoneData(r.parent);if(a){var s=i.getTimeline(a.name);if(s){var l=[];var h=[];while(s){l.push(s);h.push(a);a=n.getBoneData(a.parent);if(a){s=i.getTimeline(a.name)}else{s=null}}var u=l.length;var p;var c=new t.Matrix;var f=new t.DBTransform;var m=new t.Matrix;while(u--){s=l[u];a=h[u];e.getTimelineTransform(s,o.position,f,!p);if(!p){p=new t.DBTransform;p.copy(f)}else{f.x+=s.originTransform.x+a.transform.x;f.y+=s.originTransform.y+a.transform.y;f.skewX+=s.originTransform.skewX+a.transform.skewX;f.skewY+=s.originTransform.skewY+a.transform.skewY;f.scaleX*=s.originTransform.scaleX*a.transform.scaleX;f.scaleY*=s.originTransform.scaleY*a.transform.scaleY;t.TransformUtil.transformToMatrix(f,m,true);m.concat(c);t.TransformUtil.matrixToTransform(m,p,f.scaleX*p.scaleX>=0,f.scaleY*p.scaleY>=0)}t.TransformUtil.transformToMatrix(p,c,true)}t.TransformUtil.globalToLocal(o.transform,p)}}};e.getTimelineTransform=function(e,i,n,r){var o=e.frameList;var a=o.length;while(a--){var s=o[a];if(s.position<=i&&s.position+s.duration>i){if(a==o.length-1||i==s.position){n.copy(r?s.global:s.transform)}else{var l=s.tweenEasing;var h=(i-s.position)/s.duration;if(l&&l!=10){h=t.MathUtil.getEaseValue(h,l)}var u=o[a+1];var p=r?s.global:s.transform;var c=r?u.global:u.transform;n.x=p.x+(c.x-p.x)*h;n.y=p.y+(c.y-p.y)*h;n.skewX=t.TransformUtil.formatRadian(p.skewX+(c.skewX-p.skewX)*h);n.skewY=t.TransformUtil.formatRadian(p.skewY+(c.skewY-p.skewY)*h);n.scaleX=p.scaleX+(c.scaleX-p.scaleX)*h;n.scaleY=p.scaleY+(c.scaleY-p.scaleY)*h}break}}};e.addHideTimeline=function(t,e,i){if(i===void 0){i=false}var n=e.boneDataList;var r=e.slotDataList;var o=n.length;while(o--){var a=n[o];var s=a.name;if(!t.getTimeline(s)){if(t.hideTimelineNameMap.indexOf(s)<0){t.hideTimelineNameMap.push(s)}}}if(i){o=r.length;var l;var h;while(o--){l=r[o];h=l.name;if(!t.getSlotTimeline(h)){if(t.hideSlotTimelineNameMap.indexOf(h)<0){t.hideSlotTimelineNameMap.push(h)}}}}};return e}();t.DBDataUtil=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){}var e=__define,i=t;p=i.prototype;t.getEaseValue=function(e,i){var n=1;if(i>1){n=.5*(1-t.cos(e*Math.PI));i-=1}else if(i>0){n=1-Math.pow(1-e,2)}else if(i<0){i*=-1;n=Math.pow(e,2)}return(n-e)*i+e};t.isNumber=function(t){return typeof t==="number"&&!isNaN(t)};t.sin=function(e){e*=t.RADIAN_TO_ANGLE;var i=Math.floor(e);var n=i+1;var r=t.sinInt(i);var o=t.sinInt(n);return(e-i)*o+(n-e)*r};t.sinInt=function(t){t=t%360;if(t<0){t+=360}if(t<90){return db_sin_map[t]}if(t<180){return db_sin_map[180-t]}if(t<270){return-db_sin_map[t-180]}return-db_sin_map[360-t]};t.cos=function(e){return t.sin(Math.PI/2-e)};t.ANGLE_TO_RADIAN=Math.PI/180;t.RADIAN_TO_ANGLE=180/Math.PI;return t}();t.MathUtil=e})(dragonBones||(dragonBones={}));var db_sin_map={};for(var dbMathIndex=0;dbMathIndex<=90;dbMathIndex++){db_sin_map[dbMathIndex]=Math.sin(dbMathIndex*dragonBones.MathUtil.ANGLE_TO_RADIAN)}var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e;p=n.prototype;e.globalToLocal=function(t,i){e.transformToMatrix(t,e._helpTransformMatrix,true);e.transformToMatrix(i,e._helpParentTransformMatrix,true);e._helpParentTransformMatrix.invert();e._helpTransformMatrix.concat(e._helpParentTransformMatrix);e.matrixToTransform(e._helpTransformMatrix,t,t.scaleX*i.scaleX>=0,t.scaleY*i.scaleY>=0)};e.transformToMatrix=function(e,i,n){if(n===void 0){n=false}if(n){i.a=e.scaleX*t.MathUtil.cos(e.skewY);i.b=e.scaleX*t.MathUtil.sin(e.skewY);i.c=-e.scaleY*t.MathUtil.sin(e.skewX);i.d=e.scaleY*t.MathUtil.cos(e.skewX);i.tx=e.x;i.ty=e.y}else{i.a=t.MathUtil.cos(e.skewY);i.b=t.MathUtil.sin(e.skewY);i.c=-t.MathUtil.sin(e.skewX);i.d=t.MathUtil.cos(e.skewX);i.tx=e.x;i.ty=e.y}};e.matrixToTransform=function(t,e,i,n){e.x=t.tx;e.y=t.ty;e.scaleX=Math.sqrt(t.a*t.a+t.b*t.b)*(i?1:-1);e.scaleY=Math.sqrt(t.d*t.d+t.c*t.c)*(n?1:-1);var r=[];r[0]=Math.acos(t.d/e.scaleY);r[1]=-r[0];r[2]=Math.asin(-t.c/e.scaleY);r[3]=r[2]>=0?Math.PI-r[2]:r[2]-Math.PI;if(Number(r[0]).toFixed(4)==Number(r[2]).toFixed(4)||Number(r[0]).toFixed(4)==Number(r[3]).toFixed(4)){e.skewX=r[0]}else{e.skewX=r[1]}var o=[];o[0]=Math.acos(t.a/e.scaleX);o[1]=-o[0];o[2]=Math.asin(t.b/e.scaleX);o[3]=o[2]>=0?Math.PI-o[2]:o[2]-Math.PI;if(Number(o[0]).toFixed(4)==Number(o[2]).toFixed(4)||Number(o[0]).toFixed(4)==Number(o[3]).toFixed(4)){e.skewY=o[0]}else{e.skewY=o[1]}};e.formatRadian=function(t){if(t>Math.PI){t-=e.DOUBLE_PI}if(t<-Math.PI){t+=e.DOUBLE_PI}return t};e.normalizeRotation=function(t){t=(t+Math.PI)%(2*Math.PI);t=t>0?t:2*Math.PI+t;return t-Math.PI};e.HALF_PI=Math.PI*.5;e.DOUBLE_PI=Math.PI*2;e._helpTransformMatrix=new t.Matrix;e._helpParentTransformMatrix=new t.Matrix;return e}();t.TransformUtil=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this,this)}var n=__define,r=i;p=r.prototype;p._generateArmature=function(){var e=new t.Armature(new DisplayObjectContainer);return e};p._generateSlot=function(){var e=new t.EgretSlot;return e};p._generateDisplay=function(t,e,i,n){var r=new Bitmap;r.texture=t.getTexture(e);if(isNaN(i)||isNaN(n)){var o=t.getFrame(e);if(o!=null){i=o.width/2+o.x;n=o.height/2+o.y}else{i=r.width/2;n=r.height/2}}else{if(o!=null){i+=o.x;n+=o.y}}r.anchorOffsetX=i;r.anchorOffsetY=n;return r};p._generateFastArmature=function(){var e=new t.FastArmature(new DisplayObjectContainer);return e};p._generateFastSlot=function(){var e=new t.EgretFastSlot;return e};return i}(t.BaseFactory);t.EgretFactory=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this,this);this._egretDisplay=null}var n=__define,r=i;p=r.prototype;p.dispose=function(){if(this._displayList){var i=this._displayList.length;for(var n=0;n<i;n++){var r=this._displayList[n];if(r instanceof t.FastArmature){r.dispose()}}}e.prototype.dispose.call(this);this._egretDisplay=null};p._updateDisplay=function(t){this._egretDisplay=t};p._getDisplayIndex=function(){if(this._egretDisplay&&this._egretDisplay.parent){return this._egretDisplay.parent.getChildIndex(this._egretDisplay)}return-1};p._addDisplayToContainer=function(t,e){if(e===void 0){e=-1}var i=t;if(this._egretDisplay&&i){if(e<0){i.addChild(this._egretDisplay)}else{i.addChildAt(this._egretDisplay,Math.min(e,i.numChildren))}}};p._removeDisplayFromContainer=function(){if(this._egretDisplay&&this._egretDisplay.parent){this._egretDisplay.parent.removeChild(this._egretDisplay)}};p._updateTransform=function(){if(this._egretDisplay){this._egretDisplay.__hack_local_matrix=this._globalTransformMatrix}};p._updateDisplayVisible=function(t){};p._updateDisplayColor=function(t,i,n,r,o,a,s,l,h){if(h===void 0){h=false}e.prototype._updateDisplayColor.call(this,t,i,n,r,o,a,s,l,h);if(this._egretDisplay){this._egretDisplay.alpha=o}};p._updateDisplayBlendMode=function(t){if(this._egretDisplay&&t){this._egretDisplay.blendMode=t}};return i}(t.FastSlot);t.EgretFastSlot=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this,this);this._egretDisplay=null}var n=__define,r=i;p=r.prototype;p.dispose=function(){if(this._displayList){var i=this._displayList.length;for(var n=0;n<i;n++){var r=this._displayList[n];if(r instanceof t.Armature){r.dispose()}}}e.prototype.dispose.call(this);this._egretDisplay=null};p._updateDisplay=function(t){this._egretDisplay=t};p._getDisplayIndex=function(){if(this._egretDisplay&&this._egretDisplay.parent){return this._egretDisplay.parent.getChildIndex(this._egretDisplay)}return-1};p._addDisplayToContainer=function(t,e){if(e===void 0){e=-1}var i=t;if(this._egretDisplay&&i){if(e<0){i.addChild(this._egretDisplay)}else{i.addChildAt(this._egretDisplay,Math.min(e,i.numChildren))}}};p._removeDisplayFromContainer=function(){if(this._egretDisplay&&this._egretDisplay.parent){this._egretDisplay.parent.removeChild(this._egretDisplay)}};p._updateTransform=function(){if(this._egretDisplay){this._egretDisplay.__hack_local_matrix=this._globalTransformMatrix}};p._updateDisplayVisible=function(t){if(this._egretDisplay&&this._parent){this._egretDisplay.visible=this._parent._visible&&this._visible&&t}};p._updateDisplayColor=function(t,i,n,r,o,a,s,l,h){if(h===void 0){h=false}e.prototype._updateDisplayColor.call(this,t,i,n,r,o,a,s,l,h);if(this._egretDisplay){this._egretDisplay.alpha=o}};p._updateDisplayBlendMode=function(t){if(this._egretDisplay&&t){this._egretDisplay.blendMode=t}};p._calculateRelativeParentTransform=function(){this._global.scaleX=this._origin.scaleX*this._offset.scaleX;this._global.scaleY=this._origin.scaleY*this._offset.scaleY;this._global.skewX=this._origin.skewX+this._offset.skewX;this._global.skewY=this._origin.skewY+this._offset.skewY;this._global.x=this._origin.x+this._offset.x+this._parent._tweenPivot.x;this._global.y=this._origin.y+this._offset.y+this._parent._tweenPivot.y;if(this._displayDataList&&this._currentDisplayIndex>=0&&this._displayDataList[this._currentDisplayIndex]&&t.EgretTextureAtlas.rotatedDic[this._displayDataList[this._currentDisplayIndex].name]==1){this._global.skewX-=1.57;this._global.skewY-=1.57}};return i}(t.Slot);t.EgretSlot=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(e,i,n){if(n===void 0){n=1}this.texture=e;this.textureAtlasRawData=i;this._textureDatas={};this.scale=n;this.name=i[t.ConstValues.A_NAME];this.parseData(i);this.spriteSheet=new SpriteSheet(e)}var i=__define,n=e;p=n.prototype;p.getTexture=function(t){var i=this.spriteSheet.getTexture(t);if(!i){var n=this._textureDatas[t];if(n){i=this.spriteSheet.createTexture(t,n.region.x,n.region.y,n.region.width,n.region.height);if(n.rotated){e.rotatedDic[t]=1}}}return i};p.dispose=function(){this.texture=null};p.getRegion=function(e){var i=this._textureDatas[e];if(i&&i instanceof t.TextureData){return i.region}return null};p.getFrame=function(e){var i=this._textureDatas[e];if(i&&i instanceof t.TextureData){return i.frame}return null};p.parseData=function(e){this._textureDatas=t.DataParser.parseTextureAtlasData(e,this.scale)};e.rotatedDic={};return e}();t.EgretTextureAtlas=e})(dragonBones||(dragonBones={}));function UIRevoluteJoint(){return}UIRevoluteJoint.prototype=new UIOneJoint;UIRevoluteJoint.prototype.isUIJoint=true;UIRevoluteJoint.prototype.isUIRevoluteJoint=true;UIRevoluteJoint.prototype.initUIRevoluteJoint=function(t){this.initUIOneJoint(t);return this};UIRevoluteJoint.prototype.setValue=UIRevoluteJoint.prototype.setMotorSpeed=function(t){if(this.joint){this.joint.SetMotorSpeed(t)}return this};UIRevoluteJoint.prototype.getValue=UIRevoluteJoint.prototype.getMotorSpeed=function(){if(this.joint){return this.joint.GetMotorSpeed()}return 0};UIRevoluteJoint.prototype.recreateJoint=function(){var t=this.getWindow().world;if(t){Physics.destroyJointForElement(t,this);Physics.createJoint(t,this)}return};function UIRevoluteJointCreator(){var t=["ui-revolute-joint","ui-revolute-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIRevoluteJoint;return e.initUIRevoluteJoint(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIRevoluteJointCreator);function loadDragonBoneArmature(t,e,i,n){var r=new Image;r.onload=function(){httpGetJSON(t,function(i){var o=i;if(!i){console.log("Get Json Failed:"+t);return}httpGetJSON(e,function(t){if(!t){console.log("Get Json Failed:"+e);return}var i=t;var a=new dragonBones.factorys.GeneralFactory;a.addSkeletonData(dragonBones.objects.DataParser.parseSkeletonData(i));a.addTextureAtlas(new dragonBones.textures.GeneralTextureAtlas(r,o));for(var s=0;s<i.armature.length;s++){var l=i.armature[s].name;var h=a.buildArmature(l);if(s===0){n(h)}}})})};r.src=i;return}function onArmatureCreated(t){var e=document.getElementById("canvas");var i=e.getContext("2d");t.setPosition(300,300);function n(){i.clearRect(0,0,e.width,e.height);dragonBones.animation.WorldClock.clock.advanceTime(1/60);t.draw(i);setTimeout(n,16)}function r(){do{var e=Math.floor(Math.random()*t.animation.animationNameList.length);var i=t.animation.animationNameList[e]}while(i==t.animation.getLastAnimationName());t.animation.gotoAndPlay(i)}e.onclick=r;dragonBones.animation.WorldClock.clock.add(t);r();n();return}function UISoundMusic(){return}UISoundMusic.prototype=new UICheckBox;UISoundMusic.prototype.isUISoundMusic=true;UISoundMusic.prototype.initUISoundMusic=function(t){this.initUICheckBox(t);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;return this};UISoundMusic.prototype.shapeCanBeChild=function(t){return false};UISoundMusic.prototype.setValue=function(t){var e=this.getWindowManager();if(!e){return this}if(this.mode===Shape.MODE_EDITING){return this}e.setSoundMusicsEnable(t);if(!t){e.stopSoundMusic()}else{e.playSoundMusic()}return this};UISoundMusic.prototype.getValue=function(t){var e=this.getWindowManager();if(!e){return true}if(this.mode===Shape.MODE_EDITING){return e.soundMusicAutoPlay}else{return e.soundMusicsPlaying}};UISoundMusic.prototype.isPlaying=UISoundMusic.prototype.getValue;function UISoundMusicCreator(){var t=["ui-sound-music","ui-sound-music",null,1];
ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISoundMusic;return e.initUISoundMusic(this.type)};return}ShapeFactoryGet().addShapeCreator(new UISoundMusicCreator);function UIArtText(){return}UIArtText.prototype=new UIElement;UIArtText.prototype.isUIArtText=true;UIArtText.prototype.initUIArtText=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,null);this.setCanRectSelectable(false,true);this.addEventNames(["onUpdateTransform"]);return this};UIArtText.prototype.setText=function(t){var e=null;if(this.text!==t){this.text=t;this.setImage(UIElement.IMAGE_DEFAULT,null)}return this};UIArtText.prototype.getBgImage=function(){var t=this.getImageByType(UIElement.IMAGE_DEFAULT);if((!t||!t.src)&&this.text){var e=UIElement.createArtTextImage(this.text,this.style);this.setImage(UIElement.IMAGE_DEFAULT,e);t=this.getImageByType(UIElement.IMAGE_DEFAULT)}return t};UIArtText.prototype.shapeCanBeChild=function(t){return false};function UIArtTextCreator(){var t=["ui-art-text","ui-art-text",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIArtText;return e.initUIArtText(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIArtTextCreator);function UIPulleyJoint(){return}UIPulleyJoint.prototype=new UIFourJoint;UIPulleyJoint.prototype.isUIJoint=true;UIPulleyJoint.prototype.isUIPulleyJoint=true;UIPulleyJoint.prototype.initUIPulleyJoint=function(t,e,i){this.initUIFourJoint(t,e,i);this.visibleAtRunTime=true;return this};function UIPulleyJointCreator(){var t=["ui-pulley-joint","ui-pulley-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPulleyJoint;return e.initUIPulleyJoint(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIPulleyJointCreator);function UIEdge(){return}UIEdge.prototype=new UITwoPoints;UIEdge.prototype.isUIEdge=true;UIEdge.prototype.isUIPhysicsShape=true;UIEdge.prototype.initUIEdge=function(t,e,i){this.initUITwoPoints(t);return this};function UIEdgeCreator(){var t=["ui-edge","ui-edge",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIEdge;return e.initUIEdge(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIEdgeCreator);function UIStatus(){return}UIStatus.prototype=new UIElement;UIStatus.prototype.isUIStatus=true;UIStatus.prototype.initUIStatus=function(t,e,i){this.initUIElement(t);this.value=.5;this.roundRadius=5;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onBecomeZero","onBecomeFull","onChanged","onUpdateTransform"]);return this};UIStatus.prototype.shapeCanBeChild=function(t){return this.children.length===0&&t.isUILabel};UIStatus.prototype.setValue=function(t){this.value=Math.max(0,Math.min(100,t))/100;if(this.value===0){this.callOnBecomeZeroHandler()}else if(this.value===1){this.callOnBecomeFullHandler()}this.callOnChangedHandler(this.value);return this.getValue()};UIStatus.prototype.getValue=function(){return Math.round(this.value*100)};UIStatus.prototype.paintSelfOnly=function(t){var e=this.value;var i=this.roundRadius;var n=Math.round(e*this.h);var r=Math.round((1-e)*this.h);var o=Math.round(e*this.w);var a=Math.round((1-e)*this.w);if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.beginPath();if(this.horizonal){t.translate(o,0);drawRoundRect(t,a,this.h,i,RoundRect.TR|RoundRect.BR);t.translate(-o,0)}else{drawRoundRect(t,this.w,r,i,RoundRect.TL|RoundRect.TR)}t.fill()}if(!this.isTextColorTransparent()){t.fillStyle=this.style.textColor;t.beginPath();if(this.horizonal){drawRoundRect(t,o,this.h,i,RoundRect.TL|RoundRect.BL)}else{t.translate(0,r);drawRoundRect(t,this.w,n,i,RoundRect.BL|RoundRect.BR);t.translate(0,-r)}t.fill()}if(!this.isStrokeColorTransparent()&&this.style.lineWidth){t.beginPath();t.lineWidth=this.style.lineWidth;drawRoundRect(t,this.w,this.h,i,RoundRect.BL|RoundRect.BR|RoundRect.TL|RoundRect.TR);t.stroke()}return};function UIStatusCreator(){var t=["ui-status","ui-status",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIStatus;return e.initUIStatus(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIStatusCreator);function UITimer(){return}UITimer.prototype=new UIElement;UITimer.prototype.isUITimer=true;UITimer.prototype.initUITimer=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_AUTO;this.addEventNames(["onTimeout"]);return this};UITimer.prototype.shapeCanBeChild=function(t){return false};UITimer.prototype.onInit=function(){if(this.enable){this.start();console.log("start timer.")}else{console.log("not start disable timer.")}return};UITimer.prototype.setEnable=function(t){var e=this.getParent();if(!e||this.enable==t){return this}this.enable=t;if(t){this.start()}else{this.stop()}return};UITimer.prototype.getDuration=function(){if(this.durationType==="random"){var t=this.durationMin+Math.random()*(this.durationMax-this.durationMin);return t}else{return this.duration}};UITimer.prototype.start=function(){if(!this.enable){console.log("can not start disabled timer, please call setEnable first.")}if(this.timerID){console.log("Timer is alread started:"+this.timerID);return}var t=this;this.paused=false;this.startTime=Date.now();function e(){if(!t.enable||!t.timerID||!t.parentShape){t.timerID=null;return}if(t.paused){t.timerID=setTimeout(e,t.getDuration());return}t.callOnTimeoutHandler();t.times--;if(t.times<=0){t.timerID=null;console.log("timer stop "+t.name)}else{t.timerID=setTimeout(e,t.getDuration())}}if(this.delayStart){this.timerID=setTimeout(function(){t.timerID=setTimeout(e,t.getDuration())},this.delayStart)}else{this.timerID=setTimeout(e,t.getDuration())}return this};UITimer.prototype.stop=function(){if(this.timerID){clearTimeout(this.timerID);this.timerID=null}return this};UITimer.prototype.pause=function(){this.paused=true;return this};UITimer.prototype.resume=function(){this.paused=false;return this};UITimer.prototype.getElapsedTime=function(){return Date.now()-this.startTime};function UITimerCreator(){var t=["ui-timer","ui-timer",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITimer;return e.initUITimer(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UITimerCreator);function UISkeletonAnimation(){return}UISkeletonAnimation.prototype=new UIElement;UISkeletonAnimation.prototype.isUISkeletonAnimation=true;UISkeletonAnimation.prototype.initUISkeletonAnimation=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setSizeLimit(50,50);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,true);this.addEventNames(["onDoubleClick","onUpdateTransform","onLoadDone"]);this.animTimeScale=1;this.animationScaleX=1;this.animationScaleY=1;this.animationNames=[];return this};UISkeletonAnimation.prototype.play=function(t,e,i,n,r,o){var a=this;var s=Deferred();this.resume();this.doPlay(t,e,function(){if(typeof i==="function"){i.call(a)}s.resolve()},function(){if(typeof n==="function"){n.call(a)}},r,o);return s.promise};UISkeletonAnimation.prototype.setSkeletonJsonURL=function(t){this.skeletonJsonURL=t;return this};UISkeletonAnimation.prototype.getSkeletonJsonURL=function(){return this.skeletonJsonURL?this.skeletonJsonURL:""};UISkeletonAnimation.prototype.setTextureJsonURL=function(t){this.textureJsonURL=t;return this};UISkeletonAnimation.prototype.getTextureJsonURL=function(){return this.textureJsonURL?this.textureJsonURL:""};UISkeletonAnimation.prototype.setTextureURL=function(t){this.textureURL=t;return this};UISkeletonAnimation.prototype.getTextureURL=function(){return this.textureURL?this.textureURL:""};UISkeletonAnimation.prototype.loadSheletonData=function(t,e,i,n){var r=this;ResLoader.loadImage(i,function(i){var r=ResLoader.loadJson;if(t.indexOf(".atlas")>0){r=ResLoader.loadData}r(t,function(r){var o=r;if(!r){console.log("Get Json Failed:"+t);return}ResLoader.loadJson(e,function(t){if(!t){console.log("Get Json Failed:"+e);return}var r=t;n(i,o,r)})})});return};UISkeletonAnimation.prototype.createSkelentonAnimation=function(t){var e=this;this.destroyArmature();function i(i,n,r){e.createArmature(i,n,r);var o=e.getAnimationName();if(e.skinName){e.setSkin(e.skinName)}e.play(o);e.callOnLoadDoneHandler();if(t){t()}}this.loadSheletonData(this.textureJsonURL,this.skeletonJsonURL,this.textureURL,i);return};UISkeletonAnimation.prototype.onFromJsonDone=function(t){if(this.textureURL&&this.textureJsonURL&&this.skeletonJsonURL){function e(t,e,i){console.log("skeleton preload data done.")}this.loadSheletonData(this.textureJsonURL,this.skeletonJsonURL,this.textureURL,e)}if(t&&t.animationScale){if(!t.animationScaleX){this.animationScaleX=t.animationScale}if(!t.animationScaleY){this.animationScaleY=t.animationScale}delete this.animationScale}return};UISkeletonAnimation.prototype.onInit=function(){this.reload();return};UISkeletonAnimation.prototype.reload=function(t){if(this.textureURL&&this.textureJsonURL&&this.skeletonJsonURL){this.createSkelentonAnimation(t)}return};UISkeletonAnimation.prototype.destroy=function(){this.destroyArmature();Shape.prototype.destroy.call(this);return};UISkeletonAnimation.prototype.callOnLoadDoneHandler=function(){if(this.mode===Shape.MODE_EDITING){return}if(!this.handleOnLoadDone){var sourceCode=this.events["onLoadDone"];if(sourceCode){sourceCode="this.handleOnLoadDone = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnLoadDone){try{this.handleOnLoadDone()}catch(e){console.log("this.handleOnLoadDone:"+e.message)}}return true};UISkeletonAnimation.prototype.destroyArmature=function(){};UISkeletonAnimation.prototype.pause=function(){return this};UISkeletonAnimation.prototype.resume=function(){return this};UISkeletonAnimation.prototype.getAnimationNames=function(){return this.animationNames};UISkeletonAnimation.prototype.setAnimationName=function(t){this.animationName=t;return this};UISkeletonAnimation.prototype.getAnimationName=function(){if(this.animationName)return this.animationName;var t=this.getAnimationNames();return t?t[0]:""};UISkeletonAnimation.prototype.setScale=function(t){this.animationScaleX=t;this.animationScaleY=t;return this};UISkeletonAnimation.prototype.getScale=function(){return this.animationScaleX};UISkeletonAnimation.prototype.setScaleX=function(t){this.animationScaleX=t;return this};UISkeletonAnimation.prototype.setScaleY=function(t){this.animationScaleY=t;return this};UISkeletonAnimation.prototype.getScaleX=function(t){return this.animationScaleX};UISkeletonAnimation.prototype.getScaleY=function(t){return this.animationScaleY};UISkeletonAnimation.prototype.applyScale=function(t){};UISkeletonAnimation.prototype.setTimeScale=function(t){this.animTimeScale=t;return this};UISkeletonAnimation.prototype.setDuration=function(t){};UISkeletonAnimation.prototype.preprocessTextureAtlas=function(t){return t};UISkeletonAnimation.prototype.setSkin=function(t){this.skinName=t;return this};UISkeletonAnimation.prototype.getSkin=function(){return this.skinName};UISkeletonAnimation.prototype.getSkins=function(){return["default"]};UISkeletonAnimation.prototype.shapeCanBeChild=UISprite.prototype.shapeCanBeChild;function UIDragoneBones(){return}UIDragoneBones.prototype=new UISkeletonAnimation;UIDragoneBones.prototype.isUIDragoneBones=true;UIDragoneBones.prototype.initUIDragoneBones=UISkeletonAnimation.prototype.initUISkeletonAnimation;UIDragoneBones.prototype.pause=function(){if(this.armature){this.armature.animation.stop()}return this};UIDragoneBones.prototype.resume=function(){if(this.armature){this.armature.animation.play()}return this};UIDragoneBones.prototype.setupLoop=function(t,e,i,n){var r=this;function o(e){if(!e||!e.animationState||e.animationState.name!=t){return}if(r.onOneCycle){try{r.onOneCycle()}catch(e){console.debug("onOneCycle:",e)}}}function a(){if(r.onDone){try{r.onDone()}catch(t){console.debug("onDone:",t)}}}if(!isNaN(e)){this.onDone=i;this.onOneCycle=n;this._armature.addEventListener(dragonBones.AnimationEvent.COMPLETE,a);this._armature.addEventListener(dragonBones.AnimationEvent.LOOP_COMPLETE,o)}};UIDragoneBones.prototype.doPlay=UIDragoneBones.prototype.gotoAndPlay=function(t,e,i,n,r,o){this.animationName=t;if(this.armature){var a=this.armature;if(t&&a.animation.animationList.indexOf(t)>=0){if(i||n||e){e=isNaN(e)?4294967295:e;this.setupLoop.apply(a.animation,arguments)}var s=!r?0:undefined;a.animation.gotoAndPlay(t,s,o,e)}else if(this.animations&&t){this.animate(t)}else{console.log("Unknow animation name: "+t)}}return this};UIDragoneBones.prototype.destroyArmature=function(){if(this.armature){this.armature=null}return};UISkeletonAnimation.prototype.destroy=function(){this.destroyArmature();Shape.prototype.destroy.call(this);return};UISkeletonAnimation.prototype.getSlotRect=function(t){if(!this.armature){return null}var e=this.armature._slotList;for(var i=0;i<e.length;i++){var n=e[i];if(n.name===t){var r=n.getDisplay();return r.textureAtlasRect}}return null};UISkeletonAnimation.prototype.replaceSlotImage=function(t,e,i){if(!this.armature){return this}if(i&&i.w){i.width=i.w}if(i&&i.h){i.height=i.h}var n=this.armature._slotList;for(var r=0;r<n.length;r++){var o=n[r];if(o.name===t){o.image=e;o.imageRect=i}}return};UIDragoneBones.prototype.advanceTime=function(){var t=this;var e=this.armature;e.advanceTime=function(){if(t.isVisible()){dragonBones.Armature.prototype.advanceTime.apply(this,arguments)}};return this};UIDragoneBones.prototype.createArmature=function(t,e,i){if(this.armature){this.armature=null}if(!this.rendererContext){this.rendererContext=new CanvasRenderer;this.rendererContext.container=new DisplayObjectContainer}else{this.rendererContext.container.removeChildren()}var n=null;if(!MainContext.instance.factory){n=new dragonBones.EgretFactory;MainContext.instance.factory=n}else{n=MainContext.instance.factory}if(!n.getSkeletonData(i.name)){n.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(i))}if(!n.getTextureAtlas(e.name)){n.addTextureAtlas(new dragonBones.EgretTextureAtlas(t,e))}var r=n.buildArmature(i.armature[0].name,i.name);this.rendererContext.container.addChild(r.display);this.armature=r;this.animationNames=r.animation.animationList;this.animationName=this.animationNames.indexOf(this.animationName)>-1?this.animationName:this.animationNames[0]};UIDragoneBones.prototype.getDuration=UIDragoneBones.prototype.getAnimationDuration=function(t){if(!this.armature)return 0;t=t||this.animationName;var e=this.armature.animation.animationList.indexOf(t);if(e>-1){return this.armature.animation.animationDataList[e].duration}return 0};UIDragoneBones.prototype.paintSelfOnly=function(t){if(this.armature){if(!UIElement.timeScaleIsZero()){var e=t.timeStep*UIElement.timeScale*this.animTimeScale/1e3;this.armature.advanceTime(e)}var i=this.w>>1;var n=this.h>>1;t.save();var r=this.animationScaleX===1?1.01:this.animationScaleX;var o=this.animationScaleY===1?1.01:this.animationScaleY;this.rendererContext.setScale(r,o);this.rendererContext.setPosition(i,n);MainContext.instance.renderLoop.call(this.rendererContext,t);t.restore();t.needRedraw++}return};function UISkeletonAnimationCreator(t){var e=[t,t,null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIDragoneBones;return e.initUIDragoneBones(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UISkeletonAnimationCreator("ui-dragonbones"));ShapeFactoryGet().addShapeCreator(new UISkeletonAnimationCreator("ui-skeleton-animation"));var COMPILED=false;var goog=goog||{};goog.global=this;goog.global.CLOSURE_UNCOMPILED_DEFINES;goog.global.CLOSURE_DEFINES;goog.isDef=function(t){return t!==void 0};goog.exportPath_=function(t,e,i){var n=t.split(".");var r=i||goog.global;if(!(n[0]in r)&&r.execScript){r.execScript("var "+n[0])}for(var o;n.length&&(o=n.shift());){if(!n.length&&goog.isDef(e)){r[o]=e}else if(r[o]){r=r[o]}else{r=r[o]={}}}};goog.define=function(t,e){var i=e;if(!COMPILED){if(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,t)){i=goog.global.CLOSURE_UNCOMPILED_DEFINES[t]}else if(goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,t)){i=goog.global.CLOSURE_DEFINES[t]}}goog.exportPath_(t,i)};goog.define("goog.DEBUG",true);goog.define("goog.LOCALE","en");goog.define("goog.TRUSTED_SITE",true);goog.define("goog.STRICT_MODE_COMPATIBLE",false);goog.define("goog.DISALLOW_TEST_ONLY_CODE",COMPILED&&!goog.DEBUG);goog.define("goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING",false);goog.provide=function(t){if(!COMPILED){if(goog.isProvided_(t)){throw Error('Namespace "'+t+'" already declared.')}}goog.constructNamespace_(t)};goog.constructNamespace_=function(t,e){if(!COMPILED){delete goog.implicitNamespaces_[t];var i=t;while(i=i.substring(0,i.lastIndexOf("."))){if(goog.getObjectByName(i)){break}goog.implicitNamespaces_[i]=true}}goog.exportPath_(t,e)};goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;goog.module=function(t){if(!goog.isString(t)||!t||t.search(goog.VALID_MODULE_RE_)==-1){throw Error("Invalid module identifier")}if(!goog.isInModuleLoader_()){throw Error("Module "+t+" has been loaded incorrectly.")}if(goog.moduleLoaderState_.moduleName){throw Error("goog.module may only be called once per module.")}goog.moduleLoaderState_.moduleName=t;if(!COMPILED){if(goog.isProvided_(t)){throw Error('Namespace "'+t+'" already declared.')}delete goog.implicitNamespaces_[t]}};goog.module.get=function(t){return goog.module.getInternal_(t)};goog.module.getInternal_=function(t){if(!COMPILED){if(goog.isProvided_(t)){return t in goog.loadedModules_?goog.loadedModules_[t]:goog.getObjectByName(t)}else{return null}}};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return goog.moduleLoaderState_!=null};goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_()){throw new Error("goog.module.declareLegacyNamespace must be called from "+"within a goog.module")}if(!COMPILED&&!goog.moduleLoaderState_.moduleName){throw Error("goog.module must be called prior to "+"goog.module.declareLegacyNamespace.")}goog.moduleLoaderState_.declareLegacyNamespace=true};goog.setTestOnly=function(t){if(goog.DISALLOW_TEST_ONLY_CODE){t=t||"";throw Error("Importing test-only code into non-debug environment"+(t?": "+t:"."))}};goog.forwardDeclare=function(t){};goog.forwardDeclare("Document");goog.forwardDeclare("XMLHttpRequest");if(!COMPILED){goog.isProvided_=function(t){return t in goog.loadedModules_||!goog.implicitNamespaces_[t]&&goog.isDefAndNotNull(goog.getObjectByName(t))};goog.implicitNamespaces_={"goog.module":true}}goog.getObjectByName=function(t,e){var i=t.split(".");var n=e||goog.global;for(var r;r=i.shift();){if(goog.isDefAndNotNull(n[r])){n=n[r]}else{return null}}return n};goog.globalize=function(t,e){var i=e||goog.global;for(var n in t){i[n]=t[n]}};goog.addDependency=function(t,e,i,n){if(goog.DEPENDENCIES_ENABLED){var r,o;var a=t.replace(/\\/g,"/");var s=goog.dependencies_;for(var l=0;r=e[l];l++){s.nameToPath[r]=a;s.pathIsModule[a]=!!n}for(var h=0;o=i[h];h++){if(!(a in s.requires)){s.requires[a]={}}s.requires[a][o]=true}}};goog.define("goog.ENABLE_DEBUG_LOADER",true);goog.logToConsole_=function(t){if(goog.global.console){goog.global.console["error"](t)}};goog.require=function(t){if(!COMPILED){if(goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_){goog.maybeProcessDeferredDep_(t)}if(goog.isProvided_(t)){if(goog.isInModuleLoader_()){return goog.module.getInternal_(t)}else{return null}}if(goog.ENABLE_DEBUG_LOADER){var e=goog.getPathFromDeps_(t);if(e){goog.included_[e]=true;goog.writeScripts_();return null}}var i="goog.require could not find: "+t;goog.logToConsole_(i);throw Error(i)}};goog.basePath="";goog.global.CLOSURE_BASE_PATH;goog.global.CLOSURE_NO_DEPS;goog.global.CLOSURE_IMPORT_SCRIPT;goog.nullFunction=function(){};goog.abstractMethod=function(){throw Error("unimplemented abstract method")};goog.addSingletonGetter=function(t){t.getInstance=function(){if(t.instance_){return t.instance_}if(goog.DEBUG){goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=t}return t.instance_=new t}};goog.instantiatedSingletons_=[];goog.define("goog.LOAD_MODULE_USING_EVAL",true);goog.define("goog.SEAL_MODULE_EXPORTS",goog.DEBUG);goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;if(goog.DEPENDENCIES_ENABLED){goog.included_={};goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}};goog.inHtmlDocument_=function(){var t=goog.global.document;return typeof t!="undefined"&&"write"in t};goog.findBasePath_=function(){if(goog.isDef(goog.global.CLOSURE_BASE_PATH)){goog.basePath=goog.global.CLOSURE_BASE_PATH;return}else if(!goog.inHtmlDocument_()){return}var t=goog.global.document;var e=t.getElementsByTagName("SCRIPT");for(var i=e.length-1;i>=0;--i){var n=e[i];var r=n.src;var o=r.lastIndexOf("?");var a=o==-1?r.length:o;if(r.substr(a-7,7)=="base.js"){goog.basePath=r.substr(0,a-7);return}}};goog.importScript_=function(t,e){var i=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;if(i(t,e)){goog.dependencies_.written[t]=true}};goog.IS_OLD_IE_=!!(!goog.global.atob&&goog.global.document&&goog.global.document.all);goog.importModule_=function(t){var e='goog.retrieveAndExecModule_("'+t+'");';if(goog.importScript_("",e)){goog.dependencies_.written[t]=true}};goog.queuedModules_=[];goog.wrapModule_=function(t,e){if(!goog.LOAD_MODULE_USING_EVAL||!goog.isDef(goog.global.JSON)){return""+"goog.loadModule(function(exports) {"+'"use strict";'+e+"\n"+";return exports"+"});"+"\n//# sourceURL="+t+"\n"}else{return""+"goog.loadModule("+goog.global.JSON.stringify(e+"\n//# sourceURL="+t+"\n")+");"}};goog.loadQueuedModules_=function(){var t=goog.queuedModules_.length;if(t>0){var e=goog.queuedModules_;goog.queuedModules_=[];for(var i=0;i<t;i++){var n=e[i];goog.maybeProcessDeferredPath_(n)}}};goog.maybeProcessDeferredDep_=function(t){if(goog.isDeferredModule_(t)&&goog.allDepsAreAvailable_(t)){var e=goog.getPathFromDeps_(t);goog.maybeProcessDeferredPath_(goog.basePath+e)}};goog.isDeferredModule_=function(t){var e=goog.getPathFromDeps_(t);if(e&&goog.dependencies_.pathIsModule[e]){var i=goog.basePath+e;return i in goog.dependencies_.deferred}return false};goog.allDepsAreAvailable_=function(t){var e=goog.getPathFromDeps_(t);if(e&&e in goog.dependencies_.requires){for(var i in goog.dependencies_.requires[e]){if(!goog.isProvided_(i)&&!goog.isDeferredModule_(i)){return false}}}return true};goog.maybeProcessDeferredPath_=function(t){if(t in goog.dependencies_.deferred){var e=goog.dependencies_.deferred[t];delete goog.dependencies_.deferred[t];goog.globalEval(e)}};goog.loadModule=function(t){var e=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:undefined};var i;if(goog.isFunction(t)){i=t.call(goog.global,{})}else if(goog.isString(t)){i=goog.loadModuleFromSource_.call(goog.global,t)}else{throw Error("Invalid module definition")}var n=goog.moduleLoaderState_.moduleName;if(!goog.isString(n)||!n){throw Error('Invalid module name "'+n+'"')}if(goog.moduleLoaderState_.declareLegacyNamespace){goog.constructNamespace_(n,i)}else if(goog.SEAL_MODULE_EXPORTS&&Object.seal){Object.seal(i)}goog.loadedModules_[n]=i}finally{goog.moduleLoaderState_=e}};goog.loadModuleFromSource_=function(){"use strict";var exports={};eval(arguments[0]);return exports};goog.writeScriptSrcNode_=function(t){goog.global.document.write('<script type="text/javascript" src="'+t+'"></'+"script>")};goog.appendScriptSrcNode_=function(t){var e=goog.global.document;var i=e.createElement("script");i.type="text/javascript";i.src=t;i.defer=false;i.async=false;e.head.appendChild(i)};goog.writeScriptTag_=function(t,e){if(goog.inHtmlDocument_()){var i=goog.global.document;if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&i.readyState=="complete"){var n=/\bdeps.js$/.test(t);if(n){return false}else{throw Error('Cannot write "'+t+'" after document load')}}var r=goog.IS_OLD_IE_;if(e===undefined){if(!r){if(goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING){goog.appendScriptSrcNode_(t)}else{goog.writeScriptSrcNode_(t)}}else{var o=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ";i.write('<script type="text/javascript" src="'+t+'"'+o+"></"+"script>")}}else{i.write('<script type="text/javascript">'+e+"</"+"script>")}return true}else{return false}};goog.lastNonModuleScriptIndex_=0;goog.onScriptLoad_=function(t,e){if(t.readyState=="complete"&&goog.lastNonModuleScriptIndex_==e){goog.loadQueuedModules_()}return true};goog.writeScripts_=function(){var t=[];var e={};var i=goog.dependencies_;function n(r){if(r in i.written){return}if(r in i.visited){if(!(r in e)){e[r]=true;t.push(r)}return}i.visited[r]=true;if(r in i.requires){for(var o in i.requires[r]){if(!goog.isProvided_(o)){if(o in i.nameToPath){n(i.nameToPath[o])}else{throw Error("Undefined nameToPath for "+o)}}}}if(!(r in e)){e[r]=true;t.push(r)}}for(var r in goog.included_){if(!i.written[r]){n(r)}}for(var o=0;o<t.length;o++){var r=t[o];goog.dependencies_.written[r]=true}var a=goog.moduleLoaderState_;goog.moduleLoaderState_=null;var s=false;for(var o=0;o<t.length;o++){var r=t[o];if(r){if(!i.pathIsModule[r]){goog.importScript_(goog.basePath+r)}else{s=true;goog.importModule_(goog.basePath+r)}}else{goog.moduleLoaderState_=a;throw Error("Undefined script input")}}goog.moduleLoaderState_=a};goog.getPathFromDeps_=function(t){if(t in goog.dependencies_.nameToPath){return goog.dependencies_.nameToPath[t]}else{return null}};goog.findBasePath_();if(!goog.global.CLOSURE_NO_DEPS){goog.importScript_(goog.basePath+"deps.js")}}goog.normalizePath_=function(t){var e=t.split("/");var i=0;while(i<e.length){if(e[i]=="."){e.splice(i,1)}else if(i&&e[i]==".."&&e[i-1]&&e[i-1]!=".."){e.splice(--i,2)}else{i++}}return e.join("/")};goog.loadFileSync_=function(t){if(goog.global.CLOSURE_LOAD_FILE_SYNC){return goog.global.CLOSURE_LOAD_FILE_SYNC(t)}else{var e=new goog.global["XMLHttpRequest"];e.open("get",t,false);e.send();return e.responseText}};goog.retrieveAndExecModule_=function(t){if(!COMPILED){var e=t;t=goog.normalizePath_(t);var i=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;var n=goog.loadFileSync_(t);if(n!=null){var r=goog.wrapModule_(t,n);var o=goog.IS_OLD_IE_;if(o){goog.dependencies_.deferred[e]=r;goog.queuedModules_.push(e)}else{i(t,r)}}else{throw new Error("load of "+t+"failed")}}};goog.typeOf=function(t){var e=typeof t;if(e=="object"){if(t){if(t instanceof Array){return"array"}else if(t instanceof Object){return e}var i=Object.prototype.toString.call(t);if(i=="[object Window]"){return"object"}if(i=="[object Array]"||typeof t.length=="number"&&typeof t.splice!="undefined"&&typeof t.propertyIsEnumerable!="undefined"&&!t.propertyIsEnumerable("splice")){return"array"}if(i=="[object Function]"||typeof t.call!="undefined"&&typeof t.propertyIsEnumerable!="undefined"&&!t.propertyIsEnumerable("call")){return"function"}}else{return"null"}}else if(e=="function"&&typeof t.call=="undefined"){return"object"}return e};goog.isNull=function(t){return t===null};goog.isDefAndNotNull=function(t){return t!=null};goog.isArray=function(t){return goog.typeOf(t)=="array"};goog.isArrayLike=function(t){var e=goog.typeOf(t);return e=="array"||e=="object"&&typeof t.length=="number"};goog.isDateLike=function(t){return goog.isObject(t)&&typeof t.getFullYear=="function"};goog.isString=function(t){return typeof t=="string"};goog.isBoolean=function(t){return typeof t=="boolean"};goog.isNumber=function(t){return typeof t=="number"};goog.isFunction=function(t){return goog.typeOf(t)=="function"};goog.isObject=function(t){var e=typeof t;return e=="object"&&t!=null||e=="function"};goog.getUid=function(t){return t[goog.UID_PROPERTY_]||(t[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(t){return!!t[goog.UID_PROPERTY_]};goog.removeUid=function(t){if("removeAttribute"in t){t.removeAttribute(goog.UID_PROPERTY_)}try{delete t[goog.UID_PROPERTY_]}catch(e){}};goog.UID_PROPERTY_="closure_uid_"+(Math.random()*1e9>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(t){var e=goog.typeOf(t);if(e=="object"||e=="array"){if(t.clone){return t.clone()}var i=e=="array"?[]:{};for(var n in t){i[n]=goog.cloneObject(t[n])}return i}return t};goog.bindNative_=function(t,e,i){return t.call.apply(t.bind,arguments)};goog.bindJs_=function(t,e,i){if(!t){throw new Error}if(arguments.length>2){var n=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(i,n);return t.apply(e,i)}}else{return function(){return t.apply(e,arguments)}}};goog.bind=function(t,e,i){if(Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1){goog.bind=goog.bindNative_}else{goog.bind=goog.bindJs_}return goog.bind.apply(null,arguments)};goog.partial=function(t,e){var i=Array.prototype.slice.call(arguments,1);return function(){var e=i.slice();e.push.apply(e,arguments);return t.apply(this,e)}};goog.mixin=function(t,e){for(var i in e){t[i]=e[i]}};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};goog.globalEval=function(t){if(goog.global.execScript){goog.global.execScript(t,"JavaScript")}else if(goog.global.eval){if(goog.evalWorksForGlobals_==null){goog.global.eval("var _evalTest_ = 1;");if(typeof goog.global["_evalTest_"]!="undefined"){try{delete goog.global["_evalTest_"]}catch(e){}goog.evalWorksForGlobals_=true}else{goog.evalWorksForGlobals_=false}}if(goog.evalWorksForGlobals_){goog.global.eval(t)}else{var i=goog.global.document;var n=i.createElement("SCRIPT");n.type="text/javascript";n.defer=false;n.appendChild(i.createTextNode(t));i.body.appendChild(n);i.body.removeChild(n)}}else{throw Error("goog.globalEval not available")}};goog.evalWorksForGlobals_=null;goog.cssNameMapping_;goog.cssNameMappingStyle_;goog.getCssName=function(t,e){var i=function(t){return goog.cssNameMapping_[t]||t};var n=function(t){var e=t.split("-");var n=[];for(var r=0;r<e.length;r++){n.push(i(e[r]))}return n.join("-")};var r;if(goog.cssNameMapping_){r=goog.cssNameMappingStyle_=="BY_WHOLE"?i:n}else{r=function(t){return t}}if(e){return t+"-"+r(e)}else{return r(t)}};goog.setCssNameMapping=function(t,e){goog.cssNameMapping_=t;goog.cssNameMappingStyle_=e};goog.global.CLOSURE_CSS_NAME_MAPPING;if(!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING){goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING}goog.getMsg=function(t,e){if(e){t=t.replace(/\{\$([^}]+)}/g,function(t,i){return i in e?e[i]:t})}return t};goog.getMsgWithFallback=function(t,e){return t};goog.exportSymbol=function(t,e,i){goog.exportPath_(t,e,i)};goog.exportProperty=function(t,e,i){t[e]=i};goog.inherits=function(t,e){function i(){}i.prototype=e.prototype;t.superClass_=e.prototype;t.prototype=new i;t.prototype.constructor=t;t.base=function(t,i,n){var r=new Array(arguments.length-2);for(var o=2;o<arguments.length;o++){r[o-2]=arguments[o]}return e.prototype[i].apply(t,r)}};goog.base=function(t,e,i){var n=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!n){throw Error("arguments.caller not defined.  goog.base() cannot be used "+"with strict mode code. See "+"http://www.ecma-international.org/ecma-262/5.1/#sec-C")}if(n.superClass_){var r=new Array(arguments.length-1);for(var o=1;o<arguments.length;o++){r[o-1]=arguments[o]}return n.superClass_.constructor.apply(t,r)}var a=new Array(arguments.length-2);for(var o=2;o<arguments.length;o++){a[o-2]=arguments[o]}var s=false;for(var l=t.constructor;l;l=l.superClass_&&l.superClass_.constructor){if(l.prototype[e]===n){s=true}else if(s){return l.prototype[e].apply(t,a)}}if(t[e]===n){return t.constructor.prototype[e].apply(t,a);
}else{throw Error("goog.base called from a method of one name "+"to a method of a different name")}};goog.scope=function(t){t.call(goog.global)};if(!COMPILED){goog.global["COMPILED"]=COMPILED}goog.defineClass=function(t,e){var i=e.constructor;var n=e.statics;if(!i||i==Object.prototype.constructor){i=function(){throw Error("cannot instantiate an interface (no constructor defined).")}}var r=goog.defineClass.createSealingConstructor_(i,t);if(t){goog.inherits(r,t)}delete e.constructor;delete e.statics;goog.defineClass.applyProperties_(r.prototype,e);if(n!=null){if(n instanceof Function){n(r)}else{goog.defineClass.applyProperties_(r,n)}}return r};goog.defineClass.ClassDescriptor;goog.define("goog.defineClass.SEAL_CLASS_INSTANCES",goog.DEBUG);goog.defineClass.createSealingConstructor_=function(t,e){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(e&&e.prototype&&e.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]){return t}var i=function(){var e=t.apply(this,arguments)||this;e[goog.UID_PROPERTY_]=e[goog.UID_PROPERTY_];if(this.constructor===i){Object.seal(e)}return e};return i}return t};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];goog.defineClass.applyProperties_=function(t,e){var i;for(i in e){if(Object.prototype.hasOwnProperty.call(e,i)){t[i]=e[i]}}for(var n=0;n<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;n++){i=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[n];if(Object.prototype.hasOwnProperty.call(e,i)){t[i]=e[i]}}};goog.tagUnsealableClass=function(t){if(!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES){t.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=true}};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";goog.provide("spine");spine.loadBool=function(t,e,i){var n=t[e];switch(typeof n){case"string":return n==="true"?true:false;case"boolean":return n;default:return i||false}};spine.saveBool=function(t,e,i,n){if(typeof n!=="boolean"||i!==n){t[e]=i}};spine.loadFloat=function(t,e,i){var n=t[e];switch(typeof n){case"string":return parseFloat(n);case"number":return n;default:return i||0}};spine.saveFloat=function(t,e,i,n){if(typeof n!=="number"||i!==n){t[e]=i}};spine.loadInt=function(t,e,i){var n=t[e];switch(typeof n){case"string":return parseInt(n,10);case"number":return 0|n;default:return i||0}};spine.saveInt=function(t,e,i,n){if(typeof n!=="number"||i!==n){t[e]=i}};spine.loadString=function(t,e,i){var n=t[e];switch(typeof n){case"string":return n;default:return i||""}};spine.saveString=function(t,e,i,n){if(typeof n!=="string"||i!==n){t[e]=i}};spine.Color=function(){};spine.Color.prototype.r=1;spine.Color.prototype.g=1;spine.Color.prototype.b=1;spine.Color.prototype.a=1;spine.Color.prototype.copy=function(t){var e=this;e.r=t.r;e.g=t.g;e.b=t.b;e.a=t.a;return e};spine.Color.prototype.load=function(t){var e=this;var i=4294967295;switch(typeof t){case"string":i=parseInt(t,16);break;case"number":i=0|t;break;default:i=4294967295;break}e.r=(i>>24&255)/255;e.g=(i>>16&255)/255;e.b=(i>>8&255)/255;e.a=(i&255)/255;return e};spine.Color.prototype.toString=function(){var t=this;return"rgba("+(t.r*255).toFixed(0)+","+(t.g*255).toFixed(0)+","+(t.b*255).toFixed(0)+","+t.a+")"};spine.BezierCurve=function(t,e,i,n,r){r=r||1e-6;function o(e){var n=e*e;var r=n*e;var o=1-e;var a=o*o;return 3*t*a*e+3*i*o*n+r}function a(t){var i=t*t;var r=i*t;var o=1-t;var a=o*o;return 3*e*a*t+3*n*o*i+r}function s(e){var n=e*e;var r=n*e;return 3*t*e-3*(2*t-i)*n+(3*t-3*i+1)*r}return function(t){var e=t,i,n,l,h,u,p;for(l=e,p=0;p<8;++p){h=o(l)-e;if(Math.abs(h)<r)return a(l);u=s(l);if(Math.abs(u)<1e-6)break;l=l-h/u}i=0,n=1,l=e;if(l<i)return a(i);if(l>n)return a(n);while(i<n){h=o(l);if(Math.abs(h-e)<r)return a(l);if(e>h)i=l;else n=l;l=(n-i)*.5+i}return a(l)}};spine.StepBezierCurve=function(t,e,i,n){var r=10;var o=1/r;var a=o*o;var s=a*o;var l=3*o;var h=3*a;var u=6*a;var p=6*s;var c=-t*2+i;var f=-e*2+n;var m=(t-i)*3+1;var d=(e-n)*3+1;var y=t*l+c*h+m*s;var g=e*l+f*h+d*s;var v=c*u+m*p;var _=f*u+d*p;var I=m*p;var w=d*p;return function(t){var e=y;var i=g;var n=v;var o=_;var a=I;var s=w;var l=e,h=i;var u=r-2;while(true){if(l>=t){var p=l-e;var c=h-i;return c+(h-c)*(t-p)/(l-p)}if(u===0)break;u--;e+=n;i+=o;n+=a;o+=s;l+=e;h+=i}return h+(1-h)*(t-l)/(1-l)}};spine.Curve=function(){};spine.Curve.prototype.evaluate=function(t){return t};spine.Curve.prototype.load=function(t){var e=this;e.evaluate=function(t){return t};if(typeof t==="string"&&t==="stepped"){e.evaluate=function(t){return 0}}else if(typeof t==="object"&&typeof t.length==="number"&&t.length===4){var i=spine.loadFloat(t,0,0);var n=spine.loadFloat(t,1,0);var r=spine.loadFloat(t,2,1);var o=spine.loadFloat(t,3,1);e.evaluate=spine.StepBezierCurve(i,n,r,o)}return e};spine.wrap=function(t,e,i){if(e<i){if(t<e){return i-(e-t)%(i-e)}else{return e+(t-e)%(i-e)}}else if(e===i){return e}else{return t}};spine.tween=function(t,e,i){return t+(e-t)*i};spine.wrapAngleRadians=function(t){if(t<=0){return(t-Math.PI)%(2*Math.PI)+Math.PI}else{return(t+Math.PI)%(2*Math.PI)-Math.PI}};spine.tweenAngle=function(t,e,i){return spine.wrapAngleRadians(t+spine.wrapAngleRadians(e-t)*i)};spine.Angle=function(t){this.rad=t||0};Object.defineProperty(spine.Angle.prototype,"deg",{get:function(){return this.rad*180/Math.PI},set:function(t){this.rad=t*Math.PI/180}});Object.defineProperty(spine.Angle.prototype,"cos",{get:function(){return Math.cos(this.rad)}});Object.defineProperty(spine.Angle.prototype,"sin",{get:function(){return Math.sin(this.rad)}});spine.Angle.prototype.selfIdentity=function(){this.rad=0;return this};spine.Angle.prototype.copy=function(t){this.rad=t.rad;return this};spine.Vector=function(t,e){this.x=t||0;this.y=e||0};spine.Vector.prototype.x=0;spine.Vector.prototype.y=0;spine.Vector.prototype.copy=function(t){this.x=t.x;this.y=t.y;return this};spine.Vector.equal=function(t,e,i){i=i||1e-6;if(Math.abs(t.x-e.x)>i){return false}if(Math.abs(t.y-e.y)>i){return false}return true};spine.Vector.add=function(t,e,i){i=i||new spine.Vector;i.x=t.x+e.x;i.y=t.y+e.y;return i};spine.Vector.prototype.add=function(t,e){return spine.Vector.add(this,t,e)};spine.Vector.prototype.selfAdd=function(t){this.x+=t.x;this.y+=t.y;return this};spine.Vector.tween=function(t,e,i,n){n=n||new spine.Vector;n.x=spine.tween(t.x,e.x,i);n.y=spine.tween(t.y,e.y,i);return n};spine.Vector.prototype.tween=function(t,e,i){return spine.Vector.tween(this,t,e,i)};spine.Vector.prototype.selfTween=function(t,e){return spine.Vector.tween(this,t,e,this)};spine.Position=function(){goog.base(this,0,0)};goog.inherits(spine.Position,spine.Vector);spine.Rotation=function(){goog.base(this,0)};goog.inherits(spine.Rotation,spine.Angle);spine.Scale=function(){goog.base(this,1,1)};goog.inherits(spine.Scale,spine.Vector);spine.Scale.prototype.selfIdentity=function(){this.x=1;this.y=1;return this};spine.Flip=function(){goog.base(this,1,1)};goog.inherits(spine.Flip,spine.Vector);spine.Space=function(){var t=this;t.position=new spine.Position;t.rotation=new spine.Rotation;t.scale=new spine.Scale;t.flip=new spine.Flip};spine.Space.prototype.position;spine.Space.prototype.rotation;spine.Space.prototype.scale;spine.Space.prototype.flip;spine.Space.prototype.copy=function(t){var e=this;e.position.copy(t.position);e.rotation.copy(t.rotation);e.scale.copy(t.scale);e.flip.copy(t.flip);return e};spine.Space.prototype.load=function(t){var e=this;e.position.x=spine.loadFloat(t,"x",0);e.position.y=spine.loadFloat(t,"y",0);e.rotation.deg=spine.loadFloat(t,"rotation",0);e.scale.x=spine.loadFloat(t,"scaleX",1);e.scale.y=spine.loadFloat(t,"scaleY",1);e.flip.x=spine.loadBool(t,"flipX",false)?-1:1;e.flip.y=spine.loadBool(t,"flipY",false)?-1:1;return e};spine.Space.equal=function(t,e,i){i=i||1e-6;if(Math.abs(t.position.x-e.position.x)>i){return false}if(Math.abs(t.position.y-e.position.y)>i){return false}if(Math.abs(t.rotation.rad-e.rotation.rad)>i){return false}if(Math.abs(t.scale.x-e.scale.x)>i){return false}if(Math.abs(t.scale.y-e.scale.y)>i){return false}if(Math.abs(t.flip.x-e.flip.x)>i){return false}if(Math.abs(t.flip.y-e.flip.y)>i){return false}return true};spine.Space.identity=function(t){t=t||new spine.Space;t.position.x=0;t.position.y=0;t.rotation.rad=0;t.scale.x=1;t.scale.y=1;t.flip.x=1;t.flip.y=1;return t};spine.Space.translate=function(t,e,i){e*=t.scale.x*t.flip.x;i*=t.scale.y*t.flip.y;var n=t.rotation.rad*t.flip.x*t.flip.y;var r=Math.cos(n);var o=Math.sin(n);var a=r*e-o*i;var s=o*e+r*i;t.position.x+=a;t.position.y+=s;return t};spine.Space.rotate=function(t,e){t.rotation.rad+=e;t.rotation.rad=spine.wrapAngleRadians(t.rotation.rad);return t};spine.Space.scale=function(t,e,i){t.scale.x*=e;t.scale.y*=i;return t};spine.Space.flip=function(t,e,i){t.flip.x*=e?-1:1;t.flip.y*=i?-1:1;return t};spine.Space.invert=function(t,e){e=e||new spine.Space;var i=t.flip.x;var n=t.flip.y;var r=1/t.scale.x;var o=1/t.scale.y;var a=-t.rotation.rad;var s=-t.position.x;var l=-t.position.y;e.scale.x=r;e.scale.y=o;e.rotation.rad=a;e.flip.x=i;e.flip.y=n;var h=s;var u=l;var p=a*i*n;var c=Math.cos(p);var f=Math.sin(p);var m=c*h-f*u;var d=f*h+c*u;e.position.x=m*r*i;e.position.y=d*o*n;return e};spine.Space.combine=function(t,e,i){i=i||new spine.Space;var n=e.position.x*t.scale.x*t.flip.x;var r=e.position.y*t.scale.y*t.flip.y;var o=t.rotation.rad*t.flip.x*t.flip.y;var a=Math.cos(o);var s=Math.sin(o);var l=a*n-s*r;var h=s*n+a*r;i.position.x=l+t.position.x;i.position.y=h+t.position.y;i.rotation.rad=spine.wrapAngleRadians(e.rotation.rad+t.rotation.rad);i.scale.x=e.scale.x*t.scale.x;i.scale.y=e.scale.y*t.scale.y;i.flip.x=e.flip.x*t.flip.x;i.flip.y=e.flip.y*t.flip.y;return i};spine.Space.extract=function(t,e,i){i=i||new spine.Space;i.flip.x=t.flip.x*e.flip.x;i.flip.y=t.flip.y*e.flip.y;i.scale.x=t.scale.x/e.scale.x;i.scale.y=t.scale.y/e.scale.y;i.rotation.rad=spine.wrapAngleRadians(t.rotation.rad-e.rotation.rad);var n=t.position.x-e.position.x;var r=t.position.y-e.position.y;var o=-e.rotation.rad*e.flip.x*e.flip.y;var a=Math.cos(o);var s=Math.sin(o);var l=a*n-s*r;var h=s*n+a*r;i.position.x=l/e.scale.x*e.flip.x;i.position.y=h/e.scale.y*e.flip.y;return i};spine.Space.transform=function(t,e,i){i=i||new spine.Vector;var n=e.x*t.scale.x*t.flip.x;var r=e.y*t.scale.y*t.flip.y;var o=t.rotation.rad*t.flip.x*t.flip.y;var a=Math.cos(o);var s=Math.sin(o);var l=a*n-s*r;var h=s*n+a*r;i.x=l+t.position.x;i.y=h+t.position.y;return i};spine.Space.untransform=function(t,e,i){i=i||new spine.Vector;var n=e.x-t.position.x;var r=e.y-t.position.y;var o=-t.rotation.rad*t.flip.x*t.flip.y;var a=Math.cos(o);var s=Math.sin(o);var l=a*n-s*r;var h=s*n+a*r;i.x=l/(t.scale.x*t.flip.x);i.y=h/(t.scale.y*t.flip.y);return i};spine.Bone=function(){var t=this;t.local_space=new spine.Space;t.world_space=new spine.Space};spine.Bone.prototype.parent_key="";spine.Bone.prototype.length=0;spine.Bone.prototype.local_space;spine.Bone.prototype.world_space;spine.Bone.prototype.inherit_rotation=true;spine.Bone.prototype.inherit_scale=true;spine.Bone.prototype.copy=function(t){var e=this;e.parent_key=t.parent_key;e.length=t.length;e.local_space.copy(t.local_space);e.world_space.copy(t.world_space);e.inherit_rotation=t.inherit_rotation;e.inherit_scale=t.inherit_scale;return e};spine.Bone.prototype.load=function(t){var e=this;e.parent_key=spine.loadString(t,"parent","");e.length=spine.loadFloat(t,"length",0);e.local_space.load(t);e.world_space.copy(e.local_space);e.inherit_rotation=spine.loadBool(t,"inheritRotation",true);e.inherit_scale=spine.loadBool(t,"inheritScale",true);return e};spine.Bone.flatten=function(t,e){var i=e[t.parent_key];if(i){spine.Bone.flatten(i,e);var n=i.world_space;var r=t.local_space;var o=t.world_space;var a=r.position.x*n.scale.x*n.flip.x;var s=r.position.y*n.scale.y*n.flip.y;var l=n.rotation.rad*n.flip.x*n.flip.y;var h=Math.cos(l);var u=Math.sin(l);var p=h*a-u*s;var c=u*a+h*s;o.position.x=p+n.position.x;o.position.y=c+n.position.y;if(t.inherit_rotation){o.rotation.rad=spine.wrapAngleRadians(r.rotation.rad+n.rotation.rad)}else{o.rotation.rad=r.rotation.rad}if(t.inherit_scale){o.scale.x=r.scale.x*n.scale.x;o.scale.y=r.scale.y*n.scale.y}else{o.scale.x=r.scale.x;o.scale.y=r.scale.y}o.flip.x=r.flip.x*n.flip.x;o.flip.y=r.flip.y*n.flip.y}else{t.world_space.copy(t.local_space)}return t};spine.Ikc=function(){var t=this;t.bone_keys=[]};spine.Ikc.prototype.name="";spine.Ikc.prototype.bone_keys;spine.Ikc.prototype.target_key="";spine.Ikc.prototype.mix=1;spine.Ikc.prototype.bend_positive=true;spine.Ikc.prototype.load=function(t){var e=this;e.name=spine.loadString(t,"name","");e.bone_keys=t["bones"]||[];e.target_key=spine.loadString(t,"target","");e.mix=spine.loadFloat(t,"mix",1);e.bend_positive=spine.loadBool(t,"bendPositive",true);return e};spine.Slot=function(){var t=this;t.color=new spine.Color};spine.Slot.prototype.bone_key="";spine.Slot.prototype.color;spine.Slot.prototype.attachment_key="";spine.Slot.prototype.blend="normal";spine.Slot.prototype.copy=function(t){var e=this;e.bone_key=t.bone_key;e.color.copy(t.color);e.attachment_key=t.attachment_key;e.blend=t.blend;return e};spine.Slot.prototype.load=function(t){var e=this;e.bone_key=spine.loadString(t,"bone","");e.color.load(t.color);e.attachment_key=spine.loadString(t,"attachment","");e.blend=spine.loadString(t,"blend","normal");return e};spine.Attachment=function(t){this.type=t};spine.Attachment.prototype.type="region";spine.Attachment.prototype.name="";spine.Attachment.prototype.path="";spine.Attachment.prototype.load=function(t){var e=this;var i=spine.loadString(t,"type","region");if(i!==e.type){throw new Error}e.name=spine.loadString(t,"name","");e.path=spine.loadString(t,"path","");return e};spine.RegionAttachment=function(){goog.base(this,"region");this.local_space=new spine.Space};goog.inherits(spine.RegionAttachment,spine.Attachment);spine.RegionAttachment.prototype.local_space;spine.RegionAttachment.prototype.width=0;spine.RegionAttachment.prototype.height=0;spine.RegionAttachment.prototype.load=function(t){goog.base(this,"load",t);var e=this;e.local_space.load(t);e.width=spine.loadFloat(t,"width",0);e.height=spine.loadFloat(t,"height",0);return e};spine.BoundingBoxAttachment=function(){goog.base(this,"boundingbox");this.vertices=[]};goog.inherits(spine.BoundingBoxAttachment,spine.Attachment);spine.BoundingBoxAttachment.prototype.vertices;spine.BoundingBoxAttachment.prototype.load=function(t){goog.base(this,"load",t);var e=this;e.vertices=t.vertices||[];return e};spine.MeshAttachment=function(){goog.base(this,"mesh");this.color=new spine.Color;this.triangles=[];this.edges=[];this.vertices=[];this.uvs=[]};goog.inherits(spine.MeshAttachment,spine.Attachment);spine.MeshAttachment.prototype.color;spine.MeshAttachment.prototype.triangles;spine.MeshAttachment.prototype.edges;spine.MeshAttachment.prototype.vertices;spine.MeshAttachment.prototype.uvs;spine.MeshAttachment.prototype.hull=0;spine.MeshAttachment.prototype.load=function(t){goog.base(this,"load",t);var e=this;e.color.load(t.color);e.triangles=t.triangles||[];e.edges=t.edges||[];e.vertices=t.vertices||[];e.uvs=t.uvs||[];e.hull=spine.loadInt(t,"hull",0);return e};spine.SkinnedMeshAttachment=function(){goog.base(this,"skinnedmesh");this.color=new spine.Color;this.triangles=[];this.edges=[];this.vertices=[];this.uvs=[]};goog.inherits(spine.SkinnedMeshAttachment,spine.Attachment);spine.SkinnedMeshAttachment.prototype.color;spine.SkinnedMeshAttachment.prototype.triangles;spine.SkinnedMeshAttachment.prototype.edges;spine.SkinnedMeshAttachment.prototype.vertices;spine.SkinnedMeshAttachment.prototype.uvs;spine.SkinnedMeshAttachment.prototype.hull=0;spine.SkinnedMeshAttachment.prototype.load=function(t){goog.base(this,"load",t);var e=this;e.color.load(t.color);e.triangles=t.triangles||[];e.edges=t.edges||[];e.vertices=t.vertices||[];e.uvs=t.uvs||[];e.hull=spine.loadInt(t,"hull",0);return e};spine.SkinSlot=function(){var t=this;t.attachments={}};spine.SkinSlot.prototype.attachments;spine.SkinSlot.prototype.load=function(t){var e=this;for(var i in t){var n=t[i];switch(n.type){case"region":default:e.attachments[i]=(new spine.RegionAttachment).load(n);break;case"boundingbox":e.attachments[i]=(new spine.BoundingBoxAttachment).load(n);break;case"mesh":e.attachments[i]=(new spine.MeshAttachment).load(n);break;case"skinnedmesh":e.attachments[i]=(new spine.SkinnedMeshAttachment).load(n);break}}return e};spine.Skin=function(){var t=this;t.slots={}};spine.Skin.prototype.slots;spine.Skin.prototype.load=function(t){var e=this;for(var i in t){e.slots[i]=(new spine.SkinSlot).load(t[i])}return e};spine.Skin.prototype.iterateAttachments=function(t){var e=this;for(var i in e.slots){var n=e.slots[i];for(var r in n.attachments){var o=n.attachments[r];t(i,n,o.path||o.name||r,o)}}};spine.Event=function(){};spine.Event.prototype.name="";spine.Event.prototype.int_value=0;spine.Event.prototype.float_value=0;spine.Event.prototype.string_value="";spine.Event.prototype.copy=function(t){this.name=t.name;this.int_value=t.int_value;this.float_value=t.float_value;this.string_value=t.string_value;return this};spine.Event.prototype.load=function(t){if(typeof t["name"]==="string"){this.name=spine.loadString(t,"name","")}if(typeof t["int"]==="string"){this.int_value=spine.loadInt(t,"int",0)}if(typeof t["float"]==="string"){this.float_value=spine.loadFloat(t["float"],0)}if(typeof t["string"]==="string"){this.string_value=spine.loadString(t,"string","")}return this};spine.Keyframe=function(){};spine.Keyframe.prototype.time=0;spine.Keyframe.prototype.drop=function(){this.time=0;return this};spine.Keyframe.prototype.load=function(t){this.time=1e3*spine.loadFloat(t,"time",0);return this};spine.Keyframe.prototype.save=function(t){spine.saveFloat(t,"time",this.time/1e3,0);return this};spine.Keyframe.find=function(t,e){if(!t){return-1}if(t.length<=0){return-1}if(e<t[0].time){return-1}var i=t.length-1;if(e>=t[i].time){return i}var n=0;var r=i;if(r===0){return 0}var o=r>>1;while(true){if(t[o+1].time<=e){n=o+1}else{r=o}if(n===r){return n}o=n+r>>1}};spine.Keyframe.compare=function(t,e){return t.time-e.time};spine.BoneKeyframe=function(){goog.base(this);this.curve=new spine.Curve};goog.inherits(spine.BoneKeyframe,spine.Keyframe);spine.BoneKeyframe.prototype.curve;spine.BoneKeyframe.prototype.load=function(t){goog.base(this,"load",t);this.curve.load(t.curve);return this};spine.TranslateKeyframe=function(){goog.base(this);this.position=new spine.Position};goog.inherits(spine.TranslateKeyframe,spine.BoneKeyframe);spine.TranslateKeyframe.prototype.position;spine.TranslateKeyframe.prototype.load=function(t){goog.base(this,"load",t);this.position.x=spine.loadFloat(t,"x",0);this.position.y=spine.loadFloat(t,"y",0);return this};spine.RotateKeyframe=function(){goog.base(this);this.rotation=new spine.Rotation};goog.inherits(spine.RotateKeyframe,spine.BoneKeyframe);spine.RotateKeyframe.prototype.rotation;spine.RotateKeyframe.prototype.load=function(t){goog.base(this,"load",t);this.rotation.deg=spine.loadFloat(t,"angle",0);return this};spine.ScaleKeyframe=function(){goog.base(this);this.scale=new spine.Scale};goog.inherits(spine.ScaleKeyframe,spine.BoneKeyframe);spine.ScaleKeyframe.prototype.scale;spine.ScaleKeyframe.prototype.load=function(t){goog.base(this,"load",t);this.scale.x=spine.loadFloat(t,"x",1);this.scale.y=spine.loadFloat(t,"y",1);return this};spine.FlipXKeyframe=function(){goog.base(this)};goog.inherits(spine.FlipXKeyframe,spine.BoneKeyframe);spine.FlipXKeyframe.prototype.flip_x=false;spine.FlipXKeyframe.prototype.load=function(t){goog.base(this,"load",t);this.flip=spine.loadBool(t,"x",false);return this};spine.FlipYKeyframe=function(){goog.base(this)};goog.inherits(spine.FlipYKeyframe,spine.BoneKeyframe);spine.FlipYKeyframe.prototype.flip_y=false;spine.FlipYKeyframe.prototype.load=function(t){goog.base(this,"load",t);this.flip=spine.loadBool(t,"y",false);return this};spine.AnimBone=function(){};spine.AnimBone.prototype.min_time=0;spine.AnimBone.prototype.max_time=0;spine.AnimBone.prototype.translate_keyframes=null;spine.AnimBone.prototype.rotate_keyframes=null;spine.AnimBone.prototype.scale_keyframes=null;spine.AnimBone.prototype.flip_x_keyframes=null;spine.AnimBone.prototype.flip_y_keyframes=null;spine.AnimBone.prototype.load=function(t){var e=this;e.min_time=0;e.max_time=0;e.translate_keyframes=null;e.rotate_keyframes=null;e.scale_keyframes=null;e.flip_x_keyframes=null;e.flip_y_keyframes=null;for(var i in t){switch(i){case"translate":e.translate_keyframes=[];t.translate.forEach(function(t){var i=(new spine.TranslateKeyframe).load(t);e.translate_keyframes.push(i);e.min_time=Math.min(e.min_time,i.time);e.max_time=Math.max(e.max_time,i.time)});e.translate_keyframes=e.translate_keyframes.sort(spine.Keyframe.compare);break;case"rotate":e.rotate_keyframes=[];t.rotate.forEach(function(t){var i=(new spine.RotateKeyframe).load(t);e.rotate_keyframes.push(i);e.min_time=Math.min(e.min_time,i.time);e.max_time=Math.max(e.max_time,i.time)});e.rotate_keyframes=e.rotate_keyframes.sort(spine.Keyframe.compare);break;case"scale":e.scale_keyframes=[];t.scale.forEach(function(t){var i=(new spine.ScaleKeyframe).load(t);e.scale_keyframes.push(i);e.min_time=Math.min(e.min_time,i.time);e.max_time=Math.max(e.max_time,i.time)});e.scale_keyframes=e.scale_keyframes.sort(spine.Keyframe.compare);break;case"flipX":e.flip_x_keyframes=[];t[i].forEach(function(t){var i=(new spine.FlipXKeyframe).load(t);e.flip_x_keyframes.push(i);e.min_time=Math.min(e.min_time,i.time);e.max_time=Math.max(e.max_time,i.time)});e.flip_x_keyframes=e.flip_x_keyframes.sort(spine.Keyframe.compare);break;case"flipY":e.flip_y_keyframes=[];t[i].forEach(function(t){var i=(new spine.FlipYKeyframe).load(t);e.flip_y_keyframes.push(i);e.min_time=Math.min(e.min_time,i.time);e.max_time=Math.max(e.max_time,i.time)});e.flip_y_keyframes=e.flip_y_keyframes.sort(spine.Keyframe.compare);break;default:console.log("TODO: spine.AnimBone::load",i);break}}return e};spine.SlotKeyframe=function(){goog.base(this)};goog.inherits(spine.SlotKeyframe,spine.Keyframe);spine.SlotKeyframe.prototype.load=function(t){goog.base(this,"load",t);return this};spine.ColorKeyframe=function(){goog.base(this);this.color=new spine.Color;this.curve=new spine.Curve};goog.inherits(spine.ColorKeyframe,spine.SlotKeyframe);spine.ColorKeyframe.prototype.color;spine.ColorKeyframe.prototype.curve;spine.ColorKeyframe.prototype.load=function(t){goog.base(this,"load",t);this.color.load(t.color);this.curve.load(t.curve);return this};spine.AttachmentKeyframe=function(){goog.base(this)};goog.inherits(spine.AttachmentKeyframe,spine.SlotKeyframe);spine.AttachmentKeyframe.prototype.name="";spine.AttachmentKeyframe.prototype.load=function(t){goog.base(this,"load",t);this.name=spine.loadString(t,"name","");return this};spine.AnimSlot=function(){};spine.AnimSlot.prototype.min_time=0;spine.AnimSlot.prototype.max_time=0;spine.AnimSlot.prototype.color_keyframes=null;spine.AnimSlot.prototype.attachment_keyframes=null;spine.AnimSlot.prototype.load=function(t){var e=this;e.min_time=0;e.max_time=0;e.color_keyframes=null;e.attachment_keyframes=null;for(var i in t){switch(i){case"color":e.color_keyframes=[];t[i].forEach(function(t){var i=(new spine.ColorKeyframe).load(t);e.min_time=Math.min(e.min_time,i.time);e.max_time=Math.max(e.max_time,i.time);e.color_keyframes.push(i)});e.color_keyframes=e.color_keyframes.sort(spine.Keyframe.compare);break;case"attachment":e.attachment_keyframes=[];t[i].forEach(function(t){var i=(new spine.AttachmentKeyframe).load(t);e.min_time=Math.min(e.min_time,i.time);e.max_time=Math.max(e.max_time,i.time);e.attachment_keyframes.push(i)});e.attachment_keyframes=e.attachment_keyframes.sort(spine.Keyframe.compare);break;default:console.log("TODO: spine.AnimSlot::load",i);break}}return e};spine.EventKeyframe=function(){goog.base(this)};goog.inherits(spine.EventKeyframe,spine.Keyframe);spine.EventKeyframe.prototype.name="";spine.EventKeyframe.prototype.int_value=0;spine.EventKeyframe.prototype.float_value=0;spine.EventKeyframe.prototype.string_value="";spine.EventKeyframe.prototype.load=function(t){goog.base(this,"load",t);if(typeof t["name"]==="string"){this.name=spine.loadString(t,"name","")}if(typeof t["int"]==="string"){this.int_value=spine.loadInt(t,"int",0)}if(typeof t["float"]==="string"){this.float_value=spine.loadFloat(t,"float",0)}if(typeof t["string"]==="string"){this.string_value=spine.loadString(t,"string","")}return this};spine.SlotOffset=function(){};spine.SlotOffset.prototype.slot_key="";spine.SlotOffset.prototype.offset=0;spine.SlotOffset.prototype.load=function(t){this.slot_key=spine.loadString(t,"slot","");this.offset=spine.loadInt(t,"offset",0);return this};spine.OrderKeyframe=function(){goog.base(this);this.slot_offsets=[]};goog.inherits(spine.OrderKeyframe,spine.Keyframe);spine.OrderKeyframe.slot_offsets;spine.OrderKeyframe.prototype.load=function(t){goog.base(this,"load",t);var e=this;e.slot_offsets=[];for(var i in t){switch(i){case"offsets":t[i].forEach(function(t){e.slot_offsets.push((new spine.SlotOffset).load(t))});break}}return e};spine.IkcKeyframe=function(){goog.base(this);this.curve=new spine.Curve};goog.inherits(spine.IkcKeyframe,spine.Keyframe);spine.IkcKeyframe.prototype.curve;spine.IkcKeyframe.prototype.mix=1;spine.IkcKeyframe.prototype.bend_positive=true;spine.IkcKeyframe.prototype.load=function(t){goog.base(this,"load",t);this.curve.load(t);this.mix=spine.loadFloat(t,"mix",1);this.bend_positive=spine.loadBool(t,"bendPositive",true);return this};spine.AnimIkc=function(){};spine.AnimIkc.prototype.min_time=0;spine.AnimIkc.prototype.max_time=0;spine.AnimIkc.prototype.ikc_keyframes=null;spine.AnimIkc.prototype.load=function(t){var e=this;e.min_time=0;e.max_time=0;e.ikc_keyframes=[];t.forEach(function(t){var i=(new spine.IkcKeyframe).load(t);e.min_time=Math.min(e.min_time,i.time);e.max_time=Math.max(e.max_time,i.time);e.ikc_keyframes.push(i)});e.ikc_keyframes=e.ikc_keyframes.sort(spine.Keyframe.compare);return e};spine.FfdKeyframe=function(){goog.base(this);this.curve=new spine.Curve;this.vertices=[]};goog.inherits(spine.FfdKeyframe,spine.Keyframe);spine.FfdKeyframe.prototype.curve;spine.FfdKeyframe.prototype.offset=0;spine.FfdKeyframe.prototype.vertices;spine.FfdKeyframe.prototype.load=function(t){goog.base(this,"load",t);this.curve.load(t);this.offset=spine.loadInt(t,"offset",0);this.vertices=t.vertices||[];return this};spine.FfdAttachment=function(){};spine.FfdAttachment.prototype.min_time=0;spine.FfdAttachment.prototype.max_time=0;spine.FfdAttachment.prototype.ffd_keyframes=null;spine.FfdAttachment.prototype.load=function(t){var e=this;e.min_time=0;e.max_time=0;e.ffd_keyframes=[];t.forEach(function(t){var i=(new spine.FfdKeyframe).load(t);e.min_time=Math.min(e.min_time,i.time);e.max_time=Math.max(e.max_time,i.time);e.ffd_keyframes.push(i)});e.ffd_keyframes=e.ffd_keyframes.sort(spine.Keyframe.compare);return e};spine.FfdSlot=function(){var t=this;t.ffd_attachments={}};spine.FfdSlot.prototype.ffd_attachments;spine.FfdSlot.prototype.load=function(t){var e=this;e.ffd_attachments={};for(var i in t){e.ffd_attachments[i]=(new spine.FfdAttachment).load(t[i])}return e};spine.FfdSlot.prototype.iterateAttachments=function(t){var e=this;for(var i in e.ffd_attachments){var n=e.ffd_attachments[i];t(i,n)}};spine.AnimFfd=function(){var t=this;t.ffd_slots={}};spine.AnimFfd.prototype.min_time=0;spine.AnimFfd.prototype.max_time=0;spine.AnimFfd.prototype.ffd_slots;spine.AnimFfd.prototype.load=function(t){var e=this;e.min_time=0;e.max_time=0;e.ffd_slots={};for(var i in t){e.ffd_slots[i]=(new spine.FfdSlot).load(t[i])}e.iterateAttachments(function(t,i,n,r){e.min_time=Math.min(e.min_time,r.min_time);e.max_time=Math.max(e.max_time,r.max_time)});return e};spine.AnimFfd.prototype.iterateAttachments=function(t){var e=this;for(var i in e.ffd_slots){var n=e.ffd_slots[i];n.iterateAttachments(function(e,r){t(i,n,e,r)})}};spine.Animation=function(){var t=this;t.bones={};t.slots={};t.ikcs={};t.ffds={}};spine.Animation.prototype.name="";spine.Animation.prototype.bones;spine.Animation.prototype.slots;spine.Animation.prototype.event_keyframes=null;spine.Animation.prototype.order_keyframes=null;spine.Animation.prototype.ikcs;spine.Animation.prototype.ffds;spine.Animation.prototype.min_time=0;spine.Animation.prototype.max_time=0;spine.Animation.prototype.length=0;spine.Animation.prototype.load=function(t){var e=this;e.bones={};e.slots={};e.event_keyframes=null;e.order_keyframes=null;e.ikcs={};e.ffds={};e.min_time=0;e.max_time=0;for(var i in t){switch(i){case"bones":for(var n in t[i]){var r=(new spine.AnimBone).load(t[i][n]);e.min_time=Math.min(e.min_time,r.min_time);e.max_time=Math.max(e.max_time,r.max_time);e.bones[n]=r}break;case"slots":for(var o in t[i]){var a=(new spine.AnimSlot).load(t[i][o]);e.min_time=Math.min(e.min_time,a.min_time);e.max_time=Math.max(e.max_time,a.max_time);e.slots[o]=a}break;case"events":e.event_keyframes=[];t[i].forEach(function(t){var i=(new spine.EventKeyframe).load(t);e.min_time=Math.min(e.min_time,i.time);e.max_time=Math.max(e.max_time,i.time);e.event_keyframes.push(i)});e.event_keyframes=e.event_keyframes.sort(spine.Keyframe.compare);break;case"drawOrder":case"draworder":e.order_keyframes=[];t[i].forEach(function(t){var i=(new spine.OrderKeyframe).load(t);e.min_time=Math.min(e.min_time,i.time);e.max_time=Math.max(e.max_time,i.time);e.order_keyframes.push(i)});e.order_keyframes=e.order_keyframes.sort(spine.Keyframe.compare);break;case"ik":for(var s in t[i]){var l=(new spine.AnimIkc).load(t[i][s]);e.min_time=Math.min(e.min_time,l.min_time);e.max_time=Math.max(e.max_time,l.max_time);e.ikcs[s]=l}break;case"ffd":for(var h in t[i]){var u=(new spine.AnimFfd).load(t[i][h]);e.min_time=Math.min(e.min_time,u.min_time);e.max_time=Math.max(e.max_time,u.max_time);e.ffds[h]=u}break;default:console.log("TODO: spine.Animation::load",i);break}}e.length=e.max_time-e.min_time;return e};spine.Skeleton=function(){};spine.Skeleton.prototype.hash="";spine.Skeleton.prototype.spine="";spine.Skeleton.prototype.width=0;spine.Skeleton.prototype.height=0;spine.Skeleton.prototype.images="";spine.Skeleton.prototype.load=function(t){var e=this;e.hash=spine.loadString(t,"hash","");e.spine=spine.loadString(t,"spine","");e.width=spine.loadInt(t,"width",0);e.height=spine.loadInt(t,"height",0);e.images=spine.loadString(t,"images","");return e};spine.Data=function(){var t=this;t.skeleton=new spine.Skeleton;t.bones={};t.bone_keys=[];t.ikcs={};t.ikc_keys=[];t.slots={};t.slot_keys=[];t.skins={};t.skin_keys=[];t.events={};t.event_keys=[];t.anims={};t.anim_keys=[]};spine.Data.prototype.name="";spine.Data.prototype.skeleton;spine.Data.prototype.bones;spine.Data.prototype.bone_keys;spine.Data.prototype.ikcs;spine.Data.prototype.ikc_keys;spine.Data.prototype.slots;spine.Data.prototype.slot_keys;spine.Data.prototype.skins;spine.Data.prototype.skin_keys;spine.Data.prototype.events;spine.Data.prototype.event_keys;spine.Data.prototype.anims;spine.Data.prototype.anim_keys;spine.Data.prototype.load=function(t){var e=this;e.bones={};e.bone_keys=[];e.ikcs={};e.ikc_keys=[];e.slots={};e.slot_keys=[];e.skins={};e.skin_keys=[];e.events={};e.event_keys=[];e.anims={};e.anim_keys=[];for(var i in t){switch(i){case"skeleton":e.skeleton.load(t[i]);break;case"bones":var n=t[i];n.forEach(function(t,i){e.bones[t.name]=(new spine.Bone).load(t);e.bone_keys[i]=t.name});break;case"ik":var r=t[i];r.forEach(function(t,i){e.ikcs[t.name]=(new spine.Ikc).load(t);e.ikc_keys[i]=t.name});break;case"slots":var o=t[i];o.forEach(function(t,i){e.slots[t.name]=(new spine.Slot).load(t);e.slot_keys[i]=t.name});break;case"skins":var a=t[i];for(var s in a){var l=e.skins[s]=(new spine.Skin).load(a[s]);e.skin_keys.push(s)}break;case"events":var h=t[i];for(var u in h){var p=e.events[u]=(new spine.Event).load(h[u]);p.name=p.name||u;e.event_keys.push(u)}break;case"animations":var c=t[i];for(var f in c){var m=e.anims[f]=(new spine.Animation).load(c[f]);m.name=m.name||f;e.anim_keys.push(f)}break;default:
console.log("TODO: spine.Skeleton::load",i);break}}e.iterateBones(function(t,i){spine.Bone.flatten(i,e.bones)});return e};spine.Data.prototype.loadSkeleton=function(t){var e=this;e.skeleton.load(t);return e};spine.Data.prototype.loadEvent=function(t,e){var i=this;var n=i.events[t]=(new spine.Event).load(e);n.name=n.name||t;return i};spine.Data.prototype.loadAnimation=function(t,e){var i=this;var n=i.anims[t]=(new spine.Animation).load(e);n.name=n.name||t;return i};spine.Data.prototype.getSkins=function(){var t=this;return t.skins};spine.Data.prototype.getEvents=function(){var t=this;return t.events};spine.Data.prototype.getAnims=function(){var t=this;return t.anims};spine.Data.prototype.iterateBones=function(t){var e=this;e.bone_keys.forEach(function(i){var n=e.bones[i];t(i,n)})};spine.Data.prototype.iterateAttachments=function(t,e){var i=this;var n=i.skins[t];var r=i.skins["default"];i.slot_keys.forEach(function(t){var o=i.slots[t];var a=n&&(n.slots[t]||r.slots[t]);var s=a&&a.attachments[o.attachment_key];var l=s&&(s.path||s.name)||o.attachment_key;e(t,o,a,l,s)})};spine.Data.prototype.iterateSkins=function(t){var e=this;for(var i in e.skins){var n=e.skins[i];t(i,n)}};spine.Data.prototype.iterateEvents=function(t){var e=this;for(var i in e.events){var n=e.events[i];t(i,n)}};spine.Data.prototype.iterateAnims=function(t){var e=this;for(var i in e.anims){var n=e.anims[i];t(i,n)}};spine.Pose=function(t){var e=this;e.data=t||null;e.bones={};e.bone_keys=[];e.slots={};e.slot_keys=[];e.events=[]};spine.Pose.prototype.data;spine.Pose.prototype.skin_key="";spine.Pose.prototype.anim_key="";spine.Pose.prototype.time=0;spine.Pose.prototype.elapsed_time=0;spine.Pose.prototype.dirty=true;spine.Pose.prototype.bones;spine.Pose.prototype.bone_keys;spine.Pose.prototype.slots;spine.Pose.prototype.slot_keys;spine.Pose.prototype.events;spine.Pose.prototype.curSkel=function(){var t=this;var e=t.data;return e&&e.skeleton};spine.Pose.prototype.getSkins=function(){var t=this;var e=t.data;return e&&e.skins};spine.Pose.prototype.curSkin=function(){var t=this;var e=t.data;return e&&e.skins[t.skin_key]};spine.Pose.prototype.getSkin=function(){var t=this;return t.skin_key};spine.Pose.prototype.setSkin=function(t){var e=this;if(e.skin_key!==t){e.skin_key=t}};spine.Pose.prototype.getEvents=function(){var t=this;var e=t.data;return e&&e.events};spine.Pose.prototype.getAnims=function(){var t=this;var e=t.data;return e&&e.anims};spine.Pose.prototype.curAnim=function(){var t=this;var e=t.data;return e&&e.anims[t.anim_key]};spine.Pose.prototype.curAnimLength=function(){var t=this;var e=t.data;var i=e&&e.anims[t.anim_key];return i&&i.length||0};spine.Pose.prototype.getAnim=function(){var t=this;return t.anim_key};spine.Pose.prototype.setAnim=function(t){var e=this;if(e.anim_key!==t){e.anim_key=t;var i=e.data;var n=i&&i.anims[e.anim_key];if(n){e.time=spine.wrap(e.time,n.min_time,n.max_time)}e.elapsed_time=0;e.dirty=true}};spine.Pose.prototype.getTime=function(){var t=this;return t.time};spine.Pose.prototype.setTime=function(t){var e=this;var i=e.data;var n=i&&i.anims[e.anim_key];if(n){t=spine.wrap(t,n.min_time,n.max_time)}if(e.time!==t){e.time=t;e.elapsed_time=0;e.dirty=true}};spine.Pose.prototype.update=function(t){var e=this;e.elapsed_time+=t;e.dirty=true};spine.Pose.prototype.strike=function(){var t=this;if(!t.dirty){return}t.dirty=false;var e=t.data;var i=e&&e.anims[t.anim_key];var n=t.time;var r=t.elapsed_time;t.time=t.time+t.elapsed_time;t.elapsed_time=0;var o=false;var a=false;if(i){o=r<0&&t.time<=i.min_time;a=r>0&&t.time>=i.max_time;t.time=t.time!==i.max_time?spine.wrap(t.time,i.min_time,i.max_time):t.time}var s=t.time;e.bone_keys.forEach(function(n){var r=e.bones[n];var o=t.bones[n]||(t.bones[n]=new spine.Bone);o.copy(r);var a=i&&i.bones[n];if(a){var l=spine.Keyframe.find(a.translate_keyframes,s);if(l!==-1){var h=a.translate_keyframes[l];var u=a.translate_keyframes[l+1];if(u){var p=h.curve.evaluate((s-h.time)/(u.time-h.time));o.local_space.position.x+=spine.tween(h.position.x,u.position.x,p);o.local_space.position.y+=spine.tween(h.position.y,u.position.y,p)}else{o.local_space.position.x+=h.position.x;o.local_space.position.y+=h.position.y}}var l=spine.Keyframe.find(a.rotate_keyframes,s);if(l!==-1){var c=a.rotate_keyframes[l];var f=a.rotate_keyframes[l+1];if(f){var p=c.curve.evaluate((s-c.time)/(f.time-c.time));o.local_space.rotation.rad+=spine.tweenAngle(c.rotation.rad,f.rotation.rad,p)}else{o.local_space.rotation.rad+=c.rotation.rad}}var l=spine.Keyframe.find(a.scale_keyframes,s);if(l!==-1){var m=a.scale_keyframes[l];var d=a.scale_keyframes[l+1];if(d){var p=m.curve.evaluate((s-m.time)/(d.time-m.time));o.local_space.scale.x+=spine.tween(m.scale.x,d.scale.x,p)-1;o.local_space.scale.y+=spine.tween(m.scale.y,d.scale.y,p)-1}else{o.local_space.scale.x+=m.scale.x-1;o.local_space.scale.y+=m.scale.y-1}}var l=spine.Keyframe.find(a.flip_x_keyframes,s);if(l!==-1){var y=a.flip_x_keyframes[l];o.local_space.flip.x=y.flip?-1:1}var l=spine.Keyframe.find(a.flip_y_keyframes,s);if(l!==-1){var g=a.flip_y_keyframes[l];o.local_space.flip.y=g.flip?-1:1}}});t.bone_keys=e.bone_keys;e.ikc_keys.forEach(function(n){function r(t,e,i){return t<e?e:t>i?i:t}var o=e.ikcs[n];var a=o.mix;var l=o.bend_positive;var h=i&&i.ikcs[n];if(h){var u=spine.Keyframe.find(h.ikc_keyframes,s);if(u!==-1){var p=h.ikc_keyframes[u];var c=h.ikc_keyframes[u+1];if(c){var f=p.curve.evaluate((s-p.time)/(c.time-p.time));a=spine.tween(p.mix,c.mix,f)}else{a=p.mix}l=p.bend_positive}}var m=t.bones[o.target_key];spine.Bone.flatten(m,t.bones);var d=m.world_space.position.x;var y=m.world_space.position.y;var g=a;var v=l?1:-1;if(g===0){return}switch(o.bone_keys.length){case 1:var _=t.bones[o.bone_keys[0]];spine.Bone.flatten(_,t.bones);var I=0;var w=t.bones[_.parent_key];if(w&&_.inherit_rotation){spine.Bone.flatten(w,t.bones);I=w.world_space.rotation.rad}d-=_.world_space.position.x;y-=_.world_space.position.y;_.local_space.rotation.rad=spine.tweenAngle(_.local_space.rotation.rad,Math.atan2(y,d)-I,g);break;case 2:var x=t.bones[o.bone_keys[0]];spine.Bone.flatten(x,t.bones);var S=t.bones[o.bone_keys[1]];spine.Bone.flatten(S,t.bones);var T=new spine.Vector;var C=t.bones[x.parent_key];if(C){T.x=d;T.y=y;spine.Bone.flatten(C,t.bones);spine.Space.untransform(C.world_space,T,T);d=(T.x-x.local_space.position.x)*C.world_space.scale.x;y=(T.y-x.local_space.position.y)*C.world_space.scale.y}else{d-=x.local_space.position.x;y-=x.local_space.position.y}T.copy(S.local_space.position);var b=t.bones[S.parent_key];if(b!==x){spine.Bone.flatten(b,t.bones);spine.Space.transform(b.world_space,T,T);spine.Space.untransform(x.world_space,T,T)}var D=T.x*x.world_space.scale.x;var E=T.y*x.world_space.scale.y;var A=Math.atan2(E,D);var U=Math.sqrt(D*D+E*E);var M=S.length*S.world_space.scale.x;var P=2*U*M;if(P<1e-4){S.local_space.rotation.rad=spine.tweenAngle(S.local_space.rotation.rad,Math.atan2(y,d)-x.local_space.rotation.rad,g);return}var B=r((d*d+y*y-U*U-M*M)/P,-1,1);var L=Math.acos(B)*v;var R=Math.sin(L);var O=M*B+U;var V=M*R;var W=Math.atan2(y*O-d*V,d*O+y*V);x.local_space.rotation.rad=spine.tweenAngle(x.local_space.rotation.rad,W-A,g);var k=L;if(b!==x){k+=x.world_space.rotation.rad-b.world_space.rotation.rad}S.local_space.rotation.rad=spine.tweenAngle(S.local_space.rotation.rad,k+A,g);break}});t.iterateBones(function(e,i){spine.Bone.flatten(i,t.bones)});e.slot_keys.forEach(function(n){var r=e.slots[n];var o=t.slots[n]||(t.slots[n]=new spine.Slot);o.copy(r);var a=i&&i.slots[n];if(a){var l=spine.Keyframe.find(a.color_keyframes,s);if(l!==-1){var h=a.color_keyframes[l];var u=a.color_keyframes[l+1];if(u){var p=h.curve.evaluate((s-h.time)/(u.time-h.time));o.color.r=spine.tween(h.color.r,u.color.r,p);o.color.g=spine.tween(h.color.g,u.color.g,p);o.color.b=spine.tween(h.color.b,u.color.b,p);o.color.a=spine.tween(h.color.a,u.color.a,p)}else{o.color.r=h.color.r;o.color.g=h.color.g;o.color.b=h.color.b;o.color.a=h.color.a}}var l=spine.Keyframe.find(a.attachment_keyframes,s);if(l!==-1){var c=a.attachment_keyframes[l];o.attachment_key=c.name}}});t.slot_keys=e.slot_keys;if(i){var l=spine.Keyframe.find(i.order_keyframes,s);if(l!==-1){var h=i.order_keyframes[l];t.slot_keys=e.slot_keys.slice(0);h.slot_offsets.forEach(function(e){var i=t.slot_keys.indexOf(e.slot_key);if(i!==-1){t.slot_keys.splice(i,1);t.slot_keys.splice(i+e.offset,0,e.slot_key)}})}}t.events.length=0;if(i){var u=function(i){var n=new spine.Event;var r=e.events[i.name];if(r){n.copy(r)}n.int_value=i.int_value||n.int_value;n.float_value=i.float_value||n.float_value;n.string_value=i.string_value||n.string_value;t.events.push(n)};if(o){var l=spine.Keyframe.find(i.event_keyframes,i.min_time);if(l!==-1){var p=i.event_keyframes[l];u(p)}}else if(a){var l=spine.Keyframe.find(i.event_keyframes,i.max_time);if(l!==-1){var p=i.event_keyframes[l];u(p)}}var l=spine.Keyframe.find(i.event_keyframes,s);if(l!==-1){var p=i.event_keyframes[l];if(r<0&&(s<=p.time&&p.time<=n)||r>0&&(n<=p.time&&p.time<=s)){u(p)}}}};spine.Pose.prototype.iterateBones=function(t){var e=this;e.bone_keys.forEach(function(i){var n=e.bones[i];t(i,n)})};spine.Pose.prototype.iterateAttachments=function(t){var e=this;var i=e.data;var n=i&&i.skins[e.skin_key];var r=i&&i.skins["default"];e.slot_keys.forEach(function(i){var o=e.slots[i];var a=n&&(n.slots[i]||r.slots[i]);var s=a&&a.attachments[o.attachment_key];var l=s&&(s.path||s.name)||o.attachment_key;t(i,o,a,l,s)})};spine.deprecated=function(){console.log("deprecated")};Object.defineProperty(spine,"color",{get:function(){spine.deprecated();return spine.Color}});Object.defineProperty(spine,"skel_bone",{get:function(){spine.deprecated();return spine.Bone}});Object.defineProperty(spine.Bone.prototype,"x",{get:function(){spine.deprecated();return this.local_space.position.x}});Object.defineProperty(spine.Bone.prototype,"y",{get:function(){spine.deprecated();return this.local_space.position.y}});Object.defineProperty(spine.Bone.prototype,"rotation",{get:function(){spine.deprecated();return this.local_space.rotation.deg}});Object.defineProperty(spine.Bone.prototype,"scaleX",{get:function(){spine.deprecated();return this.local_space.scale.x}});Object.defineProperty(spine.Bone.prototype,"scaleY",{get:function(){spine.deprecated();return this.local_space.scale.y}});Object.defineProperty(spine.Bone.prototype,"parent",{get:function(){spine.deprecated();return this.parent_key}});Object.defineProperty(spine.Bone.prototype,"inheritRotation",{get:function(){spine.deprecated();return this.inherit_rotation}});Object.defineProperty(spine.Bone.prototype,"inheritScale",{get:function(){spine.deprecated();return this.inherit_scale}});Object.defineProperty(spine,"skel_slot",{get:function(){spine.deprecated();return spine.Slot}});Object.defineProperty(spine.Slot.prototype,"bone",{get:function(){spine.deprecated();return this.bone_key}});Object.defineProperty(spine.Slot.prototype,"attachment",{get:function(){spine.deprecated();return this.attachment_key}});Object.defineProperty(spine.Slot.prototype,"additive",{get:function(){spine.deprecated();return this.blend==="additive"}});Object.defineProperty(spine,"attachment",{get:function(){spine.deprecated();return spine.RegionAttachment}});Object.defineProperty(spine.RegionAttachment.prototype,"x",{get:function(){spine.deprecated();return this.local_space.position.x}});Object.defineProperty(spine.RegionAttachment.prototype,"y",{get:function(){spine.deprecated();return this.local_space.position.y}});Object.defineProperty(spine.RegionAttachment.prototype,"rotation",{get:function(){spine.deprecated();return this.local_space.rotation.deg}});Object.defineProperty(spine.RegionAttachment.prototype,"scaleX",{get:function(){spine.deprecated();return this.local_space.scale.x}});Object.defineProperty(spine.RegionAttachment.prototype,"scaleY",{get:function(){spine.deprecated();return this.local_space.scale.y}});Object.defineProperty(spine,"skin_slot",{get:function(){spine.deprecated();return spine.SkinSlot}});Object.defineProperty(spine.SkinSlot.prototype,"skin_attachments",{get:function(){spine.deprecated();return this.attachments}});Object.defineProperty(spine,"skin",{get:function(){spine.deprecated();return spine.Skin}});Object.defineProperty(spine.Skin.prototype,"skin_slots",{get:function(){spine.deprecated();return this.slots}});Object.defineProperty(spine,"event",{get:function(){spine.deprecated();return spine.Event}});Object.defineProperty(spine,"keyframe",{get:function(){spine.deprecated();return spine.Keyframe}});Object.defineProperty(spine,"bone_keyframe",{get:function(){spine.deprecated();return spine.BoneKeyframe}});Object.defineProperty(spine,"translate_keyframe",{get:function(){spine.deprecated();return spine.TranslateKeyframe}});Object.defineProperty(spine,"rotate_keyframe",{get:function(){spine.deprecated();return spine.RotateKeyframe}});Object.defineProperty(spine,"scale_keyframe",{get:function(){spine.deprecated();return spine.ScaleKeyframe}});Object.defineProperty(spine,"anim_bone",{get:function(){spine.deprecated();return spine.AnimBone}});Object.defineProperty(spine,"slot_keyframe",{get:function(){spine.deprecated();return spine.SlotKeyframe}});Object.defineProperty(spine,"color_keyframe",{get:function(){spine.deprecated();return spine.ColorKeyframe}});Object.defineProperty(spine,"attachment_keyframe",{get:function(){spine.deprecated();return spine.AttachmentKeyframe}});Object.defineProperty(spine,"anim_slot",{get:function(){spine.deprecated();return spine.AnimSlot}});Object.defineProperty(spine,"event_keyframe",{get:function(){spine.deprecated();return spine.EventKeyframe}});Object.defineProperty(spine,"slot_offset",{get:function(){spine.deprecated();return spine.SlotOffset}});Object.defineProperty(spine,"order_keyframe",{get:function(){spine.deprecated();return spine.OrderKeyframe}});Object.defineProperty(spine,"animation",{get:function(){spine.deprecated();return spine.Animation}});Object.defineProperty(spine.Animation.prototype,"anim_bones",{get:function(){spine.deprecated();return this.bones}});Object.defineProperty(spine.Animation.prototype,"anim_slots",{get:function(){spine.deprecated();return this.slots}});Object.defineProperty(spine,"skeleton",{get:function(){spine.deprecated();return spine.Skeleton}});Object.defineProperty(spine,"data",{get:function(){spine.deprecated();return spine.Data}});Object.defineProperty(spine.Data.prototype,"animations",{get:function(){spine.deprecated();return this.anims}});Object.defineProperty(spine,"pose",{get:function(){spine.deprecated();return spine.Pose}});Object.defineProperty(spine.Pose.prototype,"tweened_skel_bones",{get:function(){spine.deprecated();return this.bones}});Object.defineProperty(spine.Pose.prototype,"tweened_skel_slots",{get:function(){spine.deprecated();return this.slots}});Object.defineProperty(spine.Pose.prototype,"tweened_skel_slot_keys",{get:function(){spine.deprecated();return this.slot_keys}});Object.defineProperty(spine.Pose.prototype,"tweened_events",{get:function(){spine.deprecated();return this.events}});goog.provide("atlas");goog.provide("atlas.Data");goog.provide("atlas.Page");goog.provide("atlas.Site");atlas.Page=function(){var t=this;t.name="";t.w=0;t.h=0;t.format="RGBA8888";t.min_filter="linear";t.mag_filter="linear";t.wrap_s="clamp-to-edge";t.wrap_t="clamp-to-edge"};atlas.Site=function(){var t=this;t.page=null;t.x=0;t.y=0;t.w=0;t.h=0;t.rotate=0;t.offset_x=0;t.offset_y=0;t.original_w=0;t.original_h=0;t.index=-1};atlas.Data=function(){var t=this;t.pages=[];t.sites={}};atlas.Data.prototype.drop=function(){var t=this;t.pages=[];t.sites={};return t};atlas.Data.prototype.import=function(t){return this.importAtlasText(t)};atlas.Data.prototype.export=function(t){return this.exportAtlasText(t)};atlas.Data.prototype.importAtlasText=function(t){var e=t.split(/\n|\r\n/);return this.importAtlasTextLines(e)};atlas.Data.prototype.exportAtlasText=function(t){var e=this.exportAtlasTextLines([]);return(t||"")+e.join("\n")};atlas.Data.prototype.importAtlasTextLines=function(t){var e=this;e.pages=[];e.sites={};function i(t){return t.replace(/^\s+|\s+$/g,"")}var n=null;var r=null;var o=null;t.forEach(function(t){if(i(t).length===0){n=null;r=null}else if(o=t.match(/^size: (.*),(.*)$/)){n.w=parseInt(o[1],10);n.h=parseInt(o[2],10)}else if(o=t.match(/^format: (.*)$/)){n.format=o[1]}else if(o=t.match(/^filter: (.*),(.*)$/)){n.min_filter=o[1];n.mag_filter=o[2]}else if(o=t.match(/^repeat: (.*)$/)){var a=o[1];n.wrap_s=a==="x"||a==="xy"?"Repeat":"ClampToEdge";n.wrap_t=a==="y"||a==="xy"?"Repeat":"ClampToEdge"}else if(o=t.match(/^orig: (.*)[,| x] (.*)$/)){var s=parseInt(o[1],10);var l=parseInt(o[2],10);console.log("page:orig",s,l)}else if(n===null){n=new atlas.Page;n.name=t;e.pages.push(n)}else{if(o=t.match(/^  rotate: (.*)$/)){r.rotate=o[1]!=="false"?-1:0}else if(o=t.match(/^  xy: (.*), (.*)$/)){r.x=parseInt(o[1],10);r.y=parseInt(o[2],10)}else if(o=t.match(/^  size: (.*), (.*)$/)){r.w=parseInt(o[1],10);r.h=parseInt(o[2],10)}else if(o=t.match(/^  orig: (.*), (.*)$/)){r.original_w=parseInt(o[1],10);r.original_h=parseInt(o[2],10)}else if(o=t.match(/^  offset: (.*), (.*)$/)){r.offset_x=parseInt(o[1],10);r.offset_y=parseInt(o[2],10)}else if(o=t.match(/^  index: (.*)$/)){r.index=parseInt(o[1],10)}else{if(r){r.original_w=r.original_w||r.w;r.original_h=r.original_h||r.h}r=new atlas.Site;r.page=n;e.sites[t]=r}}});return e};atlas.Data.prototype.exportAtlasTextLines=function(t){t=t||[];var e=this;e.pages.forEach(function(i){t.push("");t.push(i.name);t.push("size: "+i.w+","+i.h);t.push("format: "+i.format);t.push("filter: "+i.min_filter+","+i.mag_filter);var n="none";if(i.wrap_s==="Repeat"&&i.wrap_t==="Repeat"){n="xy"}else if(i.wrap_s==="Repeat"){n="x"}else if(i.wrap_t==="Repeat"){n="y"}t.push("repeat: "+n);for(var r in e.sites){var o=e.sites[r];if(o.page!==i){continue}t.push(r);t.push("  rotate: "+(o.rotate!==0?"true":"false"));t.push("  xy: "+o.x+", "+o.y);t.push("  size: "+o.w+", "+o.h);t.push("  orig: "+o.original_w+", "+o.original_h);t.push("  offset: "+o.offset_x+", "+o.offset_y);t.push("  index: "+o.index)}});return t};atlas.Data.prototype.importTpsText=function(t){var e=this;e.pages=[];e.sites={};return e.importTpsTextPage(t,0)};atlas.Data.prototype.importTpsTextPage=function(t,e){var i=this;e=e||0;var n=JSON.parse(t);if(n.meta){var r=i.pages[e]=new atlas.Page;r.w=n.meta.size.w;r.h=n.meta.size.h;r.name=n.meta.image}if(n.frames)for(var o in n.frames){var a=n.frames[o];var s=i.sites[o]=new atlas.Site;s.page=e;s.x=a.frame.x;s.y=a.frame.y;s.w=a.frame.w;s.h=a.frame.h;s.rotate=a.rotated?1:0;s.offset_x=a.spriteSourceSize&&a.spriteSourceSize.x||0;s.offset_y=a.spriteSourceSize&&a.spriteSourceSize.y||0;s.original_w=a.sourceSize&&a.sourceSize.w||s.w;s.original_h=a.sourceSize&&a.sourceSize.h||s.h}return i};goog.provide("renderCtx2D");renderCtx2D=function(){var t=this;t.images={};t.skin_info_map={};t.region_vertex_position=new Float32Array([-1,-1,1,-1,1,1,-1,1]);t.region_vertex_texcoord=new Float32Array([0,1,1,1,1,0,0,0]);t.region_vertex_triangle=new Uint16Array([0,1,2,0,2,3])};renderCtx2D.prototype.setContext=function(t){this.ctx=t};renderCtx2D.prototype.dropPose=function(t,e){var i=this;for(var n in i.images){delete i.images[n]}i.images={};i.skin_info_map={}};renderCtx2D.prototype.loadPose=function(t,e,i){var n=this;t.data.iterateSkins(function(e,i){var r=n.skin_info_map[e]={};var o=r.slot_info_map={};i.iterateAttachments(function(e,i,n,r){if(!r){return}switch(r.type){case"mesh":var a=o[e]=o[e]||{};var s=a.attachment_info_map=a.attachment_info_map||{};var l=s[n]={};l.type=r.type;var h=l.vertex_count=r.vertices.length/2;var u=l.vertex_position=new Float32Array(r.vertices);var p=l.vertex_texcoord=new Float32Array(r.uvs);var c=l.vertex_triangle=new Uint16Array(r.triangles);break;case"skinnedmesh":var a=o[e]=o[e]||{};var s=a.attachment_info_map=a.attachment_info_map||{};var l=s[n]={};l.type=r.type;var h=l.vertex_count=r.uvs.length/2;var f=l.vertex_setup_position=new Float32Array(2*h);var m=l.vertex_blend_position=new Float32Array(2*h);var p=l.vertex_texcoord=new Float32Array(r.uvs);var c=l.vertex_triangle=new Uint16Array(r.triangles);var d=new spine.Vector;for(var y=0,g=0;y<h;++y){var v=r.vertices[g++];var _=0;var I=0;for(var w=0;w<v;++w){var x=r.vertices[g++];var S=d.x=r.vertices[g++];var T=d.y=r.vertices[g++];var C=r.vertices[g++];var b=t.data.bone_keys[x];var D=t.data.bones[b];spine.Space.transform(D.world_space,d,d);_+=d.x*C;I+=d.y*C}var E=y*2;f[E++]=_;f[E++]=I}m.set(f);break}})});n.images=i};renderCtx2D.prototype.updatePose=function(t,e){var i=this;t.iterateAttachments(function(e,n,r,o,a){if(!a){return}switch(a.type){case"mesh":var s=i.skin_info_map[t.skin_key],l=i.skin_info_map["default"];var h=s.slot_info_map[e]||l.slot_info_map[e];var u=h.attachment_info_map[o];var p=t.data.anims[t.anim_key];var c=p&&p.ffds&&p.ffds[t.skin_key];var f=c&&c.ffd_slots[e];var m=f&&f.ffd_attachments[o];var d=m&&m.ffd_keyframes;var y=spine.Keyframe.find(d,t.time);if(y!==-1){var g=0;var v=d[y];var _=d[y+1];if(_){g=v.curve.evaluate((t.time-v.time)/(_.time-v.time))}else{_=v}for(var I=0;I<u.vertex_position.length;++I){var w=v.vertices[I-v.offset]||0;var x=_.vertices[I-_.offset]||0;u.vertex_position[I]=a.vertices[I]+spine.tween(w,x,g)}}break;case"skinnedmesh":var s=i.skin_info_map[t.skin_key],l=i.skin_info_map["default"];var h=s.slot_info_map[e]||l.slot_info_map[e];var u=h.attachment_info_map[o];var p=t.data.anims[t.anim_key];var c=p&&p.ffds&&p.ffds[t.skin_key];var f=c&&c.ffd_slots[e];var m=f&&f.ffd_attachments[o];var d=m&&m.ffd_keyframes;var y=spine.Keyframe.find(d,t.time);if(y!==-1){var g=0;var v=d[y];var _=d[y+1];if(_){var g=v.curve.evaluate((t.time-v.time)/(_.time-v.time))}else{_=v}var S=u.vertex_blend_position;var T=new spine.Vector;for(var C=0,I=0,b=0;C<u.vertex_count;++C){var D=a.vertices[I++];var E=0;var A=0;for(var U=0;U<D;++U){var M=a.vertices[I++];T.x=a.vertices[I++];T.y=a.vertices[I++];var P=a.vertices[I++];var B=t.bone_keys[M];var L=t.bones[B];var w=v.vertices[b-v.offset]||0;var x=_.vertices[b-_.offset]||0;T.x+=spine.tween(w,x,g);++b;var w=v.vertices[b-v.offset]||0;var x=_.vertices[b-_.offset]||0;T.y+=spine.tween(w,x,g);++b;spine.Space.transform(L.world_space,T,T);E+=T.x*P;A+=T.y*P}var R=C*2;S[R++]=E;S[R++]=A}}else{var S=u.vertex_blend_position;var T=new spine.Vector;for(var C=0,I=0;C<u.vertex_count;++C){var D=a.vertices[I++];var E=0;var A=0;for(var U=0;U<D;++U){var M=a.vertices[I++];T.x=a.vertices[I++];T.y=a.vertices[I++];var P=a.vertices[I++];var B=t.bone_keys[M];var L=t.bones[B];spine.Space.transform(L.world_space,T,T);E+=T.x*P;A+=T.y*P}var R=C*2;S[R++]=E;S[R++]=A}}break}})};renderCtx2D.prototype.drawPose=function(t,e){var i=this;var n=i.ctx;i.updatePose(t,e);t.iterateAttachments(function(r,o,a,s,l){if(!l){return}if(l.type==="boundingbox"){return}var h=e&&e.sites[s];if(!h&&s.indexOf("/")>0){h=e&&e.sites[s.split("/")[1]]}var u=h&&h.page;var p=u&&u.name||s;var c=i.images[p];if(!c||!c.complete){return}n.save();n.globalAlpha=o.color.a;switch(o.blend){default:case"normal":n.globalCompositeOperation="source-over";break;case"additive":n.globalCompositeOperation="lighter";break;case"multiply":n.globalCompositeOperation="multiply";break;case"screen":n.globalCompositeOperation="screen";break}switch(l.type){case"region":var f=t.bones[o.bone_key];ctxApplySpace(n,f.world_space);ctxApplySpace(n,l.local_space);ctxApplyAtlasSitePosition(n,h);n.scale(l.width/2,l.height/2);if(h){if(h.rotate){ctxDrawImageMesh(n,i.region_vertex_triangle,i.region_vertex_position,i.region_vertex_texcoord,c,h,u)}else{n.scale(1,-1);n.drawImage(c,h.x,h.y,h.w,h.h,-1,-1,2,2)}}else{n.scale(1,-1);n.drawImage(c,-1,-1,2,2)}break;case"mesh":var m=i.skin_info_map[t.skin_key],d=i.skin_info_map["default"];var y=m.slot_info_map[r]||d.slot_info_map[r];var g=y.attachment_info_map[s];var f=t.bones[o.bone_key];ctxApplySpace(n,f.world_space);ctxApplyAtlasSitePosition(n,h);ctxDrawImageMesh(n,g.vertex_triangle,g.vertex_position,g.vertex_texcoord,c,h,u);break;case"skinnedmesh":var m=i.skin_info_map[t.skin_key],d=i.skin_info_map["default"];var y=m.slot_info_map[r]||d.slot_info_map[r];var g=y.attachment_info_map[s];ctxApplyAtlasSitePosition(n,h);ctxDrawImageMesh(n,g.vertex_triangle,g.vertex_blend_position,g.vertex_texcoord,c,h,u);break}n.restore()})};function ctxApplySpace(t,e){if(e){t.translate(e.position.x,e.position.y);t.rotate(e.rotation.rad*e.flip.x*e.flip.y);t.scale(e.scale.x*e.flip.x,e.scale.y*e.flip.y)}}function ctxApplyAtlasSitePosition(t,e){if(e){t.scale(1/e.original_w,1/e.original_h);t.translate(2*e.offset_x-(e.original_w-e.w),e.original_h-e.h-2*e.offset_y);t.scale(e.w,e.h)}}function ctxDrawCircle(t,e,i){i=i||1;t.beginPath();t.arc(0,0,12*i,0,2*Math.PI,false);t.strokeStyle=e||"grey";t.stroke()}function ctxDrawPoint(t,e,i){i=i||1;t.beginPath();t.arc(0,0,12*i,0,2*Math.PI,false);t.strokeStyle=e||"blue";t.stroke();t.beginPath();t.moveTo(0,0);t.lineTo(24*i,0);t.strokeStyle="red";t.stroke();t.beginPath();t.moveTo(0,0);t.lineTo(0,24*i);t.strokeStyle="green";t.stroke()}function ctxDrawMesh(t,e,i,n,r){t.beginPath();for(var o=0;o<e.length;){var a=e[o++]*2;var s=i[a],l=i[a+1];var a=e[o++]*2;var h=i[a],u=i[a+1];var a=e[o++]*2;var p=i[a],c=i[a+1];t.moveTo(s,l);t.lineTo(h,u);t.lineTo(p,c);t.lineTo(s,l)}if(r){t.fillStyle=r;t.fill()}t.strokeStyle=n||"grey";t.stroke()}function ctxDrawImageMesh(t,e,i,n,r,o,a){var s=new Float32Array(9);var l=new Float32Array(2);mat3x3Identity(s);mat3x3Scale(s,r.width,r.height);mat3x3ApplyAtlasPageTexcoord(s,a);mat3x3ApplyAtlasSiteTexcoord(s,o);for(var h=0;h<e.length;){var u=e[h++]*2;var p=i.subarray(u,u+2);var c=p[0],f=p[1];var m=mat3x3Transform(s,n.subarray(u,u+2),l);var d=m[0],y=m[1];var u=e[h++]*2;var p=i.subarray(u,u+2);var g=p[0],v=p[1];var m=mat3x3Transform(s,n.subarray(u,u+2),l);var _=m[0],I=m[1];var u=e[h++]*2;var p=i.subarray(u,u+2);var w=p[0],x=p[1];var m=mat3x3Transform(s,n.subarray(u,u+2),l);var S=m[0],T=m[1];t.save();t.beginPath();t.moveTo(c,f);t.lineTo(g,v);t.lineTo(w,x);t.closePath();t.clip();g-=c;v-=f;w-=c;x-=f;_-=d;I-=y;S-=d;T-=y;var C=1/(_*T-S*I);var b=C*(T*g-I*w);var D=C*(T*v-I*x);var E=C*(_*w-S*g);var A=C*(_*x-S*v);var U=c-(b*d+E*y);var M=f-(D*d+A*y);t.transform(b,D,E,A,U,M);t.drawImage(r,0,0);t.restore()}}function ctxDrawIkConstraints(t,e,i){e.ikc_keys.forEach(function(n){var r=e.ikcs[n];var o=i[r.target_key];switch(r.bone_keys.length){case 1:var a=i[r.bone_keys[0]];t.beginPath();t.moveTo(o.world_space.position.x,o.world_space.position.y);t.lineTo(a.world_space.position.x,a.world_space.position.y);t.strokeStyle="yellow";t.stroke();t.save();ctxApplySpace(t,o.world_space);ctxDrawCircle(t,"yellow",1.5);t.restore();t.save();ctxApplySpace(t,a.world_space);ctxDrawCircle(t,"yellow",.5);t.restore();break;case 2:var s=i[r.bone_keys[0]];var l=i[r.bone_keys[1]];t.beginPath();t.moveTo(o.world_space.position.x,o.world_space.position.y);t.lineTo(l.world_space.position.x,l.world_space.position.y);t.lineTo(s.world_space.position.x,s.world_space.position.y);t.strokeStyle="yellow";t.stroke();t.save();ctxApplySpace(t,o.world_space);ctxDrawCircle(t,"yellow",1.5);t.restore();t.save();ctxApplySpace(t,l.world_space);ctxDrawCircle(t,"yellow",.75);t.restore();t.save();ctxApplySpace(t,s.world_space);ctxDrawCircle(t,"yellow",.5);t.restore();break}})}function mat3x3Identity(t){t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0;t[0]=t[4]=t[8]=1;return t}function mat3x3Scale(t,e,i){t[0]*=e;t[1]*=e;t[2]*=e;t[3]*=i;t[4]*=i;t[5]*=i;return t}function mat3x3ApplyAtlasPageTexcoord(t,e){if(e){mat3x3Scale(t,1/e.w,1/e.h)}return t}function mat3x3Translate(t,e,i){t[6]+=t[0]*e+t[3]*i;t[7]+=t[1]*e+t[4]*i;return t}function mat3x3Transform(t,e,i){var n=t[0]*e[0]+t[3]*e[1]+t[6];var r=t[1]*e[0]+t[4]*e[1]+t[7];var o=t[2]*e[0]+t[5]*e[1]+t[8];var a=o?1/o:1;i[0]=n*a;i[1]=r*a;return i}function mat3x3RotateCosSin(t,e,i){var n=t[0],r=t[1];var o=t[3],a=t[4];t[0]=n*e+o*i;t[1]=r*e+a*i;t[3]=o*e-n*i;t[4]=a*e-r*i;return t}function mat3x3ApplyAtlasSiteTexcoord(t,e){if(e){mat3x3Translate(t,e.x,e.y);if(e.rotate===-1){mat3x3Translate(t,0,e.w);mat3x3RotateCosSin(t,0,-1)}else if(e.rotate===1){mat3x3Translate(t,e.h,0);mat3x3RotateCosSin(t,0,1)}mat3x3Scale(t,e.w,e.h)}return t}goog.provide("SpineWrapper");goog.require("spine");goog.require("atlas");goog.require("renderCtx2D");SpineWrapper=function(t,e,i){var n={};this.animTime=0;this.timeScale=1;this.atlas_data=(new atlas.Data).import(e);this.render_ctx2d=new renderCtx2D;this.spine_pose=new spine.Pose((new spine.Data).load(t));this.atlas_data.pages.forEach(function(t){var e=t.name;n[e]=i;t.w=t.w||i.width;t.h=t.h||i.height});this.render_ctx2d.loadPose(this.spine_pose,this.atlas_data,n)};SpineWrapper.prototype.dropPose=function(){if(this.render_ctx2d){this.render_ctx2d.dropPose()}if(this.atlas_data){this.atlas_data.drop()}this.atlas_data=null;this.spine_pose=null;this.render_ctx2d=null};SpineWrapper.prototype.getAnimationKeys=function(){return this.spine_pose.data.anim_keys};SpineWrapper.prototype.getCurrentAnimKey=function(){return this.spine_pose.getAnim()};SpineWrapper.prototype.getSkinKeys=function(){return this.spine_pose.data.skin_keys};SpineWrapper.prototype.getCurrentSkinKey=function(){return this.spine_pose.getSkin()};SpineWrapper.prototype.setSkinByName=function(t){this.spine_pose.setSkin(t)};SpineWrapper.prototype.getAnimDuration=function(t){var e=this.spine_pose.getAnims();return e[t]?e[t].max_time:0};SpineWrapper.prototype.setAnimationByName=function(t,e,i,n,r){var o=t==="default"?0:this.spine_pose.data.anim_keys.indexOf(t);var a=e==void 0?0:this.spine_pose.data.skin_keys.indexOf(e);if(o===-1||a===-1){throw new Error("invalid animation time")}else{this.animTime=0;this.repeatTimes=i;this.onPlayDone=n;this.onPlayStep=r;this.spine_pose.setSkin(this.spine_pose.data.skin_keys[a]);this.spine_pose.setAnim(this.spine_pose.data.anim_keys[o]);this.spine_pose.setTime(0)}return this};SpineWrapper.prototype.setTimeScale=function(t){this.timeScale=t;return this};SpineWrapper.prototype.setGeometry=function(t,e){this.width=t;this.height=e;return this};SpineWrapper.prototype.callOnComplete=function(){this.repeatTimes--;if(this.repeatTimes===0){if(this.onPlayStep){this.onPlayStep()}if(this.onPlayDone){this.onPlayDone()}}else{if(this.onPlayStep){this.onPlayStep()}}};SpineWrapper.prototype.update=function(t,e){if(!this.repeatTimes)return;e*=this.timeScale;this.animTime+=e;var i=this.spine_pose.curAnim();var n=i.max_time;if(this.animTime>n){this.callOnComplete();this.animTime-=n;this.spine_pose.time=n;e=0}this.render_ctx2d.setContext(t);this.spine_pose.update(e);this.spine_pose.strike()};SpineWrapper.prototype.paint=function(t){t.scale(1,-1);this.render_ctx2d.drawPose(this.spine_pose,this.atlas_data)};function UISpine(){}UISpine.prototype=new UISkeletonAnimation;UISpine.prototype.initUISpine=UISkeletonAnimation.prototype.initUISkeletonAnimation;UISpine.prototype.doPlay=UISpine.prototype.gotoAndPlay=function(t,e,i,n,r,o){var a=this;this.animationName=t;if(this.spineWrapper){var e=e?e:4294967295;this.spineWrapper.setAnimationByName(t,this.skinName,e,i,n)}return this};UISpine.prototype.pause=function(){if(this.spineWrapper){this.spineWrapper.setTimeScale(0)}return this};UISpine.prototype.resume=function(){if(this.spineWrapper){this.spineWrapper.setTimeScale(1)}return this};UISpine.prototype.createArmature=function(t,e,i,n){if(this.spineWrapper){this.spineWrapper.dropPose()}this.spineWrapper=new SpineWrapper(i,e,t);this.animationNames=this.spineWrapper.getAnimationKeys();this.animationName=this.animationName&&this.animationNames.indexOf(this.animationName)>-1?this.animationName:this.animationNames[0];return};UISpine.prototype.update=function(t){var e=t.timeStep*UIElement.timeScale*this.animTimeScale;this.spineWrapper.update(t,e)};UISpine.prototype.destroyArmature=function(){if(this.spineWrapper){this.spineWrapper.dropPose();this.spineWrapper=void 0;this.animaName=void 0;this.skinName=void 0}};UISpine.prototype.paintSelfOnly=function(t){if(!this.spineWrapper){return}var e=this.h;var i=this.w>>1;t.translate(i,e);t.scale(this.animationScaleX,this.animationScaleY);if(!UIElement.timeScaleIsZero()){
this.update(t)}this.spineWrapper.paint(t);if(isNaN(t.needRedraw)){t.needRedraw=1}t.needRedraw++;return};UISpine.prototype.setSkin=function(t){this.skinName=t;if(this.spineWrapper){this.spineWrapper.setSkinByName(t)}return this};UISpine.prototype.getCurrentSkinKey=function(){if(this.spineWrapper){return this.spineWrapper.getCurrentSkinKey()}};UISpine.prototype.getCurrentAnimKey=function(){if(this.spineWrapper){return this.spineWrapper.getCurrentAnimKey()}};UISpine.prototype.getSkins=function(){if(this.spineWrapper){return this.spineWrapper.getSkinKeys()}return["default"]};UISpine.prototype.getDuration=UISpine.prototype.getAnimationDuration=function(t){if(!this.spineWrapper)return 0;t=t||this.animationName;return this.spineWrapper.getAnimDuration(t)};function UISpineCreator(){var t=["ui-spine","ui-spine",null,true];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISpine;return e.initUISpine(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UISpineCreator);function UILineJoint(){return}UILineJoint.prototype=new UITwoJoint;UILineJoint.prototype.isUIJoint=true;UILineJoint.prototype.isUILineJoint=true;UILineJoint.prototype.initUILineJoint=function(t,e,i){this.initUITwoJoint(t,e,i);return this};function UILineJointCreator(){var t=["ui-line-joint","ui-line-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UILineJoint;return e.initUILineJoint(this.type,200,200)};return}function UITwoJoint(){return}UITwoJoint.prototype=new UITwoPoints;UITwoJoint.prototype.isUIJoint=true;UITwoJoint.prototype.isUITwoJoint=true;UITwoJoint.prototype.initUITwoJoint=function(t,e,i){this.initUITwoPoints(t);return this};function UITwoJointCreator(){var t=["ui-two-joint","ui-two-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITwoJoint;return e.initUITwoJoint(this.type,200,200)};return}function UIDragger(){return}UIDragger.prototype=new UIElement;UIDragger.prototype.isUIDragger=true;UIDragger.prototype.initUIDragger=function(t,e,i){this.initUIElement(t,e,i);this.enableVer=true;this.enableHor=true;return this};UIDragger.prototype.onInit=function(){var t=this.getParent();var e=this.enableHor;var i=this.enableVer;if(t.physicsShape||t.isUIPhysicsShape||t.isUIImage){t.handlePointerDown=function(e){return UIDragger.handleSpritePointerDown(t,e)};t.handlePointerMove=function(n){return UIDragger.handleSpritePointerMove(t,n,i,e)};t.handlePointerUp=function(t){}}};UIDragger.handleSpritePointerDown=function(t,e){t.saveX=t.left;t.saveY=t.top;return};UIDragger.handleSpritePointerMove=function(t,e,i,n){if(t.pointerDown){var r=t.getMoveAbsDeltaX();var o=n?t.saveX+r:t.saveX;var a=t.getMoveAbsDeltaY();var s=i?t.saveY+a:t.saveY;t.setLeftTop(o,s);t.onPositionChanged()}return};function UIDraggerCreator(){var t=["ui-dragger","ui-dragger",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIDragger;return e.initUIDragger(this.type,20,20,null)};return}ShapeFactoryGet().addShapeCreator(new UIDraggerCreator);function UIFootprint(){return}UIFootprint.prototype=new UIElement;UIFootprint.prototype.isUIFootprint=true;UIFootprint.prototype.initUIFootprint=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,n);return this};UIFootprint.prototype.paintSelfOnly=function(t){if(this.mode===Shape.MODE_EDITING){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){var i=this.w>>1;var n=this.h>>1;t.arc(i,n,10,0,2*Math.PI);t.fill()}}return};UIFootprint.prototype.shapeCanBeChild=function(t){return false};function UIFootprintCreator(){var t=["ui-foot-print","ui-foot-print",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFootprint;return e.initUIFootprint(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIFootprintCreator);function UITransformAnimation(){return}UITransformAnimation.prototype=new UISprite;UITransformAnimation.prototype.isUITransformAnimation=true;UITransformAnimation.prototype.initUITransformAnimation=function(t,e,i,n){this.initUISprite(t,e,i,n);this.animationConfig={};this.animationConfig.opacityFrom=1;this.animationConfig.opacityTo=1;this.animationConfig.scaleXFrom=1;this.animationConfig.scaleXTo=1;this.animationConfig.scaleYFrom=1;this.animationConfig.scaleYTo=1;this.animationConfig.rotationFrom=0;this.animationConfig.rotationTo=0;this.animationConfig.offsetXFrom=0;this.animationConfig.offsetXTo=0;this.animationConfig.offsetYFrom=0;this.animationConfig.offsetYTo=0;this.animationConfig.frequency=2;this.animationConfig.random=1e3*Math.random();this.regSerializer(this.taToJson,this.taFromJson);return this};UITransformAnimation.prototype.pause=function(){if(this.highlightConfig){this.highlightConfig.paused=true}return this};UITransformAnimation.prototype.resume=function(){if(this.highlightConfig){this.highlightConfig.paused=false}return this};UITransformAnimation.prototype.play=function(){this.setHighlightConfig(this.animationConfig);return};UITransformAnimation.prototype.stop=function(){this.setHighlightConfig(null);return};UITransformAnimation.prototype.getScaleXFrom=function(){return this.animationConfig.scaleXFrom};UITransformAnimation.prototype.setScaleXFrom=function(t){this.animationConfig.scaleXFrom=t;return this};UITransformAnimation.prototype.getScaleXTo=function(){return this.animationConfig.scaleXTo};UITransformAnimation.prototype.setScaleXTo=function(t){this.animationConfig.scaleXTo=t;return this};UITransformAnimation.prototype.getScaleYFrom=function(){return this.animationConfig.scaleYFrom};UITransformAnimation.prototype.setScaleYFrom=function(t){this.animationConfig.scaleYFrom=t;return this};UITransformAnimation.prototype.getScaleYTo=function(){return this.animationConfig.scaleYTo};UITransformAnimation.prototype.setScaleYTo=function(t){this.animationConfig.scaleYTo=t;return this};UITransformAnimation.RADIAN_TO_ANGLE=180/Math.PI;UITransformAnimation.prototype.getRotationFrom=function(){return this.animationConfig.rotationFrom*UITransformAnimation.RADIAN_TO_ANGLE};UITransformAnimation.prototype.setRotationFrom=function(t){this.animationConfig.rotationFrom=t/UITransformAnimation.RADIAN_TO_ANGLE;return this};UITransformAnimation.prototype.getRotationTo=function(){return this.animationConfig.rotationTo*UITransformAnimation.RADIAN_TO_ANGLE};UITransformAnimation.prototype.setRotationTo=function(t){this.animationConfig.rotationTo=t/UITransformAnimation.RADIAN_TO_ANGLE;return this};UITransformAnimation.prototype.getOpacityFrom=function(){return this.animationConfig.opacityFrom};UITransformAnimation.prototype.setOpacityFrom=function(t){this.animationConfig.opacityFrom=t;return this};UITransformAnimation.prototype.getOpacityTo=function(){return this.animationConfig.opacityTo};UITransformAnimation.prototype.setOpacityTo=function(t){this.animationConfig.opacityTo=t;return this};UITransformAnimation.prototype.getXFrom=function(){return this.animationConfig.offsetXFrom};UITransformAnimation.prototype.setXFrom=function(t){this.animationConfig.offsetXFrom=t;return this};UITransformAnimation.prototype.getXTo=function(){return this.animationConfig.offsetXTo};UITransformAnimation.prototype.setXTo=function(t){this.animationConfig.offsetXTo=t;return this};UITransformAnimation.prototype.getYFrom=function(){return this.animationConfig.offsetYFrom};UITransformAnimation.prototype.setYFrom=function(t){this.animationConfig.offsetYFrom=t;return this};UITransformAnimation.prototype.getYTo=function(){return this.animationConfig.offsetYTo};UITransformAnimation.prototype.setYTo=function(t){this.animationConfig.offsetYTo=t;return this};UITransformAnimation.prototype.getFrequency=function(){return this.animationConfig.frequency};UITransformAnimation.prototype.setFrequency=function(t){this.animationConfig.frequency=t;return this};UITransformAnimation.prototype.getRandom=function(){return this.animationConfig.random};UITransformAnimation.prototype.setRandom=function(t){this.animationConfig.random=t%1e3;return this};UITransformAnimation.prototype.taFromJson=function(t){if(t.animationConfig){this.animationConfig=JSON.parse(JSON.stringify(t.animationConfig))}return};UITransformAnimation.prototype.taToJson=function(t){t.animationConfig=JSON.parse(JSON.stringify(this.animationConfig));return t};UITransformAnimation.prototype.beforePaintChildren=function(t){this.applyTransform(t);return this};UITransformAnimation.prototype.onInit=function(){this.play();return};function UITransformAnimationCreator(){var t=["ui-transform-animation","ui-transform-animation",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITransformAnimation;return e.initUITransformAnimation(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UITransformAnimationCreator);function UIScene(){return}UIScene.prototype=new UINormalWindow;UIScene.prototype.isUIScene=true;UIScene.prototype.canRectSelectable=function(){return this.virtualHeight<=this.h&&this.virtualWidth<=this.w};UIScene.prototype.initUIScene=function(t,e,i,n){this.initUIWindow(t,0,0,e,i,n);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.heightAttr=UIElement.HEIGHT_FILL_PARENT;this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.xOffset=0;this.yOffset=0;this.virtualWidth=0;this.virtualHeight=0;this.autoClearForce=true;this.setAnimHint("none");this.setCanRectSelectable(false,true);this.addEventNames(["onPointerDown","onPointerMove","onPointerUp","onDoubleClick"]);this.addEventNames(["onSwipeLeft","onSwipeRight","onSwipeUp","onSwipeDown"]);this.setImage(UIElement.IMAGE_TIPS1,null);this.setImage(UIElement.IMAGE_TIPS2,null);this.setImage(UIElement.IMAGE_TIPS3,null);this.setImage(UIElement.IMAGE_TIPS4,null);this.setImage(UIElement.IMAGE_TIPS5,null);this.setCameraFollowParams(.5,.5,.5,.5);return this};UIScene.prototype.resetGame=function(){if(this.world){var t=this.world;Physics.destroyWorld(t);this.world=null}this.restoreState();this.relayout();this.initStageOne();this.doInit();this.initChildren();this.updateStickyChildren();return};UIScene.prototype.addStickyChild=function(t){if(t.parentShape!==this||t.left>=this.w||t.top>=this.h){console.log("%cWarning: invalid params to addStickyChild.","color: red; font-weight: bold");return this}t.orgX=t.left;t.orgY=t.top;this.stickyChildren.push(t);return this};UIScene.prototype.removeStickyChild=function(t){this.stickyChildren.remove(t);return this};UIScene.prototype.updateStickyChildren=function(){this.stickyChildren=[];var t=this.children;for(var e=0;e<t.length;e++){var i=t[e];if(i.sticky){if(i.orgX===undefined){i.orgX=i.left}if(i.orgY===undefined){i.orgY=i.top}this.stickyChildren.push(i)}}return this};UIScene.prototype.doInit=function(){this.xOffset=0;this.yOffset=0;this.setTimeScale(1);if(this.enablePhysics){Physics.createWorld(this);if(this.world&&this.map){this.map.createBodies(this.world)}}if(this.gameName){document.title=this.gameName}return};UIScene.prototype.onOpen=function(t){this.doInit();this.play();return};UIScene.prototype.onInit=function(){var t=this;this.initStageOne();this.updateStickyChildren();return};UIScene.prototype.onDeinit=function(){if(this.world){var t=this.world;Physics.destroyWorld(t);this.world=null}this.stop();return};UIScene.prototype.getVirtualWidth=function(){if(this.virtualWidth<this.w){return this.w}return this.virtualWidth};UIScene.prototype.getVirtualHeight=function(){if(this.virtualHeight<this.h){return this.h}return this.virtualHeight};UIScene.prototype.onScrolled=function(){var t=this.stickyChildren;if(t&&t.length){var e=this.xOffset;var i=this.yOffset;for(var n=0;n<t.length;n++){var r=t[n];var o=r.orgX+e;var a=r.orgY+i;r.setLeftTop(o,a)}}return};UIScene.prototype.setOffset=function(t,e){if(t||t===0){var i=this.getVirtualWidth()-this.w;var n=Math.max(0,t);if(n>i){n=i}this.xOffset=n}if(e||e===0){var i=this.getVirtualHeight()-this.h;var r=Math.max(0,e);if(r>i){r=i}this.yOffset=r}this.onScrolled();return};UIScene.prototype.getRelayoutWidth=function(){return this.getWidth()};UIScene.prototype.getRelayoutHeight=function(){return this.getHeight()};UIScene.prototype.defaultPaintChildren=function(t){var e=this.xOffset;var i=this.yOffset;var n=this.xOffset+this.w;var r=this.yOffset+this.h;var o=0;var a=this.children;var s=this.children.length;for(var l=0;l<s;l++){var h=a[l];if(!h){continue}var u=false;var p=h.left;var c=h.top;if(!h.rotation){if(p>n||c>r||p+h.w<e||c+h.h<i){u=true}}else{var f=Math.max(h.w,h.h);if(p-f>n||c-f>r||p+f<e||c+f<i){u=true}}if(!h.visible||u){if(h.isAnimating()){h.stepAnimation(t)}continue}h.paintSelf(t)}this.paintTargetShape(t);return};UIScene.prototype.setMap=function(t){this.map=t;if(t){var e=t.getMapWidth();var i=t.getMapHeight();if(e>this.w){this.virtualWidth=e}if(i>this.h){this.virtualHeight=i}this.setOffset(0,0)}return this};UIScene.prototype.getMap=function(){return this.map};UIScene.prototype.drawBgImage=function(t){if(this.map){var e=this.xOffset;var i=this.yOffset;var n={x:e,y:i,w:this.w,h:this.h};t.translate(-e,-i);this.map.draw(t,n);t.translate(e,i);return}var r=this.getBgImage();if(r&&r.getImage()){var o=r.getImage();var a=r.getImageRect();var s=this.images.display;if(s===UIElement.IMAGE_DISPLAY_TILE_V){this.drawBgImageVTile(t,o,a)}else if(s===UIElement.IMAGE_DISPLAY_TILE_H){this.drawBgImageHTile(t,o,a)}else{this.drawImageAt(t,o,s,0,0,this.w,this.h,a)}return}};UIScene.prototype.drawBgImageVTile=function(t,e,i){var n=this.w;var r=this.h;var o=i.w;var a=i.h;var s=n/o;var l=0;var h=i.x;var u=i.y+this.yOffset%a;var p=Math.min(a-u,r/s);for(var l=0;l<r;){var c=p*s;t.drawImage(e,h,u,o,p,0,l,n,c);l+=c;p=Math.min(a,(r-l)/s);u=i.y}};UIScene.prototype.drawBgImageHTile=function(t,e,i){var n=this.w;var r=this.h;var o=i.w;var a=i.h;var s=r/a;var l=0;var h=i.y;var u=i.x+this.xOffset%o;var p=Math.min(o-u,n/s);for(var l=0;l<n;){var c=p*s;t.drawImage(e,u,h,p,a,l,0,c,r);l+=c;p=Math.min(o,(n-l)/s);u=i.x}return};UIScene.prototype.showTrace=function(t,e,i,n){if(!t||!e){this.traceInfo=null}if(!i){i={}}if(!n){n={};n.x=0;n.y=0}var r={};r.sx=t.x;r.sy=t.y;r.vX=this.toPixel(e.x);r.vY=this.toPixel(e.y);r.dampingX=this.toPixel(n.x);r.dampingY=this.toPixel(n.y);r.lineColor=i.lineColor?i.lineColor:"Black";r.lineWidth=i.lineWidth?i.lineWidth:2;r.deltaT=.02;r.points=[];this.traceInfo=r;this.computeTrace(r);return this};UIScene.prototype.computeTrace=function(t){var e=t.sx;var i=t.sy;var n=e;var r=i;var o=t.vX;var a=t.vY;var s=this.toPixel(this.gravityX?this.gravityX:0);var l=this.toPixel(this.gravityY?this.gravityY:0);var h=t.deltaT;var u=Math.max(Math.max(o,a),Math.max(s,l));var p=this.yOffset;var c=p+this.h;var f=this.xOffset;var m=f+this.w;t.points.push({x:e,y:i});for(var d=0;d<50;d++){var y=h*d;e=Math.round(n+o*y+.5*s*y*y);i=Math.round(r+a*y+.5*l*y*y);t.points.push({x:e,y:i});if(e<f||e>m||i<p||i>c)break}return this};UIScene.prototype.drawTrace=function(t){var e=this.traceInfo;if(!e)return;t.beginPath();t.lineWidth=e.lineWidth;t.strokeStyle=e.lineColor;var i=e.points.length;for(var n=0;n<i;n++){var r=e.points[n];if(n%2){t.moveTo(r.x,r.y)}else{t.lineTo(r.x,r.y)}}t.stroke();return this};UIScene.prototype.afterPaintChildren=function(t){if(this.mode!==Shape.MODE_EDITING){this.drawTrace(t);this.drawTipsImage(t)}if(!this.selected||this.mode!==Shape.MODE_EDITING){return}var e=10;var i=this.w;var n=this.h;var r="";var o=i>>1;var a=this.getVirtualWidth();var s=this.getVirtualHeight();if(this.xOffset){r="XOffset:"+this.xOffset}if(this.yOffset){r+=" YOffset:"+this.yOffset}if(r){t.font="16pt Sans";t.textBaseline="top";t.textAlign="center";t.fillStyle="#202020";t.fillText(r,o,e)}if(!this.pointerDown){return}if(a===i&&s===n){return}var l=20;var h=t.globalAlpha;t.fillStyle=this.style.lineColor;if(a>i){var e=n-l;var u=i*(i/a);var o=i*(this.xOffset/a);t.globalAlpha=.2;t.fillRect(0,e,i,l);t.globalAlpha=.5;t.fillRect(o,e,u,l)}if(s>n){var o=i-l;var p=n*(n/s);var e=n*(this.yOffset/s);t.globalAlpha=.2;t.fillRect(o,0,l,n);t.globalAlpha=.5;t.fillRect(o,e,l,p)}t.globalAlpha=h;return};UIScene.prototype.paintSelf=function(t){UIWindow.prototype.paintSelf.call(this,t);if(this.showFPS&&this.mode!==Shape.MODE_EDITING){var e=Math.floor(Date.now()/1e3);if(!this.lastSeconds){this.fps=0;this.drawCount=0;this.lastSeconds=e}this.drawCount++;if(e>this.lastSeconds){this.fps=this.drawCount;this.drawCount=0;this.lastSeconds=e}var i=30;var n=80;var r="FPS:"+this.fps;t.save();t.beginPath();t.rect(0,0,n,i);t.fillStyle="Black";t.fill();t.textAlign="center";t.textBaseline="middle";t.font="22px Sans";t.fillStyle="White";t.fillText(r,n>>1,i>>1);t.needRedraw++;t.restore()}return};UIScene.prototype.paintChildren=function(t){t.save();t.translate(-this.xOffset,-this.yOffset);this.defaultPaintChildren(t);t.restore();if(this.popupWindow){this.popupWindow.paintSelf(t)}return};UIScene.prototype.setTipsImage=function(t,e){this.tipsImageIndex=t;this.tipsImageDisplay=e;return this};UIScene.prototype.drawTipsImage=function(t){if(!this.tipsImageIndex){return}var e="tips_img_"+this.tipsImageIndex;var i=this.images[e];if(i){var n=i.getImage();if(n){var r=i.getImageRect();var o=this.tipsImageDisplay;if(!o&&o!==0){o=this.w<this.h?UIElement.IMAGE_DISPLAY_FIT_WIDTH:UIElement.IMAGE_DISPLAY_FIT_HEIGHT}this.drawImageAt(t,n,o,0,0,this.w,this.h,r)}}return};UIScene.prototype.onPointerMoveEditing=function(t,e){if(!this.pointerDown||e||this.targetShape){return}var i=this.getVirtualWidth();var n=this.getVirtualHeight();if(i===this.w&&n===this.h){return}var r=this.getMoveDeltaX();var o=this.getMoveDeltaY();var a=this.xOffset-r;var s=this.yOffset-o;if(a<0){a=0}if(s<0){s=0}if(a+this.w>i){a=i-this.w}if(s+this.h>n){s=n-this.h}this.xOffset=a;this.yOffset=s;return};UIScene.prototype.fixChildSize=function(t){return};UIScene.prototype.fixChildPosition=function(t){return};UIScene.prototype.afterRelayoutChild=function(t){var e=this.getVirtualWidth();var i=this.getVirtualHeight();if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.left=0;t.w=e}else if(t.widthAttr===UIElement.WIDTH_FILL_AVAILABLE){t.w=e-t.left}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.top=0;t.h=i}else if(t.heightAttr===UIElement.HEIGHT_FILL_AVAILABLE){t.h=i-t.top}return};UIScene.prototype.afterChildAppended=function(t){if(this.mode===Shape.MODE_EDITING||!this.world){return}Physics.createBodyForElement(this.world,this,t)};UIScene.prototype.afterChildRemoved=function(t){if(this.map===t){this.map=null}if(this.mode===Shape.MODE_EDITING||!this.world){return}Physics.destroyBodyForElement(this.world,t);this.postRedraw();return};UIScene.prototype.translatePoint=function(t){if(this.popupWindow){return t}else{var e={x:t.x-this.left+this.xOffset,y:t.y-this.top+this.yOffset};return e}};UIScene.prototype.isPlaying=function(){return this.playing&&this.mode!=Shape.MODE_EDITING};UIScene.prototype.replay=function(){this.resetGame();this.play();return};UIScene.pauseElement=function(t){if(t.isUISkeletonAnimation||t.isUITimer||t.isUIFrameAnimation||t.isUITransformAnimation){t.pause()}for(var e=0;e<t.children.length;e++){var i=t.children[e];UIScene.pauseElement(i)}return};UIScene.prototype.pause=function(){this.playing=false;UIScene.pauseElement(this);return this};UIScene.resumeElement=function(t){if(t.isUISkeletonAnimation||t.isUITimer||t.isUIFrameAnimation||t.isUITransformAnimation){t.resume()}for(var e=0;e<t.children.length;e++){var i=t.children[e];UIScene.resumeElement(i)}return};UIScene.prototype.resume=function(){this.playing=true;UIScene.resumeElement(this);return this};UIScene.prototype.play=function(){this.playing=true;return};UIScene.prototype.stop=function(){this.playing=false;return};UIScene.prototype.toMeter=function(t){var e=this.pixelsPerMeter?this.pixelsPerMeter:10;return t/e};UIScene.prototype.toPixel=function(t){var e=this.pixelsPerMeter?this.pixelsPerMeter:10;return Math.round(t*e)};UIScene.prototype.getFPS=function(){return this.fps?this.fps:30};UIScene.prototype.setFPS=function(t){this.fps=Math.max(5,Math.min(50,t));return this};UIScene.prototype.setVelocityIterations=function(t){this.velocityIterations=t;return this};UIScene.prototype.setPositionIterations=function(t){this.positionIterations=t;return this};UIScene.prototype.setAutoClearForce=function(t){this.autoClearForce=t;return this};UIScene.prototype.setCameraFollowParams=function(t,e,i,n){this.cameraFollowParams={};this.cameraFollowParams.xMin=t;this.cameraFollowParams.xMax=e;this.cameraFollowParams.yMin=i;this.cameraFollowParams.yMax=n;return this};UIScene.prototype.cameraFollow=function(t){var e=this.w;var i=this.h;var n=t.left;var r=t.top;var o=n-this.xOffset;var a=r-this.yOffset;var s=this.cameraFollowParams;var l=this.xOffset;if(o>s.xMax*e){l=Math.round(n-s.xMax*e)+(t.w>>1)}else if(o<s.xMin*e){l=Math.round(n-s.xMin*e)+(t.w>>1)}var h=this.yOffset;if(a>s.yMax*i){h=Math.round(r-s.yMax*i)+(t.h>>1)}else if(a<s.yMin*i){h=Math.round(r-s.yMin*i)+(t.h>>1)}this.setOffset(l,h);return};function UISceneCreator(){var t=["ui-scene","ui-scene",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIScene;return e.initUIScene(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UISceneCreator);function Physics(){}Physics.pixelsPerMeter=10;Physics.toMeter=function(t){return t/Physics.pixelsPerMeter};Physics.toPixel=function(t){return Math.round(t*Physics.pixelsPerMeter)};Physics.createFixtureDef=function(t,e){var i=e.w>>1;var n=e.h>>1;var r=new b2FixtureDef;var o=e.left+i;var a=e.top+n;r.density=e.density;r.friction=e.friction;r.restitution=e.restitution;if(e.categoryBits){r.filter.categoryBits=e.categoryBits}if(e.maskBits){r.filter.maskBits=e.maskBits}if(e.groupIndex){r.filter.groupIndex=e.groupIndex}if(e.isSensor){r.isSensor=true}if(e.isUICircle||e.physicsShape==="circle"){i=e.getWidth(true)>>1;n=e.getHeight(true)>>1;var s=Physics.toMeter(Math.min(i,n));r.shape=new b2CircleShape(s)}else if(e.isUIBox||e.physicsShape==="rectangle"){i=e.getWidth(true)>>1;n=e.getHeight(true)>>1;r.shape=new b2PolygonShape;r.shape.SetAsBox(Physics.toMeter(i),Physics.toMeter(n))}else if(e.isUIPolygon){var l=i;var h=n;var u=[];var p=[];var c=e.children.length;for(var f=0;f<c;f++){var m={};var d=e.children[f];if(!d.isUIPoint){continue}m.x=Physics.toMeter(d.left+(d.w>>1)-l);m.y=Physics.toMeter(d.top+(d.h>>1)-h);if(u.length===5){r=new b2FixtureDef;r.density=e.density;r.friction=e.friction;r.restitution=e.restitution;r.isSensor=e.isSensor;r.shape=new b2PolygonShape;r.shape.SetAsArray(u,u.length);p.push(r);u=[]}u.push(m)}if(u.length>2){r=new b2FixtureDef;r.density=e.density;r.friction=e.friction;r.restitution=e.restitution;r.isSensor=e.isSensor;r.shape=new b2PolygonShape;r.shape.SetAsArray(u,u.length);p.push(r);u=[]}return p.length>1?p:p[0]}else if(e.isUIEdge){var y=e.points[0];var g=e.points[1];var v={x:y.x+g.x>>1,y:y.y+g.y>>1};var _=new b2Vec2(Physics.toMeter(y.x-v.x),Physics.toMeter(y.y-v.y));var I=new b2Vec2(Physics.toMeter(g.x-v.x),Physics.toMeter(g.y-v.y));r.density=0;r.isSensor=false;r.shape=new b2EdgeShape(_,I)}return r};Physics.createBody=function(t,e){var i=null;var n=e.getPositionInWindow();var r=e.getWidth()>>1;var o=e.getHeight()>>1;var a=n.x+r;var s=n.y+o;var l=e.density;var h=new b2BodyDef;var u=Physics.createFixtureDef(t,e);if(l<0){b2BodyDef.type=b2Body.b2_kinematicBody}else{h.type=l?b2Body.b2_dynamicBody:b2Body.b2_staticBody}h.position.Set(Physics.toMeter(a),Physics.toMeter(s));if(e.fixedRotation){h.fixedRotation=true}if(e.isBullet){h.bullet=true}if(e.allowSleep){h.awake=true;h.allowSleep=true}else{h.allowSleep=false}if(e.linearDamping!==undefined){h.linearDamping=e.linearDamping}if(e.angularDamping!==undefined){h.angularDamping=e.angularDamping}i=t.CreateBody(h);if(u.length){for(var p=0;p<u.length;p++){i.CreateFixture(u[p])}console.log("Create Composite Polygon: n="+u.length)}else{i.CreateFixture(u)}i.element=e;i.name=e.name;e.body=i;if(e.rotation){i.SetAngle(e.rotation)}if(!e.enable){i.SetActive(false)}if(e.xInitVelocity||e.yInitVelocity){e.setV(e.xInitVelocity,e.yInitVelocity)}return i};Physics.createEmbedBody=function(t,e,i){var n=null;var r=Physics.createFixtureDef(t,i);if(!n){var o=e.getPositionInWindow();var a=e.w>>1;var s=e.h>>1;var l=o.x+a;var h=o.y+s;n=new b2BodyDef;if(r.density<0){delete r.density;b2BodyDef.type=b2Body.b2_kinematicBody}else{n.type=r.density?b2Body.b2_dynamicBody:b2Body.b2_staticBody}n.position.Set(Physics.toMeter(l),Physics.toMeter(h));if(e.fixedRotation||i.fixedRotation){n.fixedRotation=true}if(e.isBullet||i.isBullet){n.bullet=true}if(e.allowSleep||i.allowSleep){n.awake=true;n.allowSleep=true}else{n.allowSleep=false}if(i.linearDamping!==undefined){n.linearDamping=i.linearDamping}if(i.angularDamping!==undefined){n.angularDamping=i.angularDamping}var u=t.CreateBody(n);u.element=e;e.body=u;if(!e.enable||!i.enable){u.SetActive(false)}}u.CreateFixture(r);return u};Physics.createBodyForElement=function(t,e,i){if(i.physicsShape){Physics.createBody(t,i)}else if(i.isUIPhysicsShape){if(e.isUIWindow){Physics.createBody(t,i)}else if(e.isUISprite||e.isUISkeletonAnimation||e.isUITransformAnimation||e.isUIFrameAnimation){Physics.createEmbedBody(t,e,i)}else{Physics.createBody(t,i)}}else{Physics.createWorldShapes(t,i)}return};Physics.destroyBodyForElement=function(t,e){for(var i=0;i<e.children.length;i++){var n=e.children[i];Physics.destroyBodyForElement(t,n)}if(e.body){var r=e.body;r.SetActive(false);setTimeout(function(){t.DestroyBody(r)},0);r.element=null;e.body=null}return};Physics.destroyJointForElement=function(t,e){if(e.joint){var i=e.joint;setTimeout(function(){t.DestroyJoint(i);i.element=null},0)}return};Physics.createWorldShapes=function(t,e){var i=0;var n=0;var r=null;var o=null;for(var a=0;a<e.children.length;a++){var s=e.children[a];Physics.createBodyForElement(t,e,s)}return};Physics.findBodiesAtPoint=function(t,e,i){var n=[];var r=t.children.length;var o=cantkGetTempCanvas(t.w,t.h);var a=o.getContext("2d");for(var s=i;s>=0;s--){var l=t.children[s];if(!l.body){continue}var h={x:l.left,y:l.top,w:l.w,h:l.h};if(l.rotation){a.save();a.beginPath();a.translate(h.x,h.y);if(l.rotation){a.translate(h.w>>1,h.h>>1);a.rotate(l.rotation);a.translate(-(h.w>>1),-(h.h>>1))}a.rect(0,0,h.w,h.h);if(a.isPointInPath(e.x,e.y)){n.push(l.body)}a.restore()}else{if(isPointInRect(e,h)){n.push(l.body)}}}return n};Physics.createJoint=function(t,e,i){var i=e.getWindow();if(!e.isUIJoint){return}if(e.isUIOneJoint){var n={};var r=null;n.x=e.left+(e.w>>1);n.y=e.top+(e.h>>1);var o=e.getIndex();r=Physics.findBodiesAtPoint(i,n,o);if(r.length==1){r=[t.GetGroundBody(),r[0]]}if(r.length>1){var a=null;var s=new b2Vec2(Physics.toMeter(n.x),Physics.toMeter(n.y));if(r[0].GetType()===b2Body.b2_staticBody&&r[1].GetType()===b2Body.b2_staticBody){console.log("%cWarning: it seems no meanings to pin two static body together.","color: red; font-weight: bold")}if(e.isUIRevoluteJoint){a=new b2RevoluteJointDef;a.Initialize(r[0],r[1],s);a.lowerAngle=(e.lowerAngle?e.lowerAngle:0)*Math.PI/180;a.upperAngle=(e.upperAngle?e.upperAngle:0)*Math.PI/180;a.motorSpeed=e.motorSpeed?e.motorSpeed:0;a.maxMotorTorque=e.maxMotorTorque?e.maxMotorTorque:0;a.enableLimit=e.enableLimit?e.enableLimit:false;a.enableMotor=e.enableMotor?e.enableMotor:false}else if(e.isUIWeldJoint){a=new b2WeldJointDef;a.Initialize(r[0],r[1],s)}var l=t.CreateJoint(a);l.element=e;e.joint=l}else{console.log("not found body")}}else if(e.isUITwoJoint){var a=null;var h=e.points[0];var u=e.points[1];var o=e.getIndex();var p=Physics.findBodiesAtPoint(i,h,o);var c=Physics.findBodiesAtPoint(i,u,o);if(p.length&&c.length){var f=new b2Vec2(Physics.toMeter(h.x),Physics.toMeter(h.y));var m=new b2Vec2(Physics.toMeter(u.x),Physics.toMeter(u.y));if(e.isUIDistanceJoint){a=new b2DistanceJointDef;a.Initialize(p[0],c[0],f,m);if(e.frequencyHz){a.frequencyHz=e.frequencyHz}if(e.dampingRatio){a.dampingRatio=e.dampingRatio}}else if(e.isUILineJoint){var d=m.x-f.x;var y=m.y-f.y;var g={};g.x=d/Math.sqrt(d*d+y*y);g.y=y/Math.sqrt(d*d+y*y);a=new b2LineJointDef;a.Initialize(p[0],p[1],f,g);a.enableLimit=true;a.lowerTranslation=0;a.upperTranslation=10;a.enableMotor=false;a.maxMotorForce=3e5;a.motorSpeed=1}var l=t.CreateJoint(a);l.element=e;e.joint=l}else{console.log("not found body")}}else if(e.isUIPulleyJoint){var a=null;var h=e.points[0];var u=e.points[1];var v=e.points[2];var _=e.points[3];var o=e.getIndex();var p=Physics.findBodiesAtPoint(i,h,o);var c=Physics.findBodiesAtPoint(i,_,o);if(p.length&&c.length){a=new b2PulleyJointDef;var I=1;var f=new b2Vec2(Physics.toMeter(h.x),Physics.toMeter(h.y));var m=new b2Vec2(Physics.toMeter(u.x),Physics.toMeter(u.y));var w=new b2Vec2(Physics.toMeter(v.x),Physics.toMeter(v.y));var x=new b2Vec2(Physics.toMeter(_.x),Physics.toMeter(_.y));a.Initialize(p[0],c[0],m,w,f,x,I);var l=t.CreateJoint(a);l.element=e;e.joint=l}else{console.log("not found body")}}return};Physics.createWorldJoints=function(t,e,i){for(var n=0;n<i.children.length;n++){var r=i.children[n];Physics.createWorldJoints(t,e,r)}Physics.createJoint(t,i,e)};Physics.updateBodyElementsPosition=function(t){for(var e=t.m_bodyList;e;e=e.m_next){var i=e.element;if(i){var n=e.GetAngle();var r=e.GetPosition();if(r.x!==undefined&&r.y!==undefined){var o=Physics.toPixel(r.x)-(i.w>>1);var a=Physics.toPixel(r.y)-(i.h>>1);var s=i.getParent();if(!s.isUIWindow){var l=s.getPositionInWindow();o=o-l.x;a=a-l.y}var h=i.left;var u=i.top;i.setRotation(n);if(h!==o||u!==a){i.setPositionByBody(o,a)}}}}for(var p=t.m_jointList;p;p=p.m_next){switch(p.m_type){case b2Joint.e_distanceJoint:{var c=p.GetAnchorA();var f=p.GetAnchorB();var i=p.element;i.points[0].x=Physics.toPixel(c.x);i.points[0].y=Physics.toPixel(c.y);i.points[1].x=Physics.toPixel(f.x);i.points[1].y=Physics.toPixel(f.y);break}case b2Joint.e_pulleyJoint:{var c=p.GetAnchorA();var f=p.GetGroundAnchorA();var m=p.GetGroundAnchorB();var d=p.GetAnchorB();var i=p.element;i.points[0].x=Physics.toPixel(c.x);i.points[0].y=Physics.toPixel(c.y);i.points[1].x=Physics.toPixel(f.x);i.points[1].y=Physics.toPixel(f.y);i.points[2].x=Physics.toPixel(m.x);i.points[2].y=Physics.toPixel(m.y);i.points[3].x=Physics.toPixel(d.x);i.points[3].y=Physics.toPixel(d.y);break}default:{var r=p.GetAnchorA();var i=p.element;var o=Physics.toPixel(r.x)-(i.w>>1);var a=Physics.toPixel(r.y)-(i.h>>1);i.setPositionByBody(o,a);break}}}return};Physics.destroyWorld=function(t){var e=t.m_bodyList;do{if(!e)break;var i=e.m_next;if(e.element){e.element.body=null;e.element=null}t.DestroyBody(e);e=i}while(true);var n=t.m_jointList;do{if(!n)break;var i=n.m_next;if(n.element){n.element=null}t.DestroyJoint(n);n=i}while(true);return};Physics.reparentPhysicsToScene=function(t){var e=[];function i(t){var i=t.getParent();if(t.isUISkeletonAnimation||t.isUISprite||t.isUIFrameAnimation||t.isUITransformAnimation){if(!i.isUIWindow){e.push(t)}}else if(t.isUIPhysicsShape){if(!i.isUISkeletonAnimation&&!i.isUISprite&&!i.isUIFrameAnimation&&!i.isUITransformAnimation&&!i.isUIWindow){e.push(t)}}}t.forEach(i);for(var n=0;n<e.length;n++){var r=e[n];r.reparent(t,true)}return};Physics.createWorld=function(t){if(t.world||!window.b2World){return}var e=null;var i=t.w>>1;var n=t.h>>1;var r=-t.w>>1;var o=-t.h>>1;var a=t.getFPS();var s=t.allowSleep?t.allowSleep:true;var l=t.gravityX?t.gravityX:0;var h=t.gravityY?t.gravityY:0;var u=t.pixelsPerMeter?t.pixelsPerMeter:10;var p=new b2Vec2(l,h);var c=new b2AABB;var f=1;Physics.pixelsPerMeter=u;c.lowerBound.Set(r,o);c.upperBound.Set(i,n);e=new b2World(p,s);Physics.createWorldShapes(e,t);Physics.createWorldJoints(e,t,t);var m=new b2ContactListener;m.BeginContact=function(t){var e=t.GetFixtureA().GetBody();var i=t.GetFixtureB().GetBody();if(e.element&&i.element){var n=e.element;if(n.handleBeginContactSync){n.handleBeginContactSync(i,t)}var r=i.element;if(r.handleBeginContactSync){r.handleBeginContactSync(e,t)}setTimeout(function(){if(e.element){e.element.callOnBeginContactHandler(i,t)}if(i.element){i.element.callOnBeginContactHandler(e,t)}},0)}};m.EndContact=function(t){var e=t.GetFixtureA().GetBody();var i=t.GetFixtureB().GetBody();if(e.element&&i.element){var n=e.element;if(n.handleEndContactSync){
n.handleEndContactSync(i,t)}var r=i.element;if(r.handleEndContactSync){r.handleEndContactSync(e,t)}setTimeout(function(){if(e.element){e.element.callOnEndContactHandler(i,t)}if(i.element){i.element.callOnEndContactHandler(e,t)}},0)}};m.PreSolve=function(t,e){var i=t.GetFixtureA().GetBody();var n=t.GetFixtureB().GetBody();if(i.element&&n.element){var r=i.element;if(r.handlePreSolve){r.handlePreSolve(n,e)}var o=n.element;if(o.handlePreSolve){o.handlePreSolve(i,e)}}};m.PostSolve=function(t,e){var i=t.GetFixtureA().GetBody();var n=t.GetFixtureB().GetBody();if(i.element&&n.element){var r=i.element;if(r.handlePostSolve){r.handlePostSolve(n,e)}var o=n.element;if(o.handlePostSolve){o.handlePostSolve(i,e)}}};e.SetContactListener(m);var d=t.velocityIterations?t.velocityIterations:8;var y=t.positionIterations?t.positionIterations:5;console.log("Box2d:"+d+":"+y+":"+a);var g=1/a;var v=0;function _(){if(t.world!=e){clearInterval(v);console.log("World is recreated.");return false}var i=UIElement.timeScale*g;if(UIElement.timeScaleIsZero()){i=0}if(t.isVisible()&&t.isTopWindow()&&t.isPlaying()){e.Step(i,d,y);t.postRedraw();if(t.autoClearForce){e.ClearForces()}Physics.updateBodyElementsPosition(e)}return true}t.world=e;v=setInterval(_,g*1e3);return};function UICircle(){return}UICircle.prototype=new UIBody;UICircle.prototype.isUICircle=true;UICircle.prototype.initUICircle=function(t,e,i){this.initUIBody(t,e,i);return this};UICircle.prototype.shapeCanBeChild=function(t){if(!UIGroup.prototype.shapeCanBeChild.call(this,t)||t.isUIJoint&&!t.isUIMouseJoint){return false}return!t.isUIPhysicsShape};UICircle.prototype.onSized=function(){var t=this.getWindow();this.updateLayoutParams();if(this.body&&t&&t.isUIScene){var e=this.left;var i=this.top;var n=t.toMeter(Math.min(this.getWidth(true)>>1,this.getHeight(true)>>1));var r=this.body.GetFixtureList().GetShape();r.SetRadius(n);this.body.SynchronizeFixtures();this.setLeftTop(e,i)}};UICircle.prototype.drawShape=function(t){var e=this.w>>1;var i=this.h>>1;var n=Math.min(this.getWidth(true)>>1,this.getHeight(true)>>1);t.arc(e,i,n,0,Math.PI*2);return};function UICircleCreator(){var t=["ui-circle","ui-circle",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UICircle;return e.initUICircle(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UICircleCreator);function UISound(){return}UISound.prototype=new UICheckBox;UISound.prototype.isUISound=true;UISound.prototype.initUISound=function(t,e,i,n){this.initUICheckBox(t,e,i,null,null,null,null,null,null);this.soundURL="";this.loop=true;this.autoPlay=true;this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;return this};UISound.prototype.setSoundURL=function(t){this.soundURL=t;return};UISound.prototype.setAutoPlay=function(t){this.value=t;this.autoPlay=t;return};UISound.prototype.setLoop=function(t){this.loop=t;return};UISound.prototype.isPlaying=function(){return this.playing};UISound.prototype.pause=function(){if(this.audio&&this.playing){this.audio.pause();this.playing=false}return};UISound.prototype.stop=function(){if(this.audio&&this.playing){this.audio.stop();this.playing=false}return};UISound.prototype.play=function(t){if(this.audio&&(!this.playing||t)){this.audio.play();this.playing=true}return};UISound.prototype.mute=function(t){this.setValue(!t);return};UISound.prototype.setValue=function(t){this.value=t;if(t){this.play()}else{this.pause()}return};UISound.prototype.onModeChanged=function(){this.stop();return};UISound.songs=[];UISound.addSong=function(t){UISound.songs.push(t);return};UISound.removeSong=function(t){for(var e=0;e<UISound.songs.length;e++){var i=UISound.songs[e];if(i.url===t){i.stop();UISound.songs.remove(i);return i}}return null};UISound.prototype.onInit=function(){var t=this;if(this.soundURL){var e={urls:[this.soundURL],autoplay:this.autoPlay,loop:this.loop,volume:.8};e.onend=function(){t.playing=false;console.log("audio end.")};UISound.removeSong(this.soundURL);var i=new Howl(e);i.url=this.soundURL;UISound.addSong(i);if(!this.getValue()){i.mute()}if(this.autoPlay){this.playing=true}this.audio=i;return}};UISound.prototype.shapeCanBeChild=function(t){return false};UISound.prototype.onClick=function(t,e){if(e||this.mode===Shape.MODE_EDITING){return}this.setValue(!this.value);this.callOnClickHandler(t);return};UISound.prototype.onFromJsonDone=function(){if(this.soundURL){ResLoader.loadAudio(this.soundURL,function(t){console.log("audio loaded: "+t.src)})}return};function UISoundCreator(){var t=["ui-sound","ui-sound",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISound;return e.initUISound(this.type,100,100,null)};return}function UIDistanceJoint(){return}UIDistanceJoint.prototype=new UITwoJoint;UIDistanceJoint.prototype.isUIJoint=true;UIDistanceJoint.prototype.isUIDistanceJoint=true;UIDistanceJoint.prototype.initUIDistanceJoint=function(t,e,i){this.initUITwoJoint(t,e,i);this.visibleAtRunTime=true;return this};function UIDistanceJointCreator(){var t=["ui-distance-joint","ui-distance-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIDistanceJoint;return e.initUIDistanceJoint(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIDistanceJointCreator);function UIParticles(){return}UIParticles.prototype=new UIElement;UIParticles.prototype.isUIParticles=true;UIParticles.prototype.initUIParticles=function(t){this.initUIElement(t);this.name="ui-particles";this.autoEmit=true;this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;return this};UIParticles.prototype.setEmitterPosition=function(t,e){if(this.emitter){this.emitter.p.x=t;this.emitter.p.y=e}else{this.emitterX=0;this.emitterY=0}return this};UIParticles.prototype.onInit=function(){this.start();return};UIParticles.prototype.onFromJsonDone=function(){var t=this.style;if(t.texture){var e=ResLoader.loadImage(t.texture)}if(t.textures){var i=t.textures.split("\n");for(var n=0;n<i.length;n++){var r=i[n];if(!r)continue;var e=ResLoader.loadImage(r)}}return};UIParticles.prototype.initParticles=function(){var t=this.w>>1;var e=this.h>>1;var i=new Proton;var n=new Proton.Emitter;var r=this.style;if(r.rateNumMax){n.rate=new Proton.Rate(new Proton.Span(r.rateNumMin,r.rateNumMax),new Proton.Span(r.rateTimeMin,r.rateTimeMax))}if(r.texture){var o=ResLoader.loadImage(r.texture);n.addInitialize(new Proton.ImageTarget(o))}if(r.textures){var a=[];var s=r.textures.split("\n");for(var l=0;l<s.length;l++){var h=s[l];if(!h)continue;var o=ResLoader.loadImage(h);a.push(o)}n.addInitialize(new Proton.ImageTarget(a))}if(r.massMax){n.addInitialize(new Proton.Mass(r.massMin,r.massMax))}if(r.radiusMin||r.radiusMax){n.addInitialize(new Proton.Radius(r.radiusMin,r.radiusMax))}if(r.lifeMax){n.addInitialize(new Proton.Life(r.lifeMin,r.lifeMax))}if(r.velocityType){n.addInitialize(new Proton.Velocity(new Proton.Span(r.velocityXMin,r.velocityXMax),new Proton.Span(r.velocityYMin,r.velocityYMax),r.velocityType))}if(r.driftX||r.driftY){n.addBehaviour(new Proton.RandomDrift(r.driftX,r.driftY,r.driftDelay,r.driftLife))}if(r.startColor||r.endColor){n.addBehaviour(new Proton.Color(r.startColor,r.endColor,r.colorLife,r.colorEasing))}if(r.position){switch(r.position){case"left":{n.addInitialize(new Proton.Position(new Proton.LineZone(-t,-e,-t,e)));break}case"right":{n.addInitialize(new Proton.Position(new Proton.LineZone(t,-e,t,e)));break}case"top":{n.addInitialize(new Proton.Position(new Proton.LineZone(-t,-e,t,-e)));break}case"bottom":{n.addInitialize(new Proton.Position(new Proton.LineZone(-t,e,t,e)));break}default:break}}if(r.rotationMin||r.rotationMax){n.addBehaviour(new Proton.Rotate(new Proton.Span(r.rotationMin,r.rotationMax),new Proton.Span(r.rotationDeltaMin,r.rotationDeltaMax),"add"))}if(r.scaleMax||r.scaleMin){n.addBehaviour(new Proton.Scale(r.scaleMin,r.scaleMax))}if(r.alphaMax||r.alphaMin){n.addBehaviour(new Proton.Alpha(r.alphaMin,r.alphaMax))}if(r.gravity){n.addBehaviour(new Proton.Gravity(r.gravity))}var u=this.getWindow();n.addBehaviour(new Proton.CrossZone(new Proton.RectZone(0,0,u.w,u.h),"dead"));n.p.x=t;n.p.y=e;if(this.autoEmit){n.emit()}i.addEmitter(n);this.emitter=n;this.lastUpdateTime=Date.now()};UIParticles.prototype.emit=function(t){this.emitter.stopEmit();if(t){this.emitter.emit("once",1e8)}else{this.emitter.emit()}return this};UIParticles.prototype.start=function(){var t=this;if(this.timerID){return this}this.initParticles();function e(){if(!t.parentShape||!t.emitter){clearInterval(t.timerID);t.timerID=0;return}if(t.isVisible()&&!t.paused&&WWindowManager.getInstance().getPaintEnable()){var e=Date.now();var i=(e-t.lastUpdateTime)/1e3;t.emitter.update(i);t.lastUpdateTime=e}}t.timerID=setInterval(e,25);return this};UIParticles.prototype.stop=function(){clearInterval(this.timerID);this.emitter.stopEmit();this.timerID=null;this.emitter=null;return this};UIParticles.prototype.pause=function(){this.paused=true;return this};UIParticles.prototype.resume=function(){this.paused=false;return this};UIParticles.prototype.drawParticle=function(t,e){if(e.target){if(e.target instanceof Image){var i=e.target.width*e.scale|0;var n=e.target.height*e.scale|0;var r=e.p.x-i/2;var o=e.p.y-n/2;t.save();t.globalAlpha=e.alpha;t.translate(e.p.x,e.p.y);t.rotate(Proton.MathUtils.degreeTransform(e.rotation));t.translate(-e.p.x,-e.p.y);t.drawImage(e.target,0,0,e.target.width,e.target.height,r,o,i,n);t.globalAlpha=1;t.restore()}}else{if(e.transform["rgb"])t.fillStyle="rgba("+e.transform.rgb.r+","+e.transform.rgb.g+","+e.transform.rgb.b+","+e.alpha+")";else t.fillStyle=e.color;t.beginPath();t.arc(e.p.x,e.p.y,e.radius,0,Math.PI*2,true);if(this.stroke){t.strokeStyle=this.stroke.color;t.lineWidth=this.stroke.thinkness;t.stroke()}t.closePath();t.fill()}};UIParticles.prototype.paintSelfOnly=function(t){if(!this.emitter){return}var e=this.emitter.particles;var i=e.length;for(var n=0;n<i;n++){var r=e[n];this.drawParticle(t,r)}this.postRedraw();return};UIParticles.prototype.shapeCanBeChild=function(t){return false};function UIParticlesCreator(){var t=["ui-particles","ui-particles",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIParticles;return e.initUIParticles(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIParticlesCreator);function UIParticlesX(){return}UIParticlesX.prototype=new UIElement;UIParticlesX.prototype.isUIParticlesX=true;UIParticlesX.prototype.initUIParticlesX=function(t){this.initUIElement(t);this.name="ui-particles";this.autoEmit=true;this.paused=false;this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;return this};UIParticlesX.prototype.setEmitterPosition=function(t,e){return this};UIParticlesX.prototype.onFromJsonDone=function(){return this};UIParticlesX.prototype.emit=function(t){this.particles.emit(t);return this};UIParticlesX.prototype.start=function(){this.particles.reset();return this};UIParticlesX.prototype.stop=function(){this.particles.stop();return this};UIParticlesX.prototype.pause=function(){this.paused=true;return this};UIParticlesX.prototype.resume=function(){this.paused=false;return this};UIParticlesX.prototype.loadPList=function(t,e){this.particles=new ParticleEmitter;this.particles.init(t);this.particles.setTexture(e);return};UIParticlesX.prototype.onInit=function(){var t=this;var e=null;if(this.dataURL){ResLoader.loadData(this.dataURL,function(i){try{e=JSON.parse(i)}catch(n){var r=new PList;e=r.parse(i);if(e.textureFileName){t.textureURL=t.dataURL.substring(0,t.dataURL.lastIndexOf("/")+1)+e.textureFileName}}delete t.particles;var o=e.imageData;if(o){var a=new Image;a.src=o;t.loadPList(e,a)}else if(t.textureURL){ResLoader.loadImage(t.textureURL,function(i){if(i.width===0||i.height===0){console.debug("particlesx invalid img");return}t.loadPList(e,i)})}})}return};UIParticlesX.prototype.drawBgImage=function(){return};UIParticlesX.prototype.setDataURL=function(t){if(t===this.dataURL||!t)return;this.dataURL=t;this.textureURL=t.substring(0,t.lastIndexOf(".")+1)+"png";this.onInit()};UIParticlesX.prototype.getDataURL=function(){return this.dataURL};UIParticlesX.prototype.drawParticle=function(t){if(!this.paused){this.particles.update(t.timeStep/1e3)}this.particles.setScaleX(this.scaleX);this.particles.setScaleY(this.scaleY);this.particles.draw(t)};UIParticlesX.prototype.paintSelfOnly=function(t){if(this.particles&&this.mode!==Shape.MODE_EDITING){t.needRedraw++;t.save();t.translate(this.w/2,this.h/2);this.drawParticle(t);t.restore()}return};UIParticlesX.prototype.shapeCanBeChild=function(t){return false};function UIParticlesXCreator(){var t=["ui-particles-x","ui-particles-x",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIParticlesX;return e.initUIParticlesX(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIParticlesXCreator);void function(){function t(t,e){t.x*=e;t.y*=e}function e(t,e){t.x=e.x;t.y=e.y}function i(t,e){t.x+=e.x;t.y+=e.y}function n(t,e){t.x-=e.x;t.y-=e.y}function r(e){t(e,1/Math.sqrt(e.x*e.x+e.y*e.y))}function o(t){t.x=0;t.y=0}function a(t,e){if(!(this instanceof a)){return new a(t,e)}this.x=t;this.y=e}function s(t,e,i,n){if(!(this instanceof s)){return new s(t,e,i,n)}this.r=t;this.g=e;this.b=i;this.a=n}function l(t,e,i,n){if(!(this instanceof l)){return new l(t,e,i,n)}this.x=t;this.y=e;this.w=i;this.h=n}function h(t,e){var i=t.x,n=t.y,r=e.a,o=e.b,a=e.c,s=e.d,l=e.tx,h=e.ty;return{x:r*i+a*n+l,y:o*i+s*n+h}}var u=Math.PI/180;function p(t){return u*t}function c(){return(Math.random()-.5)*2}function f(t,e,i){if(e>i){var n=e;e=i;i=e}return t<e?e:t>i?i:t}var m=1;var d=770;var y=771;function g(){this.pos=a(0,0);this.startPos=a(0,0);this.drawPos=a(0,0);this.color=s(0,0,0,255);this.deltaColor=s(0,0,0,255);this.modeA=new g.ParamsGravity;this.modeB=new g.ParamsRadius;this.size=0;this.deltaSize=0;this.rotation=0;this.deltaRotation=0;this.timeToLive=0;this.isChangeColor=false}g.TemporaryPoints=[a(0,0),a(0,0),a(0,0),a(0,0)];g.ModeGravity=function(t,e,i,n,r,o,a,s,l){this.speed=t;this.speedVar=e;this.gravity={x:i,y:n};this.radialAccel=r;this.radialAccelVar=o;this.tangentialAccel=a;this.tangentialAccelVar=s;this.rotationIsDir=l};g.ModeGravity.prototype.randomFeatures=function(e,i){var n=i.modeA;var r=this.speed+this.speedVar*c();n.dir.x=Math.cos(e);n.dir.y=Math.sin(e);t(n.dir,r);n.radialAccel=this.radialAccel+this.radialAccelVar*c();n.tangentialAccel=this.tangentialAccel+this.tangentialAccelVar*c()};g.ParamsGravity=function(t,e,i){this.dir=t||a(0,0);this.radialAccel=e;this.tangentialAccel=i};g.ModeRadius=function(t,e,i,n,r,o){this.startRadius=t;this.startRadiusVar=e;this.endRadius=i;this.endRadiusVar=n;this.rotatePerSecond=r;this.rotatePerSecondVar=o};g.ModeRadius.prototype.randomFeatures=function(t,e){var i=e.modeB;var n=this.startRadius+this.startRadiusVar*c();var r=this.endRadius+this.endRadiusVar*c();i.angle=t;i.radius=n;i.deltaRadius=(r-n)/e.timeToLive;i.anglePerSecond=p(this.rotatePerSecond+this.rotatePerSecondVar*c())};g.ParamsRadius=function(t,e,i,n){this.angle=t;this.radius=i||0;this.deltaRadius=n||0;this.anglePerSecond=e||0};function v(t){this.emitMode=0;this.duration=0;this.emitRate=0;this.timeCounter=0;this.srcPos=a(0,0);this.srcPosVar=a(0,0);this.angle=0;this.angleVar=0;this.maxParticles=0;this.isRemoveOnFinish=false;this.particles=[];this.particleCounter=0;this.positionType=v.POS_TYPE_FREE;this.srcBlendFunc=0;this.dstBlendFunc=0;this.life=0;this.lifeVar=0;this.startSize=0;this.startSizeVar=0;this.endSize=0;this.endSizeVar=0;this.startColor=s(0,0,0,0);this.startColorVar=s(0,0,0,0);this.endColor=s(0,0,0,0);this.endColorVar=s(0,0,0,0);this.startSpin=0;this.startSpinVar=0;this.endSpin=0;this.endSpinVar=0;this.tmpZeroPoint=a(0,0);this.elapsed=0;this.timeScale=1;this.active=true;this.texture=null;this.scaleX=1;this.scaleY=1;this.tintCache=document.createElement("canvas");this.transform={a:1,b:0,c:0,d:1,tx:0,ty:0};this.worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0};this.anchorPointInPoints=a(0,0)}v.POS_TYPE_FREE=0;v.POS_TYPE_RELATIVE=1;v.POS_TYPE_GROUPED=2;v.MODE_GRAVITY=0;v.MODE_RADIUS=1;v.MODE_WIND=2;function _(t,e,i){return t[e]!=void 0?t[e]:i}function I(t,e){var i=t.width;var n=t.height;e[0].width=i;e[0].height=n;e[1].width=i;e[1].height=n;e[2].width=i;e[2].height=n;e[3].width=i;e[3].height=n;var r=e[3].getContext("2d");r.drawImage(t,0,0);var o=r.getImageData(0,0,i,n).data;var a;for(var s=0;s<4;s++){a=e[s].getContext("2d");var l=a.getImageData(0,0,i,n);var h=l.data;for(var u=0;u<o.length;u+=4){h[u]=s===0?o[u]:0;h[u+1]=s===1?o[u+1]:0;h[u+2]=s===2?o[u+2]:0;h[u+3]=o[u+3]}a.putImageData(l,0,0)}t.onload=null}v.prototype.parseModeGravity=function(t){return new g.ModeGravity(parseFloat(_(t,"speed")),parseFloat(_(t,"speedVariance")),parseFloat(_(t,"gravityx")),parseFloat(_(t,"gravityy")),parseFloat(_(t,"radialAcceleration")),parseFloat(_(t,"radialAccelVariance")),parseFloat(_(t,"tangentialAcceleration")),parseFloat(_(t,"tangentialAccelVariance")),_(t,"rotationIsDir",false))};v.prototype.parseModeRadius=function(t){return new g.ModeRadius(parseFloat(_(t,"maxRadius")),parseFloat(_(t,"maxRadiusVariance")),parseFloat(_(t,"minRadius")),0,parseFloat(_(t,"rotatePerSecond")),parseFloat(_(t,"rotatePerSecondVariance")))};v.prototype.init=function(t){this.maxParticles=parseInt(_(t,"maxParticles",0));for(var e=0;e<this.maxParticles;e++){this.particles.push(new g)}this.angle=parseInt(_(t,"angle",0));this.angleVar=parseInt(_(t,"angleVariance",0));this.duration=parseInt(_(t,"duration",0));this.backDuration=this.duration;this.srcBlendFunc=parseInt(_(t,"blendFuncSource",0));this.dstBlendFunc=parseInt(_(t,"blendFuncDestination",0));this.startColor.r=parseFloat(_(t,"startColorRed"))*255;this.startColor.g=parseFloat(_(t,"startColorGreen"))*255;this.startColor.b=parseFloat(_(t,"startColorBlue"))*255;this.startColor.a=parseFloat(_(t,"startColorAlpha"))*255;this.startColorVar.r=parseFloat(_(t,"startColorVarianceRed"))*255;this.startColorVar.g=parseFloat(_(t,"startColorVarianceGreen"))*255;this.startColorVar.b=parseFloat(_(t,"startColorVarianceBlue"))*255;this.startColorVar.a=parseFloat(_(t,"startColorVarianceAlpha"))*255;this.endColor.r=parseFloat(_(t,"finishColorRed"))*255;this.endColor.g=parseFloat(_(t,"finishColorGreen"))*255;this.endColor.b=parseFloat(_(t,"finishColorBlue"))*255;this.endColor.a=parseFloat(_(t,"finishColorAlpha"))*255;this.endColorVar.r=parseFloat(_(t,"finishColorVarianceRed"))*255;this.endColorVar.g=parseFloat(_(t,"finishColorVarianceGreen"))*255;this.endColorVar.b=parseFloat(_(t,"finishColorVarianceBlue"))*255;this.endColorVar.a=parseFloat(_(t,"finishColorVarianceAlpha"))*255;this.startSize=parseFloat(_(t,"startParticleSize"));this.startSizeVar=parseFloat(_(t,"startParticleSizeVariance"));this.endSize=parseFloat(_(t,"finishParticleSize"));this.endSizeVar=parseFloat(_(t,"finishParticleSizeVariance"));this.srcPos.x=parseFloat(_(t,"sourcePositionx"));this.srcPos.y=parseFloat(_(t,"sourcePositiony"));this.srcPosVar.x=parseFloat(_(t,"sourcePositionVariancex"));this.srcPosVar.y=parseFloat(_(t,"sourcePositionVariancey"));this.startSpin=parseFloat(_(t,"rotationStart"));this.startSpinVar=parseFloat(_(t,"rotationStartVariance"));this.endSpin=parseFloat(_(t,"rotationEnd"));this.endSpinVar=parseFloat(_(t,"rotationEndVariance"));this.life=parseFloat(_(t,"particleLifespan"));this.lifeVar=parseFloat(_(t,"particleLifespanVariance"));this.emitRate=this.maxParticles/this.life;this.isRemoveOnFinish=_(t,"isAutoRemoveOnFinish",false);this.emitMode=parseFloat(_(t,"emitterType"));this.imageData=_(t,"imageData",null);if(this.imageData){var i=new Image;i.src=this.imageData;this.setTexture(i)}if(this.emitMode===v.MODE_GRAVITY){this.mode=this.parseModeGravity(t)}else{this.mode=this.parseModeRadius(t)}};v.prototype.setScaleX=function(t){this.scaleX=t;return this};v.prototype.setScaleY=function(t){this.scaleY=t;return this};v.prototype.emit=function(t){this.reset();if(t){if("backDuration"in this){this.duration=this.backDuration}if(this.duration===-1){this.duration=1}}else{if("backDuration"in this){this.backDuration=this.duration}this.duration=-1}};v.prototype.reset=function(){this.active=true;this.elapsed=0;if("backDuration"in this){this.duration=this.backDuration}var t=this.particles;for(var e=0;e<t.length;e++){t[e].timeToLive=0}};v.prototype.reload=function(t){this.stop();this.init(t);this.start()};v.prototype.pause=function(){this.timeScale=0;return this};v.prototype.resume=function(){this.timeScale=1;return this};v.prototype.start=function(){this.reset();return this};v.prototype.stop=function(){if("backDuration"in this){this.duration=this.backDuration}this.active=false;this.elapsed=this.duration;this.timeCounter=0;return this};v.prototype.setTexture=function(t){if(t===this.texture)return;this.texture=t;this.textureRect=l(0,0,t.width,t.height);return this};v.prototype.getWorldTransform=function(){var t=this.transform;var e=1,i=0,n=0,r=1;t.tx=this.srcPos.x;t.ty=this.srcPos.y;t.a=e;t.b=i;t.c=n;t.d=r;var o=this.scaleX,a=this.scaleY;var s=this.anchorPointInPoints.x,l=this.anchorPointInPoints.y;o=o<1e-6&&o>-1e-6?1e-6:o;a=a<1e-6&&a>-1e-6?1e-6:a;if(o!==1||a!==1){e=t.a*=o;i=t.b*=o;n=t.c*=a;r=t.d*=a}t.tx-=e*s+n*l;t.ty-=i*s+r*l;return this.transform};v.prototype.convertToWorldSpace=function(t){return h(t,this.getWorldTransform())};v.prototype.initParticle=function(t){t.timeToLive=this.life+this.lifeVar*c();t.timeToLive=Math.max(0,t.timeToLive);t.pos.x=this.srcPosVar.x*c();t.pos.y=this.srcPosVar.y*c();var e={r:f(this.startColor.r+this.startColorVar.r*c(),0,255),g:f(this.startColor.g+this.startColorVar.g*c(),0,255),b:f(this.startColor.b+this.startColorVar.b*c(),0,255),a:f(this.startColor.a+this.startColorVar.a*c(),0,255)};var i={r:f(this.endColor.r+this.endColorVar.r*c(),0,255),g:f(this.endColor.g+this.endColorVar.g*c(),0,255),b:f(this.endColor.b+this.endColorVar.b*c(),0,255),a:f(this.endColor.a+this.endColorVar.a*c(),0,255)};t.color=e;t.deltaColor={r:(i.r-e.r)/t.timeToLive,g:(i.g-e.g)/t.timeToLive,b:(i.b-e.b)/t.timeToLive,a:(i.a-e.a)/t.timeToLive};var n=this.startSize+this.startSizeVar*c();var r=this.endSize+this.endSizeVar*c();t.size=Math.max(0,n);t.deltaSize=(r-n)/t.timeToLive;var o=this.startSpin+this.startSpinVar*c();var a=this.endSpin+this.endSpinVar*c();t.rotation=o;t.deltaRotation=(a-o)/t.timeToLive;if(this.positionType===v.POS_TYPE_FREE){t.startPos=this.convertToWorldSpace(this.tmpZeroPoint)}else if(this.positionType===v.POS_TYPE_RELATIVE){t.startPos.x=this.srcPos.x;t.startPos.y=this.srcPos.y}var s=p(this.angle+this.angleVar*c());this.mode.randomFeatures(s,t)};v.prototype.isFull=function(){return this.particleCounter>=this.maxParticles};v.prototype.addParticle=function(){if(!this.isFull()){var t=null;if(this.particleCounter<this.particles.length){t=this.particles[this.particleCounter]}else{t=new g;this.particles.push(t)}this.initParticle(t);++this.particleCounter}};v.prototype.updateParticles=function(a){var s=g.TemporaryPoints[0];if(this.positionType===v.POS_TYPE_FREE){e(s,this.convertToWorldSpace(this.tmpZeroPoint))}else if(this.positionType===v.TYPE_RELATIVE){s.x=this.srcPos.x;s.y=this.srcPos.y}var l=null,h=0,u=this.particles,p=g.TemporaryPoints[1],c=g.TemporaryPoints[2],f=g.TemporaryPoints[3];while(h<this.particleCounter){o(p);o(c);o(f);l=u[h];l.timeToLive-=a;if(l.timeToLive>0){if(this.emitMode===v.MODE_GRAVITY){var m=f,d=p,y=c;if(l.pos.x||l.pos.y){e(d,l.pos);r(d)}else{o(d)}e(y,d);t(d,l.modeA.radialAccel);var _=y.x;y.x=-y.y;y.y=_;t(y,l.modeA.tangentialAccel);e(m,d);i(m,y);i(m,this.mode.gravity);t(m,a);i(l.modeA.dir,m);e(m,l.modeA.dir);t(m,a);i(l.pos,m)}else{var I=l.modeB;I.angle+=I.anglePerSecond*a;I.radius+=I.deltaRadius*a;l.pos.x=-Math.cos(I.angle)*I.radius;l.pos.y=-Math.sin(I.angle)*I.radius}l.color.r+=l.deltaColor.r*a;l.color.g+=l.deltaColor.g*a;l.color.b+=l.deltaColor.b*a;l.color.a+=l.deltaColor.a*a;l.isChangeColor=false;l.size+=l.deltaSize*a;l.size=Math.max(0,l.size);l.rotation+=l.deltaRotation*a;var w=p;if(this.positionType===v.POS_TYPE_FREE||this.positionType===v.POS_TYPE_RELATIVE){var x=c;e(x,s);n(x,l.startPos);e(w,l.pos);n(w,x)}else{e(w,l.pos)}e(l.drawPos,w);++h}else{if(h!==this.particleCounter-1){var S=u[h]=u[this.particleCounter-1];u[this.particleCounter-1]=l}--this.particleCounter}}return};v.prototype.update=function(t){var e=1/this.emitRate;t*=this.timeScale;if(this.active){if(this.particleCounter<this.maxParticles){this.timeCounter+=t}while(this.particleCounter<this.maxParticles&&this.timeCounter>e){this.addParticle();this.timeCounter-=e}this.elapsed+=t;if(this.duration!==-1&&this.duration<=this.elapsed){this.stop()}}this.updateParticles(t)};v.prototype.setTransform=function(t,e){t.transform(e.a,-e.b,-e.c,e.d,e.tx*this.scaleX,-(e.ty*this.scaleY))};v.prototype.isBlendAdditive=function(){return this.srcBlendFunc===d&&this.dstBlendFunc===m||this.srcBlendFunc===m&&this.dstBlendFunc===m};v.prototype.changeTextureColor=function(t,e,i){var n=this.tintCache;var r=n.getContext("2d");n.width=t.width;n.height=t.height;r.globalCompositeOperation="source-over";r.fillStyle="rgb("+(e.r|0)+","+(e.g|0)+","+(e.b|0)+")";r.fillRect(0,0,i.w,i.h);r.globalCompositeOperation="multiply";r.drawImage(t,i.x,i.y,i.w,i.h,0,0,i.w,i.h);r.globalCompositeOperation="destination-atop";r.drawImage(t,i.x,i.y,i.w,i.h,0,0,i.w,i.h);return n};v.prototype.draw=function(t){var e=this.texture,i=this.particles,n=this.textureRect,r=this.particleCounter;t.save();this.setTransform(t,this.worldTransform);if(this.isBlendAdditive()){t.globalCompositeOperation="lighter"}else{t.globalCompositeOperation="source-over"}var o,a,s,l,h=n.w,u=n.h;for(var c=0;c<r;c++){o=i[c];a=0|o.size*.5;s=o.color.a/255;if(s===0)continue;t.globalAlpha=s;t.save();t.translate(0|o.drawPos.x,-(0|o.drawPos.y));l=Math.floor(o.size/4)*4;t.scale(Math.max(1/h*l,1e-6),Math.max(1/u*l,1e-6));if(o.rotation){t.rotate(p(o.rotation))}var f=o.isChangeColor?this.changeTextureColor(e,o.color,n):e;t.drawImage(f,-(0|h/2),-(0|u/2));t.restore()}t.restore()};window.ParticleEmitter=v}();function UIBitmapFontText(){return}UIBitmapFontText.prototype=new UIElement;UIBitmapFontText.prototype.isUIBitmapFontText=true;UIBitmapFontText.prototype.initUIBitmapFontText=function(t,e,i){this.initUIElement(t);this.text="";this.textAlignment="center";this.setMargin(5,5);this.setDefSize(e,i);this.setSizeLimit(30,30);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_NORMAL,null);this.addEventNames(["onUpdateTransform"]);return this};UIBitmapFontText.prototype.shapeCanBeChild=function(t){return false};UIBitmapFontText.prototype.setImageWithRowCols=function(t,e,i){this.imageRows=e;this.imageColumns=i;this.setImage(UIElement.IMAGE_NORMAL_FG,t);return};UIBitmapFontText.prototype.getRectOfChar=function(t,e,i){if(this.allText){var n=this.allText.length;var r=this.allText.indexOf(i);if(r>=0){var o=e.trimmed?e.rw:e.w;var a=e.trimmed?e.rh:e.h;var s=this.imageRows?this.imageRows:a>o?n:1;var l=this.imageColumns?this.imageColumns:o>a?n:1;var h=Math.round(o/l);var u=Math.round(a/s);var p=Math.floor(r/l);var i=r%l;var c={};c.w=h;c.h=u;c.x=h*i+e.x;c.y=u*p+e.y;if(r===0){c.w=c.w-(e.ox||0);c.h=c.h-(e.oy||0)}else{c.x=c.x-(e.ox||0);c.y=c.y-(e.oy||0)}return c}}return null};UIBitmapFontText.prototype.setAllText=function(t){this.allText=t;return this};UIBitmapFontText.prototype.getAllText=function(){return this.allText};UIBitmapFontText.prototype.getBgImage=function(){var t=null;if(this.pointerDown&&!this.isClicked()){t=this.images.active_bg}else{t=this.images.normal_bg}if(!t||!t.getImage()){t=this.images.default_bg}if(!t||!t.getImage()){return}return t};UIBitmapFontText.prototype.drawFgImage=function(t){var e=this.text;var i=this.getImageByType(UIElement.IMAGE_NORMAL_FG);if(!e||!i){return}var n=i.getImage();var r=i.getImageRect();if(!n){return}var o=0;var a=this.h;var s=15;for(var l=0;l<e.length;l++){var h=e[l];var u=this.getRectOfChar(n,r,h);if(u){o+=u.w;if(u.h>s){s=u.h}}}var p=0;var c=0;var f=0;var m=this.h>>1;var d=Math.min(this.h/s,this.w/o);switch(this.textAlignment){case"right":{c=this.w-this.hMargin-o;f=c+o;break}case"center":{c=this.w-o>>1;f=this.w>>1;break}default:{c=this.hMargin;f=c;break}}if(d!=1){t.translate(f,m);t.scale(d,d);t.translate(-f,-m)}for(var l=0;l<e.length;l++){var h=e[l];var u=this.getRectOfChar(n,r,h);if(u){p=a-u.h>>1;t.drawImage(n,u.x,u.y,u.w,u.h,c,p,u.w,u.h);c+=u.w}}return};function UIBitmapFontTextCreator(){var t=["ui-bitmap-font-text","ui-bitmap-font-text",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIBitmapFontText;return e.initUIBitmapFontText(this.type,400,100)};return}ShapeFactoryGet().addShapeCreator(new UIBitmapFontTextCreator);UIElement.prototype.getScence=function(){return this.getWindow()};UIElement.prototype.getFootprints=function(t){var e=0;var i=0;var n=[];var r=this.isUIWindow?this:this.getParent().children;for(var o=0;o<r.length;o++){var a=r[o];if(!a.isUIFootprint){continue}if(t&&t!=a.name){continue}e=a.left+(a.w>>1);i=a.top+(a.h>>1);n.push({x:e,y:i})}return n};UIElement.prototype.moveAlongPath=function(t,e,i,n){var r=this.getFootprints(t);return this.moveAlongPoints(r,e,i,n)};UIElement.prototype.moveAlongPoints=function(t,e,i,n){var r=0;var o=0;var a=0;var s={};var l=[];var h=0;if(!t.length){console.log("no footprint found.")}for(var u=0;u<t.length;u++){var p=t[u];if(u){o=t[u].x-t[u-1].x;a=t[u].y-t[u-1].y;r=Math.sqrt(o*o+a*a);l.push(r);h+=r}}s.onDone=n;s.duration=e;s.distances=l;s.points=t;s.totalDistance=h;s.enableRotation=i;this.startMove(s);return};UIElement.prototype.startMove=function(t){var e=0;var i=0;var n=0;var r=this;var o=this.w>>1;var a=this.h>>1;var s=t.duration;var l=t.distances;var h=t.points;var u=t.totalDistance;var p=t.enableRotation;function c(){if(n+1>=h.length){if(t.onDone){t.onDone()}return}var f=Date.now();var m=h[n+1];var d=h[n];var y=s*(l[n]/u);var g=m.x-d.x;var v=m.y-d.y;var _=Math.asin(Math.abs(v)/Math.sqrt(g*g+v*v));if(v<=0&&g<0){_=Math.PI-_}if(v>0&&g<0){_=Math.PI+_}if(v>0&&g>=0){_=2*Math.PI-_}_=-_;function I(){var t=(Date.now()-f)/y;if(t<1){e=d.x+g*t-o;i=d.y+v*t-a;r.setPosition(e,i);if(p){r.setRotation(_)}r.postRedraw();return true}else{n++;e=m.x-o;i=m.y-a;r.setPosition(e,i);r.postRedraw();c();return false}}UIElement.setAnimTimer(I)}c();return};UIElement.prototype.setPositionWithSticky=function(t,e){this.setPosition(t,e);if(this.sticky){this.orgX=this.x;this.orgY=this.y}return this};UIElement.prototype.setAngle=UIElement.prototype.setRotation;UIElement.prototype.setPositionByBody=function(t,e){this.setLeftTop(t,e);this.callOnMovedHandler();return this};UIElement.prototype.setSoundMusicVolume=function(t){this.getWindowManager().setSoundMusicVolume(t);return this};UIElement.prototype.setSoundEffectVolume=function(t){this.getWindowManager().setSoundEffectVolume(t);return this};UIElement.prototype.playSoundEffect=function(t,e){this.getWindowManager().playSoundEffect(t,e);return this};UIElement.prototype.playSoundMusic=function(t,e){this.getWindowManager().playSoundMusic(t,e);return this};UIElement.prototype.stopSoundMusic=function(t){this.getWindowManager().stopSoundMusic(t);return this};UIElement.prototype.stopSoundEffect=function(t){this.getWindowManager().stopSoundEffect(t);return this};UIElement.prototype.setSoundEnable=function(t){var e=this.getWindowManager();e.setSoundEnable(t);return this};UIElement.prototype.isSoundEnable=UIElement.prototype.getSoundEnable=function(){var t=this.getWindowManager();return t.getSoundEnable()};UIElement.prototype.setSoundEffectEnable=function(t){var e=this.getWindowManager();e.setSoundEffectsEnable(t);return this};UIElement.prototype.isSoundEffectEnable=UIElement.prototype.getSoundEffectEnable=function(){var t=this.getWindowManager();return t.soundEffectsEnalbe};UIElement.prototype.setSoundMusicEnable=function(t){var e=this.getWindowManager();e.setSoundMusicsEnable(t);return this};UIElement.prototype.isSoundMusicEnable=UIElement.prototype.getSoundMusicEnable=function(){var t=this.getWindowManager();
return t.soundMusicsEnalbe};UIElement.prototype.setVOf=function(t,e,i){var n=this.getWindow().findChildByName(t,true);if(n){n.setV(e,i)}else{console.log("not found "+t)}return this};UIElement.prototype.setV=function(t,e){var i=this.body;if(i){this.setVisible(true);if(!i.IsActive()){i.SetActive(true)}if(!i.IsAwake()){i.SetAwake(true)}var n=i.GetLinearVelocity();if(t!==null&&t!==undefined){n.x=t}if(e!==null&&e!==undefined){n.y=e}i.SetLinearVelocity(n)}return this};UIElement.prototype.onRemoved=function(t){if(!t){return}var e=t.getWindow();if(!e){return}var i=e.world;if(this.body){Physics.destroyBodyForElement(i,this);this.body=null}if(this.joint){Physics.destroyJointForElement(i,this);this.joint=null}return this};function UIFrameAnimation(){return}UIFrameAnimation.prototype=new UIElement;UIFrameAnimation.prototype.isUIFrameAnimation=true;UIFrameAnimation.prototype.initUIFrameAnimation=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.current=0;this.frameRate=10;this.playing=false;this.autoPlay=true;this.repeatTimes=4294967295;this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.addEventNames(["onDoubleClick","onUpdateTransform"]);return this};UIFrameAnimation.prototype.syncImageFrames=function(){this.frames=[];for(var t in this.images){var e=this.images[t];if(t.indexOf("option_image_")>=0&&e){this.frames.push(e)}}return};UIFrameAnimation.prototype.elementToJson=function(t){UIElement.prototype.elementToJson.call(this,t);if(this.groups){t.groups=JSON.parse(JSON.stringify(this.groups))}return t};UIFrameAnimation.prototype.elementFromJson=function(t){UIElement.prototype.elementFromJson.call(this,t);this.playing=false;this.syncImageFrames();if(t.groups){this.groups=t.groups}else if(t.groupsData){this.groups=this.parseGroupsData(t.groupsData);this.groupsData=null}return t};UIFrameAnimation.prototype.afterChildAppended=function(t){t.xAttr=UIElement.X_CENTER_IN_PARENT;t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;return};UIFrameAnimation.prototype.setAutoPlay=function(t){this.autoPlay=t;return this};UIFrameAnimation.prototype.resume=function(){this.playing=true;return this};UIFrameAnimation.prototype.pause=function(){this.playing=false;return this};UIFrameAnimation.prototype.stop=function(){this.playing=false;return this};UIFrameAnimation.prototype.playSequence=function(t,e,i,n){this.deferred=Deferred();var r=this.frames.length;if(!r||!t||!t.length){return}this.current=0;this.playing=true;this.onDone=i;this.onOneCycle=n;this.runningSequence=t;this.nextUpdateTime=Date.now()+this.getDuration();this.repeatTimes=e?e:4294967295;return this.deferred.promise};UIFrameAnimation.prototype.playRange=function(t,e,i,n,r){var o=this.frames.length;if(t>e){var a=t;t=e;e=a}var s=[];for(var l=t;l<=e;l++){s.push(l)}return this.playSequence(s,i,n,r)};UIFrameAnimation.prototype.gotoAndPlayByName=function(t,e,i,n){var r=this.getGroupRange(t);if(r.start!==undefined&&r.end!==undefined){return this.gotoAndPlay(r.start,r.end,e,i,n)}else if(r&&r.length){return this.playSequence(r,e,i,n)}else if(this.animations&&t){return this.animate(t)}};UIFrameAnimation.prototype.play=UIFrameAnimation.prototype.gotoAndPlayByName;UIFrameAnimation.prototype.gotoAndPlay=UIFrameAnimation.prototype.playRange;UIFrameAnimation.prototype.nextFrame=function(){if(!this.frames||!this.frames.length||!this.runningSequence||!this.runningSequence.length){return}var t=this.current+1;var e=this.runningSequence.length;if(t===e){if(this.onOneCycle){try{this.onOneCycle(this)}catch(i){console.log("onOneCycle: "+i.message)}}this.repeatTimes--;if(this.repeatTimes<=0){this.playing=false;if(this.onDone){try{this.onDone(this)}catch(i){console.log("onDone: "+i.message)}}if(this.deferred){this.deferred.resolve()}return}}this.current=t%e;return};UIFrameAnimation.prototype.getCurrentImage=function(){if(!this.frames||!this.frames.length){return null}if(!this.runningSequence||!this.runningSequence.length){return this.frames[0]}if(this.current>=this.runningSequence.length){this.current=0}var t=this.runningSequence[this.current];return this.frames[t]};UIFrameAnimation.prototype.parseGroupsData=function(t){var e={};var i=t.split(";");for(var n=0;n<i.length;n++){var r=i[n].split(":");if(!r||r.length<2){continue}try{var o=JSON.parse(r[1])}catch(a){console.log(a.message);continue}if(!o||o.length<2){continue}var s=r[0];var l=o[0];var h=o[1];e[s]={start:l,end:h}}return e};UIFrameAnimation.prototype.stringifyGroups=function(t){if(!t){return null}var e="";for(var i in t){var n=t[i];if(e){e+=";"}e+=i+":["+n.start+","+n.end+"]"}return e};UIFrameAnimation.prototype.setGroupsData=function(t){if(t){this.groups=this.parseGroupsData(t)}else{this.groups={}}return this};UIFrameAnimation.prototype.getGroupRange=function(t){var e=null;if(this.groups&&t){e=this.groups[t]}if(!e){e={start:0,end:this.frames.length-1}}return e};UIFrameAnimation.prototype.getImages=function(){var t="";for(var e in this.images){var i=this.images[e];if(e.indexOf("option_image_")>=0&&i&&i.src){t+=i.src+"\n"}}return t};UIFrameAnimation.prototype.setImages=function(t){var e=this.images.display;this.images={};this.images.display=e;if(t){var i=0;var n=0;var r=t.split("\n");for(var i=0;i<r.length;i++){var o=r[i];if(!o)continue;if(o.indexOf("/")===0){o=o.substr(1)}var a="option_image_"+n++;this.setImage(a,o)}}this.syncImageFrames();return this};UIFrameAnimation.prototype.getValue=function(){return this.current};UIFrameAnimation.prototype.setValue=function(t){this.current=Math.min(t,this.frames.length);return};UIFrameAnimation.prototype.startAutoPlay=function(){if(this.defaultGroupName){this.play(this.defaultGroupName,268435455)}else{this.gotoAndPlay(0,this.frames.length-1,268435455)}return};UIFrameAnimation.prototype.onInit=function(){this.syncImageFrames();if(this.autoPlay&&this.frames&&this.frames.length){this.startAutoPlay();if(this.autoPlayDelay){this.nextUpdateTime+=this.autoPlayDelay}}return};UIFrameAnimation.prototype.paintSelf=function(t){if(this.playing&&this.isVisible()){var e=this.getDuration();var i=t.now+e;if(t.now>this.nextUpdateTime){this.nextFrame();this.nextUpdateTime=i}else{this.nextUpdateTime=Math.min(this.nextUpdateTime,i)}t.needRedraw++}return UIElement.prototype.paintSelf.call(this,t)};UIFrameAnimation.prototype.getFrameRate=function(){return this.frameRate?this.frameRate:5};UIFrameAnimation.prototype.setFrameRate=function(t){this.frameRate=Math.max(1,Math.min(t,30));return this};UIFrameAnimation.prototype.getDuration=function(){if(UIElement.timeScaleIsZero()){return 16777215}else{return 1e3/this.frameRate/UIElement.timeScale}};UIFrameAnimation.prototype.shapeCanBeChild=UISprite.prototype.shapeCanBeChild;UIFrameAnimation.prototype.drawImage=function(t){var e=this.getCurrentImage();if(e){var i=e.getImageRect();var n=e.getImage();if(n){this.drawImageAt(t,n,this.images.display,0,0,this.w,this.h,i)}}return};function UIFrameAnimationCreator(){var t=["ui-frame-animation","ui-frame-animation",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFrameAnimation;return e.initUIFrameAnimation(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIFrameAnimationCreator);function UIWeldJoint(){return}UIWeldJoint.prototype=new UIOneJoint;UIWeldJoint.prototype.isUIJoint=true;UIWeldJoint.prototype.isUIWeldJoint=true;UIWeldJoint.prototype.initUIWeldJoint=function(t){this.initUIOneJoint(t);return this};function UIWeldJointCreator(){var t=["ui-weld-joint","ui-weld-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIWeldJoint;return e.initUIWeldJoint(this.type)};return}function UIMouseJoint(){return}UIMouseJoint.prototype=new UIOneJoint;UIMouseJoint.prototype.isUIMouseJoint=true;UIMouseJoint.prototype.initUIMouseJoint=function(t){this.initUIOneJoint(t);this.speedScale=1;this.enableTop=true;this.enableLeft=true;this.enableRight=true;this.enableBottom=true;return this};UIMouseJoint.prototype.onInit=function(){var t=this.getParent();var e=this.speedScale;var i=this.enableLeft;var n=this.enableRight;var r=this.enableTop;var o=this.enableBottom;if(t.physicsShape||t.isUIPhysicsShape){t.handlePointerDown=function(e){return UIMouseJoint.handleSpritePointerDown(t,e)};t.handlePointerMove=function(e){return UIMouseJoint.handleSpritePointerMove(t,e)};t.handlePointerUp=function(a){return UIMouseJoint.handleSpritePointerUp(t,a,e,i,n,r,o)}}};UIMouseJoint.handleSpritePointerDown=function(t,e){t.body.SetLinearVelocity({x:0,y:0});return};UIMouseJoint.handleSpritePointerMove=function(t,e){t.body.SetLinearVelocity({x:0,y:0});return};UIMouseJoint.prototype.setSpeedLimit=function(t,e,i,n){var r=this.getParent();r.xMinV=t;r.yMinV=i;r.xMaxV=e;r.yMaxV=n;return};UIMouseJoint.handleSpritePointerUp=function(t,e,i,n,r,o,a){var s=(Date.now()-t.pointerDownTime)/1e3;var l=t.getMoveAbsDeltaX();var h=t.getMoveAbsDeltaY();var u=i*Physics.toMeter(l)/s;var p=i*Physics.toMeter(h)/s;if(!n&&u<0){u=0}if(!o&&p<0){p=0}if(!r&&u>0){u=0}if(!a&&p>0){p=0}var c=t.xMaxV;if(c&&Math.abs(u)>c){u=u>0?c:-c}var f=t.yMaxV;if(f&&Math.abs(p)>f){p=p>0?f:-f}var m=t.xMinV;if(m&&Math.abs(u)<m){u=u>0?m:-m}var d=t.yMinV;if(d&&Math.abs(p)<d){p=p>0?d:-d}t.body.SetLinearVelocity({x:u,y:p});return};function UIMouseJointCreator(){var t=["ui-mouse-joint","ui-mouse-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIMouseJoint;return e.initUIMouseJoint(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIMouseJointCreator);function UISoundEffects(){return}UISoundEffects.prototype=new UICheckBox;UISoundEffects.prototype.isUISoundEffects=true;UISoundEffects.prototype.initUISoundEffects=function(t){this.initUICheckBox(t);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;return this};UISoundEffects.prototype.shapeCanBeChild=function(t){return false};UISoundEffects.prototype.setValue=function(t){var e=this.getWindowManager();if(this.mode===Shape.MODE_EDITING){return this}if(e){e.setSoundEffectsEnable(t)}return this};UISoundEffects.prototype.getValue=function(t){var e=this.getWindowManager();if(e){return e.soundEffectsEnalbe}else{return true}};UISoundEffects.prototype.isPlaying=UISoundEffects.prototype.getValue;function UISoundEffectsCreator(){var t=["ui-sound-effects","ui-sound-effects",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISoundEffects;return e.initUISoundEffects(this.type)};return}ShapeFactoryGet().addShapeCreator(new UISoundEffectsCreator);function UIShaker(){return}UIShaker.prototype=new UIImage;UIShaker.prototype.isUIShaker=true;UIShaker.prototype.initUIShaker=function(t,e,i){this.initUIImage(t,e,i);return this};UIShaker.prototype.setAmplitudeX=function(t){this.amplitudeX=t;return this};UIShaker.prototype.setAmplitudeY=function(t){this.amplitudeY=t;return this};UIShaker.prototype.setDuration=function(t){this.duration=t;return this};UIShaker.prototype.setTimes=function(t){this.times=t;return this};UIShaker.prototype.setAmplitudeModifier=function(t){this.amplitudeModifier=t;return this};UIShaker.prototype.getAmplitudeX=function(){return this.amplitudeX};UIShaker.prototype.getAmplitudeY=function(){return this.amplitudeY};UIShaker.prototype.getDuration=function(){return this.duration};UIShaker.prototype.getTimes=function(){return this.times};UIShaker.prototype.getAmplitudeModifier=function(){return this.amplitudeModifier};UIShaker.prototype.setEnable=function(t){var e=this.getParent();if(!e||this.enable==t){return this}if(!t){this.enable=t;return this}var i=this;var n=this.amplitudeX?this.amplitudeX:0;var r=this.amplitudeY?this.amplitudeY:0;var o=this.times?this.times:1;var a=this.duration?this.duration:200;var s=Date.now();var l=e.paintSelf;var h=o*2*Math.PI;var u=this.amplitudeModifier;e.paintSelf=function(t){var o=Date.now()-s;if(o<a){var p=1;var c=o/a;var f=h*c;var m=n*Math.cos(f);var d=r*Math.sin(f);if(u==="i"){p=c}else if(u==="d"){p=1-c}else if(u==="i->d"){p=2*(c<.5?c:1-c)}m*=p;d*=p;t.translate(m,d)}else{e.paintSelf=l;i.enable=false}l.call(e,t)};return this};function UIShakerCreator(){var t=["ui-shaker","ui-shaker",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIShaker;return e.initUIShaker(this.type,80,80)};return}ShapeFactoryGet().addShapeCreator(new UIShakerCreator);function UISettings(){return}UISettings.prototype=new UIElement;UISettings.prototype.isUISettings=true;UISettings.prototype.initUISettings=function(t,e,i){this.initUIElement(t);this.setSize(e,i);this.settingsDef={};this.regSerializer(this.settingsToJson,this.settingsFromJson);return this};UISettings.prototype.getSettingObj=function(t){var e=this.settingsDef[t];if(e&&e.isGlobal){return this.getWindowManager()}else{return this.getWindow()}};UISettings.prototype.getSetting=function(t){var e=this.getSettingObj(t);var i=e.settings[t];if(i===undefined){var n=this.settingsDef[t];if(n){i=n.defVal}}return i};UISettings.prototype.setSetting=function(t,e){var i=this.getSettingObj(t);return i.settings[t]=e};UISettings.prototype.settingsFromJson=function(t){this.settingsDef=t.settingsDef;return this};UISettings.prototype.settingsToJson=function(t){t.settingsDef=this.settingsDef;return t};function UISettingsCreator(){var t=["ui-settings","ui-settings",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISettings;return e.initUISettings(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UISettingsCreator);function UITile(){return}UITile.prototype=new UIElement;UITile.prototype.isUITile=true;UITile.prototype.initUITile=function(t,e,i){this.initUIElement(t);this.setSize(e,i);return this};UITile.Layer=function(){};UITile.Layer.prototype.init=function(t,e){this.tile=t;this.info=e;return this};UITile.Layer.prototype.drawOrthogonal=function(t,e){var i=this.info;var n=i.x||0;var r=i.y||0;var o=i.data;var a=i.height;var s=i.width;var l=this.tile;var h=l.tileWidth;var u=l.tileHeight;var p=h*s;var c=Math.max(Math.floor(e.y/u),0);var f=Math.max(Math.floor(e.x/h),0);var m=Math.min(Math.ceil((e.x+e.w)/h),s);var d=Math.min(Math.ceil((e.y+e.h)/u),a);var y=f*h+n;var g=c*u+r;var e={x:y,y:g,w:h,h:u};n=y;t.globalAlpha=i.opacity;for(var v=c;v<=d;v++){for(var _=f;_<=m;_++){var I=v*s+_;var w=o[I];if(w){e.x=y;e.y=g;l.drawTile(t,e,w)}y+=h}y=n;g+=u}return};UITile.Layer.prototype.drawIsometric=function(t,e){var i=e.y;var n=e.x;var r=n+e.w;var o=i+e.h;var a=0;var s=this.info;var l=s.x||0;var h=s.y||0;var u=s.data;var p=s.height;var c=s.width;var f=this.tile;var m=f.tileWidth;var d=f.tileHeight;t.globalAlpha=s.opacity;var y=h;var g=l+this.info.width*m/2-m/2;var e={x:l,y:h,w:m,h:d};for(var v=0;v<p;v++){for(var _=0;_<c;_++,a++){var I=u[a];l=(_-v)*d+g;h=(_+v)*m/4+y;if(!I||l>r||h>o||l+m<n||h+d<i){continue}e.x=l;e.y=h;f.drawTile(t,e,I)}}return};UITile.Layer.prototype.draw=function(t,e){var i=this.info;if(!i.visible)return;switch(this.tile.orientation){case"orthogonal":{this.drawOrthogonal(t,e);break}case"isometric":{this.drawIsometric(t,e);break}default:{throw new Error("unknow orientation: ",this.tile.orientation)}}return};UITile.Layer.prototype.getTileByPoint=function(t,e){var i=this.tile;var n=i.tileWidth;var r=i.tileHeight;var o=Math.floor(e/r);var a=Math.floor(t/n);var s=o*this.info.width+a;var l=this.info.data[s];return{row:o,col:a,index:s,imageIndex:l}};UITile.TileSet=function(){};UITile.TileSet.prototype.init=function(t,e,i){this.tile=t;this.info=i;this.imageURL=e+"/"+i.image;this.image=WImage.create(this.imageURL);this.tileWidth=i.tilewidth+i.spacing;this.tileHeight=i.tileheight+i.spacing;this.cols=Math.floor((i.imagewidth-2*i.margin)/this.tileWidth);this.rows=Math.floor((i.imageheight-2*i.margin)/this.tileHeight);this.tileNr=this.cols*this.rows;this.startIndex=i.firstgid;return this};UITile.TileSet.prototype.testImageIndex=function(t){return t>=this.startIndex&&t<this.startIndex+this.tileNr};UITile.TileSet.prototype.drawTile=function(t,e,i,n){var r=this.image.getImage();var o=n-this.startIndex;if(o<0||o>=this.tileNr||!r||!r.width){return}var a=this.info;var s=o%this.cols;var l=Math.floor(o/this.cols);var h=s*this.tileWidth+a.margin;var u=l*this.tileHeight+a.margin;var p=a.tilewidth;var c=a.tileheight;if(this.tileHeight!==this.tile.tileHeight){i=i-(this.tileHeight-this.tile.tileHeight)}t.drawImage(r,h,u,p,c,e,i,p,c);return};UITile.prototype.loadTileSets=function(t,e){this.tilesets=[];var i=e.length;var n=t.dirname();this.images={};for(var r=0;r<i;r++){var o=new UITile.TileSet;o.init(this,n,e[r]);this.setImage("option_image_"+r,o.imageURL);this.tilesets.push(o)}return this};UITile.prototype.loadLayers=function(t){this.layers=[];var e=t.length;for(var i=0;i<e;i++){this.layers.push((new UITile.Layer).init(this,t[i]))}return this};UITile.prototype.getMapWidth=function(){return this.mapWidth};UITile.prototype.getMapHeight=function(){return this.mapHeight};UITile.prototype.getLayerNr=function(){return this.layers?this.layers.length:0};UITile.prototype.getLayerByIndex=function(t){if(this.layers&&t<this.layers.length){return this.layers[t]}return null};UITile.prototype.loadJSON=function(t,e){if(this.isIcon)return;if(!e||!e.width||!e.height){console.log("invalid tiled json");return}this.tileRows=e.height;this.tileCols=e.width;this.tileWidth=e.tilewidth;this.tileHeight=e.tileheight;this.orientation=e.orientation;this.renderorder=e.renderorder;this.properties=e.properties;this.mapWidth=this.tileWidth*this.tileCols;this.mapHeight=this.tileHeight*this.tileRows;this.loadTileSets(t,e.tilesets);this.loadLayers(e.layers);if(this.enable){var i=this.getWindow();if(i&&i.isUIScene){i.setMap(this)}}return};UITile.prototype.loadURL=function(t){var e=this;httpGetJSON(t,function(i){e.loadJSON(t,i)});return};UITile.prototype.load=function(){var t=this.dataURL||this.tiledJsonURL;if(t){this.dataURL=t;this.loadURL(t)}return};UITile.prototype.setClipRegion=function(t){this.clipRegion=t;return this};UITile.prototype.isInClipRegion=function(t){if(!this.clipRegion)return true;var e=this.clipRegion;var i=e.length;for(var n=0;n<i;n++){var r=e[n];if(Rect.hasIntersection(r,t)){return true}}return false};UITile.prototype.drawTile=function(t,e,i){if(!this.isInClipRegion(e)){return}var n=this.tilesets.length;for(var r=0;r<n;r++){var o=this.tilesets[r];if(o.testImageIndex(i)){o.drawTile(t,e.x,e.y,i);break}}return};UITile.prototype.draw=function(t,e){if(!this.layers){return}var i=this.layers;var n=i.length;for(var r=0;r<n;r++){i[r].draw(t,e)}return};UITile.prototype.onAppendedInParent=function(){this.load()};UITile.prototype.createBody=function(t,e,i,n,r,o,a){var s=r>>1;var l=o>>1;var h=i+s;var u=n+l;var p=new b2FixtureDef;p.density=a.density;p.friction=a.friction;p.restitution=a.restitution;if(a.groupIndex){p.filter.groupIndex=a.groupIndex}if(a.isSensor){p.isSensor=true}p.shape=new b2PolygonShape;p.shape.SetAsBox(Physics.toMeter(s),Physics.toMeter(l));var c=new b2BodyDef;c.type=a.density?b2Body.b2_dynamicBody:b2Body.b2_staticBody;c.position.Set(Physics.toMeter(h),Physics.toMeter(u));c.allowSleep=true;body=t.CreateBody(c);body.CreateFixture(p);body.name=e;return};UITile.prototype.createLayerBodies=function(t,e,i){var n=i.data;var r=n.length;var o=i.properties||{};var a=i.height;var s=i.width;var l=this.tileWidth;var h=this.tileHeight;var u=i.x?i.x:0;var p=i.y?i.y:0;o.density=0;o.restitution=o.restitution?parseFloat(o.restitution):.5;o.friction=o.friction?parseFloat(o.friction):.5;for(var c=0;c<r;c++){var f=n[c];if(!f)continue;var m=Math.floor(c/s);var d=c%s;var y=u+d*l;var g=p+m*h;this.createBody(t,e+"-"+c,y,g,l,h,o)}return};UITile.prototype.createBodies=function(t){var e=this.layers;var i=e.length;for(var n=0;n<i;n++){var r=e[n];var o=r.info.properties;if(o&&o.physics){this.createLayerBodies(t,n,r.info)}}return};UITile.prototype.onFromJsonDone=function(t){this.load()};UITile.prototype.setTiledJsonURL=function(t){this.dataURL=t;this.load()};UITile.prototype.getTiledJsonURL=function(){return this.dataURL||this.tiledJsonURL};UITile.prototype.setEnable=function(t){var e=this.getParent();if(!e||this.enable==t){return this}var i=this.getWindow();if(i&&i.isUIScene){if(t){i.setMap(this)}else{if(i.getMap()===this){i.setMap(null)}}}this.enable=t;return};function UITileCreator(){var t=["ui-tile","ui-tile",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITile;return e.initUITile(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UITileCreator);function UIGSensor(){return}UIGSensor.prototype=new UIElement;UIGSensor.prototype.isUIGSensor=true;UIGSensor.prototype.initUIGSensor=function(t,e,i){this.initUIElement(t);this.setSize(e,i);this.addEventNames(["onDeviceOrientation"]);return this};UIGSensor.prototype.onInit=function(){if(this.enable){this.setEnable(true)}};UIGSensor.prototype.setEnable=function(t){var e=this;if(this.mode===Shape.MODE_EDITING)return this;function i(t){var i=t.accelerationIncludingGravity;if(!i){console.log("accelerationIncludingGravity not available.");return}var n=i.x||0;var r=i.y||0;var o=i.z||-9.8;if(isAndroid()){n=-n}else if(isIPhone()){r=-r}e.callOnDeviceOrientation(n,r,o,t);return}this.enable=t;if(t){window.removeEventListener("devicemotion",i,false);window.addEventListener("devicemotion",i,false)}else{window.removeEventListener("devicemotion",i,false)}return this};function UIGSensorCreator(){var t=["ui-gsensor","ui-gsensor",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGSensor;return e.initUIGSensor(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIGSensorCreator);function UIMarquee(){return}UIMarquee.prototype=new UILabel;UIMarquee.isUIMarquee=true;UIMarquee.DIR_UP="up";UIMarquee.DIR_DOWN="down";UIMarquee.DIR_LEFT="left";UIMarquee.DIR_RIGHT="right";UIMarquee.BEHAVIOR_SCROLL="scroll";UIMarquee.BEHAVIOR_SLIDE="slide";UIMarquee.BEHAVIOR_ALTERNATE="alternate";UIMarquee.LOOP_INFINITE="infinite";UIMarquee.DEFAULT_SCROLL_AMOUNT=1;UIMarquee.DEFAULT_SCROLL_DELAY=20;UIMarquee.prototype.initUIMarquee=function(t,e,i){this.initUIElement(t);this.setText(e);this.setDefSize(200,200);this.setMargin(5,5);this.running=false;this.scrollCounter=0;this.timeScale=1;this.autoPlay=false;this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,i);this.addEventNames(["onChanged","onUpdateTransform","onPlayStepDone","onPlayDone"]);return this};var configLeftResolve={onScroll:function(t,e,i,n,r,o){if(this.done){t.rect(0,0,0,0);t.clip();return}e=e%(r+i);if(e<=i){t.rect(r-i,0,i,o);t.clip();if(this.needStep){this.callOnStep()}if(this.done){this.backText=this.text;this.text=""}}else if(e>=r){t.rect(0,0,i,o);t.clip();this.needStep=true}t.translate(r-e,0)},onSlide:function(t,e,i,n,r,o){if(this.done)return;e%=r;if(e<=i){t.rect(r-i,0,i,o);t.clip();if(this.needStep){this.callOnStep()}}else{this.needStep=true}t.translate(r-e,0)},onAlternate:function(t,e,i,n,r,o){if(this.done){t.translate(r-i,0);return}var a=parseInt(e/(r-i),10)%2>0;var s=parseInt(e%(r-i),10);s=a?r-i-s:s;if(a){this.needStep=true}else if(!a&&this.needStep){this.callOnStep()}t.translate(r-i-s,0)}};var configUpResolve={onScroll:function(t,e,i,n,r,o){if(this.done){t.rect(0,0,0,0);t.clip();return}e=e%(o+n);if(e<=n){t.rect(0,o-n,r,n);t.clip();if(this.needStep){this.callOnStep()}if(this.done){this.backText=this.text;this.text=""}}else if(e>=o){t.rect(0,0,r,o);t.clip();this.needStep=true}t.translate(0,o-e)},onSlide:function(t,e,i,n,r,o){if(this.done){return}e%=o;if(e<=n){t.rect(0,o-n,r,n);t.clip();if(this.needStep){this.callOnStep()}}else{this.needStep=true}t.translate(0,o-e)},onAlternate:function(t,e,i,n,r,o){if(this.done){t.translate(0,o-n);return}var a=parseInt(e/(o-n),10)%2>0;var s=parseInt(e%(o-n),10);s=a?o-n-s:s;if(a){this.needStep=true}else if(!a&&this.needStep){this.callOnStep()}t.translate(0,o-n-s)}};var configRightResolve={onScroll:function(t,e,i,n,r,o){if(this.done){t.rect(0,0,0,0);t.clip();return}e%=r+i;if(e>=r){this.needStep=true;t.rect(r-i,0,i,o);t.clip()}else if(e<=i){t.rect(0,0,i,o);t.clip();if(this.needStep){this.callOnStep()}if(this.done){this.backText=this.text;this.text=""}}t.translate(e-i,0)},onSlide:function(t,e,i,n,r,o){if(this.done){t.translate(r-i,0);return}e%=r;if(e<=i){t.rect(0,0,i,o);t.clip();if(this.needStep){this.callOnStep()}}else{this.needStep=true}t.translate(e-i,0)},onAlternate:function(t,e,i,n,r,o){if(this.done){return}var a=parseInt(e/(r-i),10)%2>0;var s=parseInt(e%(r-i),10);s=a?r-i-s:s;if(a){this.needStep=true}if(!a&&this.needStep){this.callOnStep()}t.translate(s,0)}};var configDownResolve={onScroll:function(t,e,i,n,r,o){if(this.done){t.rect(0,0,0,0);t.clip();return}e%=o+n;if(e<=n){t.rect(0,0,r,n+e);t.clip();if(this.needStep){this.callOnStep()}if(this.done){this.backText=this.text;this.text=""}}else if(e>=o){t.rect(0,o-n,r,n);t.clip();this.needStep=true}t.translate(0,e-n)},onSlide:function(t,e,i,n,r,o){if(this.done){t.translate(0,o-n);return}e%=o;if(e<=n){t.rect(0,0,r,n);t.clip();if(this.needStep){this.callOnStep()}}else{this.needStep=true}t.translate(0,e-n)},onAlternate:function(t,e,i,n,r,o){if(this.done){return}var a=parseInt(e/(o-n),10)%2>0;var s=parseInt(e%(o-n),10);s=a?o-n-s:s;if(a){this.needStep=true}else if(this.needStep&&!a){this.callOnStep()}t.translate(0,s)}};UIMarquee.makeResolve=function(t,e,i){return function(n){var r=this.getWidth(true),o=this.getHeight(true),a=n.timeStep;var s=parseInt(this.scrollCounter*this.scrollamount/this.scrolldelay,10);n.font=this.style.getFont();var l=this.getLocaleText(this.text);var h=n.measureText(l).width;var u=parseInt(n.font);this.hTextAlign=t;this.vTextAlign=e;var p=[n,s,h,u,r,o];switch(this.behavior){case UIMarquee.BEHAVIOR_SCROLL:{i.onScroll.apply(this,p);break}case UIMarquee.BEHAVIOR_SLIDE:{i.onSlide.apply(this,p);break}case UIMarquee.BEHAVIOR_ALTERNATE:{i.onAlternate.apply(this,p);break}default:{throw new Error("unknow behavior")}}}};UIMarquee.prototype.leftResolve=UIMarquee.makeResolve("left","middle",configLeftResolve);UIMarquee.prototype.rightResolve=UIMarquee.makeResolve("left","middle",configRightResolve);UIMarquee.prototype.upResolve=UIMarquee.makeResolve("center","up",configUpResolve);UIMarquee.prototype.downResolve=UIMarquee.makeResolve("center","up",configDownResolve);UIMarquee.prototype.update=function(t){var e=t.timeStep;if(e<this.scrolldelay)e=this.scrolldelay;this.scrollCounter+=this.timeScale*e;switch(this.direction){case UIMarquee.DIR_RIGHT:{this.rightResolve(t);break}case UIMarquee.DIR_LEFT:{this.leftResolve(t);break}case UIMarquee.DIR_UP:{this.upResolve(t);break}case UIMarquee.DIR_DOWN:{this.downResolve(t);break}default:{throw new Error("unknow UIMarquee.direction:"+this.direction)}}};UIMarquee.prototype.onInit=function(){if(this.autoPlay){this.play()}return};UIMarquee.prototype.drawText=function(t){this.layoutText(t);if((this.running||this.done)&&this.mode!==Shape.MODE_EDITING){this.update(t);this.defaultDrawText(t)}if(this.mode===Shape.MODE_EDITING){this.defaultDrawText(t)}return};UIMarquee.prototype.initOpts=function(t,e,i){if(typeof t==="function"){i=e;e=t;t={}}this.onStep=i||t.onStep;this.onDone=e||t.onDone;this.direction=t.direction||this.direction||UIMarquee.DIR_RIGHT;this.behavior=t.behavior||this.behavior||UIMarquee.BEHAVIOR_SCROLL;this.loop=t.loop>0?t.loop:this.loop?this.loop:UIMarquee.LOOP_INFINITE;this.backloop=this.loop;this.scrolldelay=t.scrolldelay||this.scrolldelay||UIMarquee.DEFAULT_SCROLL_DELAY;this.scrollamount=t.scrollamount||this.scrollamount||UIMarquee.DEFAULT_SCROLL_AMOUNT;return this};UIMarquee.prototype.play=function(t,e,i){t=t||{};this.initOpts(t,e,i);this.reset();this.started=true;this.running=true;this.done=false;this.text=this.backText?this.backText:this.text;return this};UIMarquee.prototype.reset=function(){this.timeScale=1;this.scrollCounter=0;this.needStep=false;this.loop=this.backloop};UIMarquee.prototype.restart=function(){if(!this.started)return;this.running=true;this.done=false;this.text=this.backText?this.backText:this.text;this.reset();return this};UIMarquee.prototype.stop=function(){this.reset();this.running=false;return this};UIMarquee.prototype.pause=function(){if(!this.running)return;this.timeScale=0;return this};UIMarquee.prototype.resume=function(){if(!this.running)return;this.timeScale=1;return this};UIMarquee.prototype.callOnStep=function(){this.needStep=false;if(this.loop!==UIMarquee.LOOP_INFINITE){--this.loop;if(this.loop===0){this.callOnDone();return}}if(typeof this.onStep==="function"){if(!this.onStep()){this.callOnDone();return}}return this};UIMarquee.prototype.callOnDone=function(){if(typeof this.onDone==="function"){this.onDone()}this.done=true;this.stop();return this};function UIMarqueeCreator(){var t=["ui-marquee","ui-marquee",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIMarquee;return e.initUIMarquee(this.type,dappGetText("Text"),null)}}ShapeFactoryGet().addShapeCreator(new UIMarqueeCreator);var Box2D={};Box2D.MIN_VALUE=Number.MIN_VALUE;if(Box2D.MIN_VALUE===0){var d=2;while(Box2D.MIN_VALUE===0){Box2D.MIN_VALUE=1/(Number.MAX_VALUE/d);d*=2}}(function(t,e){if(!(Object.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function){Object.defineProperty=function(t,e,i){if(i.get instanceof Function)t.__defineGetter__(e,i.get);if(i.set instanceof Function)t.__defineSetter__(e,i.set)}}function i(){}t.inherit=function(t,e){var n=t;i.prototype=e.prototype;t.prototype=new i;t.prototype.constructor=n};t.generateCallback=function n(t,e){return function(){e.apply(t,arguments)}};t.NVector=function r(t){if(t===e)t=0;var i=new Array(t||0);for(var n=0;n<t;++n)i[n]=0;return i};t.is=function o(t,i){if(t===null)return false;if(i instanceof Function&&t instanceof i)return true;if(t.constructor.__implements!=e&&t.constructor.__implements[i])return true;return false};t.parseUInt=function(t){return Math.abs(parseInt(t))}})(Box2D);var Vector=Array;var Vector_a2j_Number=Box2D.NVector;if(typeof Box2D==="undefined")Box2D={};if(typeof Box2D.Collision==="undefined")Box2D.Collision={};if(typeof Box2D.Collision.Shapes==="undefined")Box2D.Collision.Shapes={};if(typeof Box2D.Common==="undefined")Box2D.Common={};if(typeof Box2D.Common.Math==="undefined")Box2D.Common.Math={};if(typeof Box2D.Dynamics==="undefined")Box2D.Dynamics={};if(typeof Box2D.Dynamics.Contacts==="undefined")Box2D.Dynamics.Contacts={};if(typeof Box2D.Dynamics.Controllers==="undefined")Box2D.Dynamics.Controllers={};if(typeof Box2D.Dynamics.Joints==="undefined")Box2D.Dynamics.Joints={};(function(){Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";function t(){t.b2AABB.apply(this,arguments)}Box2D.Collision.b2AABB=t;function e(){e.b2Bound.apply(this,arguments)}Box2D.Collision.b2Bound=e;function i(){i.b2BoundValues.apply(this,arguments);if(this.constructor===i)this.b2BoundValues.apply(this,arguments)}Box2D.Collision.b2BoundValues=i;function n(){n.b2Collision.apply(this,arguments)}Box2D.Collision.b2Collision=n;function r(){r.b2ContactID.apply(this,arguments);if(this.constructor===r)this.b2ContactID.apply(this,arguments)}Box2D.Collision.b2ContactID=r;function o(){o.b2ContactPoint.apply(this,arguments)}Box2D.Collision.b2ContactPoint=o;function a(){a.b2Distance.apply(this,arguments)}Box2D.Collision.b2Distance=a;function s(){s.b2DistanceInput.apply(this,arguments)}Box2D.Collision.b2DistanceInput=s;function l(){l.b2DistanceOutput.apply(this,arguments)}Box2D.Collision.b2DistanceOutput=l;function h(){h.b2DistanceProxy.apply(this,arguments)}Box2D.Collision.b2DistanceProxy=h;function u(){u.b2DynamicTree.apply(this,arguments);if(this.constructor===u)this.b2DynamicTree.apply(this,arguments)}Box2D.Collision.b2DynamicTree=u;function p(){p.b2DynamicTreeBroadPhase.apply(this,arguments)}Box2D.Collision.b2DynamicTreeBroadPhase=p;function c(){c.b2DynamicTreeNode.apply(this,arguments)}Box2D.Collision.b2DynamicTreeNode=c;function f(){f.b2DynamicTreePair.apply(this,arguments)}Box2D.Collision.b2DynamicTreePair=f;function m(){m.b2Manifold.apply(this,arguments);if(this.constructor===m)this.b2Manifold.apply(this,arguments)}Box2D.Collision.b2Manifold=m;function d(){d.b2ManifoldPoint.apply(this,arguments);
if(this.constructor===d)this.b2ManifoldPoint.apply(this,arguments)}Box2D.Collision.b2ManifoldPoint=d;function y(){y.b2Point.apply(this,arguments)}Box2D.Collision.b2Point=y;function g(){g.b2RayCastInput.apply(this,arguments);if(this.constructor===g)this.b2RayCastInput.apply(this,arguments)}Box2D.Collision.b2RayCastInput=g;function v(){v.b2RayCastOutput.apply(this,arguments)}Box2D.Collision.b2RayCastOutput=v;function _(){_.b2Segment.apply(this,arguments)}Box2D.Collision.b2Segment=_;function I(){I.b2SeparationFunction.apply(this,arguments)}Box2D.Collision.b2SeparationFunction=I;function w(){w.b2Simplex.apply(this,arguments);if(this.constructor===w)this.b2Simplex.apply(this,arguments)}Box2D.Collision.b2Simplex=w;function x(){x.b2SimplexCache.apply(this,arguments)}Box2D.Collision.b2SimplexCache=x;function S(){S.b2SimplexVertex.apply(this,arguments)}Box2D.Collision.b2SimplexVertex=S;function T(){T.b2TimeOfImpact.apply(this,arguments)}Box2D.Collision.b2TimeOfImpact=T;function C(){C.b2TOIInput.apply(this,arguments)}Box2D.Collision.b2TOIInput=C;function b(){b.b2WorldManifold.apply(this,arguments);if(this.constructor===b)this.b2WorldManifold.apply(this,arguments)}Box2D.Collision.b2WorldManifold=b;function D(){D.ClipVertex.apply(this,arguments)}Box2D.Collision.ClipVertex=D;function E(){E.Features.apply(this,arguments)}Box2D.Collision.Features=E;function A(){A.b2CircleShape.apply(this,arguments);if(this.constructor===A)this.b2CircleShape.apply(this,arguments)}Box2D.Collision.Shapes.b2CircleShape=A;function U(){U.b2EdgeChainDef.apply(this,arguments);if(this.constructor===U)this.b2EdgeChainDef.apply(this,arguments)}Box2D.Collision.Shapes.b2EdgeChainDef=U;function M(){M.b2EdgeShape.apply(this,arguments);if(this.constructor===M)this.b2EdgeShape.apply(this,arguments)}Box2D.Collision.Shapes.b2EdgeShape=M;function P(){P.b2MassData.apply(this,arguments)}Box2D.Collision.Shapes.b2MassData=P;function B(){B.b2PolygonShape.apply(this,arguments);if(this.constructor===B)this.b2PolygonShape.apply(this,arguments)}Box2D.Collision.Shapes.b2PolygonShape=B;function L(){L.b2Shape.apply(this,arguments);if(this.constructor===L)this.b2Shape.apply(this,arguments)}Box2D.Collision.Shapes.b2Shape=L;Box2D.Common.b2internal="Box2D.Common.b2internal";function R(){R.b2Color.apply(this,arguments);if(this.constructor===R)this.b2Color.apply(this,arguments)}Box2D.Common.b2Color=R;function O(){O.b2Settings.apply(this,arguments)}Box2D.Common.b2Settings=O;function V(){V.b2Mat22.apply(this,arguments);if(this.constructor===V)this.b2Mat22.apply(this,arguments)}Box2D.Common.Math.b2Mat22=V;function W(){W.b2Mat33.apply(this,arguments);if(this.constructor===W)this.b2Mat33.apply(this,arguments)}Box2D.Common.Math.b2Mat33=W;function k(){k.b2Math.apply(this,arguments)}Box2D.Common.Math.b2Math=k;function F(){F.b2Sweep.apply(this,arguments)}Box2D.Common.Math.b2Sweep=F;function N(){N.b2Transform.apply(this,arguments);if(this.constructor===N)this.b2Transform.apply(this,arguments)}Box2D.Common.Math.b2Transform=N;function G(){G.b2Vec2.apply(this,arguments);if(this.constructor===G)this.b2Vec2.apply(this,arguments)}Box2D.Common.Math.b2Vec2=G;function H(){H.b2Vec3.apply(this,arguments);if(this.constructor===H)this.b2Vec3.apply(this,arguments)}Box2D.Common.Math.b2Vec3=H;function Y(){Y.b2Body.apply(this,arguments);if(this.constructor===Y)this.b2Body.apply(this,arguments)}Box2D.Dynamics.b2Body=Y;function J(){J.b2BodyDef.apply(this,arguments);if(this.constructor===J)this.b2BodyDef.apply(this,arguments)}Box2D.Dynamics.b2BodyDef=J;function X(){X.b2ContactFilter.apply(this,arguments)}Box2D.Dynamics.b2ContactFilter=X;function z(){z.b2ContactImpulse.apply(this,arguments)}Box2D.Dynamics.b2ContactImpulse=z;function K(){K.b2ContactListener.apply(this,arguments)}Box2D.Dynamics.b2ContactListener=K;function j(){j.b2ContactManager.apply(this,arguments);if(this.constructor===j)this.b2ContactManager.apply(this,arguments)}Box2D.Dynamics.b2ContactManager=j;function q(){q.b2DebugDraw.apply(this,arguments);if(this.constructor===q)this.b2DebugDraw.apply(this,arguments)}Box2D.Dynamics.b2DebugDraw=q;function Z(){Z.b2DestructionListener.apply(this,arguments)}Box2D.Dynamics.b2DestructionListener=Z;function Q(){Q.b2FilterData.apply(this,arguments)}Box2D.Dynamics.b2FilterData=Q;function $(){$.b2Fixture.apply(this,arguments);if(this.constructor===$)this.b2Fixture.apply(this,arguments)}Box2D.Dynamics.b2Fixture=$;function tt(){tt.b2FixtureDef.apply(this,arguments);if(this.constructor===tt)this.b2FixtureDef.apply(this,arguments)}Box2D.Dynamics.b2FixtureDef=tt;function et(){et.b2Island.apply(this,arguments);if(this.constructor===et)this.b2Island.apply(this,arguments)}Box2D.Dynamics.b2Island=et;function it(){it.b2TimeStep.apply(this,arguments)}Box2D.Dynamics.b2TimeStep=it;function nt(){nt.b2World.apply(this,arguments);if(this.constructor===nt)this.b2World.apply(this,arguments)}Box2D.Dynamics.b2World=nt;function rt(){rt.b2CircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2CircleContact=rt;function ot(){ot.b2Contact.apply(this,arguments);if(this.constructor===ot)this.b2Contact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2Contact=ot;function at(){at.b2ContactConstraint.apply(this,arguments);if(this.constructor===at)this.b2ContactConstraint.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactConstraint=at;function st(){st.b2ContactConstraintPoint.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactConstraintPoint=st;function lt(){lt.b2ContactEdge.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactEdge=lt;function ht(){ht.b2ContactFactory.apply(this,arguments);if(this.constructor===ht)this.b2ContactFactory.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactFactory=ht;function ut(){ut.b2ContactRegister.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactRegister=ut;function pt(){pt.b2ContactResult.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactResult=pt;function ct(){ct.b2ContactSolver.apply(this,arguments);if(this.constructor===ct)this.b2ContactSolver.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactSolver=ct;function ft(){ft.b2EdgeAndCircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=ft;function mt(){mt.b2NullContact.apply(this,arguments);if(this.constructor===mt)this.b2NullContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2NullContact=mt;function dt(){dt.b2PolyAndCircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolyAndCircleContact=dt;function yt(){yt.b2PolyAndEdgeContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=yt;function gt(){gt.b2PolygonContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolygonContact=gt;function vt(){vt.b2PositionSolverManifold.apply(this,arguments);if(this.constructor===vt)this.b2PositionSolverManifold.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PositionSolverManifold=vt;function _t(){_t.b2BuoyancyController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2BuoyancyController=_t;function It(){It.b2ConstantAccelController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ConstantAccelController=It;function wt(){wt.b2ConstantForceController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ConstantForceController=wt;function xt(){xt.b2Controller.apply(this,arguments)}Box2D.Dynamics.Controllers.b2Controller=xt;function St(){St.b2ControllerEdge.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ControllerEdge=St;function Tt(){Tt.b2GravityController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2GravityController=Tt;function Ct(){Ct.b2TensorDampingController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2TensorDampingController=Ct;function bt(){bt.b2DistanceJoint.apply(this,arguments);if(this.constructor===bt)this.b2DistanceJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2DistanceJoint=bt;function Dt(){Dt.b2DistanceJointDef.apply(this,arguments);if(this.constructor===Dt)this.b2DistanceJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2DistanceJointDef=Dt;function Et(){Et.b2FrictionJoint.apply(this,arguments);if(this.constructor===Et)this.b2FrictionJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2FrictionJoint=Et;function At(){At.b2FrictionJointDef.apply(this,arguments);if(this.constructor===At)this.b2FrictionJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2FrictionJointDef=At;function Ut(){Ut.b2GearJoint.apply(this,arguments);if(this.constructor===Ut)this.b2GearJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2GearJoint=Ut;function Mt(){Mt.b2GearJointDef.apply(this,arguments);if(this.constructor===Mt)this.b2GearJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2GearJointDef=Mt;function Pt(){Pt.b2Jacobian.apply(this,arguments)}Box2D.Dynamics.Joints.b2Jacobian=Pt;function Bt(){Bt.b2Joint.apply(this,arguments);if(this.constructor===Bt)this.b2Joint.apply(this,arguments)}Box2D.Dynamics.Joints.b2Joint=Bt;function Lt(){Lt.b2JointDef.apply(this,arguments);if(this.constructor===Lt)this.b2JointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2JointDef=Lt;function Rt(){Rt.b2JointEdge.apply(this,arguments)}Box2D.Dynamics.Joints.b2JointEdge=Rt;function Ot(){Ot.b2LineJoint.apply(this,arguments);if(this.constructor===Ot)this.b2LineJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2LineJoint=Ot;function Vt(){Vt.b2LineJointDef.apply(this,arguments);if(this.constructor===Vt)this.b2LineJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2LineJointDef=Vt;function Wt(){Wt.b2MouseJoint.apply(this,arguments);if(this.constructor===Wt)this.b2MouseJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2MouseJoint=Wt;function kt(){kt.b2MouseJointDef.apply(this,arguments);if(this.constructor===kt)this.b2MouseJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2MouseJointDef=kt;function Ft(){Ft.b2PrismaticJoint.apply(this,arguments);if(this.constructor===Ft)this.b2PrismaticJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2PrismaticJoint=Ft;function Nt(){Nt.b2PrismaticJointDef.apply(this,arguments);if(this.constructor===Nt)this.b2PrismaticJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2PrismaticJointDef=Nt;function Gt(){Gt.b2PulleyJoint.apply(this,arguments);if(this.constructor===Gt)this.b2PulleyJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2PulleyJoint=Gt;function Ht(){Ht.b2PulleyJointDef.apply(this,arguments);if(this.constructor===Ht)this.b2PulleyJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2PulleyJointDef=Ht;function Yt(){Yt.b2RevoluteJoint.apply(this,arguments);if(this.constructor===Yt)this.b2RevoluteJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2RevoluteJoint=Yt;function Jt(){Jt.b2RevoluteJointDef.apply(this,arguments);if(this.constructor===Jt)this.b2RevoluteJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2RevoluteJointDef=Jt;function Xt(){Xt.b2WeldJoint.apply(this,arguments);if(this.constructor===Xt)this.b2WeldJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2WeldJoint=Xt;function zt(){zt.b2WeldJointDef.apply(this,arguments);if(this.constructor===zt)this.b2WeldJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2WeldJointDef=zt})();Box2D.postDefs=[];(function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2EdgeChainDef,i=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2MassData,r=Box2D.Collision.Shapes.b2PolygonShape,o=Box2D.Collision.Shapes.b2Shape,a=Box2D.Common.b2Color,s=Box2D.Common.b2internal,l=Box2D.Common.b2Settings,h=Box2D.Common.Math.b2Mat22,u=Box2D.Common.Math.b2Mat33,p=Box2D.Common.Math.b2Math,c=Box2D.Common.Math.b2Sweep,f=Box2D.Common.Math.b2Transform,m=Box2D.Common.Math.b2Vec2,d=Box2D.Common.Math.b2Vec3,y=Box2D.Collision.b2AABB,g=Box2D.Collision.b2Bound,v=Box2D.Collision.b2BoundValues,_=Box2D.Collision.b2Collision,I=Box2D.Collision.b2ContactID,w=Box2D.Collision.b2ContactPoint,x=Box2D.Collision.b2Distance,S=Box2D.Collision.b2DistanceInput,T=Box2D.Collision.b2DistanceOutput,C=Box2D.Collision.b2DistanceProxy,b=Box2D.Collision.b2DynamicTree,D=Box2D.Collision.b2DynamicTreeBroadPhase,E=Box2D.Collision.b2DynamicTreeNode,A=Box2D.Collision.b2DynamicTreePair,U=Box2D.Collision.b2Manifold,M=Box2D.Collision.b2ManifoldPoint,P=Box2D.Collision.b2Point,B=Box2D.Collision.b2RayCastInput,L=Box2D.Collision.b2RayCastOutput,R=Box2D.Collision.b2Segment,O=Box2D.Collision.b2SeparationFunction,V=Box2D.Collision.b2Simplex,W=Box2D.Collision.b2SimplexCache,k=Box2D.Collision.b2SimplexVertex,F=Box2D.Collision.b2TimeOfImpact,N=Box2D.Collision.b2TOIInput,G=Box2D.Collision.b2WorldManifold,H=Box2D.Collision.ClipVertex,Y=Box2D.Collision.Features,J=Box2D.Collision.IBroadPhase;y.b2AABB=function(){this.lowerBound=new m;this.upperBound=new m};y.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x;var e=this.upperBound.y-this.lowerBound.y;var i=t>=0&&e>=0;i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid();return i};y.prototype.GetCenter=function(){return new m((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};y.prototype.GetExtents=function(){return new m((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};y.prototype.Contains=function(t){var e=true;e=e&&this.lowerBound.x<=t.lowerBound.x;e=e&&this.lowerBound.y<=t.lowerBound.y;e=e&&t.upperBound.x<=this.upperBound.x;e=e&&t.upperBound.y<=this.upperBound.y;return e};y.prototype.RayCast=function(t,e){var i=-Number.MAX_VALUE;var n=Number.MAX_VALUE;var r=e.p1.x;var o=e.p1.y;var a=e.p2.x-e.p1.x;var s=e.p2.y-e.p1.y;var l=Math.abs(a);var h=Math.abs(s);var u=t.normal;var p=0;var c=0;var f=0;var m=0;var d=0;{if(l<Box2D.MIN_VALUE){if(r<this.lowerBound.x||this.upperBound.x<r)return false}else{p=1/a;c=(this.lowerBound.x-r)*p;f=(this.upperBound.x-r)*p;d=-1;if(c>f){m=c;c=f;f=m;d=1}if(c>i){u.x=d;u.y=0;i=c}n=Math.min(n,f);if(i>n)return false}}{if(h<Box2D.MIN_VALUE){if(o<this.lowerBound.y||this.upperBound.y<o)return false}else{p=1/s;c=(this.lowerBound.y-o)*p;f=(this.upperBound.y-o)*p;d=-1;if(c>f){m=c;c=f;f=m;d=1}if(c>i){u.y=d;u.x=0;i=c}n=Math.min(n,f);if(i>n)return false}}t.fraction=i;return true};y.prototype.TestOverlap=function(t){var e=t.lowerBound.x-this.upperBound.x;var i=t.lowerBound.y-this.upperBound.y;var n=this.lowerBound.x-t.upperBound.x;var r=this.lowerBound.y-t.upperBound.y;if(e>0||i>0)return false;if(n>0||r>0)return false;return true};y.Combine=function(t,e){var i=new y;i.Combine(t,e);return i};y.prototype.Combine=function(t,e){this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x);this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y);this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x);this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y)};g.b2Bound=function(){};g.prototype.IsLower=function(){return(this.value&1)==0};g.prototype.IsUpper=function(){return(this.value&1)==1};g.prototype.Swap=function(t){var e=this.value;var i=this.proxy;var n=this.stabbingCount;this.value=t.value;this.proxy=t.proxy;this.stabbingCount=t.stabbingCount;t.value=e;t.proxy=i;t.stabbingCount=n};v.b2BoundValues=function(){};v.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};_.b2Collision=function(){};_.ClipSegmentToLine=function(t,e,i,n){if(n===undefined)n=0;var r;var o=0;r=e[0];var a=r.v;r=e[1];var s=r.v;var l=i.x*a.x+i.y*a.y-n;var h=i.x*s.x+i.y*s.y-n;if(l<=0)t[o++].Set(e[0]);if(h<=0)t[o++].Set(e[1]);if(l*h<0){var u=l/(l-h);r=t[o];var p=r.v;p.x=a.x+u*(s.x-a.x);p.y=a.y+u*(s.y-a.y);r=t[o];var c;if(l>0){c=e[0];r.id=c.id}else{c=e[1];r.id=c.id}++o}return o};_.EdgeSeparation=function(t,e,i,n,r){if(i===undefined)i=0;var o=parseInt(t.m_vertexCount);var a=t.m_vertices;var s=t.m_normals;var l=parseInt(n.m_vertexCount);var h=n.m_vertices;var u;var p;u=e.R;p=s[i];var c=u.col1.x*p.x+u.col2.x*p.y;var f=u.col1.y*p.x+u.col2.y*p.y;u=r.R;var m=u.col1.x*c+u.col1.y*f;var d=u.col2.x*c+u.col2.y*f;var y=0;var g=Number.MAX_VALUE;for(var v=0;v<l;++v){p=h[v];var _=p.x*m+p.y*d;if(_<g){g=_;y=v}}p=a[i];u=e.R;var I=e.position.x+(u.col1.x*p.x+u.col2.x*p.y);var w=e.position.y+(u.col1.y*p.x+u.col2.y*p.y);p=h[y];u=r.R;var x=r.position.x+(u.col1.x*p.x+u.col2.x*p.y);var S=r.position.y+(u.col1.y*p.x+u.col2.y*p.y);x-=I;S-=w;var T=x*c+S*f;return T};_.FindMaxSeparation=function(t,e,i,n,r){var o=parseInt(e.m_vertexCount);var a=e.m_normals;var s;var l;l=r.R;s=n.m_centroid;var h=r.position.x+(l.col1.x*s.x+l.col2.x*s.y);var u=r.position.y+(l.col1.y*s.x+l.col2.y*s.y);l=i.R;s=e.m_centroid;h-=i.position.x+(l.col1.x*s.x+l.col2.x*s.y);u-=i.position.y+(l.col1.y*s.x+l.col2.y*s.y);var p=h*i.R.col1.x+u*i.R.col1.y;var c=h*i.R.col2.x+u*i.R.col2.y;var f=0;var m=-Number.MAX_VALUE;for(var d=0;d<o;++d){s=a[d];var y=s.x*p+s.y*c;if(y>m){m=y;f=d}}var g=_.EdgeSeparation(e,i,f,n,r);var v=parseInt(f-1>=0?f-1:o-1);var I=_.EdgeSeparation(e,i,v,n,r);var w=parseInt(f+1<o?f+1:0);var x=_.EdgeSeparation(e,i,w,n,r);var S=0;var T=0;var C=0;if(I>g&&I>x){C=-1;S=v;T=I}else if(x>g){C=1;S=w;T=x}else{t[0]=f;return g}while(true){if(C==-1)f=S-1>=0?S-1:o-1;else f=S+1<o?S+1:0;g=_.EdgeSeparation(e,i,f,n,r);if(g>T){S=f;T=g}else{break}}t[0]=S;return T};_.FindIncidentEdge=function(t,e,i,n,r,o){if(n===undefined)n=0;var a=parseInt(e.m_vertexCount);var s=e.m_normals;var l=parseInt(r.m_vertexCount);var h=r.m_vertices;var u=r.m_normals;var p;var c;p=i.R;c=s[n];var f=p.col1.x*c.x+p.col2.x*c.y;var m=p.col1.y*c.x+p.col2.y*c.y;p=o.R;var d=p.col1.x*f+p.col1.y*m;m=p.col2.x*f+p.col2.y*m;f=d;var y=0;var g=Number.MAX_VALUE;for(var v=0;v<l;++v){c=u[v];var _=f*c.x+m*c.y;if(_<g){g=_;y=v}}var I;var w=parseInt(y);var x=parseInt(w+1<l?w+1:0);I=t[0];c=h[w];p=o.R;I.v.x=o.position.x+(p.col1.x*c.x+p.col2.x*c.y);I.v.y=o.position.y+(p.col1.y*c.x+p.col2.y*c.y);I.id.features.referenceEdge=n;I.id.features.incidentEdge=w;I.id.features.incidentVertex=0;I=t[1];c=h[x];p=o.R;I.v.x=o.position.x+(p.col1.x*c.x+p.col2.x*c.y);I.v.y=o.position.y+(p.col1.y*c.x+p.col2.y*c.y);I.id.features.referenceEdge=n;I.id.features.incidentEdge=x;I.id.features.incidentVertex=1};_.MakeClipPointVector=function(){var t=new Vector(2);t[0]=new H;t[1]=new H;return t};_.CollidePolygons=function(t,e,i,n,r){var o;t.m_pointCount=0;var a=e.m_radius+n.m_radius;var s=0;_.s_edgeAO[0]=s;var h=_.FindMaxSeparation(_.s_edgeAO,e,i,n,r);s=_.s_edgeAO[0];if(h>a)return;var u=0;_.s_edgeBO[0]=u;var p=_.FindMaxSeparation(_.s_edgeBO,n,r,e,i);u=_.s_edgeBO[0];if(p>a)return;var c;var f;var m;var d;var y=0;var g=0;var v=.98;var I=.001;var w;if(p>v*h+I){c=n;f=e;m=r;d=i;y=u;t.m_type=U.e_faceB;g=1}else{c=e;f=n;m=i;d=r;y=s;t.m_type=U.e_faceA;g=0}var x=_.s_incidentEdge;_.FindIncidentEdge(x,c,m,y,f,d);var S=parseInt(c.m_vertexCount);var T=c.m_vertices;var C=T[y];var b;if(y+1<S){b=T[parseInt(y+1)]}else{b=T[0]}var D=_.s_localTangent;D.Set(b.x-C.x,b.y-C.y);D.Normalize();var E=_.s_localNormal;E.x=D.y;E.y=-D.x;var A=_.s_planePoint;A.Set(.5*(C.x+b.x),.5*(C.y+b.y));var M=_.s_tangent;w=m.R;M.x=w.col1.x*D.x+w.col2.x*D.y;M.y=w.col1.y*D.x+w.col2.y*D.y;var P=_.s_tangent2;P.x=-M.x;P.y=-M.y;var B=_.s_normal;B.x=M.y;B.y=-M.x;var L=_.s_v11;var R=_.s_v12;L.x=m.position.x+(w.col1.x*C.x+w.col2.x*C.y);L.y=m.position.y+(w.col1.y*C.x+w.col2.y*C.y);R.x=m.position.x+(w.col1.x*b.x+w.col2.x*b.y);R.y=m.position.y+(w.col1.y*b.x+w.col2.y*b.y);var O=B.x*L.x+B.y*L.y;var V=-M.x*L.x-M.y*L.y+a;var W=M.x*R.x+M.y*R.y+a;var k=_.s_clipPoints1;var F=_.s_clipPoints2;var N=0;N=_.ClipSegmentToLine(k,x,P,V);if(N<2)return;N=_.ClipSegmentToLine(F,k,M,W);if(N<2)return;t.m_localPlaneNormal.SetV(E);t.m_localPoint.SetV(A);var G=0;for(var H=0;H<l.b2_maxManifoldPoints;++H){o=F[H];var Y=B.x*o.v.x+B.y*o.v.y-O;if(Y<=a){var J=t.m_points[G];w=d.R;var X=o.v.x-d.position.x;var z=o.v.y-d.position.y;J.m_localPoint.x=X*w.col1.x+z*w.col1.y;J.m_localPoint.y=X*w.col2.x+z*w.col2.y;J.m_id.Set(o.id);J.m_id.features.flip=g;++G}}t.m_pointCount=G};_.CollideCircles=function(t,e,i,n,r){t.m_pointCount=0;var o;var a;o=i.R;a=e.m_p;var s=i.position.x+(o.col1.x*a.x+o.col2.x*a.y);var l=i.position.y+(o.col1.y*a.x+o.col2.y*a.y);o=r.R;a=n.m_p;var h=r.position.x+(o.col1.x*a.x+o.col2.x*a.y);var u=r.position.y+(o.col1.y*a.x+o.col2.y*a.y);var p=h-s;var c=u-l;var f=p*p+c*c;var m=e.m_radius+n.m_radius;if(f>m*m){return}t.m_type=U.e_circles;t.m_localPoint.SetV(e.m_p);t.m_localPlaneNormal.SetZero();t.m_pointCount=1;t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0};_.CollidePolygonAndCircle=function(t,e,i,n,r){t.m_pointCount=0;var o;var a=0;var s=0;var l=0;var h=0;var u;var p;p=r.R;u=n.m_p;var c=r.position.x+(p.col1.x*u.x+p.col2.x*u.y);var f=r.position.y+(p.col1.y*u.x+p.col2.y*u.y);a=c-i.position.x;s=f-i.position.y;p=i.R;var m=a*p.col1.x+s*p.col1.y;var d=a*p.col2.x+s*p.col2.y;var y=0;var g=0;var v=-Number.MAX_VALUE;var _=e.m_radius+n.m_radius;var I=parseInt(e.m_vertexCount);var w=e.m_vertices;var x=e.m_normals;for(var S=0;S<I;++S){u=w[S];a=m-u.x;s=d-u.y;u=x[S];var T=u.x*a+u.y*s;if(T>_){return}if(T>v){v=T;g=S}}var C=parseInt(g);var b=parseInt(C+1<I?C+1:0);var D=w[C];var E=w[b];if(v<Box2D.MIN_VALUE){t.m_pointCount=1;t.m_type=U.e_faceA;t.m_localPlaneNormal.SetV(x[g]);t.m_localPoint.x=.5*(D.x+E.x);t.m_localPoint.y=.5*(D.y+E.y);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0;return}var A=(m-D.x)*(E.x-D.x)+(d-D.y)*(E.y-D.y);var M=(m-E.x)*(D.x-E.x)+(d-E.y)*(D.y-E.y);if(A<=0){if((m-D.x)*(m-D.x)+(d-D.y)*(d-D.y)>_*_)return;t.m_pointCount=1;t.m_type=U.e_faceA;t.m_localPlaneNormal.x=m-D.x;t.m_localPlaneNormal.y=d-D.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.SetV(D);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}else if(M<=0){if((m-E.x)*(m-E.x)+(d-E.y)*(d-E.y)>_*_)return;t.m_pointCount=1;t.m_type=U.e_faceA;t.m_localPlaneNormal.x=m-E.x;t.m_localPlaneNormal.y=d-E.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.SetV(E);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}else{var P=.5*(D.x+E.x);var B=.5*(D.y+E.y);v=(m-P)*x[C].x+(d-B)*x[C].y;if(v>_)return;t.m_pointCount=1;t.m_type=U.e_faceA;t.m_localPlaneNormal.x=x[C].x;t.m_localPlaneNormal.y=x[C].y;t.m_localPlaneNormal.Normalize();t.m_localPoint.Set(P,B);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}};_.TestOverlap=function(t,e){var i=e.lowerBound;var n=t.upperBound;var r=i.x-n.x;var o=i.y-n.y;i=t.lowerBound;n=e.upperBound;var a=i.x-n.x;var s=i.y-n.y;if(r>0||o>0)return false;if(a>0||s>0)return false;return true};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=_.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=_.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=_.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new m;Box2D.Collision.b2Collision.s_localNormal=new m;Box2D.Collision.b2Collision.s_planePoint=new m;Box2D.Collision.b2Collision.s_normal=new m;Box2D.Collision.b2Collision.s_tangent=new m;Box2D.Collision.b2Collision.s_tangent2=new m;Box2D.Collision.b2Collision.s_v11=new m;Box2D.Collision.b2Collision.s_v12=new m;Box2D.Collision.b2Collision.b2CollidePolyTempVec=new m;Box2D.Collision.b2Collision.b2_nullFeature=255});I.b2ContactID=function(){this.features=new Y};I.prototype.b2ContactID=function(){this.features._m_id=this};I.prototype.Set=function(t){this.key=t._key};I.prototype.Copy=function(){var t=new I;t.key=this.key;return t};Object.defineProperty(I.prototype,"key",{enumerable:false,configurable:true,get:function(){return this._key}});Object.defineProperty(I.prototype,"key",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._key=t;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});w.b2ContactPoint=function(){this.position=new m;this.velocity=new m;this.normal=new m;this.id=new I};x.b2Distance=function(){};x.Distance=function(t,e,i){++x.b2_gjkCalls;var n=i.proxyA;var r=i.proxyB;var o=i.transformA;var a=i.transformB;var s=x.s_simplex;s.ReadCache(e,n,o,r,a);var h=s.m_vertices;var u=20;var c=x.s_saveA;var f=x.s_saveB;var d=0;var y=s.GetClosestPoint();var g=y.LengthSquared();var v=g;var _=0;var I;var w=0;while(w<u){d=s.m_count;for(_=0;_<d;_++){c[_]=h[_].indexA;f[_]=h[_].indexB}switch(s.m_count){case 1:break;case 2:s.Solve2();break;case 3:s.Solve3();break;default:l.b2Assert(false)}if(s.m_count==3){break}I=s.GetClosestPoint();v=I.LengthSquared();if(v>g){}g=v;var S=s.GetSearchDirection();if(S.LengthSquared()<Box2D.MIN_VALUE*Box2D.MIN_VALUE){break}var T=h[s.m_count];T.indexA=n.GetSupport(p.MulTMV(o.R,S.GetNegative()));T.wA=p.MulX(o,n.GetVertex(T.indexA));T.indexB=r.GetSupport(p.MulTMV(a.R,S));T.wB=p.MulX(a,r.GetVertex(T.indexB));T.w=p.SubtractVV(T.wB,T.wA);++w;++x.b2_gjkIters;var C=false;for(_=0;_<d;_++){if(T.indexA==c[_]&&T.indexB==f[_]){C=true;break}}if(C){break}++s.m_count}x.b2_gjkMaxIters=p.Max(x.b2_gjkMaxIters,w);s.GetWitnessPoints(t.pointA,t.pointB);t.distance=p.SubtractVV(t.pointA,t.pointB).Length();t.iterations=w;s.WriteCache(e);if(i.useRadii){var b=n.m_radius;var D=r.m_radius;if(t.distance>b+D&&t.distance>Box2D.MIN_VALUE){t.distance-=b+D;var E=p.SubtractVV(t.pointB,t.pointA);E.Normalize();t.pointA.x+=b*E.x;t.pointA.y+=b*E.y;t.pointB.x-=D*E.x;t.pointB.y-=D*E.y}else{I=new m;I.x=.5*(t.pointA.x+t.pointB.x);I.y=.5*(t.pointA.y+t.pointB.y);t.pointA.x=t.pointB.x=I.x;t.pointA.y=t.pointB.y=I.y;t.distance=0}}};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new V;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)});S.b2DistanceInput=function(){};T.b2DistanceOutput=function(){this.pointA=new m;this.pointB=new m};C.b2DistanceProxy=function(){};C.prototype.Set=function(e){switch(e.GetType()){case o.e_circleShape:{var i=e instanceof t?e:null;this.m_vertices=new Vector(1,true);this.m_vertices[0]=i.m_p;this.m_count=1;this.m_radius=i.m_radius}break;case o.e_polygonShape:{var n=e instanceof r?e:null;this.m_vertices=n.m_vertices;this.m_count=n.m_vertexCount;this.m_radius=n.m_radius}break;default:l.b2Assert(false)}};C.prototype.GetSupport=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_count;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return e};C.prototype.GetSupportVertex=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_count;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return this.m_vertices[e]};C.prototype.GetVertexCount=function(){return this.m_count};C.prototype.GetVertex=function(t){if(t===undefined)t=0;l.b2Assert(0<=t&&t<this.m_count);return this.m_vertices[t]};b.b2DynamicTree=function(){};b.prototype.b2DynamicTree=function(){this.m_root=null;this.m_freeList=null;this.m_path=0;this.m_insertionCount=0};b.prototype.CreateProxy=function(t,e){var i=this.AllocateNode();var n=l.b2_aabbExtension;var r=l.b2_aabbExtension;i.aabb.lowerBound.x=t.lowerBound.x-n;i.aabb.lowerBound.y=t.lowerBound.y-r;i.aabb.upperBound.x=t.upperBound.x+n;i.aabb.upperBound.y=t.upperBound.y+r;i.userData=e;this.InsertLeaf(i);return i};b.prototype.DestroyProxy=function(t){this.RemoveLeaf(t);this.FreeNode(t)};b.prototype.MoveProxy=function(t,e,i){l.b2Assert(t.IsLeaf());if(t.aabb.Contains(e)){return false}this.RemoveLeaf(t);var n=l.b2_aabbExtension+l.b2_aabbMultiplier*(i.x>0?i.x:-i.x);var r=l.b2_aabbExtension+l.b2_aabbMultiplier*(i.y>0?i.y:-i.y);t.aabb.lowerBound.x=e.lowerBound.x-n;t.aabb.lowerBound.y=e.lowerBound.y-r;t.aabb.upperBound.x=e.upperBound.x+n;t.aabb.upperBound.y=e.upperBound.y+r;this.InsertLeaf(t);return true};b.prototype.Rebalance=function(t){if(t===undefined)t=0;if(this.m_root==null)return;for(var e=0;e<t;e++){var i=this.m_root;var n=0;while(i.IsLeaf()==false){i=this.m_path>>n&1?i.child2:i.child1;n=n+1&31}++this.m_path;this.RemoveLeaf(i);this.InsertLeaf(i)}};b.prototype.GetFatAABB=function(t){return t.aabb};b.prototype.GetUserData=function(t){return t.userData};b.prototype.Query=function(t,e){if(this.m_root==null)return;var i=new Vector;var n=0;i[n++]=this.m_root;while(n>0){var r=i[--n];if(r.aabb.TestOverlap(e)){if(r.IsLeaf()){var o=t(r);if(!o)return}else{i[n++]=r.child1;i[n++]=r.child2}}}};b.prototype.RayCast=function(t,e){if(this.m_root==null)return;var i=e.p1;var n=e.p2;var r=p.SubtractVV(i,n);r.Normalize();var o=p.CrossFV(1,r);var a=p.AbsV(o);var s=e.maxFraction;var l=new y;var h=0;var u=0;{h=i.x+s*(n.x-i.x);u=i.y+s*(n.y-i.y);l.lowerBound.x=Math.min(i.x,h);l.lowerBound.y=Math.min(i.y,u);l.upperBound.x=Math.max(i.x,h);l.upperBound.y=Math.max(i.y,u)}var c=new Vector;var f=0;c[f++]=this.m_root;while(f>0){var m=c[--f];if(m.aabb.TestOverlap(l)==false){continue}var d=m.aabb.GetCenter();var g=m.aabb.GetExtents();var v=Math.abs(o.x*(i.x-d.x)+o.y*(i.y-d.y))-a.x*g.x-a.y*g.y;if(v>0)continue;if(m.IsLeaf()){var _=new B;_.p1=e.p1;_.p2=e.p2;_.maxFraction=e.maxFraction;s=t(_,m);if(s==0)return;if(s>0){h=i.x+s*(n.x-i.x);u=i.y+s*(n.y-i.y);l.lowerBound.x=Math.min(i.x,h);l.lowerBound.y=Math.min(i.y,u);l.upperBound.x=Math.max(i.x,h);l.upperBound.y=Math.max(i.y,u)}}else{c[f++]=m.child1;c[f++]=m.child2}}};b.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;this.m_freeList=t.parent;t.parent=null;t.child1=null;t.child2=null;return t}return new E};b.prototype.FreeNode=function(t){t.parent=this.m_freeList;this.m_freeList=t};b.prototype.InsertLeaf=function(t){++this.m_insertionCount;if(this.m_root==null){this.m_root=t;this.m_root.parent=null;return}var e=t.aabb.GetCenter();var i=this.m_root;if(i.IsLeaf()==false){do{var n=i.child1;var r=i.child2;var o=Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-e.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-e.y);var a=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-e.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-e.y);if(o<a){i=n}else{i=r}}while(i.IsLeaf()==false)}var s=i.parent;var l=this.AllocateNode();l.parent=s;l.userData=null;l.aabb.Combine(t.aabb,i.aabb);if(s){if(i.parent.child1==i){s.child1=l}else{s.child2=l}l.child1=i;l.child2=t;i.parent=l;t.parent=l;do{if(s.aabb.Contains(l.aabb))break;s.aabb.Combine(s.child1.aabb,s.child2.aabb);l=s;s=s.parent}while(s)}else{l.child1=i;l.child2=t;i.parent=l;t.parent=l;this.m_root=l}};b.prototype.RemoveLeaf=function(t){if(t==this.m_root){this.m_root=null;return}var e=t.parent;var i=e.parent;var n;if(e.child1==t){n=e.child2}else{n=e.child1}if(i){if(i.child1==e){i.child1=n}else{i.child2=n}n.parent=i;this.FreeNode(e);while(i){var r=i.aabb;i.aabb=y.Combine(i.child1.aabb,i.child2.aabb);if(r.Contains(i.aabb))break;i=i.parent}}else{this.m_root=n;n.parent=null;this.FreeNode(e)}};D.b2DynamicTreeBroadPhase=function(){this.m_tree=new b;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};D.prototype.CreateProxy=function(t,e){var i=this.m_tree.CreateProxy(t,e);++this.m_proxyCount;this.BufferMove(i);return i};D.prototype.DestroyProxy=function(t){this.UnBufferMove(t);--this.m_proxyCount;this.m_tree.DestroyProxy(t)};D.prototype.MoveProxy=function(t,e,i){var n=this.m_tree.MoveProxy(t,e,i);if(n){this.BufferMove(t)}};D.prototype.TestOverlap=function(t,e){var i=this.m_tree.GetFatAABB(t);var n=this.m_tree.GetFatAABB(e);return i.TestOverlap(n)};D.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)};D.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)};D.prototype.GetProxyCount=function(){return this.m_proxyCount};D.prototype.UpdatePairs=function(t){var e=this;e.m_pairCount=0;var i=0,n;for(i=0;i<e.m_moveBuffer.length;++i){n=e.m_moveBuffer[i];function r(t){if(t==n)return true;if(e.m_pairCount==e.m_pairBuffer.length){e.m_pairBuffer[e.m_pairCount]=new A}var i=e.m_pairBuffer[e.m_pairCount];i.proxyA=t<n?t:n;i.proxyB=t>=n?t:n;++e.m_pairCount;return true}var o=e.m_tree.GetFatAABB(n);e.m_tree.Query(r,o)}e.m_moveBuffer.length=0;for(var i=0;i<e.m_pairCount;){var a=e.m_pairBuffer[i];var s=e.m_tree.GetUserData(a.proxyA);var l=e.m_tree.GetUserData(a.proxyB);
t(s,l);++i;while(i<e.m_pairCount){var h=e.m_pairBuffer[i];if(h.proxyA!=a.proxyA||h.proxyB!=a.proxyB){break}++i}}};D.prototype.Query=function(t,e){this.m_tree.Query(t,e)};D.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)};D.prototype.Validate=function(){};D.prototype.Rebalance=function(t){if(t===undefined)t=0;this.m_tree.Rebalance(t)};D.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t};D.prototype.UnBufferMove=function(t){var e=parseInt(this.m_moveBuffer.indexOf(t));this.m_moveBuffer.splice(e,1)};D.prototype.ComparePairs=function(t,e){return 0};D.__implements={};D.__implements[J]=true;E.b2DynamicTreeNode=function(){this.aabb=new y};E.prototype.IsLeaf=function(){return this.child1==null};A.b2DynamicTreePair=function(){};U.b2Manifold=function(){this.m_pointCount=0};U.prototype.b2Manifold=function(){this.m_points=new Vector(l.b2_maxManifoldPoints);for(var t=0;t<l.b2_maxManifoldPoints;t++){this.m_points[t]=new M}this.m_localPlaneNormal=new m;this.m_localPoint=new m};U.prototype.Reset=function(){for(var t=0;t<l.b2_maxManifoldPoints;t++){(this.m_points[t]instanceof M?this.m_points[t]:null).Reset()}this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_type=0;this.m_pointCount=0};U.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var e=0;e<l.b2_maxManifoldPoints;e++){(this.m_points[e]instanceof M?this.m_points[e]:null).Set(t.m_points[e])}this.m_localPlaneNormal.SetV(t.m_localPlaneNormal);this.m_localPoint.SetV(t.m_localPoint);this.m_type=t.m_type};U.prototype.Copy=function(){var t=new U;t.Set(this);return t};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});M.b2ManifoldPoint=function(){this.m_localPoint=new m;this.m_id=new I};M.prototype.b2ManifoldPoint=function(){this.Reset()};M.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_normalImpulse=0;this.m_tangentImpulse=0;this.m_id.key=0};M.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint);this.m_normalImpulse=t.m_normalImpulse;this.m_tangentImpulse=t.m_tangentImpulse;this.m_id.Set(t.m_id)};P.b2Point=function(){this.p=new m};P.prototype.Support=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;return this.p};P.prototype.GetFirstVertex=function(t){return this.p};B.b2RayCastInput=function(){this.p1=new m;this.p2=new m};B.prototype.b2RayCastInput=function(t,e,i){if(t===undefined)t=null;if(e===undefined)e=null;if(i===undefined)i=1;if(t)this.p1.SetV(t);if(e)this.p2.SetV(e);this.maxFraction=i};L.b2RayCastOutput=function(){this.normal=new m};R.b2Segment=function(){this.p1=new m;this.p2=new m};R.prototype.TestSegment=function(t,e,i,n){if(n===undefined)n=0;var r=i.p1;var o=i.p2.x-r.x;var a=i.p2.y-r.y;var s=this.p2.x-this.p1.x;var l=this.p2.y-this.p1.y;var h=l;var u=-s;var p=100*Box2D.MIN_VALUE;var c=-(o*h+a*u);if(c>p){var f=r.x-this.p1.x;var m=r.y-this.p1.y;var d=f*h+m*u;if(0<=d&&d<=n*c){var y=-o*m+a*f;if(-p*c<=y&&y<=c*(1+p)){d/=c;var g=Math.sqrt(h*h+u*u);h/=g;u/=g;t[0]=d;e.Set(h,u);return true}}}return false};R.prototype.Extend=function(t){this.ExtendForward(t);this.ExtendBackward(t)};R.prototype.ExtendForward=function(t){var e=this.p2.x-this.p1.x;var i=this.p2.y-this.p1.y;var n=Math.min(e>0?(t.upperBound.x-this.p1.x)/e:e<0?(t.lowerBound.x-this.p1.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p1.y)/i:i<0?(t.lowerBound.y-this.p1.y)/i:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+e*n;this.p2.y=this.p1.y+i*n};R.prototype.ExtendBackward=function(t){var e=-this.p2.x+this.p1.x;var i=-this.p2.y+this.p1.y;var n=Math.min(e>0?(t.upperBound.x-this.p2.x)/e:e<0?(t.lowerBound.x-this.p2.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p2.y)/i:i<0?(t.lowerBound.y-this.p2.y)/i:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+e*n;this.p1.y=this.p2.y+i*n};O.b2SeparationFunction=function(){this.m_localPoint=new m;this.m_axis=new m};O.prototype.Initialize=function(t,e,i,n,r){this.m_proxyA=e;this.m_proxyB=n;var o=parseInt(t.count);l.b2Assert(0<o&&o<3);var a;var s;var h;var u;var c;var f;var d=0;var y=0;var g=0;var v=0;var _=0;var I=0;var w;var x;var S=0;var T=0;if(o==1){this.m_type=O.e_points;a=this.m_proxyA.GetVertex(t.indexA[0]);u=this.m_proxyB.GetVertex(t.indexB[0]);x=a;w=i.R;d=i.position.x+(w.col1.x*x.x+w.col2.x*x.y);y=i.position.y+(w.col1.y*x.x+w.col2.y*x.y);x=u;w=r.R;g=r.position.x+(w.col1.x*x.x+w.col2.x*x.y);v=r.position.y+(w.col1.y*x.x+w.col2.y*x.y);this.m_axis.x=g-d;this.m_axis.y=v-y;this.m_axis.Normalize()}else if(t.indexB[0]==t.indexB[1]){this.m_type=O.e_faceA;s=this.m_proxyA.GetVertex(t.indexA[0]);h=this.m_proxyA.GetVertex(t.indexA[1]);u=this.m_proxyB.GetVertex(t.indexB[0]);this.m_localPoint.x=.5*(s.x+h.x);this.m_localPoint.y=.5*(s.y+h.y);this.m_axis=p.CrossVF(p.SubtractVV(h,s),1);this.m_axis.Normalize();x=this.m_axis;w=i.R;_=w.col1.x*x.x+w.col2.x*x.y;I=w.col1.y*x.x+w.col2.y*x.y;x=this.m_localPoint;w=i.R;d=i.position.x+(w.col1.x*x.x+w.col2.x*x.y);y=i.position.y+(w.col1.y*x.x+w.col2.y*x.y);x=u;w=r.R;g=r.position.x+(w.col1.x*x.x+w.col2.x*x.y);v=r.position.y+(w.col1.y*x.x+w.col2.y*x.y);S=(g-d)*_+(v-y)*I;if(S<0){this.m_axis.NegativeSelf()}}else if(t.indexA[0]==t.indexA[0]){this.m_type=O.e_faceB;c=this.m_proxyB.GetVertex(t.indexB[0]);f=this.m_proxyB.GetVertex(t.indexB[1]);a=this.m_proxyA.GetVertex(t.indexA[0]);this.m_localPoint.x=.5*(c.x+f.x);this.m_localPoint.y=.5*(c.y+f.y);this.m_axis=p.CrossVF(p.SubtractVV(f,c),1);this.m_axis.Normalize();x=this.m_axis;w=r.R;_=w.col1.x*x.x+w.col2.x*x.y;I=w.col1.y*x.x+w.col2.y*x.y;x=this.m_localPoint;w=r.R;g=r.position.x+(w.col1.x*x.x+w.col2.x*x.y);v=r.position.y+(w.col1.y*x.x+w.col2.y*x.y);x=a;w=i.R;d=i.position.x+(w.col1.x*x.x+w.col2.x*x.y);y=i.position.y+(w.col1.y*x.x+w.col2.y*x.y);S=(d-g)*_+(y-v)*I;if(S<0){this.m_axis.NegativeSelf()}}else{s=this.m_proxyA.GetVertex(t.indexA[0]);h=this.m_proxyA.GetVertex(t.indexA[1]);c=this.m_proxyB.GetVertex(t.indexB[0]);f=this.m_proxyB.GetVertex(t.indexB[1]);var C=p.MulX(i,a);var b=p.MulMV(i.R,p.SubtractVV(h,s));var D=p.MulX(r,u);var E=p.MulMV(r.R,p.SubtractVV(f,c));var A=b.x*b.x+b.y*b.y;var U=E.x*E.x+E.y*E.y;var M=p.SubtractVV(E,b);var P=b.x*M.x+b.y*M.y;var B=E.x*M.x+E.y*M.y;var L=b.x*E.x+b.y*E.y;var R=A*U-L*L;S=0;if(R!=0){S=p.Clamp((L*B-P*U)/R,0,1)}var V=(L*S+B)/U;if(V<0){V=0;S=p.Clamp((L-P)/A,0,1)}a=new m;a.x=s.x+S*(h.x-s.x);a.y=s.y+S*(h.y-s.y);u=new m;u.x=c.x+S*(f.x-c.x);u.y=c.y+S*(f.y-c.y);if(S==0||S==1){this.m_type=O.e_faceB;this.m_axis=p.CrossVF(p.SubtractVV(f,c),1);this.m_axis.Normalize();this.m_localPoint=u;x=this.m_axis;w=r.R;_=w.col1.x*x.x+w.col2.x*x.y;I=w.col1.y*x.x+w.col2.y*x.y;x=this.m_localPoint;w=r.R;g=r.position.x+(w.col1.x*x.x+w.col2.x*x.y);v=r.position.y+(w.col1.y*x.x+w.col2.y*x.y);x=a;w=i.R;d=i.position.x+(w.col1.x*x.x+w.col2.x*x.y);y=i.position.y+(w.col1.y*x.x+w.col2.y*x.y);T=(d-g)*_+(y-v)*I;if(S<0){this.m_axis.NegativeSelf()}}else{this.m_type=O.e_faceA;this.m_axis=p.CrossVF(p.SubtractVV(h,s),1);this.m_localPoint=a;x=this.m_axis;w=i.R;_=w.col1.x*x.x+w.col2.x*x.y;I=w.col1.y*x.x+w.col2.y*x.y;x=this.m_localPoint;w=i.R;d=i.position.x+(w.col1.x*x.x+w.col2.x*x.y);y=i.position.y+(w.col1.y*x.x+w.col2.y*x.y);x=u;w=r.R;g=r.position.x+(w.col1.x*x.x+w.col2.x*x.y);v=r.position.y+(w.col1.y*x.x+w.col2.y*x.y);T=(g-d)*_+(v-y)*I;if(S<0){this.m_axis.NegativeSelf()}}}};O.prototype.Evaluate=function(t,e){var i;var n;var r;var o;var a;var s;var h=0;var u;switch(this.m_type){case O.e_points:{i=p.MulTMV(t.R,this.m_axis);n=p.MulTMV(e.R,this.m_axis.GetNegative());r=this.m_proxyA.GetSupportVertex(i);o=this.m_proxyB.GetSupportVertex(n);a=p.MulX(t,r);s=p.MulX(e,o);h=(s.x-a.x)*this.m_axis.x+(s.y-a.y)*this.m_axis.y;return h}case O.e_faceA:{u=p.MulMV(t.R,this.m_axis);a=p.MulX(t,this.m_localPoint);n=p.MulTMV(e.R,u.GetNegative());o=this.m_proxyB.GetSupportVertex(n);s=p.MulX(e,o);h=(s.x-a.x)*u.x+(s.y-a.y)*u.y;return h}case O.e_faceB:{u=p.MulMV(e.R,this.m_axis);s=p.MulX(e,this.m_localPoint);i=p.MulTMV(t.R,u.GetNegative());r=this.m_proxyA.GetSupportVertex(i);a=p.MulX(t,r);h=(a.x-s.x)*u.x+(a.y-s.y)*u.y;return h}default:l.b2Assert(false);return 0}};Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4});V.b2Simplex=function(){this.m_v1=new k;this.m_v2=new k;this.m_v3=new k;this.m_vertices=new Vector(3)};V.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};V.prototype.ReadCache=function(t,e,i,n,r){l.b2Assert(0<=t.count&&t.count<=3);var o;var a;this.m_count=t.count;var s=this.m_vertices;for(var h=0;h<this.m_count;h++){var u=s[h];u.indexA=t.indexA[h];u.indexB=t.indexB[h];o=e.GetVertex(u.indexA);a=n.GetVertex(u.indexB);u.wA=p.MulX(i,o);u.wB=p.MulX(r,a);u.w=p.SubtractVV(u.wB,u.wA);u.a=0}if(this.m_count>1){var c=t.metric;var f=this.GetMetric();if(f<.5*c||2*c<f||f<Box2D.MIN_VALUE){this.m_count=0}}if(this.m_count==0){u=s[0];u.indexA=0;u.indexB=0;o=e.GetVertex(0);a=n.GetVertex(0);u.wA=p.MulX(i,o);u.wB=p.MulX(r,a);u.w=p.SubtractVV(u.wB,u.wA);this.m_count=1}};V.prototype.WriteCache=function(t){t.metric=this.GetMetric();t.count=Box2D.parseUInt(this.m_count);var e=this.m_vertices;for(var i=0;i<this.m_count;i++){t.indexA[i]=Box2D.parseUInt(e[i].indexA);t.indexB[i]=Box2D.parseUInt(e[i].indexB)}};V.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:{var t=p.SubtractVV(this.m_v2.w,this.m_v1.w);var e=p.CrossVV(t,this.m_v1.w.GetNegative());if(e>0){return p.CrossFV(1,t)}else{return p.CrossVF(t,1)}}default:l.b2Assert(false);return new m}};V.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:l.b2Assert(false);return new m;case 1:return this.m_v1.w;case 2:return new m(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:l.b2Assert(false);return new m}};V.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:l.b2Assert(false);break;case 1:t.SetV(this.m_v1.wA);e.SetV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:l.b2Assert(false);break}};V.prototype.GetMetric=function(){switch(this.m_count){case 0:l.b2Assert(false);return 0;case 1:return 0;case 2:return p.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return p.CrossVV(p.SubtractVV(this.m_v2.w,this.m_v1.w),p.SubtractVV(this.m_v3.w,this.m_v1.w));default:l.b2Assert(false);return 0}};V.prototype.Solve2=function(){var t=this.m_v1.w;var e=this.m_v2.w;var i=p.SubtractVV(e,t);var n=-(t.x*i.x+t.y*i.y);if(n<=0){this.m_v1.a=1;this.m_count=1;return}var r=e.x*i.x+e.y*i.y;if(r<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}var o=1/(r+n);this.m_v1.a=r*o;this.m_v2.a=n*o;this.m_count=2};V.prototype.Solve3=function(){var t=this.m_v1.w;var e=this.m_v2.w;var i=this.m_v3.w;var n=p.SubtractVV(e,t);var r=p.Dot(t,n);var o=p.Dot(e,n);var a=o;var s=-r;var l=p.SubtractVV(i,t);var h=p.Dot(t,l);var u=p.Dot(i,l);var c=u;var f=-h;var m=p.SubtractVV(i,e);var d=p.Dot(e,m);var y=p.Dot(i,m);var g=y;var v=-d;var _=p.CrossVV(n,l);var I=_*p.CrossVV(e,i);var w=_*p.CrossVV(i,t);var x=_*p.CrossVV(t,e);if(s<=0&&f<=0){this.m_v1.a=1;this.m_count=1;return}if(a>0&&s>0&&x<=0){var S=1/(a+s);this.m_v1.a=a*S;this.m_v2.a=s*S;this.m_count=2;return}if(c>0&&f>0&&w<=0){var T=1/(c+f);this.m_v1.a=c*T;this.m_v3.a=f*T;this.m_count=2;this.m_v2.Set(this.m_v3);return}if(a<=0&&v<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}if(c<=0&&g<=0){this.m_v3.a=1;this.m_count=1;this.m_v1.Set(this.m_v3);return}if(g>0&&v>0&&I<=0){var C=1/(g+v);this.m_v2.a=g*C;this.m_v3.a=v*C;this.m_count=2;this.m_v1.Set(this.m_v3);return}var b=1/(I+w+x);this.m_v1.a=I*b;this.m_v2.a=w*b;this.m_v3.a=x*b;this.m_count=3};W.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};k.b2SimplexVertex=function(){};k.prototype.Set=function(t){this.wA.SetV(t.wA);this.wB.SetV(t.wB);this.w.SetV(t.w);this.a=t.a;this.indexA=t.indexA;this.indexB=t.indexB};F.b2TimeOfImpact=function(){};F.TimeOfImpact=function(t){++F.b2_toiCalls;var e=t.proxyA;var i=t.proxyB;var n=t.sweepA;var r=t.sweepB;l.b2Assert(n.t0==r.t0);l.b2Assert(1-n.t0>Box2D.MIN_VALUE);var o=e.m_radius+i.m_radius;var a=t.tolerance;var s=0;var h=1e3;var u=0;var c=0;F.s_cache.count=0;F.s_distanceInput.useRadii=false;for(;;){n.GetTransform(F.s_xfA,s);r.GetTransform(F.s_xfB,s);F.s_distanceInput.proxyA=e;F.s_distanceInput.proxyB=i;F.s_distanceInput.transformA=F.s_xfA;F.s_distanceInput.transformB=F.s_xfB;x.Distance(F.s_distanceOutput,F.s_cache,F.s_distanceInput);if(F.s_distanceOutput.distance<=0){s=1;break}F.s_fcn.Initialize(F.s_cache,e,F.s_xfA,i,F.s_xfB);var f=F.s_fcn.Evaluate(F.s_xfA,F.s_xfB);if(f<=0){s=1;break}if(u==0){if(f>o){c=p.Max(o-a,.75*o)}else{c=p.Max(f-a,.02*o)}}if(f-c<.5*a){if(u==0){s=1;break}break}var m=s;{var d=s;var y=1;var g=f;n.GetTransform(F.s_xfA,y);r.GetTransform(F.s_xfB,y);var v=F.s_fcn.Evaluate(F.s_xfA,F.s_xfB);if(v>=c){s=1;break}var _=0;for(;;){var I=0;if(_&1){I=d+(c-g)*(y-d)/(v-g)}else{I=.5*(d+y)}n.GetTransform(F.s_xfA,I);r.GetTransform(F.s_xfB,I);var w=F.s_fcn.Evaluate(F.s_xfA,F.s_xfB);if(p.Abs(w-c)<.025*a){m=I;break}if(w>c){d=I;g=w}else{y=I;v=w}++_;++F.b2_toiRootIters;if(_==50){break}}F.b2_toiMaxRootIters=p.Max(F.b2_toiMaxRootIters,_)}if(m<(1+100*Box2D.MIN_VALUE)*s){break}s=m;u++;++F.b2_toiIters;if(u==h){break}}F.b2_toiMaxIters=p.Max(F.b2_toiMaxIters,u);return s};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new W;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new S;Box2D.Collision.b2TimeOfImpact.s_xfA=new f;Box2D.Collision.b2TimeOfImpact.s_xfB=new f;Box2D.Collision.b2TimeOfImpact.s_fcn=new O;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new T});N.b2TOIInput=function(){this.proxyA=new C;this.proxyB=new C;this.sweepA=new c;this.sweepB=new c};G.b2WorldManifold=function(){this.m_normal=new m};G.prototype.b2WorldManifold=function(){this.m_points=new Vector(l.b2_maxManifoldPoints);for(var t=0;t<l.b2_maxManifoldPoints;t++){this.m_points[t]=new m}};G.prototype.Initialize=function(t,e,i,n,r){if(i===undefined)i=0;if(r===undefined)r=0;if(t.m_pointCount==0){return}var o=0;var a;var s;var l=0;var h=0;var u=0;var p=0;var c=0;var f=0;switch(t.m_type){case U.e_circles:{s=e.R;a=t.m_localPoint;var m=e.position.x+s.col1.x*a.x+s.col2.x*a.y;var d=e.position.y+s.col1.y*a.x+s.col2.y*a.y;s=n.R;a=t.m_points[0].m_localPoint;var y=n.position.x+s.col1.x*a.x+s.col2.x*a.y;var g=n.position.y+s.col1.y*a.x+s.col2.y*a.y;var v=y-m;var _=g-d;var I=v*v+_*_;if(I>Box2D.MIN_VALUE*Box2D.MIN_VALUE){var w=Math.sqrt(I);this.m_normal.x=v/w;this.m_normal.y=_/w}else{this.m_normal.x=1;this.m_normal.y=0}var x=m+i*this.m_normal.x;var S=d+i*this.m_normal.y;var T=y-r*this.m_normal.x;var C=g-r*this.m_normal.y;this.m_points[0].x=.5*(x+T);this.m_points[0].y=.5*(S+C)}break;case U.e_faceA:{s=e.R;a=t.m_localPlaneNormal;l=s.col1.x*a.x+s.col2.x*a.y;h=s.col1.y*a.x+s.col2.y*a.y;s=e.R;a=t.m_localPoint;u=e.position.x+s.col1.x*a.x+s.col2.x*a.y;p=e.position.y+s.col1.y*a.x+s.col2.y*a.y;this.m_normal.x=l;this.m_normal.y=h;for(o=0;o<t.m_pointCount;o++){s=n.R;a=t.m_points[o].m_localPoint;c=n.position.x+s.col1.x*a.x+s.col2.x*a.y;f=n.position.y+s.col1.y*a.x+s.col2.y*a.y;this.m_points[o].x=c+.5*(i-(c-u)*l-(f-p)*h-r)*l;this.m_points[o].y=f+.5*(i-(c-u)*l-(f-p)*h-r)*h}}break;case U.e_faceB:{s=n.R;a=t.m_localPlaneNormal;l=s.col1.x*a.x+s.col2.x*a.y;h=s.col1.y*a.x+s.col2.y*a.y;s=n.R;a=t.m_localPoint;u=n.position.x+s.col1.x*a.x+s.col2.x*a.y;p=n.position.y+s.col1.y*a.x+s.col2.y*a.y;this.m_normal.x=-l;this.m_normal.y=-h;for(o=0;o<t.m_pointCount;o++){s=e.R;a=t.m_points[o].m_localPoint;c=e.position.x+s.col1.x*a.x+s.col2.x*a.y;f=e.position.y+s.col1.y*a.x+s.col2.y*a.y;this.m_points[o].x=c+.5*(r-(c-u)*l-(f-p)*h-i)*l;this.m_points[o].y=f+.5*(r-(c-u)*l-(f-p)*h-i)*h}}break}};H.ClipVertex=function(){this.v=new m;this.id=new I};H.prototype.Set=function(t){this.v.SetV(t.v);this.id.Set(t.id)};Y.Features=function(){};Object.defineProperty(Y.prototype,"referenceEdge",{enumerable:false,configurable:true,get:function(){return this._referenceEdge}});Object.defineProperty(Y.prototype,"referenceEdge",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._referenceEdge=t;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(Y.prototype,"incidentEdge",{enumerable:false,configurable:true,get:function(){return this._incidentEdge}});Object.defineProperty(Y.prototype,"incidentEdge",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._incidentEdge=t;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(Y.prototype,"incidentVertex",{enumerable:false,configurable:true,get:function(){return this._incidentVertex}});Object.defineProperty(Y.prototype,"incidentVertex",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._incidentVertex=t;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(Y.prototype,"flip",{enumerable:false,configurable:true,get:function(){return this._flip}});Object.defineProperty(Y.prototype,"flip",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._flip=t;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,n=Box2D.Collision.Shapes.b2CircleShape,r=Box2D.Collision.Shapes.b2EdgeChainDef,o=Box2D.Collision.Shapes.b2EdgeShape,a=Box2D.Collision.Shapes.b2MassData,s=Box2D.Collision.Shapes.b2PolygonShape,l=Box2D.Collision.Shapes.b2Shape,h=Box2D.Common.Math.b2Mat22,u=Box2D.Common.Math.b2Mat33,p=Box2D.Common.Math.b2Math,c=Box2D.Common.Math.b2Sweep,f=Box2D.Common.Math.b2Transform,m=Box2D.Common.Math.b2Vec2,d=Box2D.Common.Math.b2Vec3,y=Box2D.Dynamics.b2Body,g=Box2D.Dynamics.b2BodyDef,v=Box2D.Dynamics.b2ContactFilter,_=Box2D.Dynamics.b2ContactImpulse,I=Box2D.Dynamics.b2ContactListener,w=Box2D.Dynamics.b2ContactManager,x=Box2D.Dynamics.b2DebugDraw,S=Box2D.Dynamics.b2DestructionListener,T=Box2D.Dynamics.b2FilterData,C=Box2D.Dynamics.b2Fixture,b=Box2D.Dynamics.b2FixtureDef,D=Box2D.Dynamics.b2Island,E=Box2D.Dynamics.b2TimeStep,A=Box2D.Dynamics.b2World,U=Box2D.Collision.b2AABB,M=Box2D.Collision.b2Bound,P=Box2D.Collision.b2BoundValues,B=Box2D.Collision.b2Collision,L=Box2D.Collision.b2ContactID,R=Box2D.Collision.b2ContactPoint,O=Box2D.Collision.b2Distance,V=Box2D.Collision.b2DistanceInput,W=Box2D.Collision.b2DistanceOutput,k=Box2D.Collision.b2DistanceProxy,F=Box2D.Collision.b2DynamicTree,N=Box2D.Collision.b2DynamicTreeBroadPhase,G=Box2D.Collision.b2DynamicTreeNode,H=Box2D.Collision.b2DynamicTreePair,Y=Box2D.Collision.b2Manifold,J=Box2D.Collision.b2ManifoldPoint,X=Box2D.Collision.b2Point,z=Box2D.Collision.b2RayCastInput,K=Box2D.Collision.b2RayCastOutput,j=Box2D.Collision.b2Segment,q=Box2D.Collision.b2SeparationFunction,Z=Box2D.Collision.b2Simplex,Q=Box2D.Collision.b2SimplexCache,$=Box2D.Collision.b2SimplexVertex,tt=Box2D.Collision.b2TimeOfImpact,et=Box2D.Collision.b2TOIInput,it=Box2D.Collision.b2WorldManifold,nt=Box2D.Collision.ClipVertex,rt=Box2D.Collision.Features,ot=Box2D.Collision.IBroadPhase;Box2D.inherit(n,Box2D.Collision.Shapes.b2Shape);n.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;n.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new m};n.prototype.Copy=function(){var t=new n;t.Set(this);return t};n.prototype.Set=function(t){this.__super.Set.call(this,t);if(Box2D.is(t,n)){var e=t instanceof n?t:null;this.m_p.SetV(e.m_p)}};n.prototype.TestPoint=function(t,e){var i=t.R;var n=t.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y);var r=t.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);n=e.x-n;r=e.y-r;return n*n+r*r<=this.m_radius*this.m_radius};n.prototype.RayCast=function(t,e,i){var n=i.R;var r=i.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);var o=i.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y);var a=e.p1.x-r;var s=e.p1.y-o;var l=a*a+s*s-this.m_radius*this.m_radius;var h=e.p2.x-e.p1.x;var u=e.p2.y-e.p1.y;var p=a*h+s*u;var c=h*h+u*u;var f=p*p-c*l;if(f<0||c<Box2D.MIN_VALUE){return false}var m=-(p+Math.sqrt(f));if(0<=m&&m<=e.maxFraction*c){m/=c;t.fraction=m;t.normal.x=a+m*h;t.normal.y=s+m*u;t.normal.Normalize();return true}return false};n.prototype.ComputeAABB=function(t,e){var i=e.R;var n=e.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y);var r=e.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);t.lowerBound.Set(n-this.m_radius,r-this.m_radius);t.upperBound.Set(n+this.m_radius,r+this.m_radius)};n.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;t.mass=e*i.b2_pi*this.m_radius*this.m_radius;t.center.SetV(this.m_p);t.I=t.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};n.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;var r=p.MulX(i,this.m_p);var o=-(p.Dot(t,r)-e);if(o<-this.m_radius+Box2D.MIN_VALUE){return 0}if(o>this.m_radius){n.SetV(r);return Math.PI*this.m_radius*this.m_radius}var a=this.m_radius*this.m_radius;var s=o*o;var l=a*(Math.asin(o/this.m_radius)+Math.PI/2)+o*Math.sqrt(a-s);var h=-2/3*Math.pow(a-s,1.5)/l;n.x=r.x+t.x*h;n.y=r.y+t.y*h;return l};n.prototype.GetLocalPosition=function(){return this.m_p};n.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)};n.prototype.GetRadius=function(){return this.m_radius};n.prototype.SetRadius=function(t){if(t===undefined)t=0;this.m_radius=t};n.prototype.b2CircleShape=function(t){if(t===undefined)t=0;this.__super.b2Shape.call(this);this.m_type=l.e_circleShape;this.m_radius=t};r.b2EdgeChainDef=function(){};r.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=true;this.vertices=[]};Box2D.inherit(o,Box2D.Collision.Shapes.b2Shape);o.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;o.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new m;this.m_v1=new m;this.m_v2=new m;this.m_coreV1=new m;this.m_coreV2=new m;this.m_normal=new m;this.m_direction=new m;this.m_cornerDir1=new m;this.m_cornerDir2=new m};o.prototype.TestPoint=function(t,e){return false};o.prototype.RayCast=function(t,e,i){var n;var r=e.p2.x-e.p1.x;var o=e.p2.y-e.p1.y;n=i.R;var a=i.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y);var s=i.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y);var l=i.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y)-s;var h=-(i.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y)-a);var u=100*Box2D.MIN_VALUE;var p=-(r*l+o*h);if(p>u){var c=e.p1.x-a;var f=e.p1.y-s;var m=c*l+f*h;if(0<=m&&m<=e.maxFraction*p){var d=-r*f+o*c;if(-u*p<=d&&d<=p*(1+u)){m/=p;t.fraction=m;var y=Math.sqrt(l*l+h*h);t.normal.x=l/y;t.normal.y=h/y;return true}}}return false};o.prototype.ComputeAABB=function(t,e){var i=e.R;var n=e.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y);var r=e.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y);var o=e.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y);var a=e.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);if(n<o){t.lowerBound.x=n;t.upperBound.x=o}else{t.lowerBound.x=o;t.upperBound.x=n}if(r<a){t.lowerBound.y=r;t.upperBound.y=a}else{t.lowerBound.y=a;t.upperBound.y=r}};o.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;t.mass=0;t.center.SetV(this.m_v1);t.I=0};o.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;var r=new m(t.x*e,t.y*e);var o=p.MulX(i,this.m_v1);var a=p.MulX(i,this.m_v2);var s=p.Dot(t,o)-e;var l=p.Dot(t,a)-e;if(s>0){if(l>0){return 0}else{o.x=-l/(s-l)*o.x+s/(s-l)*a.x;o.y=-l/(s-l)*o.y+s/(s-l)*a.y}}else{if(l>0){a.x=-l/(s-l)*o.x+s/(s-l)*a.x;a.y=-l/(s-l)*o.y+s/(s-l)*a.y}else{}}n.x=(r.x+o.x+a.x)/3;n.y=(r.y+o.y+a.y)/3;return.5*((o.x-r.x)*(a.y-r.y)-(o.y-r.y)*(a.x-r.x))};o.prototype.GetLength=function(){return this.m_length};o.prototype.GetVertex1=function(){return this.m_v1};o.prototype.GetVertex2=function(){return this.m_v2};o.prototype.GetCoreVertex1=function(){return this.m_coreV1};o.prototype.GetCoreVertex2=function(){return this.m_coreV2};o.prototype.GetNormalVector=function(){return this.m_normal};o.prototype.GetDirectionVector=function(){return this.m_direction};o.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};o.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};o.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};o.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};o.prototype.GetFirstVertex=function(t){var e=t.R;return new m(t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y))};o.prototype.GetNextEdge=function(){return this.m_nextEdge};o.prototype.GetPrevEdge=function(){return this.m_prevEdge};o.prototype.Support=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var n=t.R;var r=t.position.x+(n.col1.x*this.m_coreV1.x+n.col2.x*this.m_coreV1.y);var o=t.position.y+(n.col1.y*this.m_coreV1.x+n.col2.y*this.m_coreV1.y);var a=t.position.x+(n.col1.x*this.m_coreV2.x+n.col2.x*this.m_coreV2.y);var s=t.position.y+(n.col1.y*this.m_coreV2.x+n.col2.y*this.m_coreV2.y);if(r*e+o*i>a*e+s*i){this.s_supportVec.x=r;this.s_supportVec.y=o}else{this.s_supportVec.x=a;this.s_supportVec.y=s}return this.s_supportVec};o.prototype.b2EdgeShape=function(t,e){this.__super.b2Shape.call(this);this.m_type=l.e_edgeShape;this.m_prevEdge=null;this.m_nextEdge=null;this.m_v1=t;this.m_v2=e;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-i.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-i.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-i.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-i.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};o.prototype.SetPrevEdge=function(t,e,i,n){this.m_prevEdge=t;this.m_coreV1=e;this.m_cornerDir1=i;this.m_cornerConvex1=n};o.prototype.SetNextEdge=function(t,e,i,n){this.m_nextEdge=t;this.m_coreV2=e;this.m_cornerDir2=i;this.m_cornerConvex2=n};o.prototype.Copy=function(){var t=new o(this.m_v1,this.m_v2);return t};a.b2MassData=function(){this.mass=0;this.center=new m(0,0);this.I=0};Box2D.inherit(s,Box2D.Collision.Shapes.b2Shape);s.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;s.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};s.prototype.Copy=function(){var t=new s;t.Set(this);return t};s.prototype.Set=function(t){this.__super.Set.call(this,t);if(Box2D.is(t,s)){var e=t instanceof s?t:null;this.m_centroid.SetV(e.m_centroid);this.m_vertexCount=e.m_vertexCount;this.Reserve(this.m_vertexCount);for(var i=0;i<this.m_vertexCount;i++){this.m_vertices[i].SetV(e.m_vertices[i]);this.m_normals[i].SetV(e.m_normals[i])}}};s.prototype.SetAsArray=function(t,e){if(e===undefined)e=0;var i=new Vector;var n=0,r;for(n=0;n<t.length;++n){r=t[n];i.push(r)}this.SetAsVector(i,e)};s.AsArray=function(t,e){if(e===undefined)e=0;var i=new s;i.SetAsArray(t,e);return i};s.prototype.SetAsVector=function(t,e){if(e===undefined)e=0;if(e==0)e=t.length;i.b2Assert(2<=e);this.m_vertexCount=e;this.Reserve(e);var n=0;for(n=0;n<this.m_vertexCount;n++){this.m_vertices[n].SetV(t[n])}for(n=0;n<this.m_vertexCount;++n){var r=parseInt(n);var o=parseInt(n+1<this.m_vertexCount?n+1:0);var a=p.SubtractVV(this.m_vertices[o],this.m_vertices[r]);i.b2Assert(a.LengthSquared()>Box2D.MIN_VALUE);this.m_normals[n].SetV(p.CrossVF(a,1));this.m_normals[n].Normalize()}this.m_centroid=s.ComputeCentroid(this.m_vertices,this.m_vertexCount)};s.AsVector=function(t,e){if(e===undefined)e=0;var i=new s;i.SetAsVector(t,e);return i};s.prototype.SetAsBox=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-t,-e);this.m_vertices[1].Set(t,-e);this.m_vertices[2].Set(t,e);this.m_vertices[3].Set(-t,e);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};s.AsBox=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;var i=new s;i.SetAsBox(t,e);return i};s.prototype.SetAsOrientedBox=function(t,e,i,n){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=null;if(n===undefined)n=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-t,-e);this.m_vertices[1].Set(t,-e);this.m_vertices[2].Set(t,e);this.m_vertices[3].Set(-t,e);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=i;var r=new f;r.position=i;r.R.Set(n);for(var o=0;o<this.m_vertexCount;++o){this.m_vertices[o]=p.MulX(r,this.m_vertices[o]);this.m_normals[o]=p.MulMV(r.R,this.m_normals[o])}};s.AsOrientedBox=function(t,e,i,n){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=null;if(n===undefined)n=0;var r=new s;r.SetAsOrientedBox(t,e,i,n);return r};s.prototype.SetAsEdge=function(t,e){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(t);this.m_vertices[1].SetV(e);this.m_centroid.x=.5*(t.x+e.x);this.m_centroid.y=.5*(t.y+e.y);this.m_normals[0]=p.CrossVF(p.SubtractVV(e,t),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};s.AsEdge=function(t,e){var i=new s;i.SetAsEdge(t,e);return i};s.prototype.TestPoint=function(t,e){var i;var n=t.R;var r=e.x-t.position.x;var o=e.y-t.position.y;var a=r*n.col1.x+o*n.col1.y;var s=r*n.col2.x+o*n.col2.y;for(var l=0;l<this.m_vertexCount;++l){i=this.m_vertices[l];r=a-i.x;o=s-i.y;i=this.m_normals[l];var h=i.x*r+i.y*o;if(h>0){return false}}return true};s.prototype.RayCast=function(t,e,i){var n=0;var r=e.maxFraction;var o=0;var a=0;var s;var l;o=e.p1.x-i.position.x;a=e.p1.y-i.position.y;s=i.R;var h=o*s.col1.x+a*s.col1.y;var u=o*s.col2.x+a*s.col2.y;o=e.p2.x-i.position.x;a=e.p2.y-i.position.y;s=i.R;var p=o*s.col1.x+a*s.col1.y;var c=o*s.col2.x+a*s.col2.y;var f=p-h;var m=c-u;var d=parseInt(-1);for(var y=0;y<this.m_vertexCount;++y){l=this.m_vertices[y];o=l.x-h;a=l.y-u;l=this.m_normals[y];var g=l.x*o+l.y*a;var v=l.x*f+l.y*m;if(v==0){if(g<0){return false}}else{if(v<0&&g<n*v){n=g/v;d=y}else if(v>0&&g<r*v){r=g/v}}if(r<n-Box2D.MIN_VALUE){return false}}if(d>=0){t.fraction=n;s=i.R;l=this.m_normals[d];t.normal.x=s.col1.x*l.x+s.col2.x*l.y;t.normal.y=s.col1.y*l.x+s.col2.y*l.y;return true}return false};s.prototype.ComputeAABB=function(t,e){var i=e.R;var n=this.m_vertices[0];var r=e.position.x+(i.col1.x*n.x+i.col2.x*n.y);var o=e.position.y+(i.col1.y*n.x+i.col2.y*n.y);var a=r;var s=o;for(var l=1;l<this.m_vertexCount;++l){n=this.m_vertices[l];var h=e.position.x+(i.col1.x*n.x+i.col2.x*n.y);var u=e.position.y+(i.col1.y*n.x+i.col2.y*n.y);r=r<h?r:h;o=o<u?o:u;a=a>h?a:h;s=s>u?s:u}t.lowerBound.x=r-this.m_radius;t.lowerBound.y=o-this.m_radius;t.upperBound.x=a+this.m_radius;t.upperBound.y=s+this.m_radius};s.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;if(this.m_vertexCount==2){t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x);t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y);t.mass=0;t.I=0;return}var i=0;var n=0;var r=0;var o=0;var a=0;var s=0;var l=1/3;for(var h=0;h<this.m_vertexCount;++h){
var u=this.m_vertices[h];var p=h+1<this.m_vertexCount?this.m_vertices[parseInt(h+1)]:this.m_vertices[0];var c=u.x-a;var f=u.y-s;var m=p.x-a;var d=p.y-s;var y=c*d-f*m;var g=.5*y;r+=g;i+=g*l*(a+u.x+p.x);n+=g*l*(s+u.y+p.y);var v=a;var _=s;var I=c;var w=f;var x=m;var S=d;var T=l*(.25*(I*I+x*I+x*x)+(v*I+v*x))+.5*v*v;var C=l*(.25*(w*w+S*w+S*S)+(_*w+_*S))+.5*_*_;o+=y*(T+C)}t.mass=e*r;i*=1/r;n*=1/r;t.center.Set(i,n);t.I=e*o};s.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;var r=p.MulTMV(i.R,t);var o=e-p.Dot(t,i.position);var s=new Vector_a2j_Number;var l=0;var h=parseInt(-1);var u=parseInt(-1);var c=false;var f=0;for(f=0;f<this.m_vertexCount;++f){s[f]=p.Dot(r,this.m_vertices[f])-o;var d=s[f]<-Box2D.MIN_VALUE;if(f>0){if(d){if(!c){h=f-1;l++}}else{if(c){u=f-1;l++}}}c=d}switch(l){case 0:if(c){var y=new a;this.ComputeMass(y,1);n.SetV(p.MulX(i,y.center));return y.mass}else{return 0}break;case 1:if(h==-1){h=this.m_vertexCount-1}else{u=this.m_vertexCount-1}break}var g=parseInt((h+1)%this.m_vertexCount);var v=parseInt((u+1)%this.m_vertexCount);var _=(0-s[h])/(s[g]-s[h]);var I=(0-s[u])/(s[v]-s[u]);var w=new m(this.m_vertices[h].x*(1-_)+this.m_vertices[g].x*_,this.m_vertices[h].y*(1-_)+this.m_vertices[g].y*_);var x=new m(this.m_vertices[u].x*(1-I)+this.m_vertices[v].x*I,this.m_vertices[u].y*(1-I)+this.m_vertices[v].y*I);var S=0;var T=new m;var C=this.m_vertices[g];var b;f=g;while(f!=v){f=(f+1)%this.m_vertexCount;if(f==v)b=x;else b=this.m_vertices[f];var D=.5*((C.x-w.x)*(b.y-w.y)-(C.y-w.y)*(b.x-w.x));S+=D;T.x+=D*(w.x+C.x+b.x)/3;T.y+=D*(w.y+C.y+b.y)/3;C=b}T.Multiply(1/S);n.SetV(p.MulX(i,T));return S};s.prototype.GetVertexCount=function(){return this.m_vertexCount};s.prototype.GetVertices=function(){return this.m_vertices};s.prototype.GetNormals=function(){return this.m_normals};s.prototype.GetSupport=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_vertexCount;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return e};s.prototype.GetSupportVertex=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_vertexCount;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return this.m_vertices[e]};s.prototype.Validate=function(){return false};s.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=l.e_polygonShape;this.m_centroid=new m;this.m_vertices=new Vector;this.m_normals=new Vector};s.prototype.Reserve=function(t){if(t===undefined)t=0;for(var e=parseInt(this.m_vertices.length);e<t;e++){this.m_vertices[e]=new m;this.m_normals[e]=new m}};s.ComputeCentroid=function(t,e){if(e===undefined)e=0;var i=new m;var n=0;var r=0;var o=0;var a=1/3;for(var s=0;s<e;++s){var l=t[s];var h=s+1<e?t[parseInt(s+1)]:t[0];var u=l.x-r;var p=l.y-o;var c=h.x-r;var f=h.y-o;var d=u*f-p*c;var y=.5*d;n+=y;i.x+=y*a*(r+l.x+h.x);i.y+=y*a*(o+l.y+h.y)}i.x*=1/n;i.y*=1/n;return i};s.ComputeOBB=function(t,e,i){if(i===undefined)i=0;var n=0;var r=new Vector(i+1);for(n=0;n<i;++n){r[n]=e[n]}r[i]=r[0];var o=Number.MAX_VALUE;for(n=1;n<=i;++n){var a=r[parseInt(n-1)];var s=r[n].x-a.x;var l=r[n].y-a.y;var h=Math.sqrt(s*s+l*l);s/=h;l/=h;var u=-l;var p=s;var c=Number.MAX_VALUE;var f=Number.MAX_VALUE;var m=-Number.MAX_VALUE;var d=-Number.MAX_VALUE;for(var y=0;y<i;++y){var g=r[y].x-a.x;var v=r[y].y-a.y;var _=s*g+l*v;var I=u*g+p*v;if(_<c)c=_;if(I<f)f=I;if(_>m)m=_;if(I>d)d=I}var w=(m-c)*(d-f);if(w<.95*o){o=w;t.R.col1.x=s;t.R.col1.y=l;t.R.col2.x=u;t.R.col2.y=p;var x=.5*(c+m);var S=.5*(f+d);var T=t.R;t.center.x=a.x+(T.col1.x*x+T.col2.x*S);t.center.y=a.y+(T.col1.y*x+T.col2.y*S);t.extents.x=.5*(m-c);t.extents.y=.5*(d-f)}}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new h});l.b2Shape=function(){};l.prototype.Copy=function(){return null};l.prototype.Set=function(t){this.m_radius=t.m_radius};l.prototype.GetType=function(){return this.m_type};l.prototype.TestPoint=function(t,e){return false};l.prototype.RayCast=function(t,e,i){return false};l.prototype.ComputeAABB=function(t,e){};l.prototype.ComputeMass=function(t,e){if(e===undefined)e=0};l.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;return 0};l.TestOverlap=function(t,e,i,n){var r=new V;r.proxyA=new k;r.proxyA.Set(t);r.proxyB=new k;r.proxyB.Set(i);r.transformA=e;r.transformB=n;r.useRadii=true;var o=new Q;o.count=0;var a=new W;O.Distance(a,o,r);return a.distance<10*Box2D.MIN_VALUE};l.prototype.b2Shape=function(){this.m_type=l.e_unknownShape;this.m_radius=i.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Mat22,r=Box2D.Common.Math.b2Mat33,o=Box2D.Common.Math.b2Math,a=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,l=Box2D.Common.Math.b2Vec2,h=Box2D.Common.Math.b2Vec3;t.b2Color=function(){this._r=0;this._g=0;this._b=0};t.prototype.b2Color=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this._r=Box2D.parseUInt(255*o.Clamp(t,0,1));this._g=Box2D.parseUInt(255*o.Clamp(e,0,1));this._b=Box2D.parseUInt(255*o.Clamp(i,0,1))};t.prototype.Set=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this._r=Box2D.parseUInt(255*o.Clamp(t,0,1));this._g=Box2D.parseUInt(255*o.Clamp(e,0,1));this._b=Box2D.parseUInt(255*o.Clamp(i,0,1))};Object.defineProperty(t.prototype,"r",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._r=Box2D.parseUInt(255*o.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"g",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._g=Box2D.parseUInt(255*o.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"b",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._b=Box2D.parseUInt(255*o.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"color",{enumerable:false,configurable:true,get:function(){return this._r<<16|this._g<<8|this._b}});i.b2Settings=function(){};i.b2MixFriction=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return Math.sqrt(t*e)};i.b2MixRestitution=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t>e?t:e};i.b2Assert=function(t){if(!t){throw"Assertion Failed"}};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*i.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*i.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*i.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=1;Box2D.Common.b2Settings.b2_maxLinearCorrection=.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*i.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=i.b2_maxTranslation*i.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=.5*i.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=i.b2_maxRotation*i.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=.2;Box2D.Common.b2Settings.b2_timeToSleep=.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*i.b2_pi})})();(function(){var t=Box2D.Collision.b2AABB,e=Box2D.Common.b2Color,i=Box2D.Common.b2internal,n=Box2D.Common.b2Settings,r=Box2D.Common.Math.b2Mat22,o=Box2D.Common.Math.b2Mat33,a=Box2D.Common.Math.b2Math,s=Box2D.Common.Math.b2Sweep,l=Box2D.Common.Math.b2Transform,h=Box2D.Common.Math.b2Vec2,u=Box2D.Common.Math.b2Vec3;r.b2Mat22=function(){this.col1=new h;this.col2=new h};r.prototype.b2Mat22=function(){this.SetIdentity()};r.FromAngle=function(t){if(t===undefined)t=0;var e=new r;e.Set(t);return e};r.FromVV=function(t,e){var i=new r;i.SetVV(t,e);return i};r.prototype.Set=function(t){if(t===undefined)t=0;var e=Math.cos(t);var i=Math.sin(t);this.col1.x=e;this.col2.x=-i;this.col1.y=i;this.col2.y=e};r.prototype.SetVV=function(t,e){this.col1.SetV(t);this.col2.SetV(e)};r.prototype.Copy=function(){var t=new r;t.SetM(this);return t};r.prototype.SetM=function(t){this.col1.SetV(t.col1);this.col2.SetV(t.col2)};r.prototype.AddM=function(t){this.col1.x+=t.col1.x;this.col1.y+=t.col1.y;this.col2.x+=t.col2.x;this.col2.y+=t.col2.y};r.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};r.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};r.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};r.prototype.GetInverse=function(t){var e=this.col1.x;var i=this.col2.x;var n=this.col1.y;var r=this.col2.y;var o=e*r-i*n;if(o!=0){o=1/o}t.col1.x=o*r;t.col2.x=-o*i;t.col1.y=-o*n;t.col2.y=o*e;return t};r.prototype.Solve=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var n=this.col1.x;var r=this.col2.x;var o=this.col1.y;var a=this.col2.y;var s=n*a-r*o;if(s!=0){s=1/s}t.x=s*(a*e-r*i);t.y=s*(n*i-o*e);return t};r.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};o.b2Mat33=function(){this.col1=new u;this.col2=new u;this.col3=new u};o.prototype.b2Mat33=function(t,e,i){if(t===undefined)t=null;if(e===undefined)e=null;if(i===undefined)i=null;if(!t&&!e&&!i){this.col1.SetZero();this.col2.SetZero();this.col3.SetZero()}else{this.col1.SetV(t);this.col2.SetV(e);this.col3.SetV(i)}};o.prototype.SetVVV=function(t,e,i){this.col1.SetV(t);this.col2.SetV(e);this.col3.SetV(i)};o.prototype.Copy=function(){return new o(this.col1,this.col2,this.col3)};o.prototype.SetM=function(t){this.col1.SetV(t.col1);this.col2.SetV(t.col2);this.col3.SetV(t.col3)};o.prototype.AddM=function(t){this.col1.x+=t.col1.x;this.col1.y+=t.col1.y;this.col1.z+=t.col1.z;this.col2.x+=t.col2.x;this.col2.y+=t.col2.y;this.col2.z+=t.col2.z;this.col3.x+=t.col3.x;this.col3.y+=t.col3.y;this.col3.z+=t.col3.z};o.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};o.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};o.prototype.Solve22=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var n=this.col1.x;var r=this.col2.x;var o=this.col1.y;var a=this.col2.y;var s=n*a-r*o;if(s!=0){s=1/s}t.x=s*(a*e-r*i);t.y=s*(n*i-o*e);return t};o.prototype.Solve33=function(t,e,i,n){if(e===undefined)e=0;if(i===undefined)i=0;if(n===undefined)n=0;var r=this.col1.x;var o=this.col1.y;var a=this.col1.z;var s=this.col2.x;var l=this.col2.y;var h=this.col2.z;var u=this.col3.x;var p=this.col3.y;var c=this.col3.z;var f=r*(l*c-h*p)+o*(h*u-s*c)+a*(s*p-l*u);if(f!=0){f=1/f}t.x=f*(e*(l*c-h*p)+i*(h*u-s*c)+n*(s*p-l*u));t.y=f*(r*(i*c-n*p)+o*(n*u-e*c)+a*(e*p-i*u));t.z=f*(r*(l*n-h*i)+o*(h*e-s*n)+a*(s*i-l*e));return t};a.b2Math=function(){};a.IsValid=function(t){if(t===undefined)t=0;return isFinite(t)};a.Dot=function(t,e){return t.x*e.x+t.y*e.y};a.CrossVV=function(t,e){return t.x*e.y-t.y*e.x};a.CrossVF=function(t,e){if(e===undefined)e=0;var i=new h(e*t.y,-e*t.x);return i};a.CrossFV=function(t,e){if(t===undefined)t=0;var i=new h(-t*e.y,t*e.x);return i};a.MulMV=function(t,e){var i=new h(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return i};a.MulTMV=function(t,e){var i=new h(a.Dot(e,t.col1),a.Dot(e,t.col2));return i};a.MulX=function(t,e){var i=a.MulMV(t.R,e);i.x+=t.position.x;i.y+=t.position.y;return i};a.MulXT=function(t,e){var i=a.SubtractVV(e,t.position);var n=i.x*t.R.col1.x+i.y*t.R.col1.y;i.y=i.x*t.R.col2.x+i.y*t.R.col2.y;i.x=n;return i};a.AddVV=function(t,e){var i=new h(t.x+e.x,t.y+e.y);return i};a.SubtractVV=function(t,e){var i=new h(t.x-e.x,t.y-e.y);return i};a.Distance=function(t,e){var i=t.x-e.x;var n=t.y-e.y;return Math.sqrt(i*i+n*n)};a.DistanceSquared=function(t,e){var i=t.x-e.x;var n=t.y-e.y;return i*i+n*n};a.MulFV=function(t,e){if(t===undefined)t=0;var i=new h(t*e.x,t*e.y);return i};a.AddMM=function(t,e){var i=r.FromVV(a.AddVV(t.col1,e.col1),a.AddVV(t.col2,e.col2));return i};a.MulMM=function(t,e){var i=r.FromVV(a.MulMV(t,e.col1),a.MulMV(t,e.col2));return i};a.MulTMM=function(t,e){var i=new h(a.Dot(t.col1,e.col1),a.Dot(t.col2,e.col1));var n=new h(a.Dot(t.col1,e.col2),a.Dot(t.col2,e.col2));var o=r.FromVV(i,n);return o};a.Abs=function(t){if(t===undefined)t=0;return t>0?t:-t};a.AbsV=function(t){var e=new h(a.Abs(t.x),a.Abs(t.y));return e};a.AbsM=function(t){var e=r.FromVV(a.AbsV(t.col1),a.AbsV(t.col2));return e};a.Min=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t<e?t:e};a.MinV=function(t,e){var i=new h(a.Min(t.x,e.x),a.Min(t.y,e.y));return i};a.Max=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t>e?t:e};a.MaxV=function(t,e){var i=new h(a.Max(t.x,e.x),a.Max(t.y,e.y));return i};a.Clamp=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;return t<e?e:t>i?i:t};a.ClampV=function(t,e,i){return a.MaxV(e,a.MinV(t,i))};a.Swap=function(t,e){var i=t[0];t[0]=e[0];e[0]=i};a.Random=function(){return Math.random()*2-1};a.RandomRange=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;var i=Math.random();i=(e-t)*i+t;return i};a.NextPowerOfTwo=function(t){if(t===undefined)t=0;t|=t>>1&2147483647;t|=t>>2&1073741823;t|=t>>4&268435455;t|=t>>8&16777215;t|=t>>16&65535;return t+1};a.IsPowerOfTwo=function(t){if(t===undefined)t=0;var e=t>0&&(t&t-1)==0;return e};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new h(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=r.FromVV(new h(1,0),new h(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new l(a.b2Vec2_zero,a.b2Mat22_identity)});s.b2Sweep=function(){this.localCenter=new h;this.c0=new h;this.c=new h};s.prototype.Set=function(t){this.localCenter.SetV(t.localCenter);this.c0.SetV(t.c0);this.c.SetV(t.c);this.a0=t.a0;this.a=t.a;this.t0=t.t0};s.prototype.Copy=function(){var t=new s;t.localCenter.SetV(this.localCenter);t.c0.SetV(this.c0);t.c.SetV(this.c);t.a0=this.a0;t.a=this.a;t.t0=this.t0;return t};s.prototype.GetTransform=function(t,e){if(e===undefined)e=0;t.position.x=(1-e)*this.c0.x+e*this.c.x;t.position.y=(1-e)*this.c0.y+e*this.c.y;var i=(1-e)*this.a0+e*this.a;t.R.Set(i);var n=t.R;t.position.x-=n.col1.x*this.localCenter.x+n.col2.x*this.localCenter.y;t.position.y-=n.col1.y*this.localCenter.x+n.col2.y*this.localCenter.y};s.prototype.Advance=function(t){if(t===undefined)t=0;if(this.t0<t&&1-this.t0>Box2D.MIN_VALUE){var e=(t-this.t0)/(1-this.t0);this.c0.x=(1-e)*this.c0.x+e*this.c.x;this.c0.y=(1-e)*this.c0.y+e*this.c.y;this.a0=(1-e)*this.a0+e*this.a;this.t0=t}};l.b2Transform=function(){this.position=new h;this.R=new r};l.prototype.b2Transform=function(t,e){if(t===undefined)t=null;if(e===undefined)e=null;if(t){this.position.SetV(t);this.R.SetM(e)}};l.prototype.Initialize=function(t,e){this.position.SetV(t);this.R.SetM(e)};l.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};l.prototype.Set=function(t){this.position.SetV(t.position);this.R.SetM(t.R)};l.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};h.b2Vec2=function(){};h.prototype.b2Vec2=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.x=t;this.y=e};h.prototype.SetZero=function(){this.x=0;this.y=0};h.prototype.Set=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.x=t;this.y=e};h.prototype.SetV=function(t){this.x=t.x;this.y=t.y};h.prototype.GetNegative=function(){return new h(-this.x,-this.y)};h.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};h.Make=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return new h(t,e)};h.prototype.Copy=function(){return new h(this.x,this.y)};h.prototype.Add=function(t){this.x+=t.x;this.y+=t.y};h.prototype.Subtract=function(t){this.x-=t.x;this.y-=t.y};h.prototype.Multiply=function(t){if(t===undefined)t=0;this.x*=t;this.y*=t};h.prototype.MulM=function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y;this.y=t.col1.y*e+t.col2.y*this.y};h.prototype.MulTM=function(t){var e=a.Dot(this,t.col1);this.y=a.Dot(this,t.col2);this.x=e};h.prototype.CrossVF=function(t){if(t===undefined)t=0;var e=this.x;this.x=t*this.y;this.y=-t*e};h.prototype.CrossFV=function(t){if(t===undefined)t=0;var e=this.x;this.x=-t*this.y;this.y=t*e};h.prototype.MinV=function(t){this.x=this.x<t.x?this.x:t.x;this.y=this.y<t.y?this.y:t.y};h.prototype.MaxV=function(t){this.x=this.x>t.x?this.x:t.x;this.y=this.y>t.y?this.y:t.y};h.prototype.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};h.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};h.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};h.prototype.Normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t<Box2D.MIN_VALUE){return 0}var e=1/t;this.x*=e;this.y*=e;return t};h.prototype.IsValid=function(){return a.IsValid(this.x)&&a.IsValid(this.y)};u.b2Vec3=function(){};u.prototype.b2Vec3=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this.x=t;this.y=e;this.z=i};u.prototype.SetZero=function(){this.x=this.y=this.z=0};u.prototype.Set=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this.x=t;this.y=e;this.z=i};u.prototype.SetV=function(t){this.x=t.x;this.y=t.y;this.z=t.z};u.prototype.GetNegative=function(){return new u(-this.x,-this.y,-this.z)};u.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};u.prototype.Copy=function(){return new u(this.x,this.y,this.z)};u.prototype.Add=function(t){this.x+=t.x;this.y+=t.y;this.z+=t.z};u.prototype.Subtract=function(t){this.x-=t.x;this.y-=t.y;this.z-=t.z};u.prototype.Multiply=function(t){if(t===undefined)t=0;this.x*=t;this.y*=t;this.z*=t}})();(function(){var t=Box2D.Dynamics.Controllers.b2ControllerEdge,e=Box2D.Common.Math.b2Mat22,i=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math,r=Box2D.Common.Math.b2Sweep,o=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,s=Box2D.Common.Math.b2Vec3,l=Box2D.Common.b2Color,h=Box2D.Common.b2internal,u=Box2D.Common.b2Settings,p=Box2D.Collision.b2AABB,c=Box2D.Collision.b2Bound,f=Box2D.Collision.b2BoundValues,m=Box2D.Collision.b2Collision,d=Box2D.Collision.b2ContactID,y=Box2D.Collision.b2ContactPoint,g=Box2D.Collision.b2Distance,v=Box2D.Collision.b2DistanceInput,_=Box2D.Collision.b2DistanceOutput,I=Box2D.Collision.b2DistanceProxy,w=Box2D.Collision.b2DynamicTree,x=Box2D.Collision.b2DynamicTreeBroadPhase,S=Box2D.Collision.b2DynamicTreeNode,T=Box2D.Collision.b2DynamicTreePair,C=Box2D.Collision.b2Manifold,b=Box2D.Collision.b2ManifoldPoint,D=Box2D.Collision.b2Point,E=Box2D.Collision.b2RayCastInput,A=Box2D.Collision.b2RayCastOutput,U=Box2D.Collision.b2Segment,M=Box2D.Collision.b2SeparationFunction,P=Box2D.Collision.b2Simplex,B=Box2D.Collision.b2SimplexCache,L=Box2D.Collision.b2SimplexVertex,R=Box2D.Collision.b2TimeOfImpact,O=Box2D.Collision.b2TOIInput,V=Box2D.Collision.b2WorldManifold,W=Box2D.Collision.ClipVertex,k=Box2D.Collision.Features,F=Box2D.Collision.IBroadPhase,N=Box2D.Collision.Shapes.b2CircleShape,G=Box2D.Collision.Shapes.b2EdgeChainDef,H=Box2D.Collision.Shapes.b2EdgeShape,Y=Box2D.Collision.Shapes.b2MassData,J=Box2D.Collision.Shapes.b2PolygonShape,X=Box2D.Collision.Shapes.b2Shape,z=Box2D.Dynamics.b2Body,K=Box2D.Dynamics.b2BodyDef,j=Box2D.Dynamics.b2ContactFilter,q=Box2D.Dynamics.b2ContactImpulse,Z=Box2D.Dynamics.b2ContactListener,Q=Box2D.Dynamics.b2ContactManager,$=Box2D.Dynamics.b2DebugDraw,tt=Box2D.Dynamics.b2DestructionListener,et=Box2D.Dynamics.b2FilterData,it=Box2D.Dynamics.b2Fixture,nt=Box2D.Dynamics.b2FixtureDef,rt=Box2D.Dynamics.b2Island,ot=Box2D.Dynamics.b2TimeStep,at=Box2D.Dynamics.b2World,st=Box2D.Dynamics.Contacts.b2CircleContact,lt=Box2D.Dynamics.Contacts.b2Contact,ht=Box2D.Dynamics.Contacts.b2ContactConstraint,ut=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,pt=Box2D.Dynamics.Contacts.b2ContactEdge,ct=Box2D.Dynamics.Contacts.b2ContactFactory,ft=Box2D.Dynamics.Contacts.b2ContactRegister,mt=Box2D.Dynamics.Contacts.b2ContactResult,dt=Box2D.Dynamics.Contacts.b2ContactSolver,yt=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,gt=Box2D.Dynamics.Contacts.b2NullContact,vt=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,_t=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,It=Box2D.Dynamics.Contacts.b2PolygonContact,wt=Box2D.Dynamics.Contacts.b2PositionSolverManifold,xt=Box2D.Dynamics.Controllers.b2Controller,St=Box2D.Dynamics.Joints.b2DistanceJoint,Tt=Box2D.Dynamics.Joints.b2DistanceJointDef,Ct=Box2D.Dynamics.Joints.b2FrictionJoint,bt=Box2D.Dynamics.Joints.b2FrictionJointDef,Dt=Box2D.Dynamics.Joints.b2GearJoint,Et=Box2D.Dynamics.Joints.b2GearJointDef,At=Box2D.Dynamics.Joints.b2Jacobian,Ut=Box2D.Dynamics.Joints.b2Joint,Mt=Box2D.Dynamics.Joints.b2JointDef,Pt=Box2D.Dynamics.Joints.b2JointEdge,Bt=Box2D.Dynamics.Joints.b2LineJoint,Lt=Box2D.Dynamics.Joints.b2LineJointDef,Rt=Box2D.Dynamics.Joints.b2MouseJoint,Ot=Box2D.Dynamics.Joints.b2MouseJointDef,Vt=Box2D.Dynamics.Joints.b2PrismaticJoint,Wt=Box2D.Dynamics.Joints.b2PrismaticJointDef,kt=Box2D.Dynamics.Joints.b2PulleyJoint,Ft=Box2D.Dynamics.Joints.b2PulleyJointDef,Nt=Box2D.Dynamics.Joints.b2RevoluteJoint,Gt=Box2D.Dynamics.Joints.b2RevoluteJointDef,Ht=Box2D.Dynamics.Joints.b2WeldJoint,Yt=Box2D.Dynamics.Joints.b2WeldJointDef;z.b2Body=function(){this.m_xf=new o;this.m_sweep=new r;this.m_linearVelocity=new a;this.m_force=new a};z.prototype.connectEdges=function(t,e,i){if(i===undefined)i=0;var r=Math.atan2(e.GetDirectionVector().y,e.GetDirectionVector().x);var o=Math.tan((r-i)*.5);var a=n.MulFV(o,e.GetDirectionVector());a=n.SubtractVV(a,e.GetNormalVector());a=n.MulFV(u.b2_toiSlop,a);a=n.AddVV(a,e.GetVertex1());var s=n.AddVV(t.GetDirectionVector(),e.GetDirectionVector());s.Normalize();var l=n.Dot(t.GetDirectionVector(),e.GetNormalVector())>0;t.SetNextEdge(e,a,s,l);e.SetPrevEdge(t,a,s,l);return r};z.prototype.CreateFixture=function(t){if(this.m_world.IsLocked()==true){return null}var e=new it;e.Create(this,this.m_xf,t);if(this.m_flags&z.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;e.CreateProxy(i,this.m_xf)}e.m_next=this.m_fixtureList;this.m_fixtureList=e;++this.m_fixtureCount;e.m_body=this;if(e.m_density>0){this.ResetMassData()}this.m_world.m_flags|=at.e_newFixture;return e};z.prototype.CreateFixture2=function(t,e){if(e===undefined)e=0;var i=new nt;i.shape=t;i.density=e;return this.CreateFixture(i)};z.prototype.DestroyFixture=function(t){if(this.m_world.IsLocked()==true){return}var e=this.m_fixtureList;var i=null;var n=false;while(e!=null){if(e==t){if(i)i.m_next=t.m_next;else this.m_fixtureList=t.m_next;n=true;break}i=e;e=e.m_next}var r=this.m_contactList;while(r){var o=r.contact;r=r.next;var a=o.GetFixtureA();var s=o.GetFixtureB();if(t==a||t==s){this.m_world.m_contactManager.Destroy(o)}}if(this.m_flags&z.e_activeFlag){var l=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxy(l)}else{}t.Destroy();t.m_body=null;t.m_next=null;--this.m_fixtureCount;this.ResetMassData()};z.prototype.SetPositionAndAngle=function(t,e){if(e===undefined)e=0;var i;if(this.m_world.IsLocked()==true){return}this.m_xf.R.Set(e);this.m_xf.position.SetV(t);var n=this.m_xf.R;var r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y;this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=e;var o=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.Synchronize(o,this.m_xf,this.m_xf)}this.m_world.m_contactManager.FindNewContacts()};z.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())};z.prototype.GetTransform=function(){return this.m_xf};z.prototype.GetPosition=function(){return this.m_xf.position};z.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())};z.prototype.GetAngle=function(){return this.m_sweep.a};z.prototype.SetAngle=function(t){if(t===undefined)t=0;this.SetPositionAndAngle(this.GetPosition(),t)};z.prototype.GetWorldCenter=function(){return this.m_sweep.c};z.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};z.prototype.SetLinearVelocity=function(t){if(this.m_type==z.b2_staticBody){alert("Static body not support SetLinearVelocity");return}this.m_linearVelocity.SetV(t)};z.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};z.prototype.SetAngularVelocity=function(t){if(t===undefined)t=0;if(this.m_type==z.b2_staticBody){alert("Static body not support SetAngularVelocity");return}this.m_angularVelocity=t};z.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};z.prototype.GetDefinition=function(){var t=new K;t.type=this.GetType();t.allowSleep=(this.m_flags&z.e_allowSleepFlag)==z.e_allowSleepFlag;t.angle=this.GetAngle();t.angularDamping=this.m_angularDamping;t.angularVelocity=this.m_angularVelocity;t.fixedRotation=(this.m_flags&z.e_fixedRotationFlag)==z.e_fixedRotationFlag;t.bullet=(this.m_flags&z.e_bulletFlag)==z.e_bulletFlag;t.awake=(this.m_flags&z.e_awakeFlag)==z.e_awakeFlag;t.linearDamping=this.m_linearDamping;t.linearVelocity.SetV(this.GetLinearVelocity());t.position=this.GetPosition();t.userData=this.GetUserData();return t};z.prototype.ApplyForce=function(t,e){if(this.m_type!=z.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_force.x+=t.x;this.m_force.y+=t.y;this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x};z.prototype.ApplyTorque=function(t){if(t===undefined)t=0;if(this.m_type!=z.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_torque+=t};z.prototype.ApplyImpulse=function(t,e){if(this.m_type!=z.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_linearVelocity.x+=this.m_invMass*t.x;this.m_linearVelocity.y+=this.m_invMass*t.y;this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)};z.prototype.Split=function(t){var e=this.GetLinearVelocity().Copy();var i=this.GetAngularVelocity();var r=this.GetWorldCenter();var o=this;var a=this.m_world.CreateBody(this.GetDefinition());var s;for(var l=o.m_fixtureList;l;){if(t(l)){var h=l.m_next;if(s){s.m_next=h}else{o.m_fixtureList=h}o.m_fixtureCount--;l.m_next=a.m_fixtureList;a.m_fixtureList=l;a.m_fixtureCount++;l.m_body=a;l=h}else{s=l;l=l.m_next}}o.ResetMassData();a.ResetMassData();var u=o.GetWorldCenter();var p=a.GetWorldCenter();var c=n.AddVV(e,n.CrossFV(i,n.SubtractVV(u,r)));var f=n.AddVV(e,n.CrossFV(i,n.SubtractVV(p,r)));o.SetLinearVelocity(c);a.SetLinearVelocity(f);o.SetAngularVelocity(i);a.SetAngularVelocity(i);o.SynchronizeFixtures();a.SynchronizeFixtures();return a};z.prototype.Merge=function(t){var e;for(e=t.m_fixtureList;e;){var i=e.m_next;t.m_fixtureCount--;e.m_next=this.m_fixtureList;this.m_fixtureList=e;this.m_fixtureCount++;e.m_body=r;e=i}n.m_fixtureCount=0;var n=this;var r=t;var o=n.GetWorldCenter();var a=r.GetWorldCenter();var s=n.GetLinearVelocity().Copy();var l=r.GetLinearVelocity().Copy();var h=n.GetAngularVelocity();var u=r.GetAngularVelocity();n.ResetMassData();this.SynchronizeFixtures()};z.prototype.GetMass=function(){return this.m_mass};z.prototype.GetInertia=function(){return this.m_I};z.prototype.GetMassData=function(t){t.mass=this.m_mass;t.I=this.m_I;t.center.SetV(this.m_sweep.localCenter)};z.prototype.SetMassData=function(t){u.b2Assert(this.m_world.IsLocked()==false);if(this.m_world.IsLocked()==true){return}if(this.m_type!=z.b2_dynamicBody){return}this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_mass=t.mass;if(this.m_mass<=0){this.m_mass=1}this.m_invMass=1/this.m_mass;if(t.I>0&&(this.m_flags&z.e_fixedRotationFlag)==0){this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y);this.m_invI=1/this.m_I}var e=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t.center);this.m_sweep.c0.SetV(n.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-e.x)};z.prototype.ResetMassData=function(){this.m_mass=0;this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_sweep.localCenter.SetZero();if(this.m_type==z.b2_staticBody||this.m_type==z.b2_kinematicBody){return}var t=a.Make(0,0);for(var e=this.m_fixtureList;e;e=e.m_next){if(e.m_density==0){continue}var i=e.GetMassData();this.m_mass+=i.mass;t.x+=i.center.x*i.mass;t.y+=i.center.y*i.mass;this.m_I+=i.I}if(this.m_mass>0){this.m_invMass=1/this.m_mass;t.x*=this.m_invMass;t.y*=this.m_invMass}else{this.m_mass=1;this.m_invMass=1}if(this.m_I>0&&(this.m_flags&z.e_fixedRotationFlag)==0){this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y);this.m_I*=this.m_inertiaScale;u.b2Assert(this.m_I>0);this.m_invI=1/this.m_I}else{this.m_I=0;this.m_invI=0}var r=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t);this.m_sweep.c0.SetV(n.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-r.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-r.x)};z.prototype.GetWorldPoint=function(t){var e=this.m_xf.R;var i=new a(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);i.x+=this.m_xf.position.x;i.y+=this.m_xf.position.y;return i};z.prototype.GetWorldVector=function(t){return n.MulMV(this.m_xf.R,t)};z.prototype.GetLocalPoint=function(t){return n.MulXT(this.m_xf,t)};z.prototype.GetLocalVector=function(t){return n.MulTMV(this.m_xf.R,t)};z.prototype.GetLinearVelocityFromWorldPoint=function(t){return new a(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))};z.prototype.GetLinearVelocityFromLocalPoint=function(t){var e=this.m_xf.R;var i=new a(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);i.x+=this.m_xf.position.x;i.y+=this.m_xf.position.y;return new a(this.m_linearVelocity.x-this.m_angularVelocity*(i.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(i.x-this.m_sweep.c.x))};z.prototype.GetLinearDamping=function(){return this.m_linearDamping};z.prototype.SetLinearDamping=function(t){if(t===undefined)t=0;this.m_linearDamping=t};z.prototype.GetAngularDamping=function(){return this.m_angularDamping};z.prototype.SetAngularDamping=function(t){if(t===undefined)t=0;this.m_angularDamping=t};z.prototype.SetType=function(t){if(t===undefined)t=0;if(this.m_type==t){return}this.m_type=t;this.ResetMassData();if(this.m_type==z.b2_staticBody){this.m_linearVelocity.SetZero();this.m_angularVelocity=0}this.SetAwake(true);this.m_force.SetZero();this.m_torque=0;for(var e=this.m_contactList;e;e=e.next){e.contact.FlagForFiltering()}};z.prototype.GetType=function(){return this.m_type};z.prototype.SetBullet=function(t){if(t){this.m_flags|=z.e_bulletFlag}else{this.m_flags&=~z.e_bulletFlag}};z.prototype.IsBullet=function(){return(this.m_flags&z.e_bulletFlag)==z.e_bulletFlag};z.prototype.SetSleepingAllowed=function(t){if(t){this.m_flags|=z.e_allowSleepFlag}else{this.m_flags&=~z.e_allowSleepFlag;this.SetAwake(true)}};z.prototype.SetAwake=function(t){if(t){this.m_flags|=z.e_awakeFlag;this.m_sleepTime=0}else{this.m_flags&=~z.e_awakeFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0}};z.prototype.IsAwake=function(){return(this.m_flags&z.e_awakeFlag)==z.e_awakeFlag;
};z.prototype.SetFixedRotation=function(t){if(t){this.m_flags|=z.e_fixedRotationFlag}else{this.m_flags&=~z.e_fixedRotationFlag}this.ResetMassData()};z.prototype.IsFixedRotation=function(){return(this.m_flags&z.e_fixedRotationFlag)==z.e_fixedRotationFlag};z.prototype.SetActive=function(t){if(t==this.IsActive()){return}var e;var i;if(t){this.m_flags|=z.e_activeFlag;e=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.CreateProxy(e,this.m_xf)}}else{this.m_flags&=~z.e_activeFlag;e=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.DestroyProxy(e)}var n=this.m_contactList;while(n){var r=n;n=n.next;this.m_world.m_contactManager.Destroy(r.contact)}this.m_contactList=null}};z.prototype.IsActive=function(){return(this.m_flags&z.e_activeFlag)==z.e_activeFlag};z.prototype.IsSleepingAllowed=function(){return(this.m_flags&z.e_allowSleepFlag)==z.e_allowSleepFlag};z.prototype.GetFixtureList=function(){return this.m_fixtureList};z.prototype.GetJointList=function(){return this.m_jointList};z.prototype.GetControllerList=function(){return this.m_controllerList};z.prototype.GetContactList=function(){return this.m_contactList};z.prototype.GetNext=function(){return this.m_next};z.prototype.GetUserData=function(){return this.m_userData};z.prototype.SetUserData=function(t){this.m_userData=t};z.prototype.GetWorld=function(){return this.m_world};z.prototype.b2Body=function(t,e){this.m_flags=0;if(t.bullet){this.m_flags|=z.e_bulletFlag}if(t.fixedRotation){this.m_flags|=z.e_fixedRotationFlag}if(t.allowSleep){this.m_flags|=z.e_allowSleepFlag}if(t.awake){this.m_flags|=z.e_awakeFlag}if(t.active){this.m_flags|=z.e_activeFlag}this.m_world=e;this.m_xf.position.SetV(t.position);this.m_xf.R.Set(t.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=t.angle;var i=this.m_xf.R;var n=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*n.x+i.col2.x*n.y;this.m_sweep.c.y=i.col1.y*n.x+i.col2.y*n.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_jointList=null;this.m_controllerList=null;this.m_contactList=null;this.m_controllerCount=0;this.m_prev=null;this.m_next=null;this.m_linearVelocity.SetV(t.linearVelocity);this.m_angularVelocity=t.angularVelocity;this.m_linearDamping=t.linearDamping;this.m_angularDamping=t.angularDamping;this.m_force.Set(0,0);this.m_torque=0;this.m_sleepTime=0;this.m_type=t.type;if(this.m_type==z.b2_dynamicBody){this.m_mass=1;this.m_invMass=1}else{this.m_mass=0;this.m_invMass=0}this.m_I=0;this.m_invI=0;this.m_inertiaScale=t.inertiaScale;this.m_userData=t.userData;this.m_fixtureList=null;this.m_fixtureCount=0};z.prototype.SynchronizeFixtures=function(){var t=z.s_xf1;t.R.Set(this.m_sweep.a0);var e=t.R;var i=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(e.col1.x*i.x+e.col2.x*i.y);t.position.y=this.m_sweep.c0.y-(e.col1.y*i.x+e.col2.y*i.y);var n;var r=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next){n.Synchronize(r,t,this.m_xf)}};z.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R;var e=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*e.x+t.col2.x*e.y);this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*e.x+t.col2.y*e.y)};z.prototype.ShouldCollide=function(t){if(this.m_type!=z.b2_dynamicBody&&t.m_type!=z.b2_dynamicBody){return false}for(var e=this.m_jointList;e;e=e.next){if(e.other==t)if(e.joint.m_collideConnected==false){return false}}return true};z.prototype.Advance=function(t){if(t===undefined)t=0;this.m_sweep.Advance(t);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new o;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});K.b2BodyDef=function(){this.position=new a;this.linearVelocity=new a};K.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularVelocity=0;this.linearDamping=0;this.angularDamping=0;this.allowSleep=true;this.awake=true;this.fixedRotation=false;this.bullet=false;this.type=z.b2_staticBody;this.active=true;this.inertiaScale=1};j.b2ContactFilter=function(){};j.prototype.ShouldCollide=function(t,e){var i=t.GetFilterData();var n=e.GetFilterData();if(i.groupIndex==n.groupIndex&&i.groupIndex!=0){return i.groupIndex>0}var r=(i.maskBits&n.categoryBits)!=0&&(i.categoryBits&n.maskBits)!=0;return r};j.prototype.RayCollide=function(t,e){if(!t)return true;return this.ShouldCollide(t instanceof it?t:null,e)};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new j});q.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(u.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(u.b2_maxManifoldPoints)};Z.b2ContactListener=function(){};Z.prototype.BeginContact=function(t){};Z.prototype.EndContact=function(t){};Z.prototype.PreSolve=function(t,e){};Z.prototype.PostSolve=function(t,e){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new Z});Q.b2ContactManager=function(){};Q.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=j.b2_defaultFilter;this.m_contactListener=Z.b2_defaultListener;this.m_contactFactory=new ct(this.m_allocator);this.m_broadPhase=new x};Q.prototype.AddPair=function(t,e){var i=t instanceof it?t:null;var n=e instanceof it?e:null;var r=i.GetBody();var o=n.GetBody();if(r==o)return;var a=o.GetContactList();while(a){if(a.other==r){var s=a.contact.GetFixtureA();var l=a.contact.GetFixtureB();if(s==i&&l==n)return;if(s==n&&l==i)return}a=a.next}if(o.ShouldCollide(r)==false){return}if(this.m_contactFilter.ShouldCollide(i,n)==false){return}var h=this.m_contactFactory.Create(i,n);i=h.GetFixtureA();n=h.GetFixtureB();r=i.m_body;o=n.m_body;h.m_prev=null;h.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null){this.m_world.m_contactList.m_prev=h}this.m_world.m_contactList=h;h.m_nodeA.contact=h;h.m_nodeA.other=o;h.m_nodeA.prev=null;h.m_nodeA.next=r.m_contactList;if(r.m_contactList!=null){r.m_contactList.prev=h.m_nodeA}r.m_contactList=h.m_nodeA;h.m_nodeB.contact=h;h.m_nodeB.other=r;h.m_nodeB.prev=null;h.m_nodeB.next=o.m_contactList;if(o.m_contactList!=null){o.m_contactList.prev=h.m_nodeB}o.m_contactList=h.m_nodeB;++this.m_world.m_contactCount;return};Q.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};Q.prototype.Destroy=function(t){var e=t.GetFixtureA();var i=t.GetFixtureB();var n=e.GetBody();var r=i.GetBody();if(t.IsTouching()){this.m_contactListener.EndContact(t)}if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_world.m_contactList){this.m_world.m_contactList=t.m_next}if(t.m_nodeA.prev){t.m_nodeA.prev.next=t.m_nodeA.next}if(t.m_nodeA.next){t.m_nodeA.next.prev=t.m_nodeA.prev}if(t.m_nodeA==n.m_contactList){n.m_contactList=t.m_nodeA.next}if(t.m_nodeB.prev){t.m_nodeB.prev.next=t.m_nodeB.next}if(t.m_nodeB.next){t.m_nodeB.next.prev=t.m_nodeB.prev}if(t.m_nodeB==r.m_contactList){r.m_contactList=t.m_nodeB.next}this.m_contactFactory.Destroy(t);--this.m_contactCount};Q.prototype.Collide=function(){var t=this.m_world.m_contactList;while(t){var e=t.GetFixtureA();var i=t.GetFixtureB();var n=e.GetBody();var r=i.GetBody();if(n.IsAwake()==false&&r.IsAwake()==false){t=t.GetNext();continue}if(t.m_flags&lt.e_filterFlag){if(r.ShouldCollide(n)==false){var o=t;t=o.GetNext();this.Destroy(o);continue}if(this.m_contactFilter.ShouldCollide(e,i)==false){o=t;t=o.GetNext();this.Destroy(o);continue}t.m_flags&=~lt.e_filterFlag}var a=e.m_proxy;var s=i.m_proxy;var l=this.m_broadPhase.TestOverlap(a,s);if(l==false){o=t;t=o.GetNext();this.Destroy(o);continue}t.Update(this.m_contactListener);t=t.GetNext()}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new y});$.b2DebugDraw=function(){};$.prototype.b2DebugDraw=function(){};$.prototype.SetFlags=function(t){if(t===undefined)t=0};$.prototype.GetFlags=function(){};$.prototype.AppendFlags=function(t){if(t===undefined)t=0};$.prototype.ClearFlags=function(t){if(t===undefined)t=0};$.prototype.SetSprite=function(t){};$.prototype.GetSprite=function(){};$.prototype.SetDrawScale=function(t){if(t===undefined)t=0};$.prototype.GetDrawScale=function(){};$.prototype.SetLineThickness=function(t){if(t===undefined)t=0};$.prototype.GetLineThickness=function(){};$.prototype.SetAlpha=function(t){if(t===undefined)t=0};$.prototype.GetAlpha=function(){};$.prototype.SetFillAlpha=function(t){if(t===undefined)t=0};$.prototype.GetFillAlpha=function(){};$.prototype.SetXFormScale=function(t){if(t===undefined)t=0};$.prototype.GetXFormScale=function(){};$.prototype.DrawPolygon=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawSolidPolygon=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawCircle=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawSolidCircle=function(t,e,i,n){if(e===undefined)e=0};$.prototype.DrawSegment=function(t,e,i){};$.prototype.DrawTransform=function(t){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});tt.b2DestructionListener=function(){};tt.prototype.SayGoodbyeJoint=function(t){};tt.prototype.SayGoodbyeFixture=function(t){};et.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};et.prototype.Copy=function(){var t=new et;t.categoryBits=this.categoryBits;t.maskBits=this.maskBits;t.groupIndex=this.groupIndex;return t};it.b2Fixture=function(){this.m_filter=new et};it.prototype.GetType=function(){return this.m_shape.GetType()};it.prototype.GetShape=function(){return this.m_shape};it.prototype.SetSensor=function(t){if(this.m_isSensor==t)return;this.m_isSensor=t;if(this.m_body==null)return;var e=this.m_body.GetContactList();while(e){var i=e.contact;var n=i.GetFixtureA();var r=i.GetFixtureB();if(n==this||r==this)i.SetSensor(n.IsSensor()||r.IsSensor());e=e.next}};it.prototype.IsSensor=function(){return this.m_isSensor};it.prototype.SetFilterData=function(t){this.m_filter=t.Copy();if(this.m_body)return;var e=this.m_body.GetContactList();while(e){var i=e.contact;var n=i.GetFixtureA();var r=i.GetFixtureB();if(n==this||r==this)i.FlagForFiltering();e=e.next}};it.prototype.GetFilterData=function(){return this.m_filter.Copy()};it.prototype.GetBody=function(){return this.m_body};it.prototype.GetNext=function(){return this.m_next};it.prototype.GetUserData=function(){return this.m_userData};it.prototype.SetUserData=function(t){this.m_userData=t};it.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)};it.prototype.RayCast=function(t,e){return this.m_shape.RayCast(t,e,this.m_body.GetTransform())};it.prototype.GetMassData=function(t){if(t===undefined)t=null;if(t==null){t=new Y}this.m_shape.ComputeMass(t,this.m_density);return t};it.prototype.SetDensity=function(t){if(t===undefined)t=0;this.m_density=t};it.prototype.GetDensity=function(){return this.m_density};it.prototype.GetFriction=function(){return this.m_friction};it.prototype.SetFriction=function(t){if(t===undefined)t=0;this.m_friction=t};it.prototype.GetRestitution=function(){return this.m_restitution};it.prototype.SetRestitution=function(t){if(t===undefined)t=0;this.m_restitution=t};it.prototype.GetAABB=function(){return this.m_aabb};it.prototype.b2Fixture=function(){this.m_aabb=new p;this.m_userData=null;this.m_body=null;this.m_next=null;this.m_shape=null;this.m_density=0;this.m_friction=0;this.m_restitution=0};it.prototype.Create=function(t,e,i){this.m_userData=i.userData;this.m_friction=i.friction;this.m_restitution=i.restitution;this.m_body=t;this.m_next=null;this.m_filter=i.filter.Copy();this.m_isSensor=i.isSensor;this.m_shape=i.shape.Copy();this.m_density=i.density};it.prototype.Destroy=function(){this.m_shape=null};it.prototype.CreateProxy=function(t,e){this.m_shape.ComputeAABB(this.m_aabb,e);this.m_proxy=t.CreateProxy(this.m_aabb,this)};it.prototype.DestroyProxy=function(t){if(this.m_proxy==null){return}t.DestroyProxy(this.m_proxy);this.m_proxy=null};it.prototype.Synchronize=function(t,e,i){if(!this.m_proxy)return;var r=new p;var o=new p;this.m_shape.ComputeAABB(r,e);this.m_shape.ComputeAABB(o,i);this.m_aabb.Combine(r,o);var a=n.SubtractVV(i.position,e.position);t.MoveProxy(this.m_proxy,this.m_aabb,a)};nt.b2FixtureDef=function(){this.filter=new et};nt.prototype.b2FixtureDef=function(){this.shape=null;this.userData=null;this.friction=.2;this.restitution=0;this.density=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=false};rt.b2Island=function(){};rt.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};rt.prototype.Initialize=function(t,e,i,n,r,o){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;var a=0;this.m_bodyCapacity=t;this.m_contactCapacity=e;this.m_jointCapacity=i;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_allocator=n;this.m_listener=r;this.m_contactSolver=o;for(a=this.m_bodies.length;a<t;a++)this.m_bodies[a]=null;for(a=this.m_contacts.length;a<e;a++)this.m_contacts[a]=null;for(a=this.m_joints.length;a<i;a++)this.m_joints[a]=null};rt.prototype.Clear=function(){this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0};rt.prototype.Solve=function(t,e,i){var r=0;var o=0;var a;var s;for(r=0;r<this.m_bodyCount;++r){a=this.m_bodies[r];if(a.GetType()!=z.b2_dynamicBody)continue;a.m_linearVelocity.x+=t.dt*(e.x+a.m_invMass*a.m_force.x);a.m_linearVelocity.y+=t.dt*(e.y+a.m_invMass*a.m_force.y);a.m_angularVelocity+=t.dt*a.m_invI*a.m_torque;a.m_linearVelocity.Multiply(n.Clamp(1-t.dt*a.m_linearDamping,0,1));a.m_angularVelocity*=n.Clamp(1-t.dt*a.m_angularDamping,0,1)}this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var l=this.m_contactSolver;l.InitVelocityConstraints(t);for(r=0;r<this.m_jointCount;++r){s=this.m_joints[r];s.InitVelocityConstraints(t)}for(r=0;r<t.velocityIterations;++r){for(o=0;o<this.m_jointCount;++o){s=this.m_joints[o];s.SolveVelocityConstraints(t)}l.SolveVelocityConstraints()}for(r=0;r<this.m_jointCount;++r){s=this.m_joints[r];s.FinalizeVelocityConstraints()}l.FinalizeVelocityConstraints();for(r=0;r<this.m_bodyCount;++r){a=this.m_bodies[r];if(a.GetType()==z.b2_staticBody)continue;var h=t.dt*a.m_linearVelocity.x;var p=t.dt*a.m_linearVelocity.y;if(h*h+p*p>u.b2_maxTranslationSquared){a.m_linearVelocity.Normalize();a.m_linearVelocity.x*=u.b2_maxTranslation*t.inv_dt;a.m_linearVelocity.y*=u.b2_maxTranslation*t.inv_dt}var c=t.dt*a.m_angularVelocity;if(c*c>u.b2_maxRotationSquared){if(a.m_angularVelocity<0){a.m_angularVelocity=-u.b2_maxRotation*t.inv_dt}else{a.m_angularVelocity=u.b2_maxRotation*t.inv_dt}}a.m_sweep.c0.SetV(a.m_sweep.c);a.m_sweep.a0=a.m_sweep.a;a.m_sweep.c.x+=t.dt*a.m_linearVelocity.x;a.m_sweep.c.y+=t.dt*a.m_linearVelocity.y;a.m_sweep.a+=t.dt*a.m_angularVelocity;a.SynchronizeTransform()}for(r=0;r<t.positionIterations;++r){var f=l.SolvePositionConstraints(u.b2_contactBaumgarte);var m=true;for(o=0;o<this.m_jointCount;++o){s=this.m_joints[o];var d=s.SolvePositionConstraints(u.b2_contactBaumgarte);m=m&&d}if(f&&m){break}}this.Report(l.m_constraints);if(i){var y=Number.MAX_VALUE;var g=u.b2_linearSleepTolerance*u.b2_linearSleepTolerance;var v=u.b2_angularSleepTolerance*u.b2_angularSleepTolerance;for(r=0;r<this.m_bodyCount;++r){a=this.m_bodies[r];if(a.GetType()==z.b2_staticBody){continue}if((a.m_flags&z.e_allowSleepFlag)==0){a.m_sleepTime=0;y=0}if((a.m_flags&z.e_allowSleepFlag)==0||a.m_angularVelocity*a.m_angularVelocity>v||n.Dot(a.m_linearVelocity,a.m_linearVelocity)>g){a.m_sleepTime=0;y=0}else{a.m_sleepTime+=t.dt;y=n.Min(y,a.m_sleepTime)}}if(y>=u.b2_timeToSleep){for(r=0;r<this.m_bodyCount;++r){a=this.m_bodies[r];a.SetAwake(false)}}}};rt.prototype.SolveTOI=function(t){var e=0;var i=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var n=this.m_contactSolver;for(e=0;e<this.m_jointCount;++e){this.m_joints[e].InitVelocityConstraints(t)}for(e=0;e<t.velocityIterations;++e){n.SolveVelocityConstraints();for(i=0;i<this.m_jointCount;++i){this.m_joints[i].SolveVelocityConstraints(t)}}for(e=0;e<this.m_bodyCount;++e){var r=this.m_bodies[e];if(r.GetType()==z.b2_staticBody)continue;var o=t.dt*r.m_linearVelocity.x;var a=t.dt*r.m_linearVelocity.y;if(o*o+a*a>u.b2_maxTranslationSquared){r.m_linearVelocity.Normalize();r.m_linearVelocity.x*=u.b2_maxTranslation*t.inv_dt;r.m_linearVelocity.y*=u.b2_maxTranslation*t.inv_dt}var s=t.dt*r.m_angularVelocity;if(s*s>u.b2_maxRotationSquared){if(r.m_angularVelocity<0){r.m_angularVelocity=-u.b2_maxRotation*t.inv_dt}else{r.m_angularVelocity=u.b2_maxRotation*t.inv_dt}}r.m_sweep.c0.SetV(r.m_sweep.c);r.m_sweep.a0=r.m_sweep.a;r.m_sweep.c.x+=t.dt*r.m_linearVelocity.x;r.m_sweep.c.y+=t.dt*r.m_linearVelocity.y;r.m_sweep.a+=t.dt*r.m_angularVelocity;r.SynchronizeTransform()}var l=.75;for(e=0;e<t.positionIterations;++e){var h=n.SolvePositionConstraints(l);var p=true;for(i=0;i<this.m_jointCount;++i){var c=this.m_joints[i].SolvePositionConstraints(u.b2_contactBaumgarte);p=p&&c}if(h&&p){break}}this.Report(n.m_constraints)};rt.prototype.Report=function(t){if(this.m_listener==null){return}for(var e=0;e<this.m_contactCount;++e){var i=this.m_contacts[e];var n=t[e];for(var r=0;r<n.pointCount;++r){rt.s_impulse.normalImpulses[r]=n.points[r].normalImpulse;rt.s_impulse.tangentImpulses[r]=n.points[r].tangentImpulse}this.m_listener.PostSolve(i,rt.s_impulse)}};rt.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=t};rt.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t};rt.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new q});ot.b2TimeStep=function(){};ot.prototype.Set=function(t){this.dt=t.dt;this.inv_dt=t.inv_dt;this.positionIterations=t.positionIterations;this.velocityIterations=t.velocityIterations;this.warmStarting=t.warmStarting};at.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new Q;this.m_contactSolver=new dt;this.m_island=new rt};at.prototype.b2World=function(t,e){this.m_destructionListener=null;this.m_debugDraw=null;this.m_bodyList=null;this.m_contactList=null;this.m_jointList=null;this.m_controllerList=null;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_controllerCount=0;at.m_warmStarting=true;at.m_continuousPhysics=true;this.m_allowSleep=e;t.y=t.y;this.m_gravity=t;this.m_inv_dt0=0;this.m_contactManager.m_world=this;var i=new K;this.m_groundBody=this.CreateBody(i)};at.prototype.SetDestructionListener=function(t){this.m_destructionListener=t};at.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t};at.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t};at.prototype.SetDebugDraw=function(t){this.m_debugDraw=t};at.prototype.SetBroadPhase=function(t){var e=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var i=this.m_bodyList;i;i=i.m_next){for(var n=i.m_fixtureList;n;n=n.m_next){n.m_proxy=t.CreateProxy(e.GetFatAABB(n.m_proxy),n)}}};at.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};at.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};at.prototype.CreateBody=function(t){if(this.IsLocked()==true){return null}var e=new z(t,this);e.m_prev=null;e.m_next=this.m_bodyList;if(this.m_bodyList){this.m_bodyList.m_prev=e}this.m_bodyList=e;++this.m_bodyCount;return e};at.prototype.DestroyBody=function(t){if(this.IsLocked()==true){return}var e=t.m_jointList;while(e){var i=e;e=e.next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeJoint(i.joint)}this.DestroyJoint(i.joint)}var n=t.m_controllerList;while(n){var r=n;n=n.nextController;r.controller.RemoveBody(t)}var o=t.m_contactList;while(o){var a=o;o=o.next;this.m_contactManager.Destroy(a.contact)}t.m_contactList=null;var s=t.m_fixtureList;while(s){var l=s;s=s.m_next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeFixture(l)}l.DestroyProxy(this.m_contactManager.m_broadPhase);l.Destroy()}t.m_fixtureList=null;t.m_fixtureCount=0;if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_bodyList){this.m_bodyList=t.m_next}--this.m_bodyCount};at.prototype.CreateJoint=function(t){var e=Ut.Create(t,null);e.m_prev=null;e.m_next=this.m_jointList;if(this.m_jointList){this.m_jointList.m_prev=e}this.m_jointList=e;++this.m_jointCount;e.m_edgeA.joint=e;e.m_edgeA.other=e.m_bodyB;e.m_edgeA.prev=null;e.m_edgeA.next=e.m_bodyA.m_jointList;if(e.m_bodyA.m_jointList)e.m_bodyA.m_jointList.prev=e.m_edgeA;e.m_bodyA.m_jointList=e.m_edgeA;e.m_edgeB.joint=e;e.m_edgeB.other=e.m_bodyA;e.m_edgeB.prev=null;e.m_edgeB.next=e.m_bodyB.m_jointList;if(e.m_bodyB.m_jointList)e.m_bodyB.m_jointList.prev=e.m_edgeB;e.m_bodyB.m_jointList=e.m_edgeB;var i=t.bodyA;var n=t.bodyB;if(t.collideConnected==false){var r=n.GetContactList();while(r){if(r.other==i){r.contact.FlagForFiltering()}r=r.next}}return e};at.prototype.DestroyJoint=function(t){var e=t.m_collideConnected;if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_jointList){this.m_jointList=t.m_next}var i=t.m_bodyA;var n=t.m_bodyB;i.SetAwake(true);n.SetAwake(true);if(t.m_edgeA.prev){t.m_edgeA.prev.next=t.m_edgeA.next}if(t.m_edgeA.next){t.m_edgeA.next.prev=t.m_edgeA.prev}if(t.m_edgeA==i.m_jointList){i.m_jointList=t.m_edgeA.next}t.m_edgeA.prev=null;t.m_edgeA.next=null;if(t.m_edgeB.prev){t.m_edgeB.prev.next=t.m_edgeB.next}if(t.m_edgeB.next){t.m_edgeB.next.prev=t.m_edgeB.prev}if(t.m_edgeB==n.m_jointList){n.m_jointList=t.m_edgeB.next}t.m_edgeB.prev=null;t.m_edgeB.next=null;Ut.Destroy(t,null);--this.m_jointCount;if(e==false){var r=n.GetContactList();while(r){if(r.other==i){r.contact.FlagForFiltering()}r=r.next}}};at.prototype.AddController=function(t){t.m_next=this.m_controllerList;t.m_prev=null;this.m_controllerList=t;t.m_world=this;this.m_controllerCount++;return t};at.prototype.RemoveController=function(t){if(t.m_prev)t.m_prev.m_next=t.m_next;if(t.m_next)t.m_next.m_prev=t.m_prev;if(this.m_controllerList==t)this.m_controllerList=t.m_next;this.m_controllerCount--};at.prototype.CreateController=function(t){if(t.m_world!=this)throw new Error("Controller can only be a member of one world");t.m_next=this.m_controllerList;t.m_prev=null;if(this.m_controllerList)this.m_controllerList.m_prev=t;this.m_controllerList=t;++this.m_controllerCount;t.m_world=this;return t};at.prototype.DestroyController=function(t){t.Clear();if(t.m_next)t.m_next.m_prev=t.m_prev;if(t.m_prev)t.m_prev.m_next=t.m_next;if(t==this.m_controllerList)this.m_controllerList=t.m_next;--this.m_controllerCount};at.prototype.SetWarmStarting=function(t){at.m_warmStarting=t};at.prototype.SetContinuousPhysics=function(t){at.m_continuousPhysics=t};at.prototype.GetBodyCount=function(){return this.m_bodyCount};at.prototype.GetJointCount=function(){return this.m_jointCount};at.prototype.GetContactCount=function(){return this.m_contactCount};at.prototype.SetGravity=function(t){this.m_gravity=t};at.prototype.GetGravity=function(){return this.m_gravity};at.prototype.GetGroundBody=function(){return this.m_groundBody};at.prototype.Step=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;if(this.m_flags&at.e_newFixture){this.m_contactManager.FindNewContacts();this.m_flags&=~at.e_newFixture}this.m_flags|=at.e_locked;var n=at.s_timestep2;n.dt=t;n.velocityIterations=e;n.positionIterations=i;if(t>0){n.inv_dt=1/t}else{n.inv_dt=0}n.dtRatio=this.m_inv_dt0*t;n.warmStarting=at.m_warmStarting;this.m_contactManager.Collide();if(n.dt>0){this.Solve(n)}if(at.m_continuousPhysics&&n.dt>0){this.SolveTOI(n)}if(n.dt>0){this.m_inv_dt0=n.inv_dt}this.m_flags&=~at.e_locked};at.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next){t.m_force.SetZero();t.m_torque=0}};at.prototype.DrawDebugData=function(){if(this.m_debugDraw==null){return}this.m_debugDraw.m_sprite.graphics.clear();var t=this.m_debugDraw.GetFlags();var e=0;var i;var n;var r;var o;var s;var h=new a;var u=new a;var c=new a;var f;var m=new p;var d=new p;var y=[new a,new a,new a,new a];var g=new l(0,0,0);if(t&$.e_shapeBit){for(i=this.m_bodyList;i;i=i.m_next){f=i.m_xf;for(n=i.GetFixtureList();n;n=n.m_next){r=n.GetShape();if(i.IsActive()==false){g.Set(.5,.5,.3);this.DrawShape(r,f,g)}else if(i.GetType()==z.b2_staticBody){g.Set(.5,.9,.5);this.DrawShape(r,f,g)}else if(i.GetType()==z.b2_kinematicBody){g.Set(.5,.5,.9);this.DrawShape(r,f,g)}else if(i.IsAwake()==false){g.Set(.6,.6,.6);this.DrawShape(r,f,g)}else{g.Set(.9,.7,.7);this.DrawShape(r,f,g)}}}}if(t&$.e_jointBit){for(o=this.m_jointList;o;o=o.m_next){this.DrawJoint(o)}}if(t&$.e_controllerBit){for(var v=this.m_controllerList;v;v=v.m_next){v.Draw(this.m_debugDraw)}}if(t&$.e_pairBit){g.Set(.3,.9,.9);for(var _=this.m_contactManager.m_contactList;_;_=_.GetNext()){var I=_.GetFixtureA();var w=_.GetFixtureB();var x=I.GetAABB().GetCenter();var S=w.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(x,S,g)}}if(t&$.e_aabbBit){s=this.m_contactManager.m_broadPhase;y=[new a,new a,new a,new a];for(i=this.m_bodyList;i;i=i.GetNext()){if(i.IsActive()==false){continue}for(n=i.GetFixtureList();n;n=n.GetNext()){var T=s.GetFatAABB(n.m_proxy);y[0].Set(T.lowerBound.x,T.lowerBound.y);y[1].Set(T.upperBound.x,T.lowerBound.y);y[2].Set(T.upperBound.x,T.upperBound.y);y[3].Set(T.lowerBound.x,T.upperBound.y);this.m_debugDraw.DrawPolygon(y,4,g)}}}if(t&$.e_centerOfMassBit){for(i=this.m_bodyList;i;i=i.m_next){f=at.s_xf;f.R=i.m_xf.R;f.position=i.GetWorldCenter();this.m_debugDraw.DrawTransform(f)}}};at.prototype.QueryAABB=function(t,e){var i=this;var n=i.m_contactManager.m_broadPhase;function r(e){return t(n.GetUserData(e))}n.Query(r,e)};at.prototype.QueryShape=function(t,e,i){var n=this;if(i===undefined)i=null;if(i==null){i=new o;i.SetIdentity()}var r=n.m_contactManager.m_broadPhase;function a(n){var o=r.GetUserData(n)instanceof it?r.GetUserData(n):null;if(X.TestOverlap(e,i,o.GetShape(),o.GetBody().GetTransform()))return t(o);return true}var s=new p;e.ComputeAABB(s,i);r.Query(a,s)};at.prototype.QueryPoint=function(t,e){var i=this;var n=i.m_contactManager.m_broadPhase;function r(i){var r=n.GetUserData(i)instanceof it?n.GetUserData(i):null;if(r.TestPoint(e))return t(r);return true}var o=new p;o.lowerBound.Set(e.x-u.b2_linearSlop,e.y-u.b2_linearSlop);o.upperBound.Set(e.x+u.b2_linearSlop,e.y+u.b2_linearSlop);n.Query(r,o)};at.prototype.RayCast=function(t,e,i){var n=this;var r=n.m_contactManager.m_broadPhase;var o=new A;function s(n,s){var l=r.GetUserData(s);var h=l instanceof it?l:null;var u=h.RayCast(o,n);if(u){var p=o.fraction;var c=new a((1-p)*e.x+p*i.x,(1-p)*e.y+p*i.y);return t(h,c,o.normal,p)}return n.maxFraction}var l=new E(e,i);r.RayCast(s,l)};at.prototype.RayCastOne=function(t,e){var i=this;var n;function r(t,e,i,r){if(r===undefined)r=0;n=t;return r}i.RayCast(r,t,e);return n};at.prototype.RayCastAll=function(t,e){var i=this;var n=new Vector;function r(t,e,i,r){if(r===undefined)r=0;n[n.length]=t;return 1}i.RayCast(r,t,e);return n};at.prototype.GetBodyList=function(){return this.m_bodyList};at.prototype.GetJointList=function(){return this.m_jointList};at.prototype.GetContactList=function(){return this.m_contactList};at.prototype.IsLocked=function(){return(this.m_flags&at.e_locked)>0};at.prototype.Solve=function(t){var e;for(var i=this.m_controllerList;i;i=i.m_next){i.Step(t)}var n=this.m_island;n.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(e=this.m_bodyList;e;e=e.m_next){e.m_flags&=~z.e_islandFlag}for(var r=this.m_contactList;r;r=r.m_next){r.m_flags&=~lt.e_islandFlag}for(var o=this.m_jointList;o;o=o.m_next){o.m_islandFlag=false}var a=parseInt(this.m_bodyCount);var s=this.s_stack;for(var l=this.m_bodyList;l;l=l.m_next){if(l.m_flags&z.e_islandFlag){continue}if(l.IsAwake()==false||l.IsActive()==false){continue}if(l.GetType()==z.b2_staticBody){continue}n.Clear();var h=0;s[h++]=l;l.m_flags|=z.e_islandFlag;while(h>0){e=s[--h];n.AddBody(e);if(e.IsAwake()==false){e.SetAwake(true)}if(e.GetType()==z.b2_staticBody){continue}var u;for(var p=e.m_contactList;p;p=p.next){if(p.contact.m_flags&lt.e_islandFlag){continue}if(p.contact.IsSensor()==true||p.contact.IsEnabled()==false||p.contact.IsTouching()==false){continue}n.AddContact(p.contact);p.contact.m_flags|=lt.e_islandFlag;u=p.other;if(u.m_flags&z.e_islandFlag){continue}s[h++]=u;u.m_flags|=z.e_islandFlag}for(var c=e.m_jointList;c;c=c.next){if(c.joint.m_islandFlag==true){continue}u=c.other;if(u.IsActive()==false){continue}n.AddJoint(c.joint);c.joint.m_islandFlag=true;if(u.m_flags&z.e_islandFlag){continue}s[h++]=u;u.m_flags|=z.e_islandFlag}}n.Solve(t,this.m_gravity,this.m_allowSleep);for(var f=0;f<n.m_bodyCount;++f){e=n.m_bodies[f];if(e.GetType()==z.b2_staticBody){e.m_flags&=~z.e_islandFlag}}}for(f=0;f<s.length;++f){if(!s[f])break;s[f]=null}for(e=this.m_bodyList;e;e=e.m_next){if(e.IsAwake()==false||e.IsActive()==false){continue}if(e.GetType()==z.b2_staticBody){continue}e.SynchronizeFixtures()}this.m_contactManager.FindNewContacts()};at.prototype.SolveTOI=function(t){var e;var i;var n;var r;var o;var a;var s;var l=this.m_island;l.Initialize(this.m_bodyCount,u.b2_maxTOIContactsPerIsland,u.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var h=at.s_queue;for(e=this.m_bodyList;e;e=e.m_next){e.m_flags&=~z.e_islandFlag;e.m_sweep.t0=0}var p;for(p=this.m_contactList;p;p=p.m_next){p.m_flags&=~(lt.e_toiFlag|lt.e_islandFlag)}for(s=this.m_jointList;s;s=s.m_next){s.m_islandFlag=false}for(;;){var c=null;var f=1;for(p=this.m_contactList;p;p=p.m_next){if(p.IsSensor()==true||p.IsEnabled()==false||p.IsContinuous()==false){continue}var m=1;if(p.m_flags&lt.e_toiFlag){m=p.m_toi}else{i=p.m_fixtureA;n=p.m_fixtureB;r=i.m_body;o=n.m_body;if((r.GetType()!=z.b2_dynamicBody||r.IsAwake()==false)&&(o.GetType()!=z.b2_dynamicBody||o.IsAwake()==false)){continue}var d=r.m_sweep.t0;if(r.m_sweep.t0<o.m_sweep.t0){d=o.m_sweep.t0;r.m_sweep.Advance(d)}else if(o.m_sweep.t0<r.m_sweep.t0){d=r.m_sweep.t0;o.m_sweep.Advance(d)}m=p.ComputeTOI(r.m_sweep,o.m_sweep);u.b2Assert(0<=m&&m<=1);if(m>0&&m<1){m=(1-m)*d+m;if(m>1)m=1}p.m_toi=m;p.m_flags|=lt.e_toiFlag}if(Box2D.MIN_VALUE<m&&m<f){c=p;f=m}}if(c==null||1-100*Box2D.MIN_VALUE<f){break}i=c.m_fixtureA;n=c.m_fixtureB;r=i.m_body;o=n.m_body;at.s_backupA.Set(r.m_sweep);at.s_backupB.Set(o.m_sweep);r.Advance(f);o.Advance(f);c.Update(this.m_contactManager.m_contactListener);c.m_flags&=~lt.e_toiFlag;if(c.IsSensor()==true||c.IsEnabled()==false){r.m_sweep.Set(at.s_backupA);o.m_sweep.Set(at.s_backupB);r.SynchronizeTransform();o.SynchronizeTransform();continue}if(c.IsTouching()==false){continue}var y=r;if(y.GetType()!=z.b2_dynamicBody){y=o}l.Clear();var g=0;var v=0;h[g+v++]=y;y.m_flags|=z.e_islandFlag;while(v>0){e=h[g++];--v;l.AddBody(e);if(e.IsAwake()==false){e.SetAwake(true)}if(e.GetType()!=z.b2_dynamicBody){continue}for(a=e.m_contactList;a;a=a.next){if(l.m_contactCount==l.m_contactCapacity){break}if(a.contact.m_flags&lt.e_islandFlag){continue}if(a.contact.IsSensor()==true||a.contact.IsEnabled()==false||a.contact.IsTouching()==false){continue}l.AddContact(a.contact);a.contact.m_flags|=lt.e_islandFlag;var _=a.other;if(_.m_flags&z.e_islandFlag){
continue}if(_.GetType()!=z.b2_staticBody){_.Advance(f);_.SetAwake(true)}h[g+v]=_;++v;_.m_flags|=z.e_islandFlag}for(var I=e.m_jointList;I;I=I.next){if(l.m_jointCount==l.m_jointCapacity)continue;if(I.joint.m_islandFlag==true)continue;_=I.other;if(_.IsActive()==false){continue}l.AddJoint(I.joint);I.joint.m_islandFlag=true;if(_.m_flags&z.e_islandFlag)continue;if(_.GetType()!=z.b2_staticBody){_.Advance(f);_.SetAwake(true)}h[g+v]=_;++v;_.m_flags|=z.e_islandFlag}}var w=at.s_timestep;w.warmStarting=false;w.dt=(1-f)*t.dt;w.inv_dt=1/w.dt;w.dtRatio=0;w.velocityIterations=t.velocityIterations;w.positionIterations=t.positionIterations;l.SolveTOI(w);var x=0;for(x=0;x<l.m_bodyCount;++x){e=l.m_bodies[x];e.m_flags&=~z.e_islandFlag;if(e.IsAwake()==false){continue}if(e.GetType()!=z.b2_dynamicBody){continue}e.SynchronizeFixtures();for(a=e.m_contactList;a;a=a.next){a.contact.m_flags&=~lt.e_toiFlag}}for(x=0;x<l.m_contactCount;++x){p=l.m_contacts[x];p.m_flags&=~(lt.e_toiFlag|lt.e_islandFlag)}for(x=0;x<l.m_jointCount;++x){s=l.m_joints[x];s.m_islandFlag=false}this.m_contactManager.FindNewContacts()}};at.prototype.DrawJoint=function(t){var e=t.GetBodyA();var i=t.GetBodyB();var n=e.m_xf;var r=i.m_xf;var o=n.position;var a=r.position;var s=t.GetAnchorA();var l=t.GetAnchorB();var h=at.s_jointColor;switch(t.m_type){case Ut.e_distanceJoint:this.m_debugDraw.DrawSegment(s,l,h);break;case Ut.e_pulleyJoint:{var u=t instanceof kt?t:null;var p=u.GetGroundAnchorA();var c=u.GetGroundAnchorB();this.m_debugDraw.DrawSegment(p,s,h);this.m_debugDraw.DrawSegment(c,l,h);this.m_debugDraw.DrawSegment(p,c,h)}break;case Ut.e_mouseJoint:this.m_debugDraw.DrawSegment(s,l,h);break;default:if(e!=this.m_groundBody)this.m_debugDraw.DrawSegment(o,s,h);this.m_debugDraw.DrawSegment(s,l,h);if(i!=this.m_groundBody)this.m_debugDraw.DrawSegment(a,l,h)}};at.prototype.DrawShape=function(t,e,i){switch(t.m_type){case X.e_circleShape:{var r=t instanceof N?t:null;var o=n.MulX(e,r.m_p);var a=r.m_radius;var s=e.R.col1;this.m_debugDraw.DrawSolidCircle(o,a,s,i)}break;case X.e_polygonShape:{var l=0;var h=t instanceof J?t:null;var u=parseInt(h.GetVertexCount());var p=h.GetVertices();var c=new Vector(u);for(l=0;l<u;++l){c[l]=n.MulX(e,p[l])}this.m_debugDraw.DrawSolidPolygon(c,u,i)}break;case X.e_edgeShape:{var f=t instanceof H?t:null;this.m_debugDraw.DrawSegment(n.MulX(e,f.GetVertex1()),n.MulX(e,f.GetVertex2()),i)}break}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new ot;Box2D.Dynamics.b2World.s_xf=new o;Box2D.Dynamics.b2World.s_backupA=new r;Box2D.Dynamics.b2World.s_backupB=new r;Box2D.Dynamics.b2World.s_timestep=new ot;Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new l(.5,.8,.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})})();(function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2EdgeChainDef,i=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2MassData,r=Box2D.Collision.Shapes.b2PolygonShape,o=Box2D.Collision.Shapes.b2Shape,a=Box2D.Dynamics.Contacts.b2CircleContact,s=Box2D.Dynamics.Contacts.b2Contact,l=Box2D.Dynamics.Contacts.b2ContactConstraint,h=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,u=Box2D.Dynamics.Contacts.b2ContactEdge,p=Box2D.Dynamics.Contacts.b2ContactFactory,c=Box2D.Dynamics.Contacts.b2ContactRegister,f=Box2D.Dynamics.Contacts.b2ContactResult,m=Box2D.Dynamics.Contacts.b2ContactSolver,d=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,y=Box2D.Dynamics.Contacts.b2NullContact,g=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,v=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,_=Box2D.Dynamics.Contacts.b2PolygonContact,I=Box2D.Dynamics.Contacts.b2PositionSolverManifold,w=Box2D.Dynamics.b2Body,x=Box2D.Dynamics.b2BodyDef,S=Box2D.Dynamics.b2ContactFilter,T=Box2D.Dynamics.b2ContactImpulse,C=Box2D.Dynamics.b2ContactListener,b=Box2D.Dynamics.b2ContactManager,D=Box2D.Dynamics.b2DebugDraw,E=Box2D.Dynamics.b2DestructionListener,A=Box2D.Dynamics.b2FilterData,U=Box2D.Dynamics.b2Fixture,M=Box2D.Dynamics.b2FixtureDef,P=Box2D.Dynamics.b2Island,B=Box2D.Dynamics.b2TimeStep,L=Box2D.Dynamics.b2World,R=Box2D.Common.b2Color,O=Box2D.Common.b2internal,V=Box2D.Common.b2Settings,W=Box2D.Common.Math.b2Mat22,k=Box2D.Common.Math.b2Mat33,F=Box2D.Common.Math.b2Math,N=Box2D.Common.Math.b2Sweep,G=Box2D.Common.Math.b2Transform,H=Box2D.Common.Math.b2Vec2,Y=Box2D.Common.Math.b2Vec3,J=Box2D.Collision.b2AABB,X=Box2D.Collision.b2Bound,z=Box2D.Collision.b2BoundValues,K=Box2D.Collision.b2Collision,j=Box2D.Collision.b2ContactID,q=Box2D.Collision.b2ContactPoint,Z=Box2D.Collision.b2Distance,Q=Box2D.Collision.b2DistanceInput,$=Box2D.Collision.b2DistanceOutput,tt=Box2D.Collision.b2DistanceProxy,et=Box2D.Collision.b2DynamicTree,it=Box2D.Collision.b2DynamicTreeBroadPhase,nt=Box2D.Collision.b2DynamicTreeNode,rt=Box2D.Collision.b2DynamicTreePair,ot=Box2D.Collision.b2Manifold,at=Box2D.Collision.b2ManifoldPoint,st=Box2D.Collision.b2Point,lt=Box2D.Collision.b2RayCastInput,ht=Box2D.Collision.b2RayCastOutput,ut=Box2D.Collision.b2Segment,pt=Box2D.Collision.b2SeparationFunction,ct=Box2D.Collision.b2Simplex,ft=Box2D.Collision.b2SimplexCache,mt=Box2D.Collision.b2SimplexVertex,dt=Box2D.Collision.b2TimeOfImpact,yt=Box2D.Collision.b2TOIInput,gt=Box2D.Collision.b2WorldManifold,vt=Box2D.Collision.ClipVertex,_t=Box2D.Collision.Features,It=Box2D.Collision.IBroadPhase;Box2D.inherit(a,Box2D.Dynamics.Contacts.b2Contact);a.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;a.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};a.Create=function(t){return new a};a.Destroy=function(t,e){};a.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)};a.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody();var i=this.m_fixtureB.GetBody();K.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)};s.b2Contact=function(){this.m_nodeA=new u;this.m_nodeB=new u;this.m_manifold=new ot;this.m_oldManifold=new ot};s.prototype.GetManifold=function(){return this.m_manifold};s.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody();var i=this.m_fixtureB.GetBody();var n=this.m_fixtureA.GetShape();var r=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),n.m_radius,i.GetTransform(),r.m_radius)};s.prototype.IsTouching=function(){return(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag};s.prototype.IsContinuous=function(){return(this.m_flags&s.e_continuousFlag)==s.e_continuousFlag};s.prototype.SetSensor=function(t){if(t){this.m_flags|=s.e_sensorFlag}else{this.m_flags&=~s.e_sensorFlag}};s.prototype.IsSensor=function(){return(this.m_flags&s.e_sensorFlag)==s.e_sensorFlag};s.prototype.SetEnabled=function(t){if(t){this.m_flags|=s.e_enabledFlag}else{this.m_flags&=~s.e_enabledFlag}};s.prototype.IsEnabled=function(){return(this.m_flags&s.e_enabledFlag)==s.e_enabledFlag};s.prototype.GetNext=function(){return this.m_next};s.prototype.GetFixtureA=function(){return this.m_fixtureA};s.prototype.GetFixtureB=function(){return this.m_fixtureB};s.prototype.FlagForFiltering=function(){this.m_flags|=s.e_filterFlag};s.prototype.b2Contact=function(){};s.prototype.Reset=function(t,e){if(t===undefined)t=null;if(e===undefined)e=null;this.m_flags=s.e_enabledFlag;if(!t||!e){this.m_fixtureA=null;this.m_fixtureB=null;return}if(t.IsSensor()||e.IsSensor()){this.m_flags|=s.e_sensorFlag}var i=t.GetBody();var n=e.GetBody();if(i.GetType()!=w.b2_dynamicBody||i.IsBullet()||n.GetType()!=w.b2_dynamicBody||n.IsBullet()){this.m_flags|=s.e_continuousFlag}this.m_fixtureA=t;this.m_fixtureB=e;this.m_manifold.m_pointCount=0;this.m_prev=null;this.m_next=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null};s.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=e;this.m_flags|=s.e_enabledFlag;var i=false;var n=(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag;var r=this.m_fixtureA.m_body;var a=this.m_fixtureB.m_body;var l=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&s.e_sensorFlag){if(l){var h=this.m_fixtureA.GetShape();var u=this.m_fixtureB.GetShape();var p=r.GetTransform();var c=a.GetTransform();i=o.TestOverlap(h,p,u,c)}this.m_manifold.m_pointCount=0}else{if(r.GetType()!=w.b2_dynamicBody||r.IsBullet()||a.GetType()!=w.b2_dynamicBody||a.IsBullet()){this.m_flags|=s.e_continuousFlag}else{this.m_flags&=~s.e_continuousFlag}if(l){this.Evaluate();i=this.m_manifold.m_pointCount>0;for(var f=0;f<this.m_manifold.m_pointCount;++f){var m=this.m_manifold.m_points[f];m.m_normalImpulse=0;m.m_tangentImpulse=0;var d=m.m_id;for(var y=0;y<this.m_oldManifold.m_pointCount;++y){var g=this.m_oldManifold.m_points[y];if(g.m_id.key==d.key){m.m_normalImpulse=g.m_normalImpulse;m.m_tangentImpulse=g.m_tangentImpulse;break}}}}else{this.m_manifold.m_pointCount=0}if(i!=n){r.SetAwake(true);a.SetAwake(true)}}if(i){this.m_flags|=s.e_touchingFlag}else{this.m_flags&=~s.e_touchingFlag}if(n==false&&i==true){t.BeginContact(this)}if(n==true&&i==false){t.EndContact(this)}if((this.m_flags&s.e_sensorFlag)==0){t.PreSolve(this,this.m_oldManifold)}};s.prototype.Evaluate=function(){};s.prototype.ComputeTOI=function(t,e){s.s_input.proxyA.Set(this.m_fixtureA.GetShape());s.s_input.proxyB.Set(this.m_fixtureB.GetShape());s.s_input.sweepA=t;s.s_input.sweepB=e;s.s_input.tolerance=V.b2_linearSlop;return dt.TimeOfImpact(s.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64;Box2D.Dynamics.Contacts.b2Contact.s_input=new yt});l.b2ContactConstraint=function(){this.localPlaneNormal=new H;this.localPoint=new H;this.normal=new H;this.normalMass=new W;this.K=new W};l.prototype.b2ContactConstraint=function(){this.points=new Vector(V.b2_maxManifoldPoints);for(var t=0;t<V.b2_maxManifoldPoints;t++){this.points[t]=new h}};h.b2ContactConstraintPoint=function(){this.localPoint=new H;this.rA=new H;this.rB=new H};u.b2ContactEdge=function(){};p.b2ContactFactory=function(){};p.prototype.b2ContactFactory=function(t){this.m_allocator=t;this.InitializeRegisters()};p.prototype.AddType=function(t,e,i,n){if(i===undefined)i=0;if(n===undefined)n=0;this.m_registers[i][n].createFcn=t;this.m_registers[i][n].destroyFcn=e;this.m_registers[i][n].primary=true;if(i!=n){this.m_registers[n][i].createFcn=t;this.m_registers[n][i].destroyFcn=e;this.m_registers[n][i].primary=false}};p.prototype.InitializeRegisters=function(){this.m_registers=new Vector(o.e_shapeTypeCount);for(var t=0;t<o.e_shapeTypeCount;t++){this.m_registers[t]=new Vector(o.e_shapeTypeCount);for(var e=0;e<o.e_shapeTypeCount;e++){this.m_registers[t][e]=new c}}this.AddType(a.Create,a.Destroy,o.e_circleShape,o.e_circleShape);this.AddType(g.Create,g.Destroy,o.e_polygonShape,o.e_circleShape);this.AddType(_.Create,_.Destroy,o.e_polygonShape,o.e_polygonShape);this.AddType(d.Create,d.Destroy,o.e_edgeShape,o.e_circleShape);this.AddType(v.Create,v.Destroy,o.e_polygonShape,o.e_edgeShape)};p.prototype.Create=function(t,e){var i=parseInt(t.GetType());var n=parseInt(e.GetType());var r=this.m_registers[i][n];var o;if(r.pool){o=r.pool;r.pool=o.m_next;r.poolCount--;o.Reset(t,e);return o}var a=r.createFcn;if(a!=null){if(r.primary){o=a(this.m_allocator);o.Reset(t,e);return o}else{o=a(this.m_allocator);o.Reset(e,t);return o}}else{return null}};p.prototype.Destroy=function(t){if(t.m_manifold.m_pointCount>0){t.m_fixtureA.m_body.SetAwake(true);t.m_fixtureB.m_body.SetAwake(true)}var e=parseInt(t.m_fixtureA.GetType());var i=parseInt(t.m_fixtureB.GetType());var n=this.m_registers[e][i];if(true){n.poolCount++;t.m_next=n.pool;n.pool=t}var r=n.destroyFcn;r(t,this.m_allocator)};c.b2ContactRegister=function(){};f.b2ContactResult=function(){this.position=new H;this.normal=new H;this.id=new j};m.b2ContactSolver=function(){this.m_step=new B;this.m_constraints=new Vector};m.prototype.b2ContactSolver=function(){};m.prototype.Initialize=function(t,e,i,n){if(i===undefined)i=0;var r;this.m_step.Set(t);this.m_allocator=n;var o=0;var a;var s;this.m_constraintCount=i;while(this.m_constraints.length<this.m_constraintCount){this.m_constraints[this.m_constraints.length]=new l}for(o=0;o<i;++o){r=e[o];var h=r.m_fixtureA;var u=r.m_fixtureB;var p=h.m_shape;var c=u.m_shape;var f=p.m_radius;var d=c.m_radius;var y=h.m_body;var g=u.m_body;var v=r.GetManifold();var _=V.b2MixFriction(h.GetFriction(),u.GetFriction());var I=V.b2MixRestitution(h.GetRestitution(),u.GetRestitution());var w=y.m_linearVelocity.x;var x=y.m_linearVelocity.y;var S=g.m_linearVelocity.x;var T=g.m_linearVelocity.y;var C=y.m_angularVelocity;var b=g.m_angularVelocity;V.b2Assert(v.m_pointCount>0);m.s_worldManifold.Initialize(v,y.m_xf,f,g.m_xf,d);var D=m.s_worldManifold.m_normal.x;var E=m.s_worldManifold.m_normal.y;var A=this.m_constraints[o];A.bodyA=y;A.bodyB=g;A.manifold=v;A.normal.x=D;A.normal.y=E;A.pointCount=v.m_pointCount;A.friction=_;A.restitution=I;A.localPlaneNormal.x=v.m_localPlaneNormal.x;A.localPlaneNormal.y=v.m_localPlaneNormal.y;A.localPoint.x=v.m_localPoint.x;A.localPoint.y=v.m_localPoint.y;A.radius=f+d;A.type=v.m_type;for(var U=0;U<A.pointCount;++U){var M=v.m_points[U];var P=A.points[U];P.normalImpulse=M.m_normalImpulse;P.tangentImpulse=M.m_tangentImpulse;P.localPoint.SetV(M.m_localPoint);var B=P.rA.x=m.s_worldManifold.m_points[U].x-y.m_sweep.c.x;var L=P.rA.y=m.s_worldManifold.m_points[U].y-y.m_sweep.c.y;var R=P.rB.x=m.s_worldManifold.m_points[U].x-g.m_sweep.c.x;var O=P.rB.y=m.s_worldManifold.m_points[U].y-g.m_sweep.c.y;var W=B*E-L*D;var k=R*E-O*D;W*=W;k*=k;var F=y.m_invMass+g.m_invMass+y.m_invI*W+g.m_invI*k;P.normalMass=1/F;var N=y.m_mass*y.m_invMass+g.m_mass*g.m_invMass;N+=y.m_mass*y.m_invI*W+g.m_mass*g.m_invI*k;P.equalizedMass=1/N;var G=E;var H=-D;var Y=B*H-L*G;var J=R*H-O*G;Y*=Y;J*=J;var X=y.m_invMass+g.m_invMass+y.m_invI*Y+g.m_invI*J;P.tangentMass=1/X;P.velocityBias=0;var z=S+-b*O-w- -C*L;var K=T+b*R-x-C*B;var j=A.normal.x*z+A.normal.y*K;if(j<-V.b2_velocityThreshold){P.velocityBias+=-A.restitution*j}}if(A.pointCount==2){var q=A.points[0];var Z=A.points[1];var Q=y.m_invMass;var $=y.m_invI;var tt=g.m_invMass;var et=g.m_invI;var it=q.rA.x*E-q.rA.y*D;var nt=q.rB.x*E-q.rB.y*D;var rt=Z.rA.x*E-Z.rA.y*D;var ot=Z.rB.x*E-Z.rB.y*D;var at=Q+tt+$*it*it+et*nt*nt;var st=Q+tt+$*rt*rt+et*ot*ot;var lt=Q+tt+$*it*rt+et*nt*ot;var ht=100;if(at*at<ht*(at*st-lt*lt)){A.K.col1.Set(at,lt);A.K.col2.Set(lt,st);A.K.GetInverse(A.normalMass)}else{A.pointCount=1}}}};m.prototype.InitVelocityConstraints=function(t){var e;var i;var n;for(var r=0;r<this.m_constraintCount;++r){var o=this.m_constraints[r];var a=o.bodyA;var s=o.bodyB;var l=a.m_invMass;var h=a.m_invI;var u=s.m_invMass;var p=s.m_invI;var c=o.normal.x;var f=o.normal.y;var m=f;var d=-c;var y=0;var g=0;var v=0;if(t.warmStarting){v=o.pointCount;for(g=0;g<v;++g){var _=o.points[g];_.normalImpulse*=t.dtRatio;_.tangentImpulse*=t.dtRatio;var I=_.normalImpulse*c+_.tangentImpulse*m;var w=_.normalImpulse*f+_.tangentImpulse*d;a.m_angularVelocity-=h*(_.rA.x*w-_.rA.y*I);a.m_linearVelocity.x-=l*I;a.m_linearVelocity.y-=l*w;s.m_angularVelocity+=p*(_.rB.x*w-_.rB.y*I);s.m_linearVelocity.x+=u*I;s.m_linearVelocity.y+=u*w}}else{v=o.pointCount;for(g=0;g<v;++g){var x=o.points[g];x.normalImpulse=0;x.tangentImpulse=0}}}};m.prototype.SolveVelocityConstraints=function(){var t=0;var e;var i=0;var n=0;var r=0;var o=0;var a=0;var s=0;var l=0;var h=0;var u=0;var p=0;var c=0;var f=0;var m=0;var d=0;var y=0;var g=0;var v=0;var _=0;var I=0;var w;var x;for(var S=0;S<this.m_constraintCount;++S){var T=this.m_constraints[S];var C=T.bodyA;var b=T.bodyB;var D=C.m_angularVelocity;var E=b.m_angularVelocity;var A=C.m_linearVelocity;var U=b.m_linearVelocity;var M=C.m_invMass;var P=C.m_invI;var B=b.m_invMass;var L=b.m_invI;var R=T.normal.x;var O=T.normal.y;var V=O;var W=-R;var k=T.friction;var N=0;for(t=0;t<T.pointCount;t++){e=T.points[t];a=U.x-E*e.rB.y-A.x+D*e.rA.y;s=U.y+E*e.rB.x-A.y-D*e.rA.x;h=a*V+s*W;u=e.tangentMass*-h;p=k*e.normalImpulse;c=F.Clamp(e.tangentImpulse+u,-p,p);u=c-e.tangentImpulse;f=u*V;m=u*W;A.x-=M*f;A.y-=M*m;D-=P*(e.rA.x*m-e.rA.y*f);U.x+=B*f;U.y+=B*m;E+=L*(e.rB.x*m-e.rB.y*f);e.tangentImpulse=c}var G=parseInt(T.pointCount);if(T.pointCount==1){e=T.points[0];a=U.x+-E*e.rB.y-A.x- -D*e.rA.y;s=U.y+E*e.rB.x-A.y-D*e.rA.x;l=a*R+s*O;u=-e.normalMass*(l-e.velocityBias);c=e.normalImpulse+u;c=c>0?c:0;u=c-e.normalImpulse;f=u*R;m=u*O;A.x-=M*f;A.y-=M*m;D-=P*(e.rA.x*m-e.rA.y*f);U.x+=B*f;U.y+=B*m;E+=L*(e.rB.x*m-e.rB.y*f);e.normalImpulse=c}else{var H=T.points[0];var Y=T.points[1];var J=H.normalImpulse;var X=Y.normalImpulse;var z=U.x-E*H.rB.y-A.x+D*H.rA.y;var K=U.y+E*H.rB.x-A.y-D*H.rA.x;var j=U.x-E*Y.rB.y-A.x+D*Y.rA.y;var q=U.y+E*Y.rB.x-A.y-D*Y.rA.x;var Z=z*R+K*O;var Q=j*R+q*O;var $=Z-H.velocityBias;var tt=Q-Y.velocityBias;w=T.K;$-=w.col1.x*J+w.col2.x*X;tt-=w.col1.y*J+w.col2.y*X;var et=.001;for(;;){w=T.normalMass;var it=-(w.col1.x*$+w.col2.x*tt);var nt=-(w.col1.y*$+w.col2.y*tt);if(it>=0&&nt>=0){d=it-J;y=nt-X;g=d*R;v=d*O;_=y*R;I=y*O;A.x-=M*(g+_);A.y-=M*(v+I);D-=P*(H.rA.x*v-H.rA.y*g+Y.rA.x*I-Y.rA.y*_);U.x+=B*(g+_);U.y+=B*(v+I);E+=L*(H.rB.x*v-H.rB.y*g+Y.rB.x*I-Y.rB.y*_);H.normalImpulse=it;Y.normalImpulse=nt;break}it=-H.normalMass*$;nt=0;Z=0;Q=T.K.col1.y*it+tt;if(it>=0&&Q>=0){d=it-J;y=nt-X;g=d*R;v=d*O;_=y*R;I=y*O;A.x-=M*(g+_);A.y-=M*(v+I);D-=P*(H.rA.x*v-H.rA.y*g+Y.rA.x*I-Y.rA.y*_);U.x+=B*(g+_);U.y+=B*(v+I);E+=L*(H.rB.x*v-H.rB.y*g+Y.rB.x*I-Y.rB.y*_);H.normalImpulse=it;Y.normalImpulse=nt;break}it=0;nt=-Y.normalMass*tt;Z=T.K.col2.x*nt+$;Q=0;if(nt>=0&&Z>=0){d=it-J;y=nt-X;g=d*R;v=d*O;_=y*R;I=y*O;A.x-=M*(g+_);A.y-=M*(v+I);D-=P*(H.rA.x*v-H.rA.y*g+Y.rA.x*I-Y.rA.y*_);U.x+=B*(g+_);U.y+=B*(v+I);E+=L*(H.rB.x*v-H.rB.y*g+Y.rB.x*I-Y.rB.y*_);H.normalImpulse=it;Y.normalImpulse=nt;break}it=0;nt=0;Z=$;Q=tt;if(Z>=0&&Q>=0){d=it-J;y=nt-X;g=d*R;v=d*O;_=y*R;I=y*O;A.x-=M*(g+_);A.y-=M*(v+I);D-=P*(H.rA.x*v-H.rA.y*g+Y.rA.x*I-Y.rA.y*_);U.x+=B*(g+_);U.y+=B*(v+I);E+=L*(H.rB.x*v-H.rB.y*g+Y.rB.x*I-Y.rB.y*_);H.normalImpulse=it;Y.normalImpulse=nt;break}break}}C.m_angularVelocity=D;b.m_angularVelocity=E}};m.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t){var e=this.m_constraints[t];var i=e.manifold;for(var n=0;n<e.pointCount;++n){var r=i.m_points[n];var o=e.points[n];r.m_normalImpulse=o.normalImpulse;r.m_tangentImpulse=o.tangentImpulse}}};m.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;for(var i=0;i<this.m_constraintCount;i++){var n=this.m_constraints[i];var r=n.bodyA;var o=n.bodyB;var a=r.m_mass*r.m_invMass;var s=r.m_mass*r.m_invI;var l=o.m_mass*o.m_invMass;var h=o.m_mass*o.m_invI;m.s_psm.Initialize(n);var u=m.s_psm.m_normal;for(var p=0;p<n.pointCount;p++){var c=n.points[p];var f=m.s_psm.m_points[p];var d=m.s_psm.m_separations[p];var y=f.x-r.m_sweep.c.x;var g=f.y-r.m_sweep.c.y;var v=f.x-o.m_sweep.c.x;var _=f.y-o.m_sweep.c.y;e=e<d?e:d;var I=F.Clamp(t*(d+V.b2_linearSlop),-V.b2_maxLinearCorrection,0);var w=-c.equalizedMass*I;var x=w*u.x;var S=w*u.y;r.m_sweep.c.x-=a*x;r.m_sweep.c.y-=a*S;r.m_sweep.a-=s*(y*S-g*x);r.SynchronizeTransform();o.m_sweep.c.x+=l*x;o.m_sweep.c.y+=l*S;o.m_sweep.a+=h*(v*S-_*x);o.SynchronizeTransform()}}return e>-1.5*V.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new gt;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new I});Box2D.inherit(d,Box2D.Dynamics.Contacts.b2Contact);d.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;d.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};d.Create=function(t){return new d};d.Destroy=function(t,e){};d.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)};d.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody();var n=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,n.m_xf)};d.prototype.b2CollideEdgeAndCircle=function(t,e,i,n,r){};Box2D.inherit(y,Box2D.Dynamics.Contacts.b2Contact);y.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;y.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};y.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};y.prototype.Evaluate=function(){};Box2D.inherit(g,Box2D.Dynamics.Contacts.b2Contact);g.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;g.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};g.Create=function(t){return new g};g.Destroy=function(t,e){};g.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e);V.b2Assert(t.GetType()==o.e_polygonShape);V.b2Assert(e.GetType()==o.e_circleShape)};g.prototype.Evaluate=function(){var e=this.m_fixtureA.m_body;var i=this.m_fixtureB.m_body;K.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)};Box2D.inherit(v,Box2D.Dynamics.Contacts.b2Contact);v.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;v.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};v.Create=function(t){return new v};v.Destroy=function(t,e){};v.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e);V.b2Assert(t.GetType()==o.e_polygonShape);V.b2Assert(e.GetType()==o.e_edgeShape)};v.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody();var e=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,e.m_xf)};v.prototype.b2CollidePolyAndEdge=function(t,e,i,n,r){};Box2D.inherit(_,Box2D.Dynamics.Contacts.b2Contact);_.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;_.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};_.Create=function(t){return new _};_.Destroy=function(t,e){};_.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)};_.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody();var e=this.m_fixtureB.GetBody();K.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof r?this.m_fixtureB.GetShape():null,e.m_xf)};I.b2PositionSolverManifold=function(){};I.prototype.b2PositionSolverManifold=function(){this.m_normal=new H;this.m_separations=new Vector_a2j_Number(V.b2_maxManifoldPoints);this.m_points=new Vector(V.b2_maxManifoldPoints);for(var t=0;t<V.b2_maxManifoldPoints;t++){this.m_points[t]=new H}};I.prototype.Initialize=function(t){V.b2Assert(t.pointCount>0);var e=0;var i=0;var n=0;var r;var o;var a=0;var s=0;switch(t.type){case ot.e_circles:{r=t.bodyA.m_xf.R;o=t.localPoint;var l=t.bodyA.m_xf.position.x+(r.col1.x*o.x+r.col2.x*o.y);var h=t.bodyA.m_xf.position.y+(r.col1.y*o.x+r.col2.y*o.y);r=t.bodyB.m_xf.R;o=t.points[0].localPoint;var u=t.bodyB.m_xf.position.x+(r.col1.x*o.x+r.col2.x*o.y);var p=t.bodyB.m_xf.position.y+(r.col1.y*o.x+r.col2.y*o.y);var c=u-l;var f=p-h;var m=c*c+f*f;if(m>Box2D.MIN_VALUE*Box2D.MIN_VALUE){var d=Math.sqrt(m);this.m_normal.x=c/d;this.m_normal.y=f/d}else{this.m_normal.x=1;this.m_normal.y=0}this.m_points[0].x=.5*(l+u);this.m_points[0].y=.5*(h+p);this.m_separations[0]=c*this.m_normal.x+f*this.m_normal.y-t.radius}break;case ot.e_faceA:{r=t.bodyA.m_xf.R;o=t.localPlaneNormal;this.m_normal.x=r.col1.x*o.x+r.col2.x*o.y;this.m_normal.y=r.col1.y*o.x+r.col2.y*o.y;r=t.bodyA.m_xf.R;o=t.localPoint;a=t.bodyA.m_xf.position.x+(r.col1.x*o.x+r.col2.x*o.y);s=t.bodyA.m_xf.position.y+(r.col1.y*o.x+r.col2.y*o.y);r=t.bodyB.m_xf.R;for(e=0;e<t.pointCount;++e){o=t.points[e].localPoint;i=t.bodyB.m_xf.position.x+(r.col1.x*o.x+r.col2.x*o.y);n=t.bodyB.m_xf.position.y+(r.col1.y*o.x+r.col2.y*o.y);this.m_separations[e]=(i-a)*this.m_normal.x+(n-s)*this.m_normal.y-t.radius;this.m_points[e].x=i;this.m_points[e].y=n}}break;case ot.e_faceB:{r=t.bodyB.m_xf.R;o=t.localPlaneNormal;this.m_normal.x=r.col1.x*o.x+r.col2.x*o.y;this.m_normal.y=r.col1.y*o.x+r.col2.y*o.y;r=t.bodyB.m_xf.R;o=t.localPoint;a=t.bodyB.m_xf.position.x+(r.col1.x*o.x+r.col2.x*o.y);s=t.bodyB.m_xf.position.y+(r.col1.y*o.x+r.col2.y*o.y);r=t.bodyA.m_xf.R;for(e=0;e<t.pointCount;++e){o=t.points[e].localPoint;i=t.bodyA.m_xf.position.x+(r.col1.x*o.x+r.col2.x*o.y);n=t.bodyA.m_xf.position.y+(r.col1.y*o.x+r.col2.y*o.y);this.m_separations[e]=(i-a)*this.m_normal.x+(n-s)*this.m_normal.y-t.radius;this.m_points[e].Set(i,n)}this.m_normal.x*=-1;this.m_normal.y*=-1}break}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new H;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new H})})();(function(){var t=Box2D.Dynamics.b2Body,e=Box2D.Dynamics.b2BodyDef,i=Box2D.Dynamics.b2ContactFilter,n=Box2D.Dynamics.b2ContactImpulse,r=Box2D.Dynamics.b2ContactListener,o=Box2D.Dynamics.b2ContactManager,a=Box2D.Dynamics.b2DebugDraw,s=Box2D.Dynamics.b2DestructionListener,l=Box2D.Dynamics.b2FilterData,h=Box2D.Dynamics.b2Fixture,u=Box2D.Dynamics.b2FixtureDef,p=Box2D.Dynamics.b2Island,c=Box2D.Dynamics.b2TimeStep,f=Box2D.Dynamics.b2World,m=Box2D.Common.Math.b2Mat22,d=Box2D.Common.Math.b2Mat33,y=Box2D.Common.Math.b2Math,g=Box2D.Common.Math.b2Sweep,v=Box2D.Common.Math.b2Transform,_=Box2D.Common.Math.b2Vec2,I=Box2D.Common.Math.b2Vec3,w=Box2D.Common.b2Color,x=Box2D.Common.b2internal,S=Box2D.Common.b2Settings,T=Box2D.Collision.Shapes.b2CircleShape,C=Box2D.Collision.Shapes.b2EdgeChainDef,b=Box2D.Collision.Shapes.b2EdgeShape,D=Box2D.Collision.Shapes.b2MassData,E=Box2D.Collision.Shapes.b2PolygonShape,A=Box2D.Collision.Shapes.b2Shape,U=Box2D.Dynamics.Controllers.b2BuoyancyController,M=Box2D.Dynamics.Controllers.b2ConstantAccelController,P=Box2D.Dynamics.Controllers.b2ConstantForceController,B=Box2D.Dynamics.Controllers.b2Controller,L=Box2D.Dynamics.Controllers.b2ControllerEdge,R=Box2D.Dynamics.Controllers.b2GravityController,O=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(U,Box2D.Dynamics.Controllers.b2Controller);U.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;U.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new _(0,-1);this.offset=0;this.density=0;this.velocity=new _(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=false;this.useWorldGravity=true;this.gravity=null};U.prototype.Step=function(t){if(!this.m_bodyList)return;if(this.useWorldGravity){this.gravity=this.GetWorld().GetGravity().Copy()}for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(i.IsAwake()==false){continue}var n=new _;var r=new _;var o=0;var a=0;for(var s=i.GetFixtureList();s;s=s.GetNext()){var l=new _;var h=s.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),l);o+=h;n.x+=h*l.x;n.y+=h*l.y;var u=0;if(this.useDensity){u=1}else{u=1}a+=h*u;r.x+=h*l.x*u;r.y+=h*l.y*u}n.x/=o;n.y/=o;r.x/=a;r.y/=a;if(o<Box2D.MIN_VALUE)continue;var p=this.gravity.GetNegative();p.Multiply(this.density*o);i.ApplyForce(p,r);var c=i.GetLinearVelocityFromWorldPoint(n);c.Subtract(this.velocity);c.Multiply(-this.linearDrag*o);i.ApplyForce(c,n);i.ApplyTorque(-i.GetInertia()/i.GetMass()*o*i.GetAngularVelocity()*this.angularDrag)}};U.prototype.Draw=function(t){var e=1e3;var i=new _;var n=new _;i.x=this.normal.x*this.offset+this.normal.y*e;i.y=this.normal.y*this.offset-this.normal.x*e;n.x=this.normal.x*this.offset-this.normal.y*e;n.y=this.normal.y*this.offset+this.normal.x*e;var r=new w(0,0,1);t.DrawSegment(i,n,r)};Box2D.inherit(M,Box2D.Dynamics.Controllers.b2Controller);M.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;M.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new _(0,0)};M.prototype.Step=function(t){var e=new _(this.A.x*t.dt,this.A.y*t.dt);for(var i=this.m_bodyList;i;i=i.nextBody){var n=i.body;if(!n.IsAwake())continue;n.SetLinearVelocity(new _(n.GetLinearVelocity().x+e.x,n.GetLinearVelocity().y+e.y))}};Box2D.inherit(P,Box2D.Dynamics.Controllers.b2Controller);P.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;P.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new _(0,0)};P.prototype.Step=function(t){for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(!i.IsAwake())continue;i.ApplyForce(this.F,i.GetWorldCenter())}};B.b2Controller=function(){};B.prototype.Step=function(t){};B.prototype.Draw=function(t){};B.prototype.AddBody=function(t){var e=new L;e.controller=this;e.body=t;e.nextBody=this.m_bodyList;e.prevBody=null;this.m_bodyList=e;if(e.nextBody)e.nextBody.prevBody=e;this.m_bodyCount++;e.nextController=t.m_controllerList;e.prevController=null;t.m_controllerList=e;if(e.nextController)e.nextController.prevController=e;t.m_controllerCount++};B.prototype.RemoveBody=function(t){var e=t.m_controllerList;while(e&&e.controller!=this)e=e.nextController;if(e.prevBody)e.prevBody.nextBody=e.nextBody;if(e.nextBody)e.nextBody.prevBody=e.prevBody;if(e.nextController)e.nextController.prevController=e.prevController;if(e.prevController)e.prevController.nextController=e.nextController;if(this.m_bodyList==e)this.m_bodyList=e.nextBody;if(t.m_controllerList==e)t.m_controllerList=e.nextController;t.m_controllerCount--;this.m_bodyCount--};B.prototype.Clear=function(){while(this.m_bodyList)this.RemoveBody(this.m_bodyList.body)};B.prototype.GetNext=function(){return this.m_next};B.prototype.GetWorld=function(){return this.m_world};B.prototype.GetBodyList=function(){return this.m_bodyList};L.b2ControllerEdge=function(){};Box2D.inherit(R,Box2D.Dynamics.Controllers.b2Controller);R.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;R.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=true};R.prototype.Step=function(t){var e=null;var i=null;var n=null;var r=0;var o=null;var a=null;var s=null;var l=0;var h=0;var u=0;var p=null;if(this.invSqr){for(e=this.m_bodyList;e;e=e.nextBody){i=e.body;n=i.GetWorldCenter();r=i.GetMass();for(o=this.m_bodyList;o!=e;o=o.nextBody){a=o.body;s=a.GetWorldCenter();l=s.x-n.x;h=s.y-n.y;u=l*l+h*h;if(u<Box2D.MIN_VALUE)continue;p=new _(l,h);p.Multiply(this.G/u/Math.sqrt(u)*r*a.GetMass());if(i.IsAwake())i.ApplyForce(p,n);p.Multiply(-1);if(a.IsAwake())a.ApplyForce(p,s)}}}else{for(e=this.m_bodyList;e;e=e.nextBody){i=e.body;n=i.GetWorldCenter();r=i.GetMass();for(o=this.m_bodyList;o!=e;o=o.nextBody){a=o.body;s=a.GetWorldCenter();l=s.x-n.x;h=s.y-n.y;u=l*l+h*h;if(u<Box2D.MIN_VALUE)continue;p=new _(l,h);p.Multiply(this.G/u*r*a.GetMass());if(i.IsAwake())i.ApplyForce(p,n);p.Multiply(-1);if(a.IsAwake())a.ApplyForce(p,s)}}}};Box2D.inherit(O,Box2D.Dynamics.Controllers.b2Controller);O.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;O.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new m;this.maxTimestep=0};O.prototype.SetAxisAligned=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.T.col1.x=-t;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-e;if(t>0||e>0){this.maxTimestep=1/Math.max(t,e)}else{this.maxTimestep=0}};O.prototype.Step=function(t){var e=t.dt;if(e<=Box2D.MIN_VALUE)return;if(e>this.maxTimestep&&this.maxTimestep>0)e=this.maxTimestep;
for(var i=this.m_bodyList;i;i=i.nextBody){var n=i.body;if(!n.IsAwake()){continue}var r=n.GetWorldVector(y.MulMV(this.T,n.GetLocalVector(n.GetLinearVelocity())));n.SetLinearVelocity(new _(n.GetLinearVelocity().x+r.x*e,n.GetLinearVelocity().y+r.y*e))}}})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Mat22,r=Box2D.Common.Math.b2Mat33,o=Box2D.Common.Math.b2Math,a=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,l=Box2D.Common.Math.b2Vec2,h=Box2D.Common.Math.b2Vec3,u=Box2D.Dynamics.Joints.b2DistanceJoint,p=Box2D.Dynamics.Joints.b2DistanceJointDef,c=Box2D.Dynamics.Joints.b2FrictionJoint,f=Box2D.Dynamics.Joints.b2FrictionJointDef,m=Box2D.Dynamics.Joints.b2GearJoint,d=Box2D.Dynamics.Joints.b2GearJointDef,y=Box2D.Dynamics.Joints.b2Jacobian,g=Box2D.Dynamics.Joints.b2Joint,v=Box2D.Dynamics.Joints.b2JointDef,_=Box2D.Dynamics.Joints.b2JointEdge,I=Box2D.Dynamics.Joints.b2LineJoint,w=Box2D.Dynamics.Joints.b2LineJointDef,x=Box2D.Dynamics.Joints.b2MouseJoint,S=Box2D.Dynamics.Joints.b2MouseJointDef,T=Box2D.Dynamics.Joints.b2PrismaticJoint,C=Box2D.Dynamics.Joints.b2PrismaticJointDef,b=Box2D.Dynamics.Joints.b2PulleyJoint,D=Box2D.Dynamics.Joints.b2PulleyJointDef,E=Box2D.Dynamics.Joints.b2RevoluteJoint,A=Box2D.Dynamics.Joints.b2RevoluteJointDef,U=Box2D.Dynamics.Joints.b2WeldJoint,M=Box2D.Dynamics.Joints.b2WeldJointDef,P=Box2D.Dynamics.b2Body,B=Box2D.Dynamics.b2BodyDef,L=Box2D.Dynamics.b2ContactFilter,R=Box2D.Dynamics.b2ContactImpulse,O=Box2D.Dynamics.b2ContactListener,V=Box2D.Dynamics.b2ContactManager,W=Box2D.Dynamics.b2DebugDraw,k=Box2D.Dynamics.b2DestructionListener,F=Box2D.Dynamics.b2FilterData,N=Box2D.Dynamics.b2Fixture,G=Box2D.Dynamics.b2FixtureDef,H=Box2D.Dynamics.b2Island,Y=Box2D.Dynamics.b2TimeStep,J=Box2D.Dynamics.b2World;Box2D.inherit(u,Box2D.Dynamics.Joints.b2Joint);u.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;u.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_u=new l};u.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};u.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};u.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)};u.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};u.prototype.GetLength=function(){return this.m_length};u.prototype.SetLength=function(t){if(t===undefined)t=0;this.m_length=t};u.prototype.GetFrequency=function(){return this.m_frequencyHz};u.prototype.SetFrequency=function(t){if(t===undefined)t=0;this.m_frequencyHz=t};u.prototype.GetDampingRatio=function(){return this.m_dampingRatio};u.prototype.SetDampingRatio=function(t){if(t===undefined)t=0;this.m_dampingRatio=t};u.prototype.b2DistanceJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_length=t.length;this.m_frequencyHz=t.frequencyHz;this.m_dampingRatio=t.dampingRatio;this.m_impulse=0;this.m_gamma=0;this.m_bias=0};u.prototype.InitVelocityConstraints=function(t){var e;var n=0;var r=this.m_bodyA;var o=this.m_bodyB;e=r.m_xf.R;var a=this.m_localAnchor1.x-r.m_sweep.localCenter.x;var s=this.m_localAnchor1.y-r.m_sweep.localCenter.y;n=e.col1.x*a+e.col2.x*s;s=e.col1.y*a+e.col2.y*s;a=n;e=o.m_xf.R;var l=this.m_localAnchor2.x-o.m_sweep.localCenter.x;var h=this.m_localAnchor2.y-o.m_sweep.localCenter.y;n=e.col1.x*l+e.col2.x*h;h=e.col1.y*l+e.col2.y*h;l=n;this.m_u.x=o.m_sweep.c.x+l-r.m_sweep.c.x-a;this.m_u.y=o.m_sweep.c.y+h-r.m_sweep.c.y-s;var u=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);if(u>i.b2_linearSlop){this.m_u.Multiply(1/u)}else{this.m_u.SetZero()}var p=a*this.m_u.y-s*this.m_u.x;var c=l*this.m_u.y-h*this.m_u.x;var f=r.m_invMass+r.m_invI*p*p+o.m_invMass+o.m_invI*c*c;this.m_mass=f!=0?1/f:0;if(this.m_frequencyHz>0){var m=u-this.m_length;var d=2*Math.PI*this.m_frequencyHz;var y=2*this.m_mass*this.m_dampingRatio*d;var g=this.m_mass*d*d;this.m_gamma=t.dt*(y+t.dt*g);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_bias=m*t.dt*g*this.m_gamma;this.m_mass=f+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(t.warmStarting){this.m_impulse*=t.dtRatio;var v=this.m_impulse*this.m_u.x;var _=this.m_impulse*this.m_u.y;r.m_linearVelocity.x-=r.m_invMass*v;r.m_linearVelocity.y-=r.m_invMass*_;r.m_angularVelocity-=r.m_invI*(a*_-s*v);o.m_linearVelocity.x+=o.m_invMass*v;o.m_linearVelocity.y+=o.m_invMass*_;o.m_angularVelocity+=o.m_invI*(l*_-h*v)}else{this.m_impulse=0}};u.prototype.SolveVelocityConstraints=function(t){var e;var i=this.m_bodyA;var n=this.m_bodyB;e=i.m_xf.R;var r=this.m_localAnchor1.x-i.m_sweep.localCenter.x;var o=this.m_localAnchor1.y-i.m_sweep.localCenter.y;var a=e.col1.x*r+e.col2.x*o;o=e.col1.y*r+e.col2.y*o;r=a;e=n.m_xf.R;var s=this.m_localAnchor2.x-n.m_sweep.localCenter.x;var l=this.m_localAnchor2.y-n.m_sweep.localCenter.y;a=e.col1.x*s+e.col2.x*l;l=e.col1.y*s+e.col2.y*l;s=a;var h=i.m_linearVelocity.x+-i.m_angularVelocity*o;var u=i.m_linearVelocity.y+i.m_angularVelocity*r;var p=n.m_linearVelocity.x+-n.m_angularVelocity*l;var c=n.m_linearVelocity.y+n.m_angularVelocity*s;var f=this.m_u.x*(p-h)+this.m_u.y*(c-u);var m=-this.m_mass*(f+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;var d=m*this.m_u.x;var y=m*this.m_u.y;i.m_linearVelocity.x-=i.m_invMass*d;i.m_linearVelocity.y-=i.m_invMass*y;i.m_angularVelocity-=i.m_invI*(r*y-o*d);n.m_linearVelocity.x+=n.m_invMass*d;n.m_linearVelocity.y+=n.m_invMass*y;n.m_angularVelocity+=n.m_invI*(s*y-l*d)};u.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e;if(this.m_frequencyHz>0){return true}var n=this.m_bodyA;var r=this.m_bodyB;e=n.m_xf.R;var a=this.m_localAnchor1.x-n.m_sweep.localCenter.x;var s=this.m_localAnchor1.y-n.m_sweep.localCenter.y;var l=e.col1.x*a+e.col2.x*s;s=e.col1.y*a+e.col2.y*s;a=l;e=r.m_xf.R;var h=this.m_localAnchor2.x-r.m_sweep.localCenter.x;var u=this.m_localAnchor2.y-r.m_sweep.localCenter.y;l=e.col1.x*h+e.col2.x*u;u=e.col1.y*h+e.col2.y*u;h=l;var p=r.m_sweep.c.x+h-n.m_sweep.c.x-a;var c=r.m_sweep.c.y+u-n.m_sweep.c.y-s;var f=Math.sqrt(p*p+c*c);p/=f;c/=f;var m=f-this.m_length;m=o.Clamp(m,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);var d=-this.m_mass*m;this.m_u.Set(p,c);var y=d*this.m_u.x;var g=d*this.m_u.y;n.m_sweep.c.x-=n.m_invMass*y;n.m_sweep.c.y-=n.m_invMass*g;n.m_sweep.a-=n.m_invI*(a*g-s*y);r.m_sweep.c.x+=r.m_invMass*y;r.m_sweep.c.y+=r.m_invMass*g;r.m_sweep.a+=r.m_invI*(h*g-u*y);n.SynchronizeTransform();r.SynchronizeTransform();return o.Abs(m)<i.b2_linearSlop};Box2D.inherit(p,Box2D.Dynamics.Joints.b2JointDef);p.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;p.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l};p.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_distanceJoint;this.length=1;this.frequencyHz=0;this.dampingRatio=0};p.prototype.Initialize=function(t,e,i,n){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n));var r=n.x-i.x;var o=n.y-i.y;this.length=Math.sqrt(r*r+o*o);this.frequencyHz=0;this.dampingRatio=0};Box2D.inherit(c,Box2D.Dynamics.Joints.b2Joint);c.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;c.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new l;this.m_localAnchorB=new l;this.m_linearMass=new n;this.m_linearImpulse=new l};c.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};c.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};c.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)};c.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_angularImpulse};c.prototype.SetMaxForce=function(t){if(t===undefined)t=0;this.m_maxForce=t};c.prototype.GetMaxForce=function(){return this.m_maxForce};c.prototype.SetMaxTorque=function(t){if(t===undefined)t=0;this.m_maxTorque=t};c.prototype.GetMaxTorque=function(){return this.m_maxTorque};c.prototype.b2FrictionJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchorA.SetV(t.localAnchorA);this.m_localAnchorB.SetV(t.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=t.maxForce;this.m_maxTorque=t.maxTorque};c.prototype.InitVelocityConstraints=function(t){var e;var i=0;var r=this.m_bodyA;var o=this.m_bodyB;e=r.m_xf.R;var a=this.m_localAnchorA.x-r.m_sweep.localCenter.x;var s=this.m_localAnchorA.y-r.m_sweep.localCenter.y;i=e.col1.x*a+e.col2.x*s;s=e.col1.y*a+e.col2.y*s;a=i;e=o.m_xf.R;var l=this.m_localAnchorB.x-o.m_sweep.localCenter.x;var h=this.m_localAnchorB.y-o.m_sweep.localCenter.y;i=e.col1.x*l+e.col2.x*h;h=e.col1.y*l+e.col2.y*h;l=i;var u=r.m_invMass;var p=o.m_invMass;var c=r.m_invI;var f=o.m_invI;var m=new n;m.col1.x=u+p;m.col2.x=0;m.col1.y=0;m.col2.y=u+p;m.col1.x+=c*s*s;m.col2.x+=-c*a*s;m.col1.y+=-c*a*s;m.col2.y+=c*a*a;m.col1.x+=f*h*h;m.col2.x+=-f*l*h;m.col1.y+=-f*l*h;m.col2.y+=f*l*l;m.GetInverse(this.m_linearMass);this.m_angularMass=c+f;if(this.m_angularMass>0){this.m_angularMass=1/this.m_angularMass}if(t.warmStarting){this.m_linearImpulse.x*=t.dtRatio;this.m_linearImpulse.y*=t.dtRatio;this.m_angularImpulse*=t.dtRatio;var d=this.m_linearImpulse;r.m_linearVelocity.x-=u*d.x;r.m_linearVelocity.y-=u*d.y;r.m_angularVelocity-=c*(a*d.y-s*d.x+this.m_angularImpulse);o.m_linearVelocity.x+=p*d.x;o.m_linearVelocity.y+=p*d.y;o.m_angularVelocity+=f*(l*d.y-h*d.x+this.m_angularImpulse)}else{this.m_linearImpulse.SetZero();this.m_angularImpulse=0}};c.prototype.SolveVelocityConstraints=function(t){var e;var i=0;var n=this.m_bodyA;var r=this.m_bodyB;var a=n.m_linearVelocity;var s=n.m_angularVelocity;var h=r.m_linearVelocity;var u=r.m_angularVelocity;var p=n.m_invMass;var c=r.m_invMass;var f=n.m_invI;var m=r.m_invI;e=n.m_xf.R;var d=this.m_localAnchorA.x-n.m_sweep.localCenter.x;var y=this.m_localAnchorA.y-n.m_sweep.localCenter.y;i=e.col1.x*d+e.col2.x*y;y=e.col1.y*d+e.col2.y*y;d=i;e=r.m_xf.R;var g=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var v=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*g+e.col2.x*v;v=e.col1.y*g+e.col2.y*v;g=i;var _=0;{var I=u-s;var w=-this.m_angularMass*I;var x=this.m_angularImpulse;_=t.dt*this.m_maxTorque;this.m_angularImpulse=o.Clamp(this.m_angularImpulse+w,-_,_);w=this.m_angularImpulse-x;s-=f*w;u+=m*w}{var S=h.x-u*v-a.x+s*y;var T=h.y+u*g-a.y-s*d;var C=o.MulMV(this.m_linearMass,new l(-S,-T));var b=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(C);_=t.dt*this.m_maxForce;if(this.m_linearImpulse.LengthSquared()>_*_){this.m_linearImpulse.Normalize();this.m_linearImpulse.Multiply(_)}C=o.SubtractVV(this.m_linearImpulse,b);a.x-=p*C.x;a.y-=p*C.y;s-=f*(d*C.y-y*C.x);h.x+=c*C.x;h.y+=c*C.y;u+=m*(g*C.y-v*C.x)}n.m_angularVelocity=s;r.m_angularVelocity=u};c.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return true};Box2D.inherit(f,Box2D.Dynamics.Joints.b2JointDef);f.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;f.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l};f.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_frictionJoint;this.maxForce=0;this.maxTorque=0};f.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i))};Box2D.inherit(m,Box2D.Dynamics.Joints.b2Joint);m.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;m.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new l;this.m_groundAnchor2=new l;this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_J=new y};m.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};m.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};m.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)};m.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;var e=this.m_bodyB.m_xf.R;var i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x;var n=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y;var r=e.col1.x*i+e.col2.x*n;n=e.col1.y*i+e.col2.y*n;i=r;var o=this.m_impulse*this.m_J.linearB.x;var a=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-i*a+n*o)};m.prototype.GetRatio=function(){return this.m_ratio};m.prototype.SetRatio=function(t){if(t===undefined)t=0;this.m_ratio=t};m.prototype.b2GearJoint=function(t){this.__super.b2Joint.call(this,t);var e=parseInt(t.joint1.m_type);var i=parseInt(t.joint2.m_type);this.m_revolute1=null;this.m_prismatic1=null;this.m_revolute2=null;this.m_prismatic2=null;var n=0;var r=0;this.m_ground1=t.joint1.GetBodyA();this.m_bodyA=t.joint1.GetBodyB();if(e==g.e_revoluteJoint){this.m_revolute1=t.joint1 instanceof E?t.joint1:null;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);n=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=t.joint1 instanceof T?t.joint1:null;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);n=this.m_prismatic1.GetJointTranslation()}this.m_ground2=t.joint2.GetBodyA();this.m_bodyB=t.joint2.GetBodyB();if(i==g.e_revoluteJoint){this.m_revolute2=t.joint2 instanceof E?t.joint2:null;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);r=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=t.joint2 instanceof T?t.joint2:null;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);r=this.m_prismatic2.GetJointTranslation()}this.m_ratio=t.ratio;this.m_constant=n+this.m_ratio*r;this.m_impulse=0};m.prototype.InitVelocityConstraints=function(t){var e=this.m_ground1;var i=this.m_ground2;var n=this.m_bodyA;var r=this.m_bodyB;var o=0;var a=0;var s=0;var l=0;var h;var u;var p=0;var c=0;var f=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angularA=-1;f+=n.m_invI}else{h=e.m_xf.R;u=this.m_prismatic1.m_localXAxis1;o=h.col1.x*u.x+h.col2.x*u.y;a=h.col1.y*u.x+h.col2.y*u.y;h=n.m_xf.R;s=this.m_localAnchor1.x-n.m_sweep.localCenter.x;l=this.m_localAnchor1.y-n.m_sweep.localCenter.y;c=h.col1.x*s+h.col2.x*l;l=h.col1.y*s+h.col2.y*l;s=c;p=s*a-l*o;this.m_J.linearA.Set(-o,-a);this.m_J.angularA=-p;f+=n.m_invMass+n.m_invI*p*p}if(this.m_revolute2){this.m_J.angularB=-this.m_ratio;f+=this.m_ratio*this.m_ratio*r.m_invI}else{h=i.m_xf.R;u=this.m_prismatic2.m_localXAxis1;o=h.col1.x*u.x+h.col2.x*u.y;a=h.col1.y*u.x+h.col2.y*u.y;h=r.m_xf.R;s=this.m_localAnchor2.x-r.m_sweep.localCenter.x;l=this.m_localAnchor2.y-r.m_sweep.localCenter.y;c=h.col1.x*s+h.col2.x*l;l=h.col1.y*s+h.col2.y*l;s=c;p=s*a-l*o;this.m_J.linearB.Set(-this.m_ratio*o,-this.m_ratio*a);this.m_J.angularB=-this.m_ratio*p;f+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*p*p)}this.m_mass=f>0?1/f:0;if(t.warmStarting){n.m_linearVelocity.x+=n.m_invMass*this.m_impulse*this.m_J.linearA.x;n.m_linearVelocity.y+=n.m_invMass*this.m_impulse*this.m_J.linearA.y;n.m_angularVelocity+=n.m_invI*this.m_impulse*this.m_J.angularA;r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x;r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y;r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB}else{this.m_impulse=0}};m.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n=this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,i.m_linearVelocity,i.m_angularVelocity);var r=-this.m_mass*n;this.m_impulse+=r;e.m_linearVelocity.x+=e.m_invMass*r*this.m_J.linearA.x;e.m_linearVelocity.y+=e.m_invMass*r*this.m_J.linearA.y;e.m_angularVelocity+=e.m_invI*r*this.m_J.angularA;i.m_linearVelocity.x+=i.m_invMass*r*this.m_J.linearB.x;i.m_linearVelocity.y+=i.m_invMass*r*this.m_J.linearB.y;i.m_angularVelocity+=i.m_invI*r*this.m_J.angularB};m.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var n=this.m_bodyA;var r=this.m_bodyB;var o=0;var a=0;if(this.m_revolute1){o=this.m_revolute1.GetJointAngle()}else{o=this.m_prismatic1.GetJointTranslation()}if(this.m_revolute2){a=this.m_revolute2.GetJointAngle()}else{a=this.m_prismatic2.GetJointTranslation()}var s=this.m_constant-(o+this.m_ratio*a);var l=-this.m_mass*s;n.m_sweep.c.x+=n.m_invMass*l*this.m_J.linearA.x;n.m_sweep.c.y+=n.m_invMass*l*this.m_J.linearA.y;n.m_sweep.a+=n.m_invI*l*this.m_J.angularA;r.m_sweep.c.x+=r.m_invMass*l*this.m_J.linearB.x;r.m_sweep.c.y+=r.m_invMass*l*this.m_J.linearB.y;r.m_sweep.a+=r.m_invI*l*this.m_J.angularB;n.SynchronizeTransform();r.SynchronizeTransform();return e<i.b2_linearSlop};Box2D.inherit(d,Box2D.Dynamics.Joints.b2JointDef);d.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;d.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};d.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_gearJoint;this.joint1=null;this.joint2=null;this.ratio=1};y.b2Jacobian=function(){this.linearA=new l;this.linearB=new l};y.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};y.prototype.Set=function(t,e,i,n){if(e===undefined)e=0;if(n===undefined)n=0;this.linearA.SetV(t);this.angularA=e;this.linearB.SetV(i);this.angularB=n};y.prototype.Compute=function(t,e,i,n){if(e===undefined)e=0;if(n===undefined)n=0;return this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*e+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*n};g.b2Joint=function(){this.m_edgeA=new _;this.m_edgeB=new _;this.m_localCenterA=new l;this.m_localCenterB=new l};g.prototype.GetType=function(){return this.m_type};g.prototype.GetAnchorA=function(){return null};g.prototype.GetAnchorB=function(){return null};g.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return null};g.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};g.prototype.GetBodyA=function(){return this.m_bodyA};g.prototype.GetBodyB=function(){return this.m_bodyB};g.prototype.GetNext=function(){return this.m_next};g.prototype.GetUserData=function(){return this.m_userData};g.prototype.SetUserData=function(t){this.m_userData=t};g.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};g.Create=function(t,e){var i=null;switch(t.type){case g.e_distanceJoint:{i=new u(t instanceof p?t:null)}break;case g.e_mouseJoint:{i=new x(t instanceof S?t:null)}break;case g.e_prismaticJoint:{i=new T(t instanceof C?t:null)}break;case g.e_revoluteJoint:{i=new E(t instanceof A?t:null)}break;case g.e_pulleyJoint:{i=new b(t instanceof D?t:null)}break;case g.e_gearJoint:{i=new m(t instanceof d?t:null)}break;case g.e_lineJoint:{i=new I(t instanceof w?t:null)}break;case g.e_weldJoint:{i=new U(t instanceof M?t:null)}break;case g.e_frictionJoint:{i=new c(t instanceof f?t:null)}break;default:break}return i};g.Destroy=function(t,e){};g.prototype.b2Joint=function(t){i.b2Assert(t.bodyA!=t.bodyB);this.m_type=t.type;this.m_prev=null;this.m_next=null;this.m_bodyA=t.bodyA;this.m_bodyB=t.bodyB;this.m_collideConnected=t.collideConnected;this.m_islandFlag=false;this.m_userData=t.userData};g.prototype.InitVelocityConstraints=function(t){};g.prototype.SolveVelocityConstraints=function(t){};g.prototype.FinalizeVelocityConstraints=function(){};g.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return false};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});v.b2JointDef=function(){};v.prototype.b2JointDef=function(){this.type=g.e_unknownJoint;this.userData=null;this.bodyA=null;this.bodyB=null;this.collideConnected=false};_.b2JointEdge=function(){};Box2D.inherit(I,Box2D.Dynamics.Joints.b2Joint);I.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;I.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_localXAxis1=new l;this.m_localYAxis1=new l;this.m_axis=new l;this.m_perp=new l;this.m_K=new n;this.m_impulse=new l};I.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};I.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};I.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};I.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.y};I.prototype.GetJointTranslation=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;var n=t.GetWorldPoint(this.m_localAnchor1);var r=e.GetWorldPoint(this.m_localAnchor2);var o=r.x-n.x;var a=r.y-n.y;var s=t.GetWorldVector(this.m_localXAxis1);var l=s.x*o+s.y*a;return l};I.prototype.GetJointSpeed=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;i=t.m_xf.R;var n=this.m_localAnchor1.x-t.m_sweep.localCenter.x;var r=this.m_localAnchor1.y-t.m_sweep.localCenter.y;var o=i.col1.x*n+i.col2.x*r;r=i.col1.y*n+i.col2.y*r;n=o;i=e.m_xf.R;var a=this.m_localAnchor2.x-e.m_sweep.localCenter.x;var s=this.m_localAnchor2.y-e.m_sweep.localCenter.y;o=i.col1.x*a+i.col2.x*s;s=i.col1.y*a+i.col2.y*s;a=o;var l=t.m_sweep.c.x+n;var h=t.m_sweep.c.y+r;var u=e.m_sweep.c.x+a;var p=e.m_sweep.c.y+s;var c=u-l;var f=p-h;var m=t.GetWorldVector(this.m_localXAxis1);var d=t.m_linearVelocity;var y=e.m_linearVelocity;var g=t.m_angularVelocity;var v=e.m_angularVelocity;var _=c*(-g*m.y)+f*(g*m.x)+(m.x*(y.x+-v*s-d.x- -g*r)+m.y*(y.y+v*a-d.y-g*n));return _};I.prototype.IsLimitEnabled=function(){return this.m_enableLimit};I.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=t};I.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};I.prototype.GetUpperLimit=function(){return this.m_upperTranslation};I.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=t;this.m_upperTranslation=e};I.prototype.IsMotorEnabled=function(){return this.m_enableMotor};I.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=t};I.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};I.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};I.prototype.SetMaxMotorForce=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=t};I.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};I.prototype.GetMotorForce=function(){return this.m_motorImpulse};I.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_localXAxis1.SetV(t.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=t.lowerTranslation;this.m_upperTranslation=t.upperTranslation;this.m_maxMotorForce=t.maxMotorForce;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=g.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};I.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;var a=0;this.m_localCenterA.SetV(e.GetLocalCenter());this.m_localCenterB.SetV(n.GetLocalCenter());var s=e.GetTransform();var l=n.GetTransform();r=e.m_xf.R;var h=this.m_localAnchor1.x-this.m_localCenterA.x;var u=this.m_localAnchor1.y-this.m_localCenterA.y;a=r.col1.x*h+r.col2.x*u;u=r.col1.y*h+r.col2.y*u;h=a;r=n.m_xf.R;var p=this.m_localAnchor2.x-this.m_localCenterB.x;var c=this.m_localAnchor2.y-this.m_localCenterB.y;a=r.col1.x*p+r.col2.x*c;c=r.col1.y*p+r.col2.y*c;p=a;var f=n.m_sweep.c.x+p-e.m_sweep.c.x-h;var m=n.m_sweep.c.y+c-e.m_sweep.c.y-u;this.m_invMassA=e.m_invMass;this.m_invMassB=n.m_invMass;this.m_invIA=e.m_invI;this.m_invIB=n.m_invI;{this.m_axis.SetV(o.MulMV(s.R,this.m_localXAxis1));this.m_a1=(f+h)*this.m_axis.y-(m+u)*this.m_axis.x;this.m_a2=p*this.m_axis.y-c*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Box2D.MIN_VALUE?1/this.m_motorMass:0}{this.m_perp.SetV(o.MulMV(s.R,this.m_localYAxis1));this.m_s1=(f+h)*this.m_perp.y-(m+u)*this.m_perp.x;this.m_s2=p*this.m_perp.y-c*this.m_perp.x;var d=this.m_invMassA;var y=this.m_invMassB;var v=this.m_invIA;var _=this.m_invIB;this.m_K.col1.x=d+y+v*this.m_s1*this.m_s1+_*this.m_s2*this.m_s2;this.m_K.col1.y=v*this.m_s1*this.m_a1+_*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=d+y+v*this.m_a1*this.m_a1+_*this.m_a2*this.m_a2}if(this.m_enableLimit){var I=this.m_axis.x*f+this.m_axis.y*m;if(o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){this.m_limitState=g.e_equalLimits}else if(I<=this.m_lowerTranslation){if(this.m_limitState!=g.e_atLowerLimit){this.m_limitState=g.e_atLowerLimit;this.m_impulse.y=0}}else if(I>=this.m_upperTranslation){if(this.m_limitState!=g.e_atUpperLimit){this.m_limitState=g.e_atUpperLimit;this.m_impulse.y=0}}else{this.m_limitState=g.e_inactiveLimit;this.m_impulse.y=0}}else{this.m_limitState=g.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var w=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x;var x=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y;var S=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1;var T=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;e.m_linearVelocity.x-=this.m_invMassA*w;e.m_linearVelocity.y-=this.m_invMassA*x;e.m_angularVelocity-=this.m_invIA*S;n.m_linearVelocity.x+=this.m_invMassB*w;n.m_linearVelocity.y+=this.m_invMassB*x;n.m_angularVelocity+=this.m_invIB*T}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};I.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n=e.m_linearVelocity;var r=e.m_angularVelocity;var a=i.m_linearVelocity;var s=i.m_angularVelocity;var h=0;var u=0;var p=0;var c=0;if(this.m_enableMotor&&this.m_limitState!=g.e_equalLimits){var f=this.m_axis.x*(a.x-n.x)+this.m_axis.y*(a.y-n.y)+this.m_a2*s-this.m_a1*r;var m=this.m_motorMass*(this.m_motorSpeed-f);var d=this.m_motorImpulse;var y=t.dt*this.m_maxMotorForce;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+m,-y,y);m=this.m_motorImpulse-d;h=m*this.m_axis.x;u=m*this.m_axis.y;p=m*this.m_a1;c=m*this.m_a2;n.x-=this.m_invMassA*h;n.y-=this.m_invMassA*u;r-=this.m_invIA*p;a.x+=this.m_invMassB*h;a.y+=this.m_invMassB*u;s+=this.m_invIB*c}var v=this.m_perp.x*(a.x-n.x)+this.m_perp.y*(a.y-n.y)+this.m_s2*s-this.m_s1*r;if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){var _=this.m_axis.x*(a.x-n.x)+this.m_axis.y*(a.y-n.y)+this.m_a2*s-this.m_a1*r;var I=this.m_impulse.Copy();var w=this.m_K.Solve(new l,-v,-_);this.m_impulse.Add(w);if(this.m_limitState==g.e_atLowerLimit){this.m_impulse.y=o.Max(this.m_impulse.y,0)}else if(this.m_limitState==g.e_atUpperLimit){this.m_impulse.y=o.Min(this.m_impulse.y,0)}var x=-v-(this.m_impulse.y-I.y)*this.m_K.col2.x;var S=0;if(this.m_K.col1.x!=0){S=x/this.m_K.col1.x+I.x}else{S=I.x}this.m_impulse.x=S;w.x=this.m_impulse.x-I.x;w.y=this.m_impulse.y-I.y;h=w.x*this.m_perp.x+w.y*this.m_axis.x;u=w.x*this.m_perp.y+w.y*this.m_axis.y;p=w.x*this.m_s1+w.y*this.m_a1;c=w.x*this.m_s2+w.y*this.m_a2;n.x-=this.m_invMassA*h;n.y-=this.m_invMassA*u;r-=this.m_invIA*p;a.x+=this.m_invMassB*h;a.y+=this.m_invMassB*u;s+=this.m_invIB*c}else{var T=0;if(this.m_K.col1.x!=0){T=-v/this.m_K.col1.x}else{T=0}this.m_impulse.x+=T;h=T*this.m_perp.x;u=T*this.m_perp.y;p=T*this.m_s1;c=T*this.m_s2;n.x-=this.m_invMassA*h;n.y-=this.m_invMassA*u;r-=this.m_invIA*p;a.x+=this.m_invMassB*h;a.y+=this.m_invMassB*u;s+=this.m_invIB*c}e.m_linearVelocity.SetV(n);e.m_angularVelocity=r;i.m_linearVelocity.SetV(a);i.m_angularVelocity=s};I.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var r=0;var a=this.m_bodyA;var s=this.m_bodyB;var h=a.m_sweep.c;var u=a.m_sweep.a;var p=s.m_sweep.c;var c=s.m_sweep.a;var f;var m=0;var d=0;var y=0;var g=0;var v=0;var _=0;var I=0;var w=false;var x=0;var S=n.FromAngle(u);var T=n.FromAngle(c);f=S;var C=this.m_localAnchor1.x-this.m_localCenterA.x;var b=this.m_localAnchor1.y-this.m_localCenterA.y;m=f.col1.x*C+f.col2.x*b;b=f.col1.y*C+f.col2.y*b;C=m;f=T;var D=this.m_localAnchor2.x-this.m_localCenterB.x;var E=this.m_localAnchor2.y-this.m_localCenterB.y;m=f.col1.x*D+f.col2.x*E;E=f.col1.y*D+f.col2.y*E;D=m;var A=p.x+D-h.x-C;var U=p.y+E-h.y-b;if(this.m_enableLimit){this.m_axis=o.MulMV(S,this.m_localXAxis1);this.m_a1=(A+C)*this.m_axis.y-(U+b)*this.m_axis.x;this.m_a2=D*this.m_axis.y-E*this.m_axis.x;var M=this.m_axis.x*A+this.m_axis.y*U;if(o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){x=o.Clamp(M,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);_=o.Abs(M);w=true}else if(M<=this.m_lowerTranslation){x=o.Clamp(M-this.m_lowerTranslation+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);_=this.m_lowerTranslation-M;w=true}else if(M>=this.m_upperTranslation){x=o.Clamp(M-this.m_upperTranslation+i.b2_linearSlop,0,i.b2_maxLinearCorrection);_=M-this.m_upperTranslation;w=true}}this.m_perp=o.MulMV(S,this.m_localYAxis1);this.m_s1=(A+C)*this.m_perp.y-(U+b)*this.m_perp.x;this.m_s2=D*this.m_perp.y-E*this.m_perp.x;var P=new l;var B=this.m_perp.x*A+this.m_perp.y*U;_=o.Max(_,o.Abs(B));I=0;if(w){d=this.m_invMassA;y=this.m_invMassB;g=this.m_invIA;v=this.m_invIB;this.m_K.col1.x=d+y+g*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2;this.m_K.col1.y=g*this.m_s1*this.m_a1+v*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=d+y+g*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2;this.m_K.Solve(P,-B,-x)}else{d=this.m_invMassA;y=this.m_invMassB;g=this.m_invIA;v=this.m_invIB;var L=d+y+g*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2;var R=0;if(L!=0){R=-B/L}else{R=0}P.x=R;P.y=0}var O=P.x*this.m_perp.x+P.y*this.m_axis.x;var V=P.x*this.m_perp.y+P.y*this.m_axis.y;var W=P.x*this.m_s1+P.y*this.m_a1;var k=P.x*this.m_s2+P.y*this.m_a2;h.x-=this.m_invMassA*O;h.y-=this.m_invMassA*V;u-=this.m_invIA*W;p.x+=this.m_invMassB*O;p.y+=this.m_invMassB*V;c+=this.m_invIB*k;a.m_sweep.a=u;s.m_sweep.a=c;a.SynchronizeTransform();s.SynchronizeTransform();return _<=i.b2_linearSlop&&I<=i.b2_angularSlop};Box2D.inherit(w,Box2D.Dynamics.Joints.b2JointDef);w.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;
w.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l;this.localAxisA=new l};w.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=false;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=false;this.maxMotorForce=0;this.motorSpeed=0};w.prototype.Initialize=function(t,e,i,n){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.localAxisA=this.bodyA.GetLocalVector(n)};Box2D.inherit(x,Box2D.Dynamics.Joints.b2Joint);x.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;x.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new n;this.K1=new n;this.K2=new n;this.m_localAnchor=new l;this.m_target=new l;this.m_impulse=new l;this.m_mass=new n;this.m_C=new l};x.prototype.GetAnchorA=function(){return this.m_target};x.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};x.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse.x,t*this.m_impulse.y)};x.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};x.prototype.GetTarget=function(){return this.m_target};x.prototype.SetTarget=function(t){if(this.m_bodyB.IsAwake()==false){this.m_bodyB.SetAwake(true)}this.m_target=t};x.prototype.GetMaxForce=function(){return this.m_maxForce};x.prototype.SetMaxForce=function(t){if(t===undefined)t=0;this.m_maxForce=t};x.prototype.GetFrequency=function(){return this.m_frequencyHz};x.prototype.SetFrequency=function(t){if(t===undefined)t=0;this.m_frequencyHz=t};x.prototype.GetDampingRatio=function(){return this.m_dampingRatio};x.prototype.SetDampingRatio=function(t){if(t===undefined)t=0;this.m_dampingRatio=t};x.prototype.b2MouseJoint=function(t){this.__super.b2Joint.call(this,t);this.m_target.SetV(t.target);var e=this.m_target.x-this.m_bodyB.m_xf.position.x;var i=this.m_target.y-this.m_bodyB.m_xf.position.y;var n=this.m_bodyB.m_xf.R;this.m_localAnchor.x=e*n.col1.x+i*n.col1.y;this.m_localAnchor.y=e*n.col2.x+i*n.col2.y;this.m_maxForce=t.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=t.frequencyHz;this.m_dampingRatio=t.dampingRatio;this.m_beta=0;this.m_gamma=0};x.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyB;var i=e.GetMass();var n=2*Math.PI*this.m_frequencyHz;var r=2*i*this.m_dampingRatio*n;var o=i*n*n;this.m_gamma=t.dt*(r+t.dt*o);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=t.dt*o*this.m_gamma;var a;a=e.m_xf.R;var s=this.m_localAnchor.x-e.m_sweep.localCenter.x;var l=this.m_localAnchor.y-e.m_sweep.localCenter.y;var h=a.col1.x*s+a.col2.x*l;l=a.col1.y*s+a.col2.y*l;s=h;var u=e.m_invMass;var p=e.m_invI;this.K1.col1.x=u;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=u;this.K2.col1.x=p*l*l;this.K2.col2.x=-p*s*l;this.K2.col1.y=-p*s*l;this.K2.col2.y=p*s*s;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=e.m_sweep.c.x+s-this.m_target.x;this.m_C.y=e.m_sweep.c.y+l-this.m_target.y;e.m_angularVelocity*=.98;this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;e.m_linearVelocity.x+=u*this.m_impulse.x;e.m_linearVelocity.y+=u*this.m_impulse.y;e.m_angularVelocity+=p*(s*this.m_impulse.y-l*this.m_impulse.x)};x.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyB;var i;var n=0;var r=0;i=e.m_xf.R;var o=this.m_localAnchor.x-e.m_sweep.localCenter.x;var a=this.m_localAnchor.y-e.m_sweep.localCenter.y;n=i.col1.x*o+i.col2.x*a;a=i.col1.y*o+i.col2.y*a;o=n;var s=e.m_linearVelocity.x+-e.m_angularVelocity*a;var l=e.m_linearVelocity.y+e.m_angularVelocity*o;i=this.m_mass;n=s+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;r=l+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var h=-(i.col1.x*n+i.col2.x*r);var u=-(i.col1.y*n+i.col2.y*r);var p=this.m_impulse.x;var c=this.m_impulse.y;this.m_impulse.x+=h;this.m_impulse.y+=u;var f=t.dt*this.m_maxForce;if(this.m_impulse.LengthSquared()>f*f){this.m_impulse.Multiply(f/this.m_impulse.Length())}h=this.m_impulse.x-p;u=this.m_impulse.y-c;e.m_linearVelocity.x+=e.m_invMass*h;e.m_linearVelocity.y+=e.m_invMass*u;e.m_angularVelocity+=e.m_invI*(o*u-a*h)};x.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return true};Box2D.inherit(S,Box2D.Dynamics.Joints.b2JointDef);S.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;S.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new l};S.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7};Box2D.inherit(T,Box2D.Dynamics.Joints.b2Joint);T.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;T.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_localXAxis1=new l;this.m_localYAxis1=new l;this.m_axis=new l;this.m_perp=new l;this.m_K=new r;this.m_impulse=new h};T.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};T.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};T.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};T.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.y};T.prototype.GetJointTranslation=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;var n=t.GetWorldPoint(this.m_localAnchor1);var r=e.GetWorldPoint(this.m_localAnchor2);var o=r.x-n.x;var a=r.y-n.y;var s=t.GetWorldVector(this.m_localXAxis1);var l=s.x*o+s.y*a;return l};T.prototype.GetJointSpeed=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;i=t.m_xf.R;var n=this.m_localAnchor1.x-t.m_sweep.localCenter.x;var r=this.m_localAnchor1.y-t.m_sweep.localCenter.y;var o=i.col1.x*n+i.col2.x*r;r=i.col1.y*n+i.col2.y*r;n=o;i=e.m_xf.R;var a=this.m_localAnchor2.x-e.m_sweep.localCenter.x;var s=this.m_localAnchor2.y-e.m_sweep.localCenter.y;o=i.col1.x*a+i.col2.x*s;s=i.col1.y*a+i.col2.y*s;a=o;var l=t.m_sweep.c.x+n;var h=t.m_sweep.c.y+r;var u=e.m_sweep.c.x+a;var p=e.m_sweep.c.y+s;var c=u-l;var f=p-h;var m=t.GetWorldVector(this.m_localXAxis1);var d=t.m_linearVelocity;var y=e.m_linearVelocity;var g=t.m_angularVelocity;var v=e.m_angularVelocity;var _=c*(-g*m.y)+f*(g*m.x)+(m.x*(y.x+-v*s-d.x- -g*r)+m.y*(y.y+v*a-d.y-g*n));return _};T.prototype.IsLimitEnabled=function(){return this.m_enableLimit};T.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=t};T.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};T.prototype.GetUpperLimit=function(){return this.m_upperTranslation};T.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=t;this.m_upperTranslation=e};T.prototype.IsMotorEnabled=function(){return this.m_enableMotor};T.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=t};T.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};T.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};T.prototype.SetMaxMotorForce=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=t};T.prototype.GetMotorForce=function(){return this.m_motorImpulse};T.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_localXAxis1.SetV(t.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=t.lowerTranslation;this.m_upperTranslation=t.upperTranslation;this.m_maxMotorForce=t.maxMotorForce;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=g.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};T.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;var a=0;this.m_localCenterA.SetV(e.GetLocalCenter());this.m_localCenterB.SetV(n.GetLocalCenter());var s=e.GetTransform();var l=n.GetTransform();r=e.m_xf.R;var h=this.m_localAnchor1.x-this.m_localCenterA.x;var u=this.m_localAnchor1.y-this.m_localCenterA.y;a=r.col1.x*h+r.col2.x*u;u=r.col1.y*h+r.col2.y*u;h=a;r=n.m_xf.R;var p=this.m_localAnchor2.x-this.m_localCenterB.x;var c=this.m_localAnchor2.y-this.m_localCenterB.y;a=r.col1.x*p+r.col2.x*c;c=r.col1.y*p+r.col2.y*c;p=a;var f=n.m_sweep.c.x+p-e.m_sweep.c.x-h;var m=n.m_sweep.c.y+c-e.m_sweep.c.y-u;this.m_invMassA=e.m_invMass;this.m_invMassB=n.m_invMass;this.m_invIA=e.m_invI;this.m_invIB=n.m_invI;{this.m_axis.SetV(o.MulMV(s.R,this.m_localXAxis1));this.m_a1=(f+h)*this.m_axis.y-(m+u)*this.m_axis.x;this.m_a2=p*this.m_axis.y-c*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Box2D.MIN_VALUE)this.m_motorMass=1/this.m_motorMass}{this.m_perp.SetV(o.MulMV(s.R,this.m_localYAxis1));this.m_s1=(f+h)*this.m_perp.y-(m+u)*this.m_perp.x;this.m_s2=p*this.m_perp.y-c*this.m_perp.x;var d=this.m_invMassA;var y=this.m_invMassB;var v=this.m_invIA;var _=this.m_invIB;this.m_K.col1.x=d+y+v*this.m_s1*this.m_s1+_*this.m_s2*this.m_s2;this.m_K.col1.y=v*this.m_s1+_*this.m_s2;this.m_K.col1.z=v*this.m_s1*this.m_a1+_*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=v+_;this.m_K.col2.z=v*this.m_a1+_*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=d+y+v*this.m_a1*this.m_a1+_*this.m_a2*this.m_a2}if(this.m_enableLimit){var I=this.m_axis.x*f+this.m_axis.y*m;if(o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){this.m_limitState=g.e_equalLimits}else if(I<=this.m_lowerTranslation){if(this.m_limitState!=g.e_atLowerLimit){this.m_limitState=g.e_atLowerLimit;this.m_impulse.z=0}}else if(I>=this.m_upperTranslation){if(this.m_limitState!=g.e_atUpperLimit){this.m_limitState=g.e_atUpperLimit;this.m_impulse.z=0}}else{this.m_limitState=g.e_inactiveLimit;this.m_impulse.z=0}}else{this.m_limitState=g.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var w=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x;var x=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y;var S=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1;var T=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;e.m_linearVelocity.x-=this.m_invMassA*w;e.m_linearVelocity.y-=this.m_invMassA*x;e.m_angularVelocity-=this.m_invIA*S;n.m_linearVelocity.x+=this.m_invMassB*w;n.m_linearVelocity.y+=this.m_invMassB*x;n.m_angularVelocity+=this.m_invIB*T}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};T.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n=e.m_linearVelocity;var r=e.m_angularVelocity;var a=i.m_linearVelocity;var s=i.m_angularVelocity;var u=0;var p=0;var c=0;var f=0;if(this.m_enableMotor&&this.m_limitState!=g.e_equalLimits){var m=this.m_axis.x*(a.x-n.x)+this.m_axis.y*(a.y-n.y)+this.m_a2*s-this.m_a1*r;var d=this.m_motorMass*(this.m_motorSpeed-m);var y=this.m_motorImpulse;var v=t.dt*this.m_maxMotorForce;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+d,-v,v);d=this.m_motorImpulse-y;u=d*this.m_axis.x;p=d*this.m_axis.y;c=d*this.m_a1;f=d*this.m_a2;n.x-=this.m_invMassA*u;n.y-=this.m_invMassA*p;r-=this.m_invIA*c;a.x+=this.m_invMassB*u;a.y+=this.m_invMassB*p;s+=this.m_invIB*f}var _=this.m_perp.x*(a.x-n.x)+this.m_perp.y*(a.y-n.y)+this.m_s2*s-this.m_s1*r;var I=s-r;if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){var w=this.m_axis.x*(a.x-n.x)+this.m_axis.y*(a.y-n.y)+this.m_a2*s-this.m_a1*r;var x=this.m_impulse.Copy();var S=this.m_K.Solve33(new h,-_,-I,-w);this.m_impulse.Add(S);if(this.m_limitState==g.e_atLowerLimit){this.m_impulse.z=o.Max(this.m_impulse.z,0)}else if(this.m_limitState==g.e_atUpperLimit){this.m_impulse.z=o.Min(this.m_impulse.z,0)}var T=-_-(this.m_impulse.z-x.z)*this.m_K.col3.x;var C=-I-(this.m_impulse.z-x.z)*this.m_K.col3.y;var b=this.m_K.Solve22(new l,T,C);b.x+=x.x;b.y+=x.y;this.m_impulse.x=b.x;this.m_impulse.y=b.y;S.x=this.m_impulse.x-x.x;S.y=this.m_impulse.y-x.y;S.z=this.m_impulse.z-x.z;u=S.x*this.m_perp.x+S.z*this.m_axis.x;p=S.x*this.m_perp.y+S.z*this.m_axis.y;c=S.x*this.m_s1+S.y+S.z*this.m_a1;f=S.x*this.m_s2+S.y+S.z*this.m_a2;n.x-=this.m_invMassA*u;n.y-=this.m_invMassA*p;r-=this.m_invIA*c;a.x+=this.m_invMassB*u;a.y+=this.m_invMassB*p;s+=this.m_invIB*f}else{var D=this.m_K.Solve22(new l,-_,-I);this.m_impulse.x+=D.x;this.m_impulse.y+=D.y;u=D.x*this.m_perp.x;p=D.x*this.m_perp.y;c=D.x*this.m_s1+D.y;f=D.x*this.m_s2+D.y;n.x-=this.m_invMassA*u;n.y-=this.m_invMassA*p;r-=this.m_invIA*c;a.x+=this.m_invMassB*u;a.y+=this.m_invMassB*p;s+=this.m_invIB*f}e.m_linearVelocity.SetV(n);e.m_angularVelocity=r;i.m_linearVelocity.SetV(a);i.m_angularVelocity=s};T.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var r=0;var a=this.m_bodyA;var s=this.m_bodyB;var u=a.m_sweep.c;var p=a.m_sweep.a;var c=s.m_sweep.c;var f=s.m_sweep.a;var m;var d=0;var y=0;var g=0;var v=0;var _=0;var I=0;var w=0;var x=false;var S=0;var T=n.FromAngle(p);var C=n.FromAngle(f);m=T;var b=this.m_localAnchor1.x-this.m_localCenterA.x;var D=this.m_localAnchor1.y-this.m_localCenterA.y;d=m.col1.x*b+m.col2.x*D;D=m.col1.y*b+m.col2.y*D;b=d;m=C;var E=this.m_localAnchor2.x-this.m_localCenterB.x;var A=this.m_localAnchor2.y-this.m_localCenterB.y;d=m.col1.x*E+m.col2.x*A;A=m.col1.y*E+m.col2.y*A;E=d;var U=c.x+E-u.x-b;var M=c.y+A-u.y-D;if(this.m_enableLimit){this.m_axis=o.MulMV(T,this.m_localXAxis1);this.m_a1=(U+b)*this.m_axis.y-(M+D)*this.m_axis.x;this.m_a2=E*this.m_axis.y-A*this.m_axis.x;var P=this.m_axis.x*U+this.m_axis.y*M;if(o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){S=o.Clamp(P,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);I=o.Abs(P);x=true}else if(P<=this.m_lowerTranslation){S=o.Clamp(P-this.m_lowerTranslation+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);I=this.m_lowerTranslation-P;x=true}else if(P>=this.m_upperTranslation){S=o.Clamp(P-this.m_upperTranslation+i.b2_linearSlop,0,i.b2_maxLinearCorrection);I=P-this.m_upperTranslation;x=true}}this.m_perp=o.MulMV(T,this.m_localYAxis1);this.m_s1=(U+b)*this.m_perp.y-(M+D)*this.m_perp.x;this.m_s2=E*this.m_perp.y-A*this.m_perp.x;var B=new h;var L=this.m_perp.x*U+this.m_perp.y*M;var R=f-p-this.m_refAngle;I=o.Max(I,o.Abs(L));w=o.Abs(R);if(x){y=this.m_invMassA;g=this.m_invMassB;v=this.m_invIA;_=this.m_invIB;this.m_K.col1.x=y+g+v*this.m_s1*this.m_s1+_*this.m_s2*this.m_s2;this.m_K.col1.y=v*this.m_s1+_*this.m_s2;this.m_K.col1.z=v*this.m_s1*this.m_a1+_*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=v+_;this.m_K.col2.z=v*this.m_a1+_*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=y+g+v*this.m_a1*this.m_a1+_*this.m_a2*this.m_a2;this.m_K.Solve33(B,-L,-R,-S)}else{y=this.m_invMassA;g=this.m_invMassB;v=this.m_invIA;_=this.m_invIB;var O=y+g+v*this.m_s1*this.m_s1+_*this.m_s2*this.m_s2;var V=v*this.m_s1+_*this.m_s2;var W=v+_;this.m_K.col1.Set(O,V,0);this.m_K.col2.Set(V,W,0);var k=this.m_K.Solve22(new l,-L,-R);B.x=k.x;B.y=k.y;B.z=0}var F=B.x*this.m_perp.x+B.z*this.m_axis.x;var N=B.x*this.m_perp.y+B.z*this.m_axis.y;var G=B.x*this.m_s1+B.y+B.z*this.m_a1;var H=B.x*this.m_s2+B.y+B.z*this.m_a2;u.x-=this.m_invMassA*F;u.y-=this.m_invMassA*N;p-=this.m_invIA*G;c.x+=this.m_invMassB*F;c.y+=this.m_invMassB*N;f+=this.m_invIB*H;a.m_sweep.a=p;s.m_sweep.a=f;a.SynchronizeTransform();s.SynchronizeTransform();return I<=i.b2_linearSlop&&w<=i.b2_angularSlop};Box2D.inherit(C,Box2D.Dynamics.Joints.b2JointDef);C.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;C.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l;this.localAxisA=new l};C.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=false;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=false;this.maxMotorForce=0;this.motorSpeed=0};C.prototype.Initialize=function(t,e,i,n){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.localAxisA=this.bodyA.GetLocalVector(n);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(b,Box2D.Dynamics.Joints.b2Joint);b.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;b.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new l;this.m_groundAnchor2=new l;this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_u1=new l;this.m_u2=new l};b.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};b.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};b.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)};b.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};b.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();t.Add(this.m_groundAnchor1);return t};b.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();t.Add(this.m_groundAnchor2);return t};b.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1);var e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var n=t.x-e;var r=t.y-i;return Math.sqrt(n*n+r*r)};b.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2);var e=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var i=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;var n=t.x-e;var r=t.y-i;return Math.sqrt(n*n+r*r)};b.prototype.GetRatio=function(){return this.m_ratio};b.prototype.b2PulleyJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_ratio=t.ratio;this.m_constant=t.lengthA+this.m_ratio*t.lengthB;this.m_maxLength1=o.Min(t.maxLengthA,this.m_constant-this.m_ratio*b.b2_minPulleyLength);this.m_maxLength2=o.Min(t.maxLengthB,(this.m_constant-b.b2_minPulleyLength)/this.m_ratio);this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0};b.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;r=e.m_xf.R;var o=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var a=this.m_localAnchor1.y-e.m_sweep.localCenter.y;var s=r.col1.x*o+r.col2.x*a;a=r.col1.y*o+r.col2.y*a;o=s;r=n.m_xf.R;var l=this.m_localAnchor2.x-n.m_sweep.localCenter.x;var h=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=r.col1.x*l+r.col2.x*h;h=r.col1.y*l+r.col2.y*h;l=s;var u=e.m_sweep.c.x+o;var p=e.m_sweep.c.y+a;var c=n.m_sweep.c.x+l;var f=n.m_sweep.c.y+h;var m=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var d=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var y=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var v=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(u-m,p-d);this.m_u2.Set(c-y,f-v);var _=this.m_u1.Length();var I=this.m_u2.Length();if(_>i.b2_linearSlop){this.m_u1.Multiply(1/_)}else{this.m_u1.SetZero()}if(I>i.b2_linearSlop){this.m_u2.Multiply(1/I)}else{this.m_u2.SetZero()}var w=this.m_constant-_-this.m_ratio*I;if(w>0){this.m_state=g.e_inactiveLimit;this.m_impulse=0}else{this.m_state=g.e_atUpperLimit}if(_<this.m_maxLength1){this.m_limitState1=g.e_inactiveLimit;this.m_limitImpulse1=0}else{this.m_limitState1=g.e_atUpperLimit}if(I<this.m_maxLength2){this.m_limitState2=g.e_inactiveLimit;this.m_limitImpulse2=0}else{this.m_limitState2=g.e_atUpperLimit}var x=o*this.m_u1.y-a*this.m_u1.x;var S=l*this.m_u2.y-h*this.m_u2.x;this.m_limitMass1=e.m_invMass+e.m_invI*x*x;this.m_limitMass2=n.m_invMass+n.m_invI*S*S;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;if(t.warmStarting){this.m_impulse*=t.dtRatio;this.m_limitImpulse1*=t.dtRatio;this.m_limitImpulse2*=t.dtRatio;var T=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x;var C=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y;var b=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x;var D=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;e.m_linearVelocity.x+=e.m_invMass*T;e.m_linearVelocity.y+=e.m_invMass*C;e.m_angularVelocity+=e.m_invI*(o*C-a*T);n.m_linearVelocity.x+=n.m_invMass*b;n.m_linearVelocity.y+=n.m_invMass*D;n.m_angularVelocity+=n.m_invI*(l*D-h*b)}else{this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0}};b.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var a=this.m_localAnchor1.y-e.m_sweep.localCenter.y;var s=n.col1.x*r+n.col2.x*a;a=n.col1.y*r+n.col2.y*a;r=s;n=i.m_xf.R;var l=this.m_localAnchor2.x-i.m_sweep.localCenter.x;var h=this.m_localAnchor2.y-i.m_sweep.localCenter.y;s=n.col1.x*l+n.col2.x*h;h=n.col1.y*l+n.col2.y*h;l=s;var u=0;var p=0;var c=0;var f=0;var m=0;var d=0;var y=0;var v=0;var _=0;var I=0;var w=0;if(this.m_state==g.e_atUpperLimit){u=e.m_linearVelocity.x+-e.m_angularVelocity*a;p=e.m_linearVelocity.y+e.m_angularVelocity*r;c=i.m_linearVelocity.x+-i.m_angularVelocity*h;f=i.m_linearVelocity.y+i.m_angularVelocity*l;_=-(this.m_u1.x*u+this.m_u1.y*p)-this.m_ratio*(this.m_u2.x*c+this.m_u2.y*f);I=this.m_pulleyMass*-_;w=this.m_impulse;this.m_impulse=o.Max(0,this.m_impulse+I);I=this.m_impulse-w;m=-I*this.m_u1.x;d=-I*this.m_u1.y;y=-this.m_ratio*I*this.m_u2.x;v=-this.m_ratio*I*this.m_u2.y;e.m_linearVelocity.x+=e.m_invMass*m;e.m_linearVelocity.y+=e.m_invMass*d;e.m_angularVelocity+=e.m_invI*(r*d-a*m);i.m_linearVelocity.x+=i.m_invMass*y;i.m_linearVelocity.y+=i.m_invMass*v;i.m_angularVelocity+=i.m_invI*(l*v-h*y)}if(this.m_limitState1==g.e_atUpperLimit){u=e.m_linearVelocity.x+-e.m_angularVelocity*a;p=e.m_linearVelocity.y+e.m_angularVelocity*r;_=-(this.m_u1.x*u+this.m_u1.y*p);I=-this.m_limitMass1*_;w=this.m_limitImpulse1;this.m_limitImpulse1=o.Max(0,this.m_limitImpulse1+I);I=this.m_limitImpulse1-w;m=-I*this.m_u1.x;d=-I*this.m_u1.y;e.m_linearVelocity.x+=e.m_invMass*m;e.m_linearVelocity.y+=e.m_invMass*d;e.m_angularVelocity+=e.m_invI*(r*d-a*m)}if(this.m_limitState2==g.e_atUpperLimit){c=i.m_linearVelocity.x+-i.m_angularVelocity*h;f=i.m_linearVelocity.y+i.m_angularVelocity*l;_=-(this.m_u2.x*c+this.m_u2.y*f);I=-this.m_limitMass2*_;w=this.m_limitImpulse2;this.m_limitImpulse2=o.Max(0,this.m_limitImpulse2+I);I=this.m_limitImpulse2-w;y=-I*this.m_u2.x;v=-I*this.m_u2.y;i.m_linearVelocity.x+=i.m_invMass*y;i.m_linearVelocity.y+=i.m_invMass*v;i.m_angularVelocity+=i.m_invI*(l*v-h*y)}};b.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=this.m_bodyA;var n=this.m_bodyB;var r;var a=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var s=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var h=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;var u=0;var p=0;var c=0;var f=0;var m=0;var d=0;var y=0;var v=0;var _=0;var I=0;var w=0;var x=0;var S=0;var T=0;var C=0;var b=0;if(this.m_state==g.e_atUpperLimit){r=e.m_xf.R;u=this.m_localAnchor1.x-e.m_sweep.localCenter.x;p=this.m_localAnchor1.y-e.m_sweep.localCenter.y;C=r.col1.x*u+r.col2.x*p;p=r.col1.y*u+r.col2.y*p;u=C;r=n.m_xf.R;c=this.m_localAnchor2.x-n.m_sweep.localCenter.x;f=this.m_localAnchor2.y-n.m_sweep.localCenter.y;C=r.col1.x*c+r.col2.x*f;f=r.col1.y*c+r.col2.y*f;c=C;m=e.m_sweep.c.x+u;d=e.m_sweep.c.y+p;y=n.m_sweep.c.x+c;v=n.m_sweep.c.y+f;this.m_u1.Set(m-a,d-s);this.m_u2.Set(y-l,v-h);_=this.m_u1.Length();I=this.m_u2.Length();if(_>i.b2_linearSlop){this.m_u1.Multiply(1/_)}else{this.m_u1.SetZero()}if(I>i.b2_linearSlop){this.m_u2.Multiply(1/I)}else{this.m_u2.SetZero()}w=this.m_constant-_-this.m_ratio*I;b=o.Max(b,-w);w=o.Clamp(w+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);x=-this.m_pulleyMass*w;m=-x*this.m_u1.x;d=-x*this.m_u1.y;y=-this.m_ratio*x*this.m_u2.x;v=-this.m_ratio*x*this.m_u2.y;e.m_sweep.c.x+=e.m_invMass*m;e.m_sweep.c.y+=e.m_invMass*d;e.m_sweep.a+=e.m_invI*(u*d-p*m);n.m_sweep.c.x+=n.m_invMass*y;n.m_sweep.c.y+=n.m_invMass*v;n.m_sweep.a+=n.m_invI*(c*v-f*y);e.SynchronizeTransform();n.SynchronizeTransform()}if(this.m_limitState1==g.e_atUpperLimit){r=e.m_xf.R;u=this.m_localAnchor1.x-e.m_sweep.localCenter.x;p=this.m_localAnchor1.y-e.m_sweep.localCenter.y;C=r.col1.x*u+r.col2.x*p;p=r.col1.y*u+r.col2.y*p;u=C;m=e.m_sweep.c.x+u;d=e.m_sweep.c.y+p;this.m_u1.Set(m-a,d-s);_=this.m_u1.Length();if(_>i.b2_linearSlop){this.m_u1.x*=1/_;this.m_u1.y*=1/_}else{this.m_u1.SetZero()}w=this.m_maxLength1-_;b=o.Max(b,-w);w=o.Clamp(w+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);x=-this.m_limitMass1*w;m=-x*this.m_u1.x;d=-x*this.m_u1.y;e.m_sweep.c.x+=e.m_invMass*m;e.m_sweep.c.y+=e.m_invMass*d;e.m_sweep.a+=e.m_invI*(u*d-p*m);e.SynchronizeTransform()}if(this.m_limitState2==g.e_atUpperLimit){r=n.m_xf.R;c=this.m_localAnchor2.x-n.m_sweep.localCenter.x;f=this.m_localAnchor2.y-n.m_sweep.localCenter.y;C=r.col1.x*c+r.col2.x*f;f=r.col1.y*c+r.col2.y*f;c=C;y=n.m_sweep.c.x+c;v=n.m_sweep.c.y+f;this.m_u2.Set(y-l,v-h);I=this.m_u2.Length();if(I>i.b2_linearSlop){this.m_u2.x*=1/I;this.m_u2.y*=1/I}else{this.m_u2.SetZero()}w=this.m_maxLength2-I;b=o.Max(b,-w);w=o.Clamp(w+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);x=-this.m_limitMass2*w;y=-x*this.m_u2.x;v=-x*this.m_u2.y;n.m_sweep.c.x+=n.m_invMass*y;n.m_sweep.c.y+=n.m_invMass*v;n.m_sweep.a+=n.m_invI*(c*v-f*y);n.SynchronizeTransform()}return b<i.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});Box2D.inherit(D,Box2D.Dynamics.Joints.b2JointDef);D.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;D.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new l;this.groundAnchorB=new l;this.localAnchorA=new l;this.localAnchorB=new l};D.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.lengthA=0;this.maxLengthA=0;this.lengthB=0;this.maxLengthB=0;this.ratio=1;this.collideConnected=true};D.prototype.Initialize=function(t,e,i,n,r,o,a){if(a===undefined)a=0;this.bodyA=t;this.bodyB=e;this.groundAnchorA.SetV(i);this.groundAnchorB.SetV(n);this.localAnchorA=this.bodyA.GetLocalPoint(r);this.localAnchorB=this.bodyB.GetLocalPoint(o);var s=r.x-i.x;var l=r.y-i.y;this.lengthA=Math.sqrt(s*s+l*l);var h=o.x-n.x;var u=o.y-n.y;this.lengthB=Math.sqrt(h*h+u*u);this.ratio=a;var p=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=p-this.ratio*b.b2_minPulleyLength;this.maxLengthB=(p-b.b2_minPulleyLength)/this.ratio};Box2D.inherit(E,Box2D.Dynamics.Joints.b2Joint);E.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;E.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new n;this.K1=new n;this.K2=new n;this.K3=new n;this.impulse3=new h;this.impulse2=new l;this.reduced=new l;this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_impulse=new h;this.m_mass=new r};E.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};E.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};E.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse.x,t*this.m_impulse.y)};E.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.z};E.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};E.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};E.prototype.IsLimitEnabled=function(){return this.m_enableLimit};E.prototype.EnableLimit=function(t){this.m_enableLimit=t};E.prototype.GetLowerLimit=function(){return this.m_lowerAngle};E.prototype.GetUpperLimit=function(){return this.m_upperAngle};E.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_lowerAngle=t;this.m_upperAngle=e};E.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);return this.m_enableMotor};E.prototype.EnableMotor=function(t){this.m_enableMotor=t};E.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};E.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};E.prototype.SetMaxMotorTorque=function(t){if(t===undefined)t=0;this.m_maxMotorTorque=t};E.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};E.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_referenceAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=t.lowerAngle;this.m_upperAngle=t.upperAngle;this.m_maxMotorTorque=t.maxMotorTorque;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=g.e_inactiveLimit};E.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;var a=0;if(this.m_enableMotor||this.m_enableLimit){}r=e.m_xf.R;var s=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var l=this.m_localAnchor1.y-e.m_sweep.localCenter.y;a=r.col1.x*s+r.col2.x*l;l=r.col1.y*s+r.col2.y*l;s=a;r=n.m_xf.R;var h=this.m_localAnchor2.x-n.m_sweep.localCenter.x;var u=this.m_localAnchor2.y-n.m_sweep.localCenter.y;a=r.col1.x*h+r.col2.x*u;u=r.col1.y*h+r.col2.y*u;h=a;var p=e.m_invMass;var c=n.m_invMass;var f=e.m_invI;var m=n.m_invI;this.m_mass.col1.x=p+c+l*l*f+u*u*m;this.m_mass.col2.x=-l*s*f-u*h*m;this.m_mass.col3.x=-l*f-u*m;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=p+c+s*s*f+h*h*m;this.m_mass.col3.y=s*f+h*m;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=f+m;this.m_motorMass=1/(f+m);if(this.m_enableMotor==false){this.m_motorImpulse=0}if(this.m_enableLimit){var d=n.m_sweep.a-e.m_sweep.a-this.m_referenceAngle;if(o.Abs(this.m_upperAngle-this.m_lowerAngle)<2*i.b2_angularSlop){this.m_limitState=g.e_equalLimits}else if(d<=this.m_lowerAngle){if(this.m_limitState!=g.e_atLowerLimit){this.m_impulse.z=0}this.m_limitState=g.e_atLowerLimit}else if(d>=this.m_upperAngle){if(this.m_limitState!=g.e_atUpperLimit){this.m_impulse.z=0}this.m_limitState=g.e_atUpperLimit}else{this.m_limitState=g.e_inactiveLimit;this.m_impulse.z=0}}else{this.m_limitState=g.e_inactiveLimit;
}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var y=this.m_impulse.x;var v=this.m_impulse.y;e.m_linearVelocity.x-=p*y;e.m_linearVelocity.y-=p*v;e.m_angularVelocity-=f*(s*v-l*y+this.m_motorImpulse+this.m_impulse.z);n.m_linearVelocity.x+=c*y;n.m_linearVelocity.y+=c*v;n.m_angularVelocity+=m*(h*v-u*y+this.m_motorImpulse+this.m_impulse.z)}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};E.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n;var r=0;var a=0;var s=0;var l=0;var h=0;var u=0;var p=e.m_linearVelocity;var c=e.m_angularVelocity;var f=i.m_linearVelocity;var m=i.m_angularVelocity;var d=e.m_invMass;var y=i.m_invMass;var v=e.m_invI;var _=i.m_invI;if(this.m_enableMotor&&this.m_limitState!=g.e_equalLimits){var I=m-c-this.m_motorSpeed;var w=this.m_motorMass*-I;var x=this.m_motorImpulse;var S=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+w,-S,S);w=this.m_motorImpulse-x;c-=v*w;m+=_*w}if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){n=e.m_xf.R;s=this.m_localAnchor1.x-e.m_sweep.localCenter.x;l=this.m_localAnchor1.y-e.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*l;l=n.col1.y*s+n.col2.y*l;s=r;n=i.m_xf.R;h=this.m_localAnchor2.x-i.m_sweep.localCenter.x;u=this.m_localAnchor2.y-i.m_sweep.localCenter.y;r=n.col1.x*h+n.col2.x*u;u=n.col1.y*h+n.col2.y*u;h=r;var T=f.x+-m*u-p.x- -c*l;var C=f.y+m*h-p.y-c*s;var b=m-c;this.m_mass.Solve33(this.impulse3,-T,-C,-b);if(this.m_limitState==g.e_equalLimits){this.m_impulse.Add(this.impulse3)}else if(this.m_limitState==g.e_atLowerLimit){a=this.m_impulse.z+this.impulse3.z;if(a<0){this.m_mass.Solve22(this.reduced,-T,-C);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}else if(this.m_limitState==g.e_atUpperLimit){a=this.m_impulse.z+this.impulse3.z;if(a>0){this.m_mass.Solve22(this.reduced,-T,-C);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}p.x-=d*this.impulse3.x;p.y-=d*this.impulse3.y;c-=v*(s*this.impulse3.y-l*this.impulse3.x+this.impulse3.z);f.x+=y*this.impulse3.x;f.y+=y*this.impulse3.y;m+=_*(h*this.impulse3.y-u*this.impulse3.x+this.impulse3.z)}else{n=e.m_xf.R;s=this.m_localAnchor1.x-e.m_sweep.localCenter.x;l=this.m_localAnchor1.y-e.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*l;l=n.col1.y*s+n.col2.y*l;s=r;n=i.m_xf.R;h=this.m_localAnchor2.x-i.m_sweep.localCenter.x;u=this.m_localAnchor2.y-i.m_sweep.localCenter.y;r=n.col1.x*h+n.col2.x*u;u=n.col1.y*h+n.col2.y*u;h=r;var D=f.x+-m*u-p.x- -c*l;var E=f.y+m*h-p.y-c*s;this.m_mass.Solve22(this.impulse2,-D,-E);this.m_impulse.x+=this.impulse2.x;this.m_impulse.y+=this.impulse2.y;p.x-=d*this.impulse2.x;p.y-=d*this.impulse2.y;c-=v*(s*this.impulse2.y-l*this.impulse2.x);f.x+=y*this.impulse2.x;f.y+=y*this.impulse2.y;m+=_*(h*this.impulse2.y-u*this.impulse2.x)}e.m_linearVelocity.SetV(p);e.m_angularVelocity=c;i.m_linearVelocity.SetV(f);i.m_angularVelocity=m};E.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var n=0;var r;var a=this.m_bodyA;var s=this.m_bodyB;var l=0;var h=0;var u=0;var p=0;var c=0;if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){var f=s.m_sweep.a-a.m_sweep.a-this.m_referenceAngle;var m=0;if(this.m_limitState==g.e_equalLimits){n=o.Clamp(f-this.m_lowerAngle,-i.b2_maxAngularCorrection,i.b2_maxAngularCorrection);m=-this.m_motorMass*n;l=o.Abs(n)}else if(this.m_limitState==g.e_atLowerLimit){n=f-this.m_lowerAngle;l=-n;n=o.Clamp(n+i.b2_angularSlop,-i.b2_maxAngularCorrection,0);m=-this.m_motorMass*n}else if(this.m_limitState==g.e_atUpperLimit){n=f-this.m_upperAngle;l=n;n=o.Clamp(n-i.b2_angularSlop,0,i.b2_maxAngularCorrection);m=-this.m_motorMass*n}a.m_sweep.a-=a.m_invI*m;s.m_sweep.a+=s.m_invI*m;a.SynchronizeTransform();s.SynchronizeTransform()}{r=a.m_xf.R;var d=this.m_localAnchor1.x-a.m_sweep.localCenter.x;var y=this.m_localAnchor1.y-a.m_sweep.localCenter.y;u=r.col1.x*d+r.col2.x*y;y=r.col1.y*d+r.col2.y*y;d=u;r=s.m_xf.R;var v=this.m_localAnchor2.x-s.m_sweep.localCenter.x;var _=this.m_localAnchor2.y-s.m_sweep.localCenter.y;u=r.col1.x*v+r.col2.x*_;_=r.col1.y*v+r.col2.y*_;v=u;var I=s.m_sweep.c.x+v-a.m_sweep.c.x-d;var w=s.m_sweep.c.y+_-a.m_sweep.c.y-y;var x=I*I+w*w;var S=Math.sqrt(x);h=S;var T=a.m_invMass;var C=s.m_invMass;var b=a.m_invI;var D=s.m_invI;var A=10*i.b2_linearSlop;if(x>A*A){var U=I/S;var M=w/S;var P=T+C;var B=1/P;p=B*-I;c=B*-w;var L=.5;a.m_sweep.c.x-=L*T*p;a.m_sweep.c.y-=L*T*c;s.m_sweep.c.x+=L*C*p;s.m_sweep.c.y+=L*C*c;I=s.m_sweep.c.x+v-a.m_sweep.c.x-d;w=s.m_sweep.c.y+_-a.m_sweep.c.y-y}this.K1.col1.x=T+C;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=T+C;this.K2.col1.x=b*y*y;this.K2.col2.x=-b*d*y;this.K2.col1.y=-b*d*y;this.K2.col2.y=b*d*d;this.K3.col1.x=D*_*_;this.K3.col2.x=-D*v*_;this.K3.col1.y=-D*v*_;this.K3.col2.y=D*v*v;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(E.tImpulse,-I,-w);p=E.tImpulse.x;c=E.tImpulse.y;a.m_sweep.c.x-=a.m_invMass*p;a.m_sweep.c.y-=a.m_invMass*c;a.m_sweep.a-=a.m_invI*(d*c-y*p);s.m_sweep.c.x+=s.m_invMass*p;s.m_sweep.c.y+=s.m_invMass*c;s.m_sweep.a+=s.m_invI*(v*c-_*p);a.SynchronizeTransform();s.SynchronizeTransform()}return h<=i.b2_linearSlop&&l<=i.b2_angularSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new l});Box2D.inherit(A,Box2D.Dynamics.Joints.b2JointDef);A.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;A.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l};A.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.referenceAngle=0;this.lowerAngle=0;this.upperAngle=0;this.maxMotorTorque=0;this.motorSpeed=0;this.enableLimit=false;this.enableMotor=false};A.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(U,Box2D.Dynamics.Joints.b2Joint);U.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;U.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new l;this.m_localAnchorB=new l;this.m_impulse=new h;this.m_mass=new r};U.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};U.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};U.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse.x,t*this.m_impulse.y)};U.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.z};U.prototype.b2WeldJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchorA.SetV(t.localAnchorA);this.m_localAnchorB.SetV(t.localAnchorB);this.m_referenceAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_mass=new r};U.prototype.InitVelocityConstraints=function(t){var e;var i=0;var n=this.m_bodyA;var r=this.m_bodyB;e=n.m_xf.R;var o=this.m_localAnchorA.x-n.m_sweep.localCenter.x;var a=this.m_localAnchorA.y-n.m_sweep.localCenter.y;i=e.col1.x*o+e.col2.x*a;a=e.col1.y*o+e.col2.y*a;o=i;e=r.m_xf.R;var s=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var l=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*s+e.col2.x*l;l=e.col1.y*s+e.col2.y*l;s=i;var h=n.m_invMass;var u=r.m_invMass;var p=n.m_invI;var c=r.m_invI;this.m_mass.col1.x=h+u+a*a*p+l*l*c;this.m_mass.col2.x=-a*o*p-l*s*c;this.m_mass.col3.x=-a*p-l*c;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=h+u+o*o*p+s*s*c;this.m_mass.col3.y=o*p+s*c;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=p+c;if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_impulse.z*=t.dtRatio;n.m_linearVelocity.x-=h*this.m_impulse.x;n.m_linearVelocity.y-=h*this.m_impulse.y;n.m_angularVelocity-=p*(o*this.m_impulse.y-a*this.m_impulse.x+this.m_impulse.z);r.m_linearVelocity.x+=u*this.m_impulse.x;r.m_linearVelocity.y+=u*this.m_impulse.y;r.m_angularVelocity+=c*(s*this.m_impulse.y-l*this.m_impulse.x+this.m_impulse.z)}else{this.m_impulse.SetZero()}};U.prototype.SolveVelocityConstraints=function(t){var e;var i=0;var n=this.m_bodyA;var r=this.m_bodyB;var o=n.m_linearVelocity;var a=n.m_angularVelocity;var s=r.m_linearVelocity;var l=r.m_angularVelocity;var u=n.m_invMass;var p=r.m_invMass;var c=n.m_invI;var f=r.m_invI;e=n.m_xf.R;var m=this.m_localAnchorA.x-n.m_sweep.localCenter.x;var d=this.m_localAnchorA.y-n.m_sweep.localCenter.y;i=e.col1.x*m+e.col2.x*d;d=e.col1.y*m+e.col2.y*d;m=i;e=r.m_xf.R;var y=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var g=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*y+e.col2.x*g;g=e.col1.y*y+e.col2.y*g;y=i;var v=s.x-l*g-o.x+a*d;var _=s.y+l*y-o.y-a*m;var I=l-a;var w=new h;this.m_mass.Solve33(w,-v,-_,-I);this.m_impulse.Add(w);o.x-=u*w.x;o.y-=u*w.y;a-=c*(m*w.y-d*w.x+w.z);s.x+=p*w.x;s.y+=p*w.y;l+=f*(y*w.y-g*w.x+w.z);n.m_angularVelocity=a;r.m_angularVelocity=l};U.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e;var n=0;var r=this.m_bodyA;var a=this.m_bodyB;e=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x;var l=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=e.col1.x*s+e.col2.x*l;l=e.col1.y*s+e.col2.y*l;s=n;e=a.m_xf.R;var u=this.m_localAnchorB.x-a.m_sweep.localCenter.x;var p=this.m_localAnchorB.y-a.m_sweep.localCenter.y;n=e.col1.x*u+e.col2.x*p;p=e.col1.y*u+e.col2.y*p;u=n;var c=r.m_invMass;var f=a.m_invMass;var m=r.m_invI;var d=a.m_invI;var y=a.m_sweep.c.x+u-r.m_sweep.c.x-s;var g=a.m_sweep.c.y+p-r.m_sweep.c.y-l;var v=a.m_sweep.a-r.m_sweep.a-this.m_referenceAngle;var _=10*i.b2_linearSlop;var I=Math.sqrt(y*y+g*g);var w=o.Abs(v);if(I>_){m*=1;d*=1}this.m_mass.col1.x=c+f+l*l*m+p*p*d;this.m_mass.col2.x=-l*s*m-p*u*d;this.m_mass.col3.x=-l*m-p*d;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=c+f+s*s*m+u*u*d;this.m_mass.col3.y=s*m+u*d;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=m+d;var x=new h;this.m_mass.Solve33(x,-y,-g,-v);r.m_sweep.c.x-=c*x.x;r.m_sweep.c.y-=c*x.y;r.m_sweep.a-=m*(s*x.y-l*x.x+x.z);a.m_sweep.c.x+=f*x.x;a.m_sweep.c.y+=f*x.y;a.m_sweep.a+=d*(u*x.y-p*x.x+x.z);r.SynchronizeTransform();a.SynchronizeTransform();return I<=i.b2_linearSlop&&w<=i.b2_angularSlop};Box2D.inherit(M,Box2D.Dynamics.Joints.b2JointDef);M.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;M.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l};M.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_weldJoint;this.referenceAngle=0};M.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();(function(){var t=Box2D.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_drawScale=1;this.m_lineThickness=1;this.m_alpha=1;this.m_fillAlpha=1;this.m_xformScale=1;var t=this;this.m_sprite={graphics:{clear:function(){t.m_ctx.clearRect(0,0,t.m_ctx.canvas.width,t.m_ctx.canvas.height)}}}};t.prototype._color=function(t,e){return"rgba("+((t&16711680)>>16)+","+((t&65280)>>8)+","+(t&255)+","+e+")"};t.prototype.b2DebugDraw=function(){this.m_drawFlags=0};t.prototype.SetFlags=function(t){if(t===undefined)t=0;this.m_drawFlags=t};t.prototype.GetFlags=function(){return this.m_drawFlags};t.prototype.AppendFlags=function(t){if(t===undefined)t=0;this.m_drawFlags|=t};t.prototype.ClearFlags=function(t){if(t===undefined)t=0;this.m_drawFlags&=~t};t.prototype.SetSprite=function(t){this.m_ctx=t};t.prototype.GetSprite=function(){return this.m_ctx};t.prototype.SetDrawScale=function(t){if(t===undefined)t=0;this.m_drawScale=t};t.prototype.GetDrawScale=function(){return this.m_drawScale};t.prototype.SetLineThickness=function(t){if(t===undefined)t=0;this.m_lineThickness=t;this.m_ctx.strokeWidth=t};t.prototype.GetLineThickness=function(){return this.m_lineThickness};t.prototype.SetAlpha=function(t){if(t===undefined)t=0;this.m_alpha=t};t.prototype.GetAlpha=function(){return this.m_alpha};t.prototype.SetFillAlpha=function(t){if(t===undefined)t=0;this.m_fillAlpha=t};t.prototype.GetFillAlpha=function(){return this.m_fillAlpha};t.prototype.SetXFormScale=function(t){if(t===undefined)t=0;this.m_xformScale=t};t.prototype.GetXFormScale=function(){return this.m_xformScale};t.prototype.DrawPolygon=function(t,e,i){if(!e)return;var n=this.m_ctx;var r=this.m_drawScale;n.beginPath();n.strokeStyle=this._color(i.color,this.m_alpha);n.moveTo(t[0].x*r,t[0].y*r);for(var o=1;o<e;o++){n.lineTo(t[o].x*r,t[o].y*r)}n.lineTo(t[0].x*r,t[0].y*r);n.closePath();n.stroke()};t.prototype.DrawSolidPolygon=function(t,e,i){if(!e)return;var n=this.m_ctx;var r=this.m_drawScale;n.beginPath();n.strokeStyle=this._color(i.color,this.m_alpha);n.fillStyle=this._color(i.color,this.m_fillAlpha);n.moveTo(t[0].x*r,t[0].y*r);for(var o=1;o<e;o++){n.lineTo(t[o].x*r,t[o].y*r)}n.lineTo(t[0].x*r,t[0].y*r);n.closePath();n.fill();n.stroke()};t.prototype.DrawCircle=function(t,e,i){if(!e)return;var n=this.m_ctx;var r=this.m_drawScale;n.beginPath();n.strokeStyle=this._color(i.color,this.m_alpha);n.arc(t.x*r,t.y*r,e*r,0,Math.PI*2,true);n.closePath();n.stroke()};t.prototype.DrawSolidCircle=function(t,e,i,n){if(!e)return;var r=this.m_ctx,o=this.m_drawScale,a=t.x*o,s=t.y*o;r.moveTo(0,0);r.beginPath();r.strokeStyle=this._color(n.color,this.m_alpha);r.fillStyle=this._color(n.color,this.m_fillAlpha);r.arc(a,s,e*o,0,Math.PI*2,true);r.moveTo(a,s);r.lineTo((t.x+i.x*e)*o,(t.y+i.y*e)*o);r.closePath();r.fill();r.stroke()};t.prototype.DrawSegment=function(t,e,i){var n=this.m_ctx,r=this.m_drawScale;n.strokeStyle=this._color(i.color,this.m_alpha);n.beginPath();n.moveTo(t.x*r,t.y*r);n.lineTo(e.x*r,e.y*r);n.closePath();n.stroke()};t.prototype.DrawTransform=function(t){var e=this.m_ctx,i=this.m_drawScale;e.beginPath();e.strokeStyle=this._color(16711680,this.m_alpha);e.moveTo(t.position.x*i,t.position.y*i);e.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*i,(t.position.y+this.m_xformScale*t.R.col1.y)*i);e.strokeStyle=this._color(65280,this.m_alpha);e.moveTo(t.position.x*i,t.position.y*i);e.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*i,(t.position.y+this.m_xformScale*t.R.col2.y)*i);e.closePath();e.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;if(typeof require!=="undefined"&&typeof module!=="undefined"){module.exports=Box2D}window.b2Color=Box2D.Common.b2Color,window.b2internal=Box2D.Common.b2internal,window.b2Settings=Box2D.Common.b2Settings,window.b2CircleShape=Box2D.Collision.Shapes.b2CircleShape,window.b2EdgeChainDef=Box2D.Collision.Shapes.b2EdgeChainDef,window.b2EdgeShape=Box2D.Collision.Shapes.b2EdgeShape,window.b2MassData=Box2D.Collision.Shapes.b2MassData,window.b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,window.b2Shape=Box2D.Collision.Shapes.b2Shape,window.b2Mat22=Box2D.Common.Math.b2Mat22,window.b2Mat33=Box2D.Common.Math.b2Mat33,window.b2Math=Box2D.Common.Math.b2Math,window.b2Sweep=Box2D.Common.Math.b2Sweep,window.b2Transform=Box2D.Common.Math.b2Transform,window.b2Vec2=Box2D.Common.Math.b2Vec2,window.b2Vec3=Box2D.Common.Math.b2Vec3,window.b2Body=Box2D.Dynamics.b2Body,window.b2BodyDef=Box2D.Dynamics.b2BodyDef,window.b2ContactFilter=Box2D.Dynamics.b2ContactFilter,window.b2ContactImpulse=Box2D.Dynamics.b2ContactImpulse,window.b2ContactListener=Box2D.Dynamics.b2ContactListener,window.b2ContactManager=Box2D.Dynamics.b2ContactManager,window.b2DebugDraw=Box2D.Dynamics.b2DebugDraw,window.b2DestructionListener=Box2D.Dynamics.b2DestructionListener,window.b2FilterData=Box2D.Dynamics.b2FilterData,window.b2Fixture=Box2D.Dynamics.b2Fixture,window.b2FixtureDef=Box2D.Dynamics.b2FixtureDef,window.b2Island=Box2D.Dynamics.b2Island,window.b2TimeStep=Box2D.Dynamics.b2TimeStep,window.b2World=Box2D.Dynamics.b2World,window.b2AABB=Box2D.Collision.b2AABB,window.b2Bound=Box2D.Collision.b2Bound,window.b2BoundValues=Box2D.Collision.b2BoundValues,window.b2Collision=Box2D.Collision.b2Collision,window.b2ContactID=Box2D.Collision.b2ContactID,window.b2ContactPoint=Box2D.Collision.b2ContactPoint,window.b2Distance=Box2D.Collision.b2Distance,window.b2DistanceInput=Box2D.Collision.b2DistanceInput,window.b2DistanceOutput=Box2D.Collision.b2DistanceOutput,window.b2DistanceProxy=Box2D.Collision.b2DistanceProxy,window.b2DynamicTree=Box2D.Collision.b2DynamicTree,window.b2DynamicTreeBroadPhase=Box2D.Collision.b2DynamicTreeBroadPhase,window.b2DynamicTreeNode=Box2D.Collision.b2DynamicTreeNode,window.b2DynamicTreePair=Box2D.Collision.b2DynamicTreePair,window.b2Manifold=Box2D.Collision.b2Manifold,window.b2ManifoldPoint=Box2D.Collision.b2ManifoldPoint,window.b2Point=Box2D.Collision.b2Point,window.b2RayCastInput=Box2D.Collision.b2RayCastInput,window.b2RayCastOutput=Box2D.Collision.b2RayCastOutput,window.b2Segment=Box2D.Collision.b2Segment,window.b2SeparationFunction=Box2D.Collision.b2SeparationFunction,window.b2Simplex=Box2D.Collision.b2Simplex,window.b2SimplexCache=Box2D.Collision.b2SimplexCache,window.b2SimplexVertex=Box2D.Collision.b2SimplexVertex,window.b2TimeOfImpact=Box2D.Collision.b2TimeOfImpact,window.b2TOIInput=Box2D.Collision.b2TOIInput,window.b2WorldManifold=Box2D.Collision.b2WorldManifold,window.b2DistanceJoint=Box2D.Dynamics.Joints.b2DistanceJoint,window.b2DistanceJointDef=Box2D.Dynamics.Joints.b2DistanceJointDef,window.b2FrictionJoint=Box2D.Dynamics.Joints.b2FrictionJoint,window.b2FrictionJointDef=Box2D.Dynamics.Joints.b2FrictionJointDef,window.b2GearJoint=Box2D.Dynamics.Joints.b2GearJoint,window.b2GearJointDef=Box2D.Dynamics.Joints.b2GearJointDef,window.b2Jacobian=Box2D.Dynamics.Joints.b2Jacobian,window.b2Joint=Box2D.Dynamics.Joints.b2Joint,window.b2JointDef=Box2D.Dynamics.Joints.b2JointDef,window.b2JointEdge=Box2D.Dynamics.Joints.b2JointEdge,window.b2LineJoint=Box2D.Dynamics.Joints.b2LineJoint,window.b2LineJointDef=Box2D.Dynamics.Joints.b2LineJointDef,window.b2MouseJoint=Box2D.Dynamics.Joints.b2MouseJoint,window.b2MouseJointDef=Box2D.Dynamics.Joints.b2MouseJointDef,window.b2PrismaticJoint=Box2D.Dynamics.Joints.b2PrismaticJoint,window.b2PrismaticJointDef=Box2D.Dynamics.Joints.b2PrismaticJointDef,window.b2PulleyJoint=Box2D.Dynamics.Joints.b2PulleyJoint,window.b2PulleyJointDef=Box2D.Dynamics.Joints.b2PulleyJointDef,window.b2RevoluteJoint=Box2D.Dynamics.Joints.b2RevoluteJoint,window.b2RevoluteJointDef=Box2D.Dynamics.Joints.b2RevoluteJointDef,window.b2WeldJoint=Box2D.Dynamics.Joints.b2WeldJoint,window.b2WeldJointDef=Box2D.Dynamics.Joints.b2WeldJointDef;function UIWeixin(){return}UIWeixin.prototype=new UIElement;UIWeixin.prototype.isUIWeixin=true;UIWeixin.prototype.initUIWeixin=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,n);this.setCanRectSelectable(false,true);return this};UIWeixin.prototype.onAppendedInParent=function(){TangideApp.addUserScript("http://res.wx.qq.com/open/js/jweixin-1.0.0.js");return};UIWeixin.jsApiList=["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","translateVoice","startRecord","stopRecord","onRecordEnd","playVoice","pauseVoice","stopVoice","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"];UIWeixin.prototype.getConfig=function(t,e,i){if(UIWeixin.config){return}else{UIWeixin.config={}}httpGetJSON(t,function n(t){UIWeixin.config=t;if(UIWeixin.config){UIWeixin.config.jsApiList=e;UIWeixin.config.debug=i;console.log("Fetch UIWeixin.config success:")}else{console.log("Fetch weixin config failed.");return}function n(){try{wx.config(UIWeixin.config);UIWeixin.configDone=true;console.log(JSON.stringify(UIWeixin.config,null,"	"));console.log("Call wx.config done:")}catch(t){console.log("wx script is not load yet, try to config lator:");setTimeout(n,100)}}if(isWeiXin()){console.log("Is WeiXin, try to config it.");n()}else{console.log("It is not weixin browser")}})};UIWeixin.prototype.onFromJsonDone=function(){var t=window.btoa(location.href);var e=null;if(location.href.indexOf("i5r.com.cn")>=0){e=this.configURL?this.configURL:"/weixin/php/json_config.php"}else{e=this.configURL?this.configURL:"/wechat/config"}if(e.indexOf("?")>0){e=e+"&url="+t}else{e=e+"?url="+t}var i=UIWeixin.jsApiList;if(this.apiList){i=this.apiList.split("\n")}this.getConfig(e,i,this.debug);return};UIWeixin.prototype.onInit=function(){var t=this;if(!window.wx){console.log("UIWeixin.prototype.onInit wx not defined.");return}wx.ready(function(){UIWeixin.ready=true;t.updateShareInfo();console.log("wx.ready")});wx.error(function(t){});console.log("UIWeixin.prototype.onInit end");return};UIWeixin.prototype.onDeinit=function(){return};UIWeixin.prototype.shapeCanBeChild=function(t){return false};UIWeixin.prototype.setShareTitle=function(t){this.shareTitle=t;this.updateShareInfo();return this};UIWeixin.prototype.setShareDesc=function(t){this.shareDesc=t;this.updateShareInfo();return this};UIWeixin.prototype.setShareLink=function(t){this.shareLink=t;this.updateShareInfo();return this};UIWeixin.prototype.setShareImage=function(t){this.shareImage=t;this.updateShareInfo();return this};UIWeixin.prototype.updateShareInfo=function(){if(!window.wx){return}var t=this.view;var e=this.shareTitle?this.shareTitle:t.getAppName();var i=this.shareDesc?this.shareDesc:t.getAppDesc();var n=this.shareLink?this.shareLink:location.href;var r=ResLoader.toAbsURL(this.shareImage?this.shareImage:t.getAppIcon());var o={title:e,desc:i,link:n,imgUrl:r,trigger:function(t){console.log("weixin operation trigger:"+JSON.stringify(t))},success:function(t){console.log("weixin operation success:"+JSON.stringify(t))},cancel:function(t){console.log("weixin operation cancel:"+JSON.stringify(t))},fail:function(t){console.log("weixin operation fail:"+JSON.stringify(t))}};wx.onMenuShareAppMessage(o);wx.onMenuShareTimeline(o);wx.onMenuShareQQ(o);wx.onMenuShareWeibo(o);return};function UIWeixinCreator(){var t=["ui-weixin","ui-weixin",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIWeixin;return e.initUIWeixin(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIWeixinCreator);if(!window.CanTK){window.CanTK={}}CanTK.isOldIE=isOldIE;CanTK.isTizen=isTizen;CanTK.isMobile=isMobile;CanTK.isAndroid=isAndroid;CanTK.isFirefoxOS=isFirefoxOS;CanTK.isRightMouseEvent=isRightMouseEvent;CanTK.delayLoadScripts=delayLoadScripts;CanTK.initViewPort=cantkInitViewPort;CanTK.restoreViewPort=cantkRestoreViewPort;CanTK.httpGetURL=httpGetURL;CanTK.httpGetJSON=httpGetJSON;CanTK.httpDoRequest=httpDoRequest;CanTK.LinearInterpolator=LinearInterpolator;CanTK.BounceInterpolator=BounceInterpolator;CanTK.AccelerateInterpolator=AccelerateInterpolator;CanTK.AccDecelerateInterpolator=AccDecelerateInterpolator;CanTK.DecelerateInterpolator=DecelerateInterpolator;CanTK.detectDeviceConfig=cantkDetectDeviceConfig;CanTK.regShapeCreator=cantkRegShapeCreator;CanTK.ShapeCreator=ShapeCreator;window.isOldIE=isOldIE;window.isTizen=isTizen;window.isMobile=isMobile;window.isAndroid=isAndroid;window.isFirefoxOS=isFirefoxOS;window.httpGetURL=httpGetURL;window.httpGetJSON=httpGetJSON;window.httpDoRequest=httpDoRequest;window.cantkGetLocale=cantkGetLocale;window.cantkInitViewPort=cantkInitViewPort;window.cantkRestoreViewPort=cantkRestoreViewPort;window.cantkRegisterUIElements=cantkRegisterUIElements;window.cantkGetViewPort=cantkGetViewPort;window.Shape=Shape;window.UIElement=UIElement;window.UIWindowManager=UIWindowManager;window.ShapeFactory=ShapeFactory;CanTK.UIImage=UIImage;CanTK.Physics=Physics;CanTK.Shape=Shape;CanTK.UIElement=UIElement;CanTK.init=function(){return cantkRegisterUIElements()};CanTK.createElement=function(t){return ShapeFactoryGet().createShape(t,C_CREATE_FOR_PROGRAM)};CanTK.createElementWithJson=function(t){var e=t.type;var i=ShapeFactoryGet().createShape(e,C_CREATE_FOR_PROGRAM);if(i){i.fromJson(t);i.setMode(Shape.MODE_RUNNING,true)}return i};CanTK.UIElement.RUNNING=Shape.MODE_RUNNING;CanTK.UIElement.DEFAULT_IMAGE=UIElement.IMAGE_DEFAULT;CanTK.setResRoot=function(t){return ResLoader.setResRoot(t)};function HolaSDK(){}HolaSDK.exec=function(t,e){if(window.HolaF){window.HolaF(t,e);console.log("HolaSDK.exec:"+t+":"+(e?JSON.stringify(e):"{}"))}else{console.log("HolaSDK.exec(e):"+t+":"+(e?JSON.stringify(e):"{}"))}};HolaSDK.init=function(t,e){if(HolaSDK.initialized){return}var i={};i.app_id=t;i.debug=e;HolaSDK.appID=t;HolaSDK.initialized=true;HolaSDK.startTime=Date.now();HolaSDK.exec("GameJsAdSdk.init",i);console.log("HolaSDK.init done")};HolaSDK.showAd=function(t,e,i,n){var r={};r.placement_id=HolaSDK.appID+"_"+t;r.placement_type=e;r.impression_time=i;r.closable=n;HolaSDK.exec("GameJsAdSdk.showAd",r)};HolaSDK.closeAd=function(){if(!HolaSDK.initialized)return;HolaSDK.exec("GameJsAdSdk.closeAd")};HolaSDK.share=function(t,e,i,n){var r={};r.title=t;r.description=e;HolaSDK.exec("share",r)};HolaSDK.fixTime=function(t){if(t>1e3){t=t/1e3}return t};HolaSDK.sendBarrage=function(t,e,i){var n={};n.score=t;n.level=e;n.duration=HolaSDK.fixTime(i);HolaSDK.exec("Barrage.send",n)};HolaSDK.ping=function(t,e,i){var n={};n.score=t;n.level=e;n.duration=HolaSDK.fixTime(i);HolaSDK.exec("Barrage.ping",n)};HolaSDK.onPaused=function(){if(HolaSDK.onPausedCallback){HolaSDK.onPausedCallback()}};HolaSDK.whenPaused=function(t){HolaSDK.onPausedCallback=t;HolaSDK.exec("Game.Event.onPause",HolaSDK.onPaused)};HolaSDK.onResumed=function(){if(HolaSDK.onResumedCallback){HolaSDK.onResumedCallback()}};HolaSDK.whenResumed=function(t){HolaSDK.onResumedCallback=t;HolaSDK.exec("Game.Event.onResume",HolaSDK.onResumed)};HolaSDK.onRestarted=function(){if(HolaSDK.onRestartedCallback){HolaSDK.onRestartedCallback()}};HolaSDK.whenRestarted=function(t){HolaSDK.onRestartedCallback=t;HolaSDK.exec("Game.Event.onRestart",HolaSDK.onRestarted)};HolaSDK.gameStarted=function(t){var e={};e.level=t;HolaSDK.exec("Game.Status.start",e)};HolaSDK.gamePaused=function(){HolaSDK.exec("Game.Status.pause")};HolaSDK.gameResumed=function(){HolaSDK.exec("Game.Status.resume")};HolaSDK.gameOver=function(t,e,i){var n={};n.score=t;n.level=e;n.duration=HolaSDK.fixTime(i);HolaSDK.exec("Game.Status.over",n)};HolaSDK.gameRestarted=function(){console.log("HolaSDK.gameRestarted is not supported now!!!")};HolaSDK.gameExited=function(){HolaSDK.exec("Game.Status.exit")};HolaSDK.getSDKURL=function(){return"http://game-ad-sdk.haloapps.com/static/abyhola/sdk/js_ad_sdk_loader.js?v=034&must-online=true"};window.HolaSDK=HolaSDK;function stableSortMerge(t,e){function i(t,i){var n=t.length,r=i.length,o=n+r,a=new Array(o);for(var s=0,l=0,h=0;h<o;){if(s===n)a[h++]=i[l++];else if(l===r||e(t[s],i[l])<=0)a[h++]=t[s++];else a[h++]=i[l++]}return a}function n(t){var e=t.length,r=Math.ceil(e/2);return e<=1?t:i(n(t.slice(0,r)),n(t.slice(r)))}return n(t)}UIFrameAnimation.prototype.getSupportedImageDisplay=function(){return["scale","incenter","auto"]};UIScene.prototype.getSupportedImageDisplay=function(){return["default","scale","incenter","tile","vtile","htile","fit-width","fit-height"]};UIScene.prototype.setDebug=function(t){this.debug=t;return};UIScene.prototype.beforePaintChildren=function(t){var e=0;var i=0;var n=[];var r=null;if(!this.debug&&this.mode!=Shape.MODE_EDITING){return}for(var o=0;o<this.children.length;o++){var a=this.children[o];if(!a.isUIFootprint){continue}n.push(a)}stableSortMerge(n,function(t,e){if(t.name>e.name){return 1}if(t.name<e.name){return-1}else{return 0}});t.lineCap="round";t.lineJoin="round";t.lineWidth=5;for(var o=0;o<n.length;o++){var a=n[o];e=a.left+(a.w>>1);i=a.top+(a.h>>1);if(o===0||a.name!=n[o-1].name){if(o!=0){t.strokeStyle=r;t.stroke();t.beginPath()}t.moveTo(e,i);r=a.style.fillColor}else{t.lineTo(e,i)}}t.strokeStyle=r;t.stroke();return};UICircle.prototype.getEventNames=function(){var t=this.getParent();if(t&&(t.isUISprite||t.isUISkeletonAnimation||t.isUITransformAnimation||t.isUIFrameAnimation)){return[]}else{return UIElement.prototype.getEventNames.call(this)}};UIBox.prototype.getEventNames=UICircle.prototype.getEventNames;UIPolygon.prototype.getEventNames=UICircle.prototype.getEventNames;UISprite.prototype.getMoreSelectMark=RShape.prototype.getRotateSelectMark;UIBox.prototype.getMoreSelectMark=RShape.prototype.getRotateSelectMark;UIFrameAnimation.prototype.getMoreSelectMark=RShape.prototype.getRotateSelectMark;UISoundEffects.prototype.setParent=function(t){Shape.prototype.setParent.call(this,t);var e=this.getWindowManager();if(e&&!e.soundEffectURLs){e.setSoundEffectURLs("/cantk-game/assets/sound/disappear.mp3")}return this};UISoundMusic.prototype.setParent=function(t){Shape.prototype.setParent.call(this,t);var e=this.getWindowManager();if(e&&!e.soundMusicURLs){e.setSoundMusicURLs("/cantk-game/assets/sound/bg.mp3")}return this};root.CanTK=CanTK;UIElement.prototype.setsd=function(t){window.statisticsData=t;return this};UIElement.prototype.sendsd=function(t){window.statisticsStr=t;setTimeout(window.sendStatistics,10)}}).call(this);
